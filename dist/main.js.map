{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../commons/js/isArray.js","webpack:///../commons/js/isString.js","webpack:///../commons/js/isUndefined.js","webpack:///../commons/js/isNull.js","webpack:///../commons/js/isTypeObject.js","webpack:///../commons/js/isObject.js","webpack:///../commons/arr/from.js","webpack:///../commons/js/isEmpty.js","webpack:///../commons/js/isTypeArray.js","webpack:///../commons/arr/remove.js","webpack:///../commons/js/instanceof.js","webpack:///../commons/js/isNumber.js","webpack:///../commons/js/isFunction.js","webpack:///../commons/js/isTypeFunction.js","webpack:///../commons/js/isPlainObject.js","webpack:///../commons/js/isBoolean.js","webpack:///../commons/js/isNumeric.js","webpack:///../commons/obj/each.js","webpack:///../commons/obj/even.js","webpack:///../commons/obj/compareCallback.js","webpack:///../jsen/src/ExprInterface.js","webpack:///../jsen/src/Expr/ReferenceInterface.js","webpack:///../jsen/src/Expr/CallInterface.js","webpack:///../jsen/src/Jsen.js","webpack:///../commons/arr/flatten.js","webpack:///../commons/arr/first.js","webpack:///../commons/arr/last.js","webpack:///../commons/arr/pushUnique.js","webpack:///../commons/obj/getAllPropertyNames.js","webpack:///../commons/obj/getPrototypeChain.js","webpack:///../commons/obj/mergeCallback.js","webpack:///../commons/obj/merge.js","webpack:///../commons/obj/copyPlain.js","webpack:///../jsen/src/Lexer.js","webpack:///../jsen/src/Contexts.js","webpack:///../commons/str/wrapped.js","webpack:///../commons/str/after.js","webpack:///../commons/str/before.js","webpack:///../commons/str/beforeLast.js","webpack:///../commons/str/unwrap.js","webpack:///../jsen/src/Expr/AbstractionInterface.js","webpack:///../jsen/src/Expr/Abstraction.js","webpack:///../jsen/src/Expr/ArrInterface.js","webpack:///../jsen/src/Expr/Arr.js","webpack:///../jsen/src/Expr/ArgumentsInterface.js","webpack:///../jsen/src/Expr/Arguments.js","webpack:///../commons/arr/unique.js","webpack:///../jsen/src/Expr/AssertionInterface.js","webpack:///../jsen/src/Expr/Assertion.js","webpack:///../jsen/src/Expr/AssignmentInterface.js","webpack:///../jsen/src/Expr/Assignment.js","webpack:///../jsen/src/Expr/BoolInterface.js","webpack:///../jsen/src/Expr/Bool.js","webpack:///../jsen/src/Expr/Call.js","webpack:///../jsen/src/Expr/CommentsInterface.js","webpack:///../jsen/src/Expr/Comments.js","webpack:///../jsen/src/Expr/ComparisonInterface.js","webpack:///../jsen/src/Expr/Comparison.js","webpack:///../jsen/src/Expr/ConditionInterface.js","webpack:///../jsen/src/Expr/Condition.js","webpack:///../jsen/src/Expr/DeletionInterface.js","webpack:///../jsen/src/Expr/Deletion.js","webpack:///../commons/obj/copy.js","webpack:///../jsen/src/Expr/FuncInterface.js","webpack:///../jsen/src/Expr/Func.js","webpack:///../commons/arr/intersect.js","webpack:///../jsen/src/Expr/MathInterface.js","webpack:///../jsen/src/Expr/Math.js","webpack:///../jsen/src/Expr/NumInterface.js","webpack:///../jsen/src/Expr/Num.js","webpack:///../jsen/src/Expr/ObjInterface.js","webpack:///../jsen/src/Expr/Obj.js","webpack:///../jsen/src/Expr/PresenceInterface.js","webpack:///../jsen/src/Expr/Presence.js","webpack:///../jsen/src/Expr/Reference.js","webpack:///../jsen/src/Expr/ReturnInterface.js","webpack:///../jsen/src/Expr/Return.js","webpack:///../jsen/src/Expr/StatementsInterface.js","webpack:///../jsen/src/Expr/Statements.js","webpack:///../jsen/src/Expr/StrInterface.js","webpack:///../jsen/src/Expr/Str.js","webpack:///../jsen/src/index.js","webpack:///../commons/obj/from.js","webpack:///../reflex/src/internal/Event.js","webpack:///../reflex/src/internal/QueryEvent.js","webpack:///../reflex/src/internal/Fireable.js","webpack:///../reflex/src/internal/Firebase.js","webpack:///../reflex/src/internal/Trap.js","webpack:///../reflex/src/internal/TrapBase.js","webpack:///../reflex/src/internal/MutationEvent.js","webpack:///../reflex/src/internal/ObserverBase.js","webpack:///../reflex/src/unobserve.js","webpack:///../reflex/src/disconnect.js","webpack:///../commons/js/getType.js","webpack:///../commons/obj/get.js","webpack:///../reflex/src/internal/Observer.js","webpack:///../commons/arr/crossJoin.js","webpack:///../reflex/src/observe.js","webpack:///../reflex/src/connect.js","webpack:///../reflex/src/transaction.js","webpack:///../reflex/src/get.js","webpack:///../commons/arr/all.js","webpack:///../reflex/src/has.js","webpack:///../reflex/src/_setProp.js","webpack:///../reflex/src/set.js","webpack:///../reflex/src/init.js","webpack:///../reflex/src/_getProps.js","webpack:///../reflex/src/keys.js","webpack:///../reflex/src/trap.js","webpack:///../reflex/src/def.js","webpack:///../reflex/src/del.js","webpack:///../reflex/src/index.js","webpack:///../reflex/src/build.js","webpack:///../reflex/src/untrap.js","webpack:///../reflex/src/ownKeys.js","webpack:///./src/params.js","webpack:///./src/core/createElement.js","webpack:///./src/composing/recomposeDirectives.js","webpack:///./src/composing/recompose.js","webpack:///./src/composing/recomposeNodes.js","webpack:///./src/composing/Matrix.js","webpack:///./src/directive/Rule.js","webpack:///./src/directive/RuleSheet.js","webpack:///../commons/obj/inherit.js","webpack:///./src/core/schema.js","webpack:///./src/core/Core.js","webpack:///./src/core/disconnectedCallback.js","webpack:///./src/Chtml.js","webpack:///./src/composing/parseNamespace.js","webpack:///../commons/arr/following.js","webpack:///./src/composing/defineBundleElements.js","webpack:///./src/composing/createBundleMatrix.js","webpack:///../commons/arr/divide.js","webpack:///./src/composing/defineImportElements.js","webpack:///./src/index.js","webpack:///./src/browser-entry.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","Array","isArray","val","arguments","length","undefined","castObject","keys","slice","values","arr","indexOf","itm","limit","splice","obj","classB","mixinTest","classA","Function","prototypes","reduce","prevAns","getPrototypeOf","constructor","toString","isNaN","returnValue","forEach","k","callback","parseFloat","_even","obj1","obj2","assertion","depth","obj1Keys","obj2Keys","result","contn","v1","testPass","v2","netComparison","push","contrast","returnOnFirstFalse","Expr","jsenType","this","Super","comments","meta","vars","Interface","ExprInterface","Jsen","expr","Parsers","params","Static","parsers","grammars","varsScope","parsed","parse","_expr","_Parsers","ReferenceInterface","CallInterface","context","explain","assert","Error","_flatten","withObjects","acc","concat","count","firsts","amount","reverse","items","keysAll","until","prototypalChain","getOwnPropertyNames","mergeCallback","objs","deepProps","isReplace","withSymbols","shift","valAtObj1","valAtObj2","getOwnPropertyDescriptor","e","filter","Lexer","str","delims","options","instance","$cache","lex","tokens","matches","$str","$options","blocks","$blocks","quotes","$quotes","$comments","runtime","nesting","maxDepth","matchesi","cache","_evalCharsAt","join","charWidth","commentTest","quoteTest","nestingTest","openComment","_testQuotes","openQuote","_testComments","ending","_push","chars","starting","preserveComments","_testNesting","stopChar","_testChars","stopChars","stopCharForward","substr","matchedDelim","preserveDelims","quote","block","match","RegExp","Math","max","testList","test","useRegex","ci","toLowerCase","target","splitSeries","regParse","prop","trap","bindThis","_set","cntxt","set","_has","deleteProperty","del","prop2","args","fn","exec","apply","execUnknown","map","has","subject","startsWith","openingTag","endsWith","closingTag","search","pos","afterLast","lastIndexOf","beforeLast","Abstraction","AbstractionInterface","super","eval","parseCallback","Arr","ArrInterface","exprs","newExprs","exprA","uniqueSoFar","exprB","even","trim","split","Arguments","ArgumentsInterface","list","arg","index","self","Assertion","AssertionInterface","logic","operators","toUpperCase","isOr","or","isNor","nor","isAnd","and","isNand","nand","lastResult","trues","Assignment","AssignmentInterface","reference","operator","getEval","Bool","BoolInterface","state","Call","pop","Comments","CommentsInterface","type","_comments","commentPlacement","splits","_beforeLast","line","replace","console","log","commenta","Comparison","ComparisonInterface","operand1","operand2","compare","oper","strict","exact","is","isNull","equalsTo","strictlyNotEqualsTo","notEqualsTo","relative","lesserThan","greaterThan","lesserThanOrEqualsTo","greaterThanOrEqualsTo","between","partial","contains","any","in","Condition","ConditionInterface","onTrue","onFalse","Deletion","DeletionInterface","red","Func","FuncInterface","paramters","statements","arrowFunctionFormatting","parentParams","ownParams","nameInParent","nameInSelf","defaultValInParent","defaultValInSelf","sup","localContext","defaultVal","multipleContexts","headNoWrap","head","bodyNoWrap","body","b","funcHead","funcBody","param","paramSplit","arr2","val1","val2","MathInterface","currentTotal","sub","Num","NumInterface","int","dec","parseInt","Obj","ObjInterface","entries","_entriesSplit","entry","Presence","PresenceInterface","Reference","backticks","sourceContext","parts","subjectContext","separator","nameSplit","isContext","Return","ReturnInterface","exprLc","Statements","StatementsInterface","stmts","delim","stmt","Str","StrInterface","details","$","Event","disconnected","fireables","currentlyFiringEvents","fireable","tags","_fireable","query","observer","handler","Base","firebases","firebaseKey","Fireable","evt","next","total","Firebase","defaultHandler","_args","fire","createForTarget","getForTarget","data","fields","srcEvt","dataEven","originatingTarget","originatingType","originatingFields","originatingData","_originatingData","field","path","_path","originatingCreated","originatingDeleted","_data","created","deleted","propagationStopped","defaultPrevented","promisesInstance","promises","promise","Promise","all","rspns","proms","isEvent","stopPropagation","preventDefault","findFireables","firebase","originalCallback","removeFireable","unobserve","reciever","_ctxt","ctxt","_key","exists","fieldsArray","isDynamicField","diff","fireCallback","fieldData","originatingField","_value","fieldQuery","currentValue","response","prevValue","dynamicFieldOutcomes","observedField","inputOriginatingField","inputOriginatingFieldSplit","observedDynamicFieldOutcome","seg","observeUp","observeDown","currTable","column","newTable","row","_row","addFireable","Observer","observe","_entries","base","MutationEvent","bubbling","targets","targetCopy","setData","_setData","delData","_delData","mutationBase","initialKeys","currentKeys","changedKeys","includes","disconnect","connect","returnEvent","trapBase","defaultGet","QueryEvent","transaction","prevTest","defaultHas","_state","keysOrPayload","handleSet","descriptor","define","success","defaultSet","_success","successStates","_setProp","onGetFire","onSetFire","currentDescriptor","writable","newValue","defaultKeys","_keys","ownKeys","_getProps","defaultDel","build","_init","init","Trap","untrap","def","env","factory","attrMap","model","related","bindings","namespace","superrole","subrole","nocompose","bundle","tagMap","jsen","jsenp","import","remodelCallback","dataKey","globalParamsAttrs","hideDefsheet","contextDocument","document","el","source","temp","createElement","innerHtml","firstChild","querySelector","norecompose","elTo","hasAttribute","getAttribute","recomposeCallback","disposition","elFrom","appendOrPrepend","b_attr","a_attr","jointList","setAttribute","attr","jointDefs","attributes","elToDefs","shadowRoot","children","node","elFromDefs","textContent","prepend","cloneNode","elFromNs","elToNs","elToRoles","recomposeDirectives","replacementNode","applicableContextRoles","applicableReplacementNodeRoles","replacementNodeRole","_applicableContextRoles","contextRole","CSSEscape","CSS","escape","slotNodes","contextSelector","slotNodeSelector","querySelectorAll","closest","replaceWith","append","recomposeNodes","sources","carry","collections","subMatrix","nsKey","nsArray","nsDrill","enter","flag","allowChaining","argsExpr","a","error","opts","_opts","ruleSplit","vf","flags","atRules","atRule","specifiers","condition","rule","rewriteWithAtRuleCondition","ruleChaining","rules","atRuleConditionAbs","atRuleName","atRuleCondition","atRuleSpecifiers","current","existing","isDuplicate","overridden","key_a","value_a","value_aUnwrapped","key_b","value_b","value_bUnwrapped","incase_a","important_a","incase_b","important_b","ruleObj","ruleToJsen","toJsenString","finalRule","atRuleSplits","part","Schema","std","html","singleton","caption","col","colgroup","dd","implicitRole","dt","figcaption","legend","li","optgroup","option","rp","rt","summary","track","tbody","td","tfoot","thead","tr","abbr","address","area","article","acceptableRoles","aside","audio","bdi","bdo","blockquote","br","button","canvas","cite","code","datalist","dfn","dialog","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","img","input","ins","kbd","label","link","main","mark","math","menu","names","meter","nav","noscript","ol","output","picture","pre","progress","q","ruby","samp","script","section","select","slot","small","span","strong","style","svg","table","template","textarea","time","title","u","ul","var","video","wbr","aria","banner","contentinfo","complementary","navigation","listitem","elTagName","nodeName","expandRules","roleInclusive","elSchema","currentElCategories","role","valid","contextModel","HTMLElement","getContentModelFor","nodeCategories","getCategoriesFor","allowedNode","disallowedNode","scope","nodeSchema","contextCategories","parentNode","assertNodeBelongsInContentModel","rles","categories","roles","prev","getNodes","modelRoles","_related","freeze","nodeNames","getRelatedNode","getExplicitNode","getImplicitNode","addNode","_objFrom","requestNodeName","rolecase","matchedNode","closestSuper","_matchedNode","closestSuperSelector","nodeSelector","isSameNode","tries","schema","selector","tagname","trie","assertNodeBelongsInScopeAs","nodeComponent","_node","disconnectedCallback","MutationObserver","called","mutations","removedNodes","childList","namespaceParse","roadmap","namespaceStr","subnamespace","parseNamespace","exits","autoEval","newState","oldState","evalReturn","dataBlockScript","rulesheet","applicableRules","bindingsPush","initialRendering","remove","changes","remodel","srcModel","existingNode","isNewNode","nodeNamespaceArray","nodeEl","following","from","lastReference","after","rotate","_nodeName","before","destroy","unbind","then","catch","binding","contextWindow","bundleElements","Window","customElements","HTMLTemplateElement","oldValue","load","src","content","warn","fetch","ok","text","reject","statusText","innerHTML","dispatchEvent","setTimeout","extends","defineBundleElements","contentLoadedPromise","resolve","readyState","addEventListener","bundles","loadingBundles","readyBundles","passes","failures","loadingBundlesPromise","fetchedBundles","warnedEarlyBundleAccess","promiseReciever","anticyclicBundlesQuery","bundleMatrix","superEl","bundleIndex","_namespace","find","recompose","message","createBundleMatrix","processed","shouldResolve","replacement","namespaceAttr","__namespace","resolved","attachShadow","innnerText","defineImportElements","waitForBundles","resolveInheritance","superNs","isImport","_el","window","WebNative","Chtml","Reflex"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","\r\n/**\r\n * Tells if val is of type \"array\".\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val);\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'string';\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"undefined\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn arguments.length && (val === undefined || typeof val === 'undefined');\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is null.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === null || val === '';\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"object\".\r\n * This holds true for anything object, including built-ins.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val) || typeof val === 'object';\r\n};\r\n","\r\n/**\r\n * Tells if val is pure object.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !Array.isArray(val) && typeof val === 'object' && val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isTypeArray from '../js/isTypeArray.js';\r\nimport _isEmpty from '../js/isEmpty.js';\r\nimport _isObject from '../js/isObject.js';\r\n\r\n/**\r\n * Casts an array-like object to an array.\r\n *\r\n * @param mixed \tval\r\n * @param bool\t \tcastObject\r\n *\r\n * @return array\r\n */\r\nexport default function(val, castObject = true) {\r\n\tif (_isArray(val)) {\r\n\t\treturn val;\r\n\t};\r\n\tif (!castObject && _isObject(val)) {\r\n\t\treturn [val];\r\n\t};\r\n\tif (val !== false && val !== 0 && _isEmpty(val)) {\r\n\t\treturn [];\r\n\t};\r\n\tif (_isTypeArray(val)) {\r\n\t\treturn Array.prototype.slice.call(val);\r\n\t};\r\n\tif (_isObject(val)) {\r\n\t\treturn Object.values(val);\r\n\t};\r\n\treturn [val];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from './isNull.js';\r\nimport _isUndefined from './isUndefined.js';\r\nimport _isTypeObject from './isTypeObject.js';\r\n\r\n/**\r\n * Tells if val is empty in its own type.\r\n * This holds true for NULLs, UNDEFINED, FALSE, 0,\r\n * objects without keys, empty arrays.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isNull(val) || _isUndefined(val) || val === false || val === 0 \r\n\t\t|| (_isTypeObject(val) && !Object.keys(val).length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from './isString.js';\r\nimport _isUndefined from './isUndefined.js';\r\n\r\n/**\r\n * Tells if val is \"array-like\".\r\n * This holds true for anything that has a length property.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !_isString(val) && !_isUndefined(val.length);\r\n};\r\n","\r\n/**\r\n * Removes instances of reference up to <limit> times.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \titm\r\n * @param int|bool \tlimit\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, itm, limit = false) {\r\n\tvar i = arr.indexOf(itm);\r\n\twhile (i > -1 && (limit || limit === false)) {\r\n\t\tarr.splice(i, 1);\r\n\t\tif (limit > 0) {\r\n\t\t\tlimit --;\r\n\t\t};\r\n\t\ti = arr.indexOf(itm);\r\n\t};\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * Instanceof that supports our multi-inheritance implementstion.\r\n *\r\n * @param object\t \tobj1\r\n * @param object\t \tclassB\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj, classB) {\r\n\tif (!obj) {\r\n\t\treturn false;\r\n\t}\r\n\tif (obj instanceof classB) {\r\n\t\treturn true;\r\n\t}\r\n\tvar mixinTest = classA => {\r\n\t\twhile (classA && classA !== Function.prototype) {\r\n\t\t\tif (classA === classB || (classA.prototypes && classA.prototypes.reduce((prevAns, prototype) => prevAns || (prototype === classB) || mixinTest(prototype), false))) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tclassA = Object.getPrototypeOf(classA);\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\treturn mixinTest(obj.constructor);\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"number\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'number';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeFunction from './isTypeFunction.js';\r\n\r\n/**\r\n * Tells if val is of type \"function\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isTypeFunction(val) || (val && {}.toString.call(val) === '[object function]');\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"function\".\r\n * This holds true for both regular functions and classes.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'function';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from './isObject.js';\r\n\r\n/**\r\n * Tells if an object is direct instance of Object.prototype.\r\n * Quite useful in differentiating native objects and class instances from plain objects ({}).\r\n *\r\n * @param object \tobj\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj) {\r\n\treturn _isObject(obj) && Object.getPrototypeOf(obj) === Object.prototype;\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"boolean\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === true || val === false;\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\" or a numeric string.\r\n * This holds true for both numbers and numeric strings.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val !== true && val !== false && val !== null && val !== '' && !isNaN(val * 1);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\n\r\n/**\r\n * Loops thru obj flatly with a callback function.\r\n * Stops when callback returns a non-undefined value.\r\n *\r\n * @param array|object \t\t\tobj \t\t\tThe array or object to iterate.\r\n * @param function \t\t\t\tcallback \t\tThe callback function.\r\n *\r\n * @return mixed|null\t\t\tAny non-null return from callback\r\n */\r\nexport default function(obj, callback) {\r\n\tvar returnValue = undefined;\r\n\tif (_isTypeObject(obj)) {\r\n\t\tObject.keys(obj).forEach((k, i) => {\r\n\t\t\tif (returnValue !== false) {\r\n\t\t\t\treturnValue = callback(_isNumeric(k) ? parseFloat(k) : k, obj[k], i);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn returnValue;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNumber from '../js/isNumber.js';\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isPlainObject from '../js/isPlainObject.js';\r\nimport _compareCallback from './compareCallback.js';\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n * @param int\t\t\t\tdepth\r\n *\r\n * @return bool\r\n */\r\nconst _even = function(obj1, obj2, assertion = true, depth = 1) {\r\n\tif (_isArray(obj1) && _isArray(obj2) && obj1.length !== obj2.length) {\r\n\t\treturn !assertion;\r\n\t}\r\n\tif (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tvar obj1Keys = Object.keys(obj1);\r\n\t\tvar obj2Keys = Object.keys(obj2);\r\n\t\tif (!obj1Keys.length && !obj2Keys.length) {\r\n\t\t\t// Objects that won't show keys must be compared by instance\r\n\t\t\t// Many native objects won't. So we can't judge by keys alone.\r\n\t\t\treturn _isPlainObject(obj1) && _isPlainObject(obj2) \r\n\t\t\t\t? assertion\r\n\t\t\t\t: (obj1 === obj2) === assertion;\r\n\t\t}\r\n\t\tif (!_even(obj1Keys, obj2Keys)) {\r\n\t\t\treturn !assertion;\r\n\t\t}\r\n\t}\r\n\tif (depth > 0 && ((_isArray(obj1) && _isArray(obj2)) || (_isObject(obj1) && _isObject(obj2)))) {\r\n\t\tvar result = _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\t\treturn _even(v1, v2, assertion, depth - 1);\r\n\t\t}, false/*netComparison*/, false/*contrast*/, true/*returnOnFirstFalse*/);\r\n\t\treturn _isArray(result) \r\n\t\t\t? result.length === obj1.length && result.length === obj2.length \r\n\t\t\t: (_isObject(result) && _isObject(obj1) \r\n\t\t\t\t? Object.keys(result).length === Object.keys(obj1).length && Object.keys(result).length ===  Object.keys(obj2).length \r\n\t\t\t\t: result);\r\n\t}\r\n\treturn _isFunction(assertion) ? assertion(obj1, obj2) : (\r\n\t\t_isNumber(obj1) && _isNumber(obj2) && isNaN(obj1) && isNaN(obj2) \r\n\t\t\t? assertion \r\n\t\t\t: (obj1 === obj2) === assertion\r\n\t);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _even;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isBoolean from '../js/isBoolean.js';\r\nimport _each from './each.js';\r\n\r\n/**\r\n * Gets the match(es) between (members of) two values;\r\n * assertion optionally custom.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetComparison\r\n * @param bool\t\t\t\tcontrast\r\n * @param bool\t\t\t\treturnOnFirstFalse\r\n *\r\n * @return bool|array|object\r\n */\r\nexport default function(obj1, obj2, assertion = true, netComparison = true, contrast = false, returnOnFirstFalse = false) {\r\n\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\tvar result = [];\r\n\t\tvar contn = true;\r\n\t\tobj1.forEach(v1 => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = false;\r\n\t\t\t_each(obj2, (k, v2) => {\r\n\t\t\t\tif (!testPass || (netComparison && _isTypeObject(v1))) {\r\n\t\t\t\t\ttestPass = assertion(v1, v2);\r\n\t\t\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\t\t\ttestPass = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_isTypeObject(testPass) && netComparison) {\r\n\t\t\t\t\t\t// Further recursions should use this testPass as v1\r\n\t\t\t\t\t\tv1 = testPass;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult.push(netComparison ? testPass : v1);\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult.push(testPass);\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult.push(v1);\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tif (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tvar result = {};\r\n\t\tvar contn = true;\r\n\t\tObject.keys(obj1).forEach(k => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = assertion(obj1[k], obj2[k]);\r\n\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\ttestPass = false;\r\n\t\t\t}\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult[k] = netComparison ? testPass : obj1[k];\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult[k] = testPass;\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult[k] = obj1[k];\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '@web-native-js/commons/js/isObject.js';\r\nimport _even from '@web-native-js/commons/obj/even.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ExprInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Compares the current instance with another object.\r\n\t *\r\n\t * @param object Expr\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\teven(Expr) {\r\n\t\tif (_isObject(Expr) && Expr.jsenType === this.jsenType) {\r\n\t\t\treturn _even(Expr, this);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Inherits properties from a super Expr.\r\n\t *\r\n\t * @param ExprInterface Super\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tinherit(Super) {\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds comments to the instance.\r\n\t *\r\n\t * @param string\t comments\r\n\t *\r\n\t * @return this\r\n\t */\r\n\twithComments(comments) {\r\n\t\tif (!this.meta) {\r\n\t\t\tthis.meta = {};\r\n\t\t}\r\n\t\tthis.meta.comments = comments;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds variables to the instance.\r\n\t *\r\n\t * @param array\t\t vars\r\n\t *\r\n\t * @return this\r\n\t */\r\n\twithVars(vars) {\r\n\t\tif (!this.meta) {\r\n\t\t\tthis.meta = {};\r\n\t\t}\r\n\t\tthis.meta.vars = vars;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Evaluates the expression instance for a result,\r\n\t * optionally in the context of an object.\r\n\t *\r\n\t * @param object context\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t//eval(context = null, trap = {})\r\n\t\r\n\t/**\r\n\t * Serializes the expression instance back to a string,\r\n\t * optionally in the context of an object.\r\n\t *\r\n\t * @param object context\r\n\t *\r\n\t * @return string\r\n\t */\r\n\t//toString(context = null)\r\n\t\r\n\t/**\r\n\t * SAttempts to parse a string into the class instance.\r\n\t *\r\n\t * @param string expr\r\n\t * @param object params\r\n\t *\r\n\t * @return ExprInterface\r\n\t */\r\n\t//static parse(expr, params = {})\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ReferenceInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Reference'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * CallInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'CallExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _remove from '@web-native-js/commons/arr/remove.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _instanceof from '@web-native-js/commons/js/instanceof.js';\r\nimport ReferenceInterface from './Expr/ReferenceInterface.js';\r\nimport CallInterface from './Expr/CallInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Jsen (base) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Jsen = class {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, Parsers, params = {}, Static = Jsen) {\r\n\t\tif (!params.meta) {\r\n\t\t\tparams.meta = {vars: []};\r\n\t\t}\r\n\t\tif (expr.length) {\r\n\t\t\tvar parsers = Object.values(Parsers || Static.grammars);\r\n\t\t\tfor (var i = 0; i < parsers.length; i ++) {\r\n\t\t\t\t// From this point forward, all vars is within current scope\r\n\t\t\t\tvar varsScope = params.meta && _isArray(params.meta.vars) ? params.meta.vars.length : 0;\r\n\t\t\t\tvar parsed = parsers[i].parse(expr, (_expr, _Parsers) => Jsen.parse(_expr, _Parsers, params, Static));\r\n\t\t\t\t// Add/remove vars to scope\r\n\t\t\t\tif (parsed && params.meta) {\r\n\t\t\t\t\tif (!parsed.meta) {\r\n\t\t\t\t\t\tparsed.meta = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Reap vars into scope expr\r\n\t\t\t\t\tparsed.meta.vars = params.meta.vars.slice(varsScope);\r\n\t\t\t\t\t// Add vars to scope\r\n\t\t\t\t\tif (_instanceof(parsed, ReferenceInterface) || _instanceof(parsed, CallInterface)) {\r\n\t\t\t\t\t\t_remove(parsed.meta.vars, parsed.context);\r\n\t\t\t\t\t\t_remove(params.meta.vars, parsed.context);\r\n\t\t\t\t\t\tparams.meta.vars.push(parsed);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (parsed && _isArray(params.explain)) {\r\n\t\t\t\t\tparams.explain.push(expr + ' >>------------->> ' + parsed.jsenType);\r\n\t\t\t\t}\r\n\t\t\t\tif (parsed) {\r\n\t\t\t\t\treturn parsed;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (params.assert === false) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthrow new Error('[Syntax error:] ' + expr);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Jsen;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\n\r\n/**\r\n * Flattens a nested array to the given depth.\r\n *\r\n * @param array \tarr\r\n * @param int \t \tdepth\r\n * @param bool \t \twithObjects\r\n *\r\n * @return array\r\n */\r\nconst _flatten = function(arr, depth = 1, withObjects = true) {\r\n\tif (!_isNumeric(depth) || depth <= 0) {\r\n\t\treturn arr;\r\n\t};\r\n\tif (!_isArray(arr) && _isObject(arr) && withObjects) {\r\n\t\tarr = Object.values(arr);\r\n\t};\r\n\tif (!_isArray(arr)) {\r\n\t\treturn arr;\r\n\t};\r\n\treturn arr.reduce((acc, val) => _isArray(val) || (_isObject(val) && withObjects) \r\n\t\t? acc.concat(_flatten(!_isArray(val) ? Object.values(val) : val, depth - 1, withObjects)) \r\n\t\t: acc.concat(val), []);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _flatten;","\r\n/**\r\n * Returns THE FIRST ENTRY OR A NUMBER OF ENTRIES counting forward from the begining.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nexport default function(arr, amount = 1) {\r\n\tvar count = 0;\r\n\tarr.forEach(itm => {\r\n\t\tcount ++;\r\n\t});\r\n\tvar firsts = arr.slice(arr.length - count, amount);\r\n\treturn arguments.length > 1 ? firsts : firsts[0];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _first from './first.js';\r\n\r\n/**\r\n * Returns THE LAST ENTRY OR A NUMBER OF ENTRIES counting forward to the end.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nexport default function(arr, amount = 1) {\r\n\treturn arguments.length > 1\r\n\t\t? _first(arr.slice().reverse(), amount).reverse()\r\n\t\t: _first(arr.slice().reverse());\r\n};\r\n","\r\n/**\r\n * Adds an item if not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...itms\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...items) {\r\n\titems.forEach(itm => {\r\n\t\tif (arr.indexOf(itm) < 0) {\r\n\t\t\tarr.push(itm);\r\n\t\t}\r\n\t});\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _pushUnique from '../arr/pushUnique.js';\r\nimport _getPrototypeChain from './getPrototypeChain.js';\r\n\r\n/**\r\n * Eagerly retrieves object members all down the prototype chain.\r\n *\r\n * @param object\t \tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return array\r\n */\r\nexport default function(obj, until) {\r\n\tvar keysAll = [];\r\n\t_getPrototypeChain(obj, until).forEach(obj => {\r\n\t\t_pushUnique(keysAll, ...Object.getOwnPropertyNames(obj));\r\n\t});\r\n\treturn keysAll;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the prototype chain.\r\n *\r\n * @param object \t\tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj, until) {\r\n\tuntil = until || Object.prototype;\r\n\tuntil = until && !_isArray(until) ? [until] : until;\r\n\t// We get the chain of inheritance\r\n\tvar prototypalChain = [];\r\n\tvar obj = obj;\r\n\twhile((obj && (!until || until.indexOf(obj) < 0) && obj.name !== 'default')) {\r\n\t\tprototypalChain.push(obj);\r\n\t\tobj = obj ? Object.getPrototypeOf(obj) : null;\r\n\t}\r\n\treturn prototypalChain;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _getAllPropertyNames from './getAllPropertyNames.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function mergeCallback(objs, callback, deepProps = false, isReplace = false, withSymbols = true) {\r\n\tvar depth = 0;\r\n\tvar obj1 = objs.shift();\r\n\tif (_isNumeric(obj1) || obj1 === true || obj1 === false) {\r\n\t\tdepth = obj1;\r\n\t\tobj1 = objs.shift();\r\n\t}\r\n\tif (!objs.length) {\r\n\t\tthrow new Error('_merge() requires two or more array/objects.');\r\n\t}\r\n\tobjs.forEach((obj2, i) => {\r\n\t\tif (!_isTypeObject(obj2) && !_isFunction(obj2)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t(deepProps ? _getAllPropertyNames(obj2) : Object.getOwnPropertyNames(obj2)).forEach(key => {\r\n\t\t\tvar valAtObj1 = obj1[key];\r\n\t\t\tvar valAtObj2 = obj2[key];\r\n\t\t\tif (((_isArray(valAtObj1) && _isArray(valAtObj2)) || (_isObject(valAtObj1) && _isObject(valAtObj2))) \r\n\t\t\t&& (depth === true || depth > 0)) {\r\n\t\t\t\t// RECURSE...\r\n\t\t\t\tobj1[key] = _isArray(valAtObj1) && _isArray(valAtObj2) ? [] : {};\r\n\t\t\t\tmergeCallback([_isNumeric(depth) ? depth - 1 : depth, obj1[key], valAtObj1, valAtObj2], callback, deepProps, isReplace, withSymbols);\r\n\t\t\t} else if (callback(key, obj1, obj2, i)) {\r\n\t\t\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\t\t\tif (isReplace) {\r\n\t\t\t\t\t\tobj1[key] = valAtObj2;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj1.push(valAtObj2);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// In case we're setting a read-only property\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tif (withSymbols) {\r\n\t\t\t\t\t\t\tObject.defineProperty(obj1, key, Object.getOwnPropertyDescriptor(obj2, key));\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tobj1[key] = obj2[key];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch(e) {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\treturn obj1;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(...objs) {\r\n\treturn _mergeCallback(objs, (k, obj1, obj2) => {\r\n\t\treturn true;\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n * Copies only properties of an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tonly\r\n * @param array\t\t \texcept\r\n *\r\n * @return object\r\n */\r\nexport default function(obj, filter = []) {\r\n\treturn _mergeCallback([{}, obj], (key, obj1, obj2) => {\r\n\t\tif (!_isFunction(obj2[key])) {\r\n\t\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t\t}\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _flatten from '@web-native-js/commons/arr/flatten.js';\r\nimport _first from '@web-native-js/commons/arr/first.js';\r\nimport _last from '@web-native-js/commons/arr/last.js';\r\nimport _merge from '@web-native-js/commons/obj/merge.js';\r\nimport _even from '@web-native-js/commons/obj/even.js';\r\nimport _copyPlain from '@web-native-js/commons/obj/copyPlain.js';\r\n\r\n/**\r\n * --------------------------\r\n * TOKENIZER\r\n * --------------------------\r\n */\r\n\r\nconst Lexer = class {\r\n\r\n\t/**\r\n\t * Factory method.\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic lex(str, delims, options) {\r\n\t\tif (!_isString(str)) {\r\n\t\t\tthrow new Error('Argument1 must be a string!');\r\n\t\t}\r\n\t\t// CREATE NEW -----------------------------\r\n\t\tvar instance = new Lexer(str, options);\r\n\t\t// GIVE CACHE -----------------------------\r\n\t\tLexer.$cache[str] = Lexer.$cache[str] || [];\r\n\t\tLexer.$cache[str].push(instance);\r\n\t\t// RETURN NEW -----------------------------\r\n\t\treturn instance.lex(delims);\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method for .split().\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic split(str, delims, options) {\r\n\t\treturn Lexer.lex(str, delims, options).tokens;\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method for .match().\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic match(str, delims, options) {\r\n\t\treturn Lexer.lex(str, delims, options).matches;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a lexer instance on a string with the given options.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions:\r\n\t * @param string \t\tblocks\t\t\t\tThe strings that begin and end a nested structure\r\n\t * @param number \t\tlimit\t\t\t\tMax results to return\r\n\t * @param string \t\tbackreference\t\tA character like (\\) that prefixes non-delim characters\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tconstructor(str, options) {\r\n\t\tif (!_isString(str)) {\r\n\t\t\tthrow new Error('Lexer requires the first argument to be a string.');\r\n\t\t}\r\n\t\tthis.$str = str;\r\n\t\tthis.$options = options || {};\r\n\t\tif (!this.$options.blocks) {\r\n\t\t\tthis.$options.blocks = Lexer.$blocks;\r\n\t\t}\r\n\t\tif (!this.$options.quotes) {\r\n\t\t\tthis.$options.quotes = Lexer.$quotes;\r\n\t\t}\r\n\t\tif (!this.$options.comments) {\r\n\t\t\tthis.$options.comments = Lexer.$comments;\r\n\t\t}\r\n\t\tthis.$cache = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the instance string on the given delimeters.\r\n\t *\r\n\t * This method supports static calling,\r\n\t * in which case a string is required as the first argument.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tlex(delims, options) {\r\n\t\tvar runtime = {\r\n\t\t\tdelims: _arrFrom(delims),\r\n\t\t\toptions: _merge(true, {}, this.$options, options || {}),\r\n\t\t\tnesting: [],\r\n\t\t\tmaxDepth: 0,\r\n\t\t\tcomments: [],\r\n\t\t\ttokens: [],\r\n\t\t\tmatches: [],\r\n\t\t\tmatchesi: {},\r\n\t\t};\r\n\t\t// ASK INSTANCE CACHE ---------------------------\r\n\t\tif (runtime.options.cache !== false) {\r\n\t\t\tfor (var i = 0; i < this.$cache.length; i ++) {\r\n\t\t\t\tif (_even(this.$cache[i].delims, runtime.delims) && _even(this.$cache[i].options, runtime.options)) {\r\n\t\t\t\t\treturn _copyPlain(this.$cache[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// EVALUATE NEW --------------------------------\r\n\t\t// Iterate over each character, keep track of current row and column (of the returned array)\r\n\t\tthis._evalCharsAt(runtime, 0);\r\n\t\tif (runtime.nesting.length) {\r\n\t\t\tthrow new Error('Error parsing the string: ' + this.$str + '. Unterminated blocks: ' + _flatten(runtime.nesting).join(', ') + '');\r\n\t\t}\r\n\t\t// GIVE CACHE ----------------------------------\r\n\t\tif (runtime.options.cache !== false) {\r\n\t\t\tthis.$cache.push(runtime);\r\n\t\t}\r\n\t\t// RETURN NEW ----------------------------------\r\n\t\treturn runtime;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: evaluates and handles the character on the current cursor.\r\n\t * Advances the cursor.\r\n\t *\r\n\t * @param object \truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_evalCharsAt(runtime, i) {\r\n\t\tif (i >= this.$str.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar charWidth = 1;\r\n\t\tvar commentTest = {}, quoteTest = {}, nestingTest = {};\r\n\t\t// Quotes inside comments must be ignored\r\n\t\tif (!runtime.openComment) {\r\n\t\t\tquoteTest = this._testQuotes(runtime, i);\r\n\t\t}\r\n\t\t// Comments inside quotes must be ignored\r\n\t\tif (!runtime.openQuote) {\r\n\t\t\tcommentTest = this._testComments(runtime, i);\r\n\t\t}\r\n\t\t// Save comments\r\n\t\tif (runtime.openComment || commentTest.ending) {\r\n\t\t\t// Save only outer comments\r\n\t\t\tif (!runtime.nesting.length && !nestingTest.ending) {\r\n\t\t\t\tvar chars = commentTest.starting || commentTest.ending || this.$str[i];\r\n\t\t\t\tcharWidth = chars.length;\r\n\t\t\t\tthis._push(runtime, chars, 'comments');\r\n\t\t\t\tif (runtime.options.preserveComments) {\r\n\t\t\t\t\tthis._push(runtime, chars);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\t}\r\n\t\t} else if (runtime.openQuote || quoteTest.ending) {\r\n\t\t\t// Yes add quotes\r\n\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t} else if (runtime.options.limit && runtime.matches.length === runtime.options.limit) {\r\n\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\treturn this._evalCharsAt(runtime, i + 1);\r\n\t\t} else {\r\n\t\t\t// Nesting tags inside comments and quotes have been ignored\r\n\t\t\tnestingTest = this._testNesting(runtime, i);\r\n\t\t\t// ---------------------\r\n\t\t\t// STOP ON THIS CHARACTER...?\r\n\t\t\t// ---------------------\r\n\t\t\tvar nestingTest = this._testNesting(runtime, i);\r\n\t\t\t// STOP CHAR(S)? at top level?\r\n\t\t\tvar stopChar = this._testChars(runtime.options.stopChars || [], runtime, i);\r\n\t\t\tif (!runtime.nesting.length && stopChar !== false) {\r\n\t\t\t\truntime.options.stopChar = stopChar;\r\n\t\t\t\truntime.options.stopCharForward = this.$str.substr(i);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// ---------------------\r\n\t\t\t// Match and split now...\r\n\t\t\t// ---------------------\r\n\t\t\tif (!runtime.delims.length) {\r\n\t\t\t\t// BLOCK-BASED SPLITTING...\r\n\t\t\t\tif (runtime.nesting.length === 2 && nestingTest.starting) {\r\n\t\t\t\t\truntime.matches.push(null);\r\n\t\t\t\t\tthis._push(runtime, nestingTest.starting);\r\n\t\t\t\t\tcharWidth = nestingTest.starting.length;\r\n\t\t\t\t} else if (!runtime.nesting.length && nestingTest.ending) {\r\n\t\t\t\t\tthis._push(runtime, nestingTest.ending);\r\n\t\t\t\t\tcharWidth = nestingTest.ending.length;\r\n\t\t\t\t\truntime.matches.push(null);\r\n\t\t\t\t} else/*no-nesting flag*/ {\r\n\t\t\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// ---------------------\r\n\t\t\t\t// DELIMS-BASED SPLITTING\r\n\t\t\t\t// ---------------------\r\n\t\t\t\tif (!runtime.nesting.length && !nestingTest.ending) {\r\n\t\t\t\t\t// In case the chars at index 0 is a delim,\r\n\t\t\t\t\t// the resulting split should first have an empty string, instead of undefined\r\n\t\t\t\t\tthis._push(runtime, '');\r\n\t\t\t\t\tvar matchedDelim = this._testChars(runtime.delims, runtime, i);\r\n\t\t\t\t\tif (matchedDelim !== false) {\r\n\t\t\t\t\t\truntime.matches.push(matchedDelim);\r\n\t\t\t\t\t\truntime.matchesi[i] = matchedDelim;\r\n\t\t\t\t\t\tcharWidth = matchedDelim.length || 1;\r\n\t\t\t\t\t\tif (!runtime.options.preserveDelims) {\r\n\t\t\t\t\t\t\t// The current character is a delimiter...\r\n\t\t\t\t\t\t\t// and should not get to appending to the split series down the line\r\n\t\t\t\t\t\t\treturn this._evalCharsAt(runtime, i + (matchedDelim.length || 1));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._push(runtime, matchedDelim || this.$str[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar chars = nestingTest.starting || nestingTest.ending || this.$str[i];\r\n\t\t\t\t\tcharWidth = chars.length;\r\n\t\t\t\t\tthis._push(runtime, chars);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._evalCharsAt(runtime, i + charWidth);\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a quote start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testQuotes(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.quotes || []).forEach(quote => {\r\n\t\t\tif (this.$str.substr(i, 1) === quote) {\r\n\t\t\t\tif (!runtime.openQuote) {\r\n\t\t\t\t\truntime.openQuote = quote;\r\n\t\t\t\t\tresult.starting = quote;\r\n\t\t\t\t} else if (quote === runtime.openQuote) {\r\n\t\t\t\t\truntime.openQuote = false;\r\n\t\t\t\t\tresult.ending = quote;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a comment start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testComments(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.comments || []).forEach(block => {\r\n\t\t\tif (!runtime.openComment) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + _first(block)));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\truntime.openComment = block;\r\n\t\t\t\t\tresult.starting = m[0];\r\n\t\t\t\t}\r\n\t\t\t} else if (_last(block) === _last(runtime.openComment)) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + _last(block)));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\truntime.openComment = false;\r\n\t\t\t\t\tresult.ending = m[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a nesting start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testNesting(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.blocks || []).forEach(block => {\r\n\t\t\tvar starting = this.$str.substr(i).match(new RegExp('^' + _first(block)));\r\n\t\t\tif (starting) {\r\n\t\t\t\truntime.nesting = runtime.nesting.concat([block]);\r\n\t\t\t\tresult.starting = starting[0];\r\n\t\t\t} else if (runtime.nesting.length && _last(block) === _last(_last(runtime.nesting))) {\r\n\t\t\t\tvar ending = this.$str.substr(i).match(new RegExp('^' + _last(block)));\r\n\t\t\t\tif (ending) {\r\n\t\t\t\t\truntime.nesting = runtime.nesting.slice(0, -1);\r\n\t\t\t\t\tresult.ending = ending[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\truntime.maxDepth = Math.max(runtime.maxDepth, runtime.nesting.length);\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a delimiter or stop character on the current cursor.\r\n\t *\r\n\t * @param array\t\ttestList\r\n\t * @param object \truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t_testChars(testList, runtime, i) {\r\n\t\tfor (var k = 0; k < testList.length; k ++) {\r\n\t\t\tvar test = testList[k];\r\n\t\t\tif (runtime.options.useRegex) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + test, runtime.options.useRegex !== true ? runtime.options.useRegex : ''));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\treturn m[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ((!runtime.options.ci && this.$str.substr(i, test.length) === test)\r\n\t\t\t|| (runtime.options.ci && this.$str.substr(i, test.length).toLowerCase() === test.toLowerCase())) {\r\n\t\t\t\treturn test;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Expr helper: pushes a character or set of characters into the current split series.\r\n\t *\r\n\t * @param object \truntime\r\n\t * @param string\tchars\r\n\t * @param string\ttarget\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_push(runtime, chars, target = 'tokens') {\r\n\t\tvar splitSeries = runtime.matches.length;\r\n\t\tif (_isUndefined(runtime[target][splitSeries])) {\r\n\t\t\truntime[target][splitSeries] = '';\r\n\t\t}\r\n\t\truntime[target][splitSeries] += chars;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters and returns the tokens.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tsplit(str, delims, options) {\r\n\t\treturn this.lex(delims, options).tokens;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters and returns the matches.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions:\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tmatch(str, delims, options) {\r\n\t\treturn this.lex(delims, options).matches;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses the instance string on the given delimeters using regex.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tregParse(delims, options) {\r\n\t\treturn this.lex(delims, _merge({useRegex: true}, options || {}));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters using regex; returns the tokens.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tregSplit(delims, options) {\r\n\t\treturn this.regParse(delims, options).tokens;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Matches the instance string on the given delimeters using regex; returns the matches.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tregMatch(delims, options) {\r\n\t\treturn this.regParse(delims, options).matches;\r\n\t}\r\n};\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$blocks = [['\\\\(', '\\\\)'], ['\\\\[', '\\\\]'], ['\\\\{', '\\\\}'],];\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$quotes = ['\"', \"'\", '`',];\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$comments = [['\\\\/\\\\*', '\\\\*\\\\/'], ['\\\\/\\\\/', '(\\\\r)?\\\\n'],];\r\n\r\n/**\r\n * @var object\r\n */\r\nLexer.$cache = {};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Lexer;\r\n\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default class Contexts extends Array {\r\n\t\r\n\t/**\r\n\t * Returns a property's value from the first possessing context.\r\n\t *\r\n\t * @param string|number prop\r\n\t * @param object\t\ttrap\r\n\t * @param bool\t\t\tbindThis\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(prop, trap = {}, bindThis = true) {\r\n\t\tfor(var i = 0; i < this.length; i ++) {\r\n\t\t\tvar val;\r\n\t\t\tif (!_isUndefined(this[i])/*asking first mught not go well generally && _has(this[i], prop, trap)*/) {\r\n\t\t\t\tval = trap.get ? trap.get(this[i], prop) : this[i][prop];\r\n\t\t\t\tif (_isFunction(val) && bindThis) {\r\n\t\t\t\t\treturn val.bind(this[i]);\r\n\t\t\t\t}\r\n\t\t\t\treturn val;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Updates a property's value from the first possessing context.\r\n\t * Or adds a new context to set the property.\r\n\t *\r\n\t * @param string|number prop\r\n\t * @param mixed\t\t\tval\r\n\t * @param object\t\ttrap\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tset(prop, val, trap = {}) {\r\n\t\tconst _set = (cntxt, prop, val, trap) => {\r\n\t\t\tif (trap.set) {\r\n\t\t\t\treturn trap.set(cntxt, prop, val);\r\n\t\t\t}\r\n\t\t\tcntxt[prop] = val;\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\tfor(var i = 0; i < this.length; i ++) {\r\n\t\t\tif (!_isUndefined(this[i]) && _has(this[i], prop, trap)) {\r\n\t\t\t\treturn _set(this[i], prop, val, trap);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// No possessing context?\r\n\t\tif (1) {\r\n\t\t\t// Set to first context?\r\n\t\t\tif (_isTypeObject(this[0]) && this[0]) {\r\n\t\t\t\treturn _set(this[0], prop, val, trap);\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\t// Create new?\r\n\t\tvar cntxt = {};\r\n\t\tcntxt[prop] = val;\r\n\t\tthis.unshift(cntxt);\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Deletes a property from the first possessing context.\r\n\t *\r\n\t * @param string|number prop\r\n\t * @param object\t\ttrap\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tdel(prop, trap = {}) {\r\n\t\tfor(var i = 0; i < this.length; i ++) {\r\n\t\t\tif (!_isUndefined(this[i]) && _has(this[i], prop, trap)) {\r\n\t\t\t\tif (trap.deleteProperty || trap.del) {\r\n\t\t\t\t\treturn (trap.deleteProperty || trap.del)(this[i], prop);\r\n\t\t\t\t}\r\n\t\t\t\tdelete this[i][prop];\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Tests if a property exists in any context.\r\n\t *\r\n\t * @param string|number prop\r\n\t * @param string|number prop2\r\n\t * @param object\t\ttrap\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\thas(prop, prop2, trap = {}) {\r\n\t\tfor(var i = 0; i < this.length; i ++) {\r\n\t\t\tif (!_isUndefined(this[i]) && _has(this[i], prop, trap)) {\r\n\t\t\t\tvar context = trap.get ? trap.get(this[i], prop) : this[i][prop];\r\n\t\t\t\treturn _has(context, prop2, trap);\r\n\t\t\t}\r\n\t\t}\r\n\t\tthrow new Error('\"' + prop + '\" is undefined!');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Tests if a property exists in any context.\r\n\t *\r\n\t * @param string|number prop\r\n\t * @param array\t\t\targs\r\n\t * @param object\t\ttrap\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\texec(prop, args, trap = {}) {\r\n\t\tfor(var i = 0; i < this.length; i ++) {\r\n\t\t\tif (!_isUndefined(this[i]) && _has(this[i], prop, trap)) {\r\n\t\t\t\tvar fn = trap.get ? trap.get(this[i], prop) : this[i][prop];\r\n\t\t\t\tif (!_isFunction(fn)) {\r\n\t\t\t\t\tif (trap.exec) {\r\n\t\t\t\t\t\treturn trap.exec(this[i], prop, args);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthrow new Error('\"' + prop + '\" is not a function! (Called on type: ' + typeof this[i] + '.)');\r\n\t\t\t\t}\r\n\t\t\t\tif (trap.apply) {\r\n\t\t\t\t\treturn trap.apply(fn, this[i], args);\r\n\t\t\t\t}\r\n\t\t\t\treturn fn.apply(this[i], args);\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (trap.execUnknown) {\r\n\t\t\treturn trap.execUnknown(this, prop, args);\r\n\t\t}\r\n\t\tthrow new Error('\"' + prop + '\" is undefined! (Called on types: ' + this.map(c => typeof c).join(', ') + '.)');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Factory method for making a Contexts instance.\r\n\t *\r\n\t * @param array|object \tcntxt\r\n\t *\r\n\t * @return Contexts\r\n\t */\r\n\tstatic create(cntxt) {\r\n\t\treturn cntxt instanceof Contexts ? cntxt \r\n\t\t\t: (cntxt ? new Contexts(cntxt) : new Contexts());\r\n\t}\r\n};\r\n\r\nconst _has = (cntxt, prop, trap) => trap.has ? trap.has(cntxt, prop) : (\r\n\t _isTypeObject(cntxt) && cntxt ? prop in cntxt : !_isUndefined(cntxt[prop])\r\n);","\r\n/**\r\n * Tells if the string is warapped with the given opening and closing tags.\r\n *\r\n * @param  string  subject\r\n * @param  string  openingTag\r\n * @param  string  closingTag\r\n *\r\n * @return bool\r\n */\r\nexport default function(subject, openingTag, closingTag) {\r\n\treturn subject.startsWith(openingTag) && subject.endsWith(closingTag);\r\n};\r\n","\r\n/**\r\n * Return the remainder of a string after a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   afterLast\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search, afterLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = afterLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn '';\r\n\t}\r\n\treturn subject.substr(pos + search.length);\r\n};\r\n","\r\n/**\r\n * Return the part of a string before a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   beforeLast\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search, beforeLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = beforeLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn subject;\r\n\t}\r\n\treturn subject.substr(0, pos);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _before from './before.js';\r\n\r\n/**\r\n * Return the part of a string before last occurence of a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search) {\r\n\treturn _before(subject, search, true);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _after from './after.js';\r\nimport _beforeLast from './beforeLast.js';\r\n\r\n/**\r\n * Returns the string without the given opening and closing tags.\r\n *\r\n * @param  string  subject\r\n * @param  string  openingTag\r\n * @param  string  closingTag\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, openingTag, closingTag) {\r\n\treturn _beforeLast(_after(subject, openingTag), closingTag);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AbstractionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Abstraction'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@web-native-js/commons/str/wrapped.js';\r\nimport _unwrap from '@web-native-js/commons/str/unwrap.js';\r\nimport AbstractionInterface from './AbstractionInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Abstraction class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Abstraction = class extends AbstractionInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\treturn this.expr.eval(context, trap);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '(' + this.expr.toString(context) + ')';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Abstraction) {\r\n\t\tif (_wrapped(expr, '(', ')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(_unwrap(expr, '(', ')'))\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Abstraction;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ArrInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ArrayType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@web-native-js/commons/str/wrapped.js';\r\nimport _unwrap from '@web-native-js/commons/str/unwrap.js';\r\nimport ArrInterface from './ArrInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Array utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Arr = class extends ArrInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(exprs) {\r\n\t\tsuper();\r\n\t\tthis.exprs = exprs || [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof ArrInterface) {\r\n\t\t\tvar newExprs = Super.exprs.filter(exprA => {\r\n\t\t\t\treturn this.exprs.reduce((uniqueSoFar, exprB) => uniqueSoFar && !exprA.even(exprB), true);\r\n\t\t\t});\r\n\t\t\tthis.exprs = newExprs.concat(this.exprs);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\treturn this.exprs.map(expr => expr.eval(context, trap));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '[' + this.exprs.map(expr => expr.toString(context)).join(', ') + ']';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Arr) {\r\n\t\tif (_wrapped(expr, '[', ']') && !Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar splits = Lexer.split(_unwrap(expr, '[', ']'), [','])\r\n\t\t\t\t.map(n => n.trim()).filter(n => n).map(expr => parseCallback(expr));\r\n\t\t\treturn new Static(splits);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Arr;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ArgumentsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Arguments'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@web-native-js/commons/str/wrapped.js';\r\nimport _unwrap from '@web-native-js/commons/str/unwrap.js';\r\nimport ArgumentsInterface from './ArgumentsInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Arguments class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Arguments = class extends ArgumentsInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(list = []) {\r\n\t\tsuper();\r\n\t\tthis.list = list;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\treturn this.list.map(arg => arg.eval(context, trap));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '(' + this.list.map(arg => arg.toString(context)).join(', ') + ')';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Arguments) {\r\n\t\tvar args; expr = expr.trim();\r\n\t\tif (_wrapped(expr, '(', ')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tLexer.split(_unwrap(expr, '(', ')'), [',']).map(arg => parseCallback(arg.trim()))\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Arguments;\r\n","\r\n/**\r\n * Returns a list of unique items.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n *\t *\r\n * @return array\r\n */\r\nexport default function(arr) {\r\n\tconst distinct = (value, index, self) => {\r\n\t\treturn self.indexOf(value) === index;\r\n\t};\r\n\treturn arr.filter(distinct);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AssertionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'AssertionExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _first from '@web-native-js/commons/arr/first.js';\r\nimport _flatten from '@web-native-js/commons/arr/flatten.js';\r\nimport _unique from '@web-native-js/commons/arr/unique.js';\r\nimport AssertionInterface from './AssertionInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Assertion class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Assertion = class extends AssertionInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(exprs, logic) {\r\n\t\tsuper();\r\n\t\tthis.exprs = exprs;\r\n\t\tthis.logic = logic;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\t eval(context = null, trap = {}) {\r\n\t\tif (this.logic === '!') {\r\n\t\t\treturn !_first(this.exprs).eval(context, trap);\r\n\t\t}\r\n\t\tvar operators = _flatten(Assertion.operators);\r\n\t\tvar logic = (this.logic || '').trim().toUpperCase();\r\n\t\tvar isOr = logic === (Assertion.operators.or || '').trim().toUpperCase();\r\n\t\tvar isNor = logic === (Assertion.operators.nor || '').trim().toUpperCase();\r\n\t\tvar isAnd = logic === (Assertion.operators.and || '').trim().toUpperCase();\r\n\t\tvar isNand = logic === (Assertion.operators.nand || '').trim().toUpperCase();\r\n\t\tvar lastResult = true, trues = 0;\r\n\t\tfor(var i = 0; i < this.exprs.length; i ++) {\r\n\t\t\tlastResult = this.exprs[i].eval(context, trap);\r\n\t\t\tif (isAnd && !lastResult) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (isNand && !lastResult) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tif (isOr && lastResult) {\r\n\t\t\t\treturn lastResult;\r\n\t\t\t}\r\n\t\t\ttrues += lastResult ? 1 : 0;\r\n\t\t}\r\n\t\tif (isOr) {\r\n\t\t\t// Which is falsey,\r\n\t\t\t// by virtue of getting here\r\n\t\t\treturn lastResult;\r\n\t\t}\r\n\t\tif (isAnd || isNand) {\r\n\t\t\t// For AND and NAND, all entries must be true by now,\r\n\t\t\t// by virtue of getting here.\r\n\t\t\t// For AND, this means true; for NAND, false\r\n\t\t\treturn isAnd;\r\n\t\t}\r\n\t\t// For NOR, all entries need to be false\r\n\t\treturn isNor && trues === 0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\t toString(context = null) {\r\n\t\tif (this.logic === '!') {\r\n\t\t\treturn '!' + _first(this.exprs).toString(context);\r\n\t\t}\r\n\t\treturn this.exprs.map(expr => expr.toString(context)).join(' ' + this.logic + ' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Assertion) {\r\n\t\tif (expr.startsWith('!')) {\r\n\t\t\treturn new Static(\r\n\t\t\t\t[parseCallback(expr.substr(1))],\r\n\t\t\t\t'!'\r\n\t\t\t);\r\n\t\t}\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\tvar logic = _unique(parse.matches);\r\n\t\t\tif (logic.length > 1) {\r\n\t\t\t\tthrow new Error('\"AND\" and \"OR\" logic cannot be asserted in the same expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparse.tokens.map(expr => parseCallback(expr.trim())),\r\n\t\t\t\t_first(logic)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nAssertion.operators = {\r\n\tand: '&&',\r\n\tor: '||',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Assertion;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AssignmentInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'AssignmentExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _last from '@web-native-js/commons/arr/last.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport AssignmentInterface from './AssignmentInterface.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Assignment class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Assignment = class extends AssignmentInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, val, operator = '=') {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.val = val;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\tvar reference = this.reference.getEval(context, trap);\r\n\t\tvar val = this.val.eval(context, trap);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\treturn Contexts.create(reference.context).set(reference.name, val, trap);\r\n\t\t}\r\n\t\tthrow new Error('\"' + this + '\" is undefined!');\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.reference.toString(context), this.operator, this.val.toString(context)].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Assignment) {\r\n\t\tvar parse = Lexer.lex(expr, Static.operators);\r\n\t\tif (parse.tokens.length === 2) {\r\n\t\t\tvar reference, val;\r\n\t\t\tif (!((reference = parseCallback(parse.tokens.shift().trim())) instanceof ReferenceInterface) \r\n\t\t\t|| !(val = parseCallback(parse.tokens.shift().trim()))) {\r\n\t\t\t\tthrow new Error('Invalid assignment expression: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, val, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nAssignment.operators = [' = '];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Assignment;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * BoolInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'BooleanType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport BoolInterface from './BoolInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Bool (boolean) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Bool = class extends BoolInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(state) {\r\n\t\tsuper();\r\n\t\tthis.state = state;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn this.state.toLowerCase().trim() === 'true';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString() {\r\n\t\treturn this.state;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Bool) {\r\n\t\tvar expr = expr.toLowerCase().trim();\r\n\t\tif (expr === 'true' || expr === 'false') {\r\n\t\t\treturn new Static(expr);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Bool;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport CallInterface from './CallInterface.js';\r\nimport Arguments from './Arguments.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Call = class extends CallInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, args) {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.args = args;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\tvar reference = this.reference.getEval(context, trap);\r\n\t\tvar args = this.args.eval(context, trap);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\treturn Contexts.create(reference.context).exec(reference.name, args, trap);\r\n\t\t}\r\n\t\tthrow new Error('\"' + this + '\" is undefined!');\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.reference.toString(context) + this.args.toString(context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Call) {\r\n\t\tif (!expr.startsWith('(') && expr.endsWith(')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\tvar tokens = Lexer.split(expr, []);\r\n\t\t\tvar reference, args = tokens.pop();\r\n\t\t\tif (!((reference = parseCallback(tokens.join(''))) instanceof ReferenceInterface) \r\n\t\t\t|| !(args = parseCallback(args, [Arguments]))) {\r\n\t\t\t\tthrow new Error('Invalid call directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, args);\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Call;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * CommentsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Comments'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _after from '@web-native-js/commons/str/after.js';\r\nimport _before from '@web-native-js/commons/str/before.js';\r\nimport CommentsInterface from './CommentsInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Comments class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Comments = class extends CommentsInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(comments, type) {\r\n\t\tsuper();\r\n\t\tthis.comments = comments;\r\n\t\tthis.type = type;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Comments) {\r\n\t\tvar _comments = null;\r\n\t\tvar _expr = null;\r\n\t\tvar type = 0;\r\n\t\tvar commentPlacement = 'before';\r\n\t\t// Oneliner comments\r\n\t\tif (expr.startsWith('//')) {\r\n\t\t\tvar splits = Lexer.split(_after(expr, '//'), [\"\\r\\n\"]);\r\n\t\t\t_comments = splits.shift().trim();\r\n\t\t\t_expr = splits.shift().trim();\r\n\t\t\ttype = 1;\r\n\t\t} else if (expr.startsWith('/*')) {\r\n\t\t\tvar splits = Lexer.split(_after(expr, '/*'), [\"*/\"]);\r\n\t\t\t_comments = splits.shift().trim();\r\n\t\t\t_expr = splits.shift().trim();\r\n\t\t\ttype = 2;\r\n\t\t} else if (expr.endsWith('*/')) {\r\n\t\t\tvar splits = Lexer.split(_beforeLast(expr, '*/'), [\"/*\"]);\r\n\t\t\t_comments = splits.pop().trim();\r\n\t\t\t_expr = splits.pop().trim();\r\n\t\t\ttype = 2;\r\n\t\t\tvar commentPlacement = 'after';\r\n\t\t}\r\n\t\tif (type) {\r\n\t\t\tif (type === 2) {\r\n\t\t\t\t_comments = Lexer.split(_comments.trim(), [\"\\r\\n\"])\r\n\t\t\t\t\t.map(line => line.replace(/^[\\*]+/, ''))\r\n\t\t\t\t\t.filter(line => line.trim());\r\n\t\t\t}\r\n\t\t\tconsole.log(_comments, commentPlacement, expr);\r\n\t\t\t_comments = new Static(_comments, type);\r\n\t\t}\r\n\t\tif (_expr) {\r\n\t\t\t_expr = parseCallback(_expr);\r\n\t\t\t_expr.meta.commenta = _comments;\r\n\t\t\treturn _expr;\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Comments;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ComparisonInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ComparisonExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _flatten from '@web-native-js/commons/arr/flatten.js';\r\nimport _first from '@web-native-js/commons/arr/first.js';\r\nimport _last from '@web-native-js/commons/arr/last.js';\r\nimport _difference from '@web-native-js/commons/arr/difference.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _isObject from '@web-native-js/commons/js/isObject.js';\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _each from '@web-native-js/commons/obj/each.js';\r\nimport ComparisonInterface from './ComparisonInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Comparison class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Comparison = class extends ComparisonInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(operand1, operand2, operator) {\r\n\t\tsuper();\r\n\t\tthis.operand1 = operand1;\r\n\t\tthis.operand2 = operand2;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\treturn Comparison.compare(\r\n\t\t\tthis.operand1.eval(context, trap), \r\n\t\t\tthis.operand2.eval(context, trap), \r\n\t\t\tthis.operator\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [\r\n\t\t\tthis.operand1.toString(context), \r\n\t\t\tthis.operator, \r\n\t\t\tthis.operand2.toString(context)\r\n\t\t].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Comparison) {\r\n\t\tvar operators = _flatten(Static.operators).map(oper => ' ' + oper + ' ');\r\n\t\tvar parse = Lexer.lex(expr, operators);\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\tif (parse.tokens.length > 2) {\r\n\t\t\t\tthrow new Error('Malformed \"Comparison\" expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(_first(parse.tokens).trim()),\r\n\t\t\t\tparseCallback(_last(parse.tokens).trim()),\r\n\t\t\t\tparse.matches[0].trim()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------------------------------------------\r\n\t */\r\n\t \r\n\t/**\r\n\t * Use the operator type to compare the two operands\r\n\t *\r\n\t * @param mixed\t\toperand1\t\t\r\n\t * @param mixed\t\toperand2\t\t\r\n\t * @param string \toperator\t\t\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstatic compare(operand1, operand2, operator = '==') {\r\n\t\tif (_flatten(Comparison.operators).indexOf(operator) === -1) {\r\n\t\t\tthrow new Error('The operator \"' + operator + '\" is not recognized.');\r\n\t\t}\r\n\t\tswitch(operator) {\r\n\t\t\tcase '===':\r\n\t\t\t\treturn operand1 === operand2;\r\n\t\t\tcase '==':\r\n\t\t\tcase '=':\r\n\t\t\t\treturn operand1 == operand2;\r\n\t\t\tcase '>':\r\n\t\t\t\treturn operand1 > operand2;\r\n\t\t\tcase '<':\r\n\t\t\t\treturn operand1 < operand2;\r\n\t\t\tcase '>=':\r\n\t\t\t\treturn operand1 >= operand2;\r\n\t\t\tcase '<=':\r\n\t\t\t\treturn operand1 <= operand2;\r\n\t\t\tcase '!=':\r\n\t\t\t\treturn operand1 != operand2;\r\n\t\t\tcase '!==':\r\n\t\t\t\treturn operand1 !== operand2;\r\n\t\t\tcase '^=':\r\n\t\t\t\treturn _isString(operand1) && operand1.startsWith(operand2);\r\n\t\t\tcase '$=':\r\n\t\t\t\treturn _isString(operand1) && operand1.endsWith(operand2);\r\n\t\t\tcase '*=':\r\n\t\t\t\t// Contains\r\n\t\t\t\treturn _isArray(operand2) || _isString(operand2) ? operand1.indexOf(operand2) > -1 : false;\r\n\t\t\tcase '~=':\r\n\t\t\t\t// Contains word\r\n\t\t\t\treturn _isString(operand1) && _isString(operand2) && (' ' + operand1 + ' ').indexOf(' ' + operand2 + ' ') > -1;\r\n\t\t\tcase '>=<': // Between\r\n\t\t\t\t if (!(_isArray(operand2) && operand2.length === 2)) {\r\n\t\t\t\t\t throw new Error('A \\'Between\\' comparison requires argument 2 to be an array of exactly 2 values.');\r\n\t\t\t\t }\r\n\t\t\t\t return operand1 >= operand2[0] && operand1 <= operand2[1];\r\n\t\r\n\t\t\tcase '/**/': // Regex\r\n\t\t\t\treturn operand2.match(new RegExp(operand1));\r\n\t\t\tdefault:\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * Compares two operands for differences\r\n\t *\r\n\t * @param mixed\t\toperand1\t\t\r\n\t * @param mixed\t\toperand2\t\t\r\n\t * @param bool\t \tstrict\t\t\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstatic diff(operand1, operand2, strict) {\r\n\t\treturn !Comparison.compare(operand1, operand2, strict ? '===' : '==');\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nComparison.operators = {\r\n\texact: {\r\n\t\tis: '===',\r\n\t\tisNull: '===',\r\n\t\tequalsTo: '==',\r\n\t\tstrictlyNotEqualsTo: '!==',\r\n\t\tnotEqualsTo: '!=',\r\n\t},\r\n\trelative: {\r\n\t\tlesserThan: '<',\r\n\t\tgreaterThan: '>',\r\n\t\tlesserThanOrEqualsTo: '<=',\r\n\t\tgreaterThanOrEqualsTo: '>=',\r\n\t\tbetween: '>=<',\r\n\t},\r\n\tpartial: {\r\n\t\tstartsWith: '^=',\r\n\t\tendsWith: '$=',\r\n\t\tcontains: '*=',\r\n\t\tany: '~=',\r\n\t\tin: '~=',\r\n\t\tmatches: '/**/',\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Comparison;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ConditionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ConditionExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport ConditionInterface from './ConditionInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Condition class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Condition = class extends ConditionInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(assertion, onTrue, onFalse) {\r\n\t\tsuper();\r\n\t\tthis.assertion = assertion;\r\n\t\tthis.onTrue = onTrue;\r\n\t\tthis.onFalse = onFalse;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\treturn this.assertion.eval(context, trap) \r\n\t\t\t? this.onTrue.eval(context, trap) \r\n\t\t\t: this.onFalse.eval(context, trap);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [\r\n\t\t\tthis.assertion.toString(context), \r\n\t\t\tCondition.operators[0], \r\n\t\t\tthis.onTrue.toString(context),\r\n\t\t\tCondition.operators[1], \r\n\t\t\tthis.onFalse.toString(context)\r\n\t\t].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Condition) {\r\n\t\tvar splits = Lexer.split(expr, Static.operators);\r\n\t\tif (splits.length > 1) {\r\n\t\t\tif (splits.length === 2) {\r\n\t\t\t\tthrow new Error('Malformed ternary expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(splits[0].trim()),\r\n\t\t\t\tparseCallback(splits[1].trim()),\r\n\t\t\t\tparseCallback(splits[2].trim())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nCondition.operators = ['?', ':'];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Condition;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * DeletionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'DeleteExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _last from '@web-native-js/commons/arr/last.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport DeletionInterface from './DeletionInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Deletion class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Deletion = class extends DeletionInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, operator = 'delete') {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\tvar reference = this.reference.getEval(context, trap);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\treturn Contexts.create(reference.context).del(reference.name, trap);\r\n\t\t}\r\n\t\tthrow new Error('\"' + this + '\" is undefined!');\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.operator + ' ' + this.reference.toString(context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Deletion) {\r\n\t\tvar parse = Lexer.lex(expr, Object.values(Static.operators));\r\n\t\tif (parse.matches.length === 1 && expr.startsWith(parse.matches[0] + ' ')) {\r\n\t\t\tvar reference;\r\n\t\t\tif (!((reference = parseCallback(parse.tokens.pop().trim())) instanceof ReferenceInterface)) {\r\n\t\t\t\tthrow new Error('Invalid delete directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nDeletion.operators = {\r\n\tred: 'reduce', \r\n\tdel: 'delete',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Deletion;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n * Copies an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tfilter\r\n *\r\n * @return object\r\n */\r\nexport default function(obj, filter = []) {\r\n\tvar depth = 0;\r\n\tif (_isNumeric(arguments[0]) && _isTypeObject(arguments[1])) {\r\n\t\tdepth = arguments[0];\r\n\t\tobj = arguments[1];\r\n\t\tfilter = arguments[2] || [];\r\n\t}\r\n\treturn _mergeCallback([depth, {}, obj], (key, obj1, obj2) => {\r\n\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t}, false/*deepProps*/, false/*isReplace*/, true/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * FuncInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'FunctionType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _copy from '@web-native-js/commons/obj/copy.js';\r\nimport _each from '@web-native-js/commons/obj/each.js';\r\nimport _flatten from '@web-native-js/commons/arr/flatten.js';\r\nimport _wrapped from '@web-native-js/commons/str/wrapped.js';\r\nimport _unwrap from '@web-native-js/commons/str/unwrap.js';\r\nimport FuncInterface from './FuncInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Func class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Func = class extends FuncInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(paramters, statements, arrowFunctionFormatting = {}) {\r\n\t\tsuper();\r\n\t\tthis.paramters = paramters || {};\r\n\t\tthis.statements = statements;\r\n\t\tthis.arrowFunctionFormatting = arrowFunctionFormatting;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof FuncInterface) {\r\n\t\t\tvar parentParams = Object.keys(Super.paramters);\r\n\t\t\tvar ownParams = Object.keys(this.paramters);\r\n\t\t\tfor (var i = 0; i < Math.max(ownParams.length, parentParams.length); i ++) {\r\n\t\t\t\tvar nameInParent = parentParams[i];\r\n\t\t\t\tvar nameInSelf = ownParams[i];\r\n\t\t\t\tif (!nameInSelf && nameInParent) {\r\n\t\t\t\t\tthrow new Error('Parameter #' + i + ' (' + nameInParent + ') in parent function must be implemented.');\r\n\t\t\t\t}\r\n\t\t\t\tif (nameInSelf && nameInParent) {\r\n\t\t\t\t\tvar defaultValInParent = Super.paramters[nameInParent];\r\n\t\t\t\t\tvar defaultValInSelf = this.paramters[nameInSelf];\r\n\t\t\t\t\tif (defaultValInSelf && !defaultValInParent) {\r\n\t\t\t\t\t\tthrow new Error('Parameter #' + i + ' (' + nameInSelf + ') must not have a default value as established in parent function.');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (defaultValInSelf && defaultValInParent && defaultValInSelf.jsenType !== defaultValInParent.jsenType) {\r\n\t\t\t\t\t\tthrow new Error('Default value for parameter #' + i + ' (' + nameInSelf + ') must be of type ' + defaultValInParent.jsenType + ' as established in parent function.');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.sup = Super;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\treturn (...args) => {\r\n\t\t\tvar localContext = {};\r\n\t\t\t_each(Object.keys(this.paramters), (i, name) => {\r\n\t\t\t\tvar defaultVal = this.paramters[name];\r\n\t\t\t\tif (args.length - 1 < i && !defaultVal) {\r\n\t\t\t\t\tthrow new Error('The parameter \"' + name + '\" is required.');\r\n\t\t\t\t}\r\n\t\t\t\tlocalContext[name] = args.length > i \r\n\t\t\t\t\t? args[i] \r\n\t\t\t\t\t: (this.paramters[name] \r\n\t\t\t\t\t\t? this.paramters[name].eval(context, trap) \r\n\t\t\t\t\t\t: null);\r\n\t\t\t});\r\n\t\t\t// But this newer context should come first\r\n\t\t\tvar multipleContexts = Contexts.create(localContext).concat(Contexts.create(context));\r\n\t\t\treturn this.statements.eval(multipleContexts, trap);\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar paramters = [];\r\n\t\t_each(this.paramters, (name, value) => {\r\n\t\t\tparamters.push(name + (value ? '=' + value.toString(context) : ''));\r\n\t\t});\r\n\t\tif (this.arrowFunctionFormatting) {\r\n\t\t\tvar headNoWrap = this.arrowFunctionFormatting.head === false || (paramters.length === 1 && paramters[0].indexOf('=') === -1);\r\n\t\t\tvar bodyNoWrap = this.arrowFunctionFormatting.body === false\r\n\t\t\treturn (headNoWrap ? paramters[0] : '(' + paramters.join(', ') + ')')\r\n\t\t\t+ ' => ' + (bodyNoWrap ? this.statements.toString(context) : '{' + this.statements.toString(context) + '}');\r\n\t\t}\r\n\t\treturn 'function (' + paramters.join(', ') + ') {' + this.statements.toString(context) + '}';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Func) {\r\n\t\texpr = expr.trim();\r\n\t\tvar splits;\r\n\t\tif (expr.startsWith('function') \r\n\t\t&& (splits = Lexer.split(expr, []).slice(1).filter(b => b.trim())) && splits.length === 2) {\r\n\t\t\tvar arrowFunctionFormatting = false;\r\n\t\t\tvar funcHead = _unwrap(splits.shift().trim(), '(', ')');\r\n\t\t\tvar funcBody = _unwrap(splits.shift().trim(), '{', '}');\r\n\t\t} else if (!expr.startsWith('function') \r\n\t\t&& (splits = Lexer.split(expr, ['=>'])) && splits.length === 2) {\r\n\t\t\tvar funcHead = splits.shift().trim();\r\n\t\t\tvar funcBody = splits.shift().trim();\r\n\t\t\tvar arrowFunctionFormatting = {};\r\n\t\t\tif (_wrapped(funcHead, '(', ')')) {\r\n\t\t\t\tfuncHead = _unwrap(funcHead, '(', ')');\r\n\t\t\t} else {\r\n\t\t\t\tarrowFunctionFormatting.head = false;\r\n\t\t\t}\r\n\t\t\tif (_wrapped(funcBody, '{', '}')) {\r\n\t\t\t\tfuncBody = _unwrap(funcBody, '{', '}');\r\n\t\t\t} else {\r\n\t\t\t\tarrowFunctionFormatting.body = false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar paramters = {};\r\n\t\tLexer.split(funcHead, [',']).forEach(param => {\r\n\t\t\tvar paramSplit = param.split('=');\r\n\t\t\tif (paramSplit[1]) {\r\n\t\t\t\tparamters[paramSplit[0].trim()] = parseCallback(paramSplit[1].trim());\r\n\t\t\t} else {\r\n\t\t\t\tparamters[param.trim()] = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar statements = parseCallback(funcBody);\r\n\t\treturn new Static(paramters, statements, arrowFunctionFormatting);\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nFunc.operators = ['=>',];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Func;","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the intersection of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) !== -1\r\n\t);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * MathInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'MathExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNumeric from '@web-native-js/commons/js/isNumeric.js';\r\nimport _flatten from '@web-native-js/commons/arr/flatten.js';\r\nimport _intersect from '@web-native-js/commons/arr/intersect.js';\r\nimport _unique from '@web-native-js/commons/arr/unique.js';\r\nimport MathInterface from './MathInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Math class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Math = class extends MathInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(val, exprs) {\r\n\t\tsuper();\r\n\t\tthis.val = val;\r\n\t\tthis.exprs = exprs;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\treturn this.exprs.reduce((currentTotal, expr) => {\r\n\t\t\tvar val = expr.val.eval(context, trap);\r\n\t\t\tvar operator = expr.operator.trim();\r\n\t\t\tif ((!_isNumeric(currentTotal) || !_isNumeric(val)) && operator !== '+') {\r\n\t\t\t\tthrow new Error('Invalid Math expression: ' + this.toString() + '!');\r\n\t\t\t}\r\n\t\t\tswitch(operator) {\r\n\t\t\t\tcase '+':\r\n\t\t\t\t\treturn currentTotal + val;\r\n\t\t\t\tcase '-':\r\n\t\t\t\t\treturn currentTotal - val;\r\n\t\t\t\tcase '*':\r\n\t\t\t\t\treturn currentTotal * val;\r\n\t\t\t\tcase '/':\r\n\t\t\t\t\treturn currentTotal / val;\r\n\t\t\t}\r\n\t\t}, this.val.eval(context, trap));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.val.toString(context)].concat(\r\n\t\t\tthis.exprs.map(expr => expr.operator + ' ' + expr.val.toString(context))\r\n\t\t).join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Math) {\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1 && parse.matches.length === parse.tokens.length - 1) {\r\n\t\t\tvar operators = _unique(parse.matches);\r\n\t\t\tif (_intersect(operators, Math.operators.sup).length && _intersect(operators, Math.operators.sub).length) {\r\n\t\t\t\tthrow new Error('\"Addition/subtraction\" and \"multiplication/division\" operators cannot be used in the same expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(parse.tokens.shift().trim()),\r\n\t\t\t\tparse.tokens.map((expr, i) => {return {\r\n\t\t\t\t\toperator: parse.matches[i],\r\n\t\t\t\t\tval: parseCallback(expr.trim())\r\n\t\t\t\t};})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nMath.operators = {\r\n\tsup: ['*', '/'],\r\n\tsub: [' + ', ' - '],\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Math;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * NumInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'NumberType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNumeric from '@web-native-js/commons/js/isNumeric.js';\r\nimport NumInterface from './NumInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Num (number) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Num = class extends NumInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(int, dec = 0) {\r\n\t\tsuper();\r\n\t\tthis.int = int;\r\n\t\tthis.dec = dec;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn parseFloat(this.int + (this.dec ? '.' + this.dec : null));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.int + (this.dec ? '.' + this.dec : null);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Num) {\r\n\t\tif (_isNumeric(expr)) {\r\n\t\t\tvar expr = expr.split('.');\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseInt(expr.shift()),\r\n\t\t\t\tparseInt(expr.shift())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Num;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ObjInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ObjectType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@web-native-js/commons/str/wrapped.js';\r\nimport _unwrap from '@web-native-js/commons/str/unwrap.js';\r\nimport _first from '@web-native-js/commons/arr/first.js';\r\nimport _last from '@web-native-js/commons/arr/last.js';\r\nimport _each from '@web-native-js/commons/obj/each.js';\r\nimport ObjInterface from './ObjInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Object utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Obj = class extends ObjInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(entries) {\r\n\t\tsuper();\r\n\t\tthis.entries = entries || {};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof ObjInterface) {\r\n\t\t\t_each(Super.entries, (name, val) => {\r\n\t\t\t\tif (!(name in this.entries)) {\r\n\t\t\t\t\tthis.entries[name] = val;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\tvar items = {};\r\n\t\t_each(this.entries, (key, expr) => {\r\n\t\t\titems[key] = expr.eval(context, trap);\r\n\t\t});\r\n\t\treturn items;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar str = [];\r\n\t\t_each(this.entries, (key, expr) => {\r\n\t\t\tstr.push(key + Obj.operators.sub + expr.toString(context));\r\n\t\t});\r\n\t\treturn '{' + str.join(Obj.operators.sup) + '}';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Obj) {\r\n\t\tif (_wrapped(expr, '{', '}') && !Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar entries = {};\r\n\t\t\tvar _entriesSplit = Lexer.split(_unwrap(expr, '{', '}'), [Obj.operators.sup])\r\n\t\t\t\t.map(n => n.trim()).filter(n => n);\r\n\t\t\t_each(_entriesSplit, (key, expr) => {\r\n\t\t\t\tvar entry = Lexer.split(expr, [Obj.operators.sub], {limit:1}/*IMPORTANT*/);\r\n\t\t\t\tentries[_first(entry).trim()] = parseCallback(_last(entry).trim());\r\n\t\t\t});\r\n\t\t\treturn new Static(entries);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nObj.operators = {\r\n\tsup: ',',\r\n\tsub: ':',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Obj;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * PresenceInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'PresenceOperator'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _last from '@web-native-js/commons/arr/last.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport PresenceInterface from './PresenceInterface.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Presence class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Presence = class extends PresenceInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(prop, reference, operator = 'in') {\r\n\t\tsuper();\r\n\t\tthis.prop = prop;\r\n\t\tthis.reference = reference;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\tvar reference = this.reference.getEval(context, trap);\r\n\t\tvar prop = this.prop.eval(context, trap);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\treturn Contexts.create(reference.context).has(reference.name, prop, trap);\r\n\t\t}\r\n\t\tthrow new Error('\"' + this + '\" is undefined!');\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.prop.toString(context), this.operator, this.reference.toString(context)].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Presence) {\r\n\t\tvar parse = Lexer.lex(expr, Static.operators);\r\n\t\tif (parse.tokens.length === 2) {\r\n\t\t\tvar prop, reference;\r\n\t\t\tif (!(prop = parseCallback(parse.tokens.shift().trim()))\r\n\t\t\t|| !((reference = parseCallback(parse.tokens.shift().trim())) instanceof ReferenceInterface)) {\r\n\t\t\t\tthrow new Error('Invalid presence check expression: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(prop, reference, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nPresence.operators = [' in '];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Presence;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport _wrapped from '@web-native-js/commons/str/wrapped.js';\r\nimport _unwrap from '@web-native-js/commons/str/unwrap.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport ExprInterface from '../ExprInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Reference class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Reference = class extends ReferenceInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(context, name, backticks = false) {\r\n\t\tsuper();\r\n\t\tthis.context = context;\r\n\t\tthis.name = name;\r\n\t\tthis.backticks = backticks;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tgetEval(context = null, trap = {}) {\r\n\t\tvar sourceContext = context, name = this.name;\r\n\t\tif (this.context) {\r\n\t\t\tif (name instanceof ExprInterface) {\r\n\t\t\t\tname = name.eval(context, trap);\r\n\t\t\t}\r\n\t\t\tsourceContext = this.context.eval(context, trap);\r\n\t\t}\r\n\t\treturn {context:sourceContext, name:name,};\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\tvar parts = this.getEval(context, trap);\r\n\t\tif (!_isUndefined(parts.context) && !_isUndefined(parts.name)) {\r\n\t\t\treturn Contexts.create(parts.context).get(parts.name, trap);\r\n\t\t}\r\n\t\tthrow new Error('\"' + this + '\" is undefined!');\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar name = this.name;\r\n\t\tif (this.context) {\r\n\t\t\tvar subjectContext = this.context.toString(context);\r\n\t\t\tif (name instanceof ExprInterface) {\r\n\t\t\t\tname = '[' + name.toString(context) + ']';\r\n\t\t\t} else if (this.backticks) {\r\n\t\t\t\tname = '`' + name + '`';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar subjectContext = context;\r\n\t\t\tif (this.backticks) {\r\n\t\t\t\tname = '`' + name + '`';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn (subjectContext || '') + (subjectContext && !name.startsWith('[') ? Reference.separator : '') + name;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Reference) {\r\n\t\tif (!Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar splits = Lexer.split(expr, []);\r\n\t\t\t// ------------------------\r\n\t\t\t// name, first\r\n\t\t\t// ------------------------\r\n\t\t\tvar context, name = splits.pop(), backticks;\r\n\t\t\tvar nameSplit = Lexer.split(name.trim(), [Static.separator], {preserveDelims:true});\r\n\t\t\tif (nameSplit.length > 1) {\r\n\t\t\t\tname = nameSplit.pop().substr(1);\r\n\t\t\t\tsplits = splits.concat(nameSplit);\r\n\t\t\t}\r\n\t\t\tif (_wrapped(name, '`', '`')) {\r\n\t\t\t\tname = _unwrap(name, '`', '`');\r\n\t\t\t\tbackticks = true;\r\n\t\t\t}\r\n\t\t\t// ------------------------\r\n\t\t\t// context, second\r\n\t\t\t// ------------------------\r\n\t\t\tif (splits.length) {\r\n\t\t\t\tcontext = parseCallback(splits.join(''));\r\n\t\t\t\tcontext.isContext = true;\r\n\t\t\t}\r\n\t\t\tif (_wrapped(name, '[', ']')) {\r\n\t\t\t\tif (!context) {\r\n\t\t\t\t\tthrow new Error('Invalid reference: ' + expr + '!');\r\n\t\t\t\t}\r\n\t\t\t\tname = parseCallback(_unwrap(name, '[', ']'));\r\n\t\t\t}\r\n\t\t\treturn new Static(context, name, backticks);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop string\r\n */\r\nReference.separator = '.';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Reference;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ReturnInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ReturnDirective'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport ReturnInterface from './ReturnInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Ret (return) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Return = class extends ReturnInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\treturn this.expr ? this.expr.eval(context, trap) : undefined;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.expr ? 'return ' + this.expr.toString(context) : 'return';\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------------------------------------------\r\n\t */\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Return) {\r\n\t\tvar exprLc = expr.toLowerCase();\r\n\t\tif (exprLc.startsWith('return ') || exprLc === 'return') {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(expr.substr(6).trim())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Return;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * StatementsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Statements'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _flatten from '@web-native-js/commons/arr/flatten.js';\r\nimport StatementsInterface from './StatementsInterface.js';\r\nimport ReturnInterface from './ReturnInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Statements class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Statements = class extends StatementsInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(stmts, delim) {\r\n\t\tsuper();\r\n\t\tthis.stmts = stmts;\r\n\t\tthis.delim = delim;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, trap = {}) {\r\n\t\tvar stmts = [];\r\n\t\tfor (var i = 0; i < this.stmts.length; i ++) {\r\n\t\t\tif (this.stmts[i] instanceof ReturnInterface) {\r\n\t\t\t\treturn this.stmts[i].eval(context, trap);\r\n\t\t\t} else {\r\n\t\t\t\tstmts[i] = this.stmts[i].eval(context, trap);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn stmts;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.stmts.map(stmt => stmt.toString(context)).join(this.delim);\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Statements) {\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparse.tokens.map(stmt => parseCallback(stmt)),\r\n\t\t\t\tparse.matches[0].trim()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop array\r\n */\r\nStatements.operators = [\r\n\t';',\r\n\t\"\\r\\n\",\r\n];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Statements;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * StrInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'StringType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@web-native-js/commons/str/wrapped.js';\r\nimport _unwrap from '@web-native-js/commons/str/unwrap.js';\r\nimport StrInterface from './StrInterface.js';\r\nimport Lexer from '../Lexer.js';\r\nimport Bool from './Bool.js';\r\n\r\n/**\r\n * ---------------------------\r\n * String utils\r\n * ---------------------------\r\n */\r\n\r\nconst Str = class extends StrInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr, quote) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t\tthis.quote = quote;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn this.expr;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString() {\r\n\t\treturn this.quote + this.expr + this.quote;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Str) {\r\n\t\texpr = expr.trim();\r\n\t\tif ((_wrapped(expr, '\"', '\"') || _wrapped(expr, \"'\", \"'\")) \r\n\t\t&& !Lexer.match(expr, [' ']).length) {\r\n\t\t\tvar quote = _wrapped(expr, '\"', '\"') ? '\"' : \"'\";\r\n\t\t\treturn new Static(\r\n\t\t\t\t_unwrap(expr, quote, quote),\r\n\t\t\t\tquote\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Str;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen from './Jsen.js';\r\nimport ExprInterface from './ExprInterface.js';\r\nimport Lexer from './Lexer.js';\r\nimport Contexts from './Contexts.js';\r\nimport Abstraction from './Expr/Abstraction.js';\r\nimport AbstractionInterface from './Expr/AbstractionInterface.js';\r\nimport Arr from './Expr/Arr.js';\r\nimport ArrInterface from './Expr/ArrInterface.js';\r\nimport Arguments from './Expr/Arguments.js';\r\nimport ArgumentsInterface from './Expr/ArgumentsInterface.js';\r\nimport Assertion from './Expr/Assertion.js';\r\nimport AssertionInterface from './Expr/AssertionInterface.js';\r\nimport Assignment from './Expr/Assignment.js';\r\nimport AssignmentInterface from './Expr/AssignmentInterface.js';\r\nimport Bool from './Expr/Bool.js';\r\nimport BoolInterface from './Expr/BoolInterface.js';\r\nimport Call from './Expr/Call.js';\r\nimport CallInterface from './Expr/CallInterface.js';\r\nimport Comments from './Expr/Comments.js';\r\nimport CommentsInterface from './Expr/CommentsInterface.js';\r\nimport Comparison from './Expr/Comparison.js';\r\nimport ComparisonInterface from './Expr/ComparisonInterface.js';\r\nimport Condition from './Expr/Condition.js';\r\nimport ConditionInterface from './Expr/ConditionInterface.js';\r\nimport Deletion from './Expr/Deletion.js';\r\nimport DeletionInterface from './Expr/DeletionInterface.js';\r\nimport Func from './Expr/Func.js';\r\nimport FuncInterface from './Expr/FuncInterface.js';\r\nimport Math from './Expr/Math.js';\r\nimport MathInterface from './Expr/MathInterface.js';\r\nimport Num from './Expr/Num.js';\r\nimport NumInterface from './Expr/NumInterface.js';\r\nimport Obj from './Expr/Obj.js';\r\nimport ObjInterface from './Expr/ObjInterface.js';\r\nimport Presence from './Expr/Presence.js';\r\nimport PresenceInterface from './Expr/PresenceInterface.js';\r\nimport Reference from './Expr/Reference.js';\r\nimport ReferenceInterface from './Expr/ReferenceInterface.js';\r\nimport Return from './Expr/Return.js';\r\nimport ReturnInterface from './Expr/ReturnInterface.js';\r\nimport Statements from './Expr/Statements.js';\r\nimport StatementsInterface from './Expr/StatementsInterface.js';\r\nimport Str from './Expr/Str.js';\r\nimport StrInterface from './Expr/StrInterface.js';\r\n\r\n/**\r\n * @var object\r\n */\r\nJsen.grammars = {\r\n\tComments: Comments,\t\t\t// // single-line | /* double-line */\r\n\tReturn: Return,\t\t\t\t// return field1\r\n\tStatements: Statements,\t\t// field1 = 3; field2 = val2\r\n\tDeletion: Deletion,\t\t\t// delete field1\r\n\tAssignment: Assignment,\t\t// field1[key1].key2 = k\r\n\tPresence: Presence,\t\t\t// key1 in field1\r\n\tFunc: Func,\t\t\t\t\t// (field1, field2) => {}\r\n\tAbstraction: Abstraction,\t// (field1)\r\n\tCondition: Condition,\t\t// field1 > field2 ? val1 : val2\r\n\tAssertion: Assertion,\t\t// !field1 && field2\r\n\tComparison: Comparison,\t\t// field1 > field2\r\n\tMath: Math,\t\t\t\t\t// field1 + field2\r\n\tArr: Arr,\t\t\t\t\t// [field1, field2]\r\n\tObj: Obj,\t\t\t\t\t// {field1:val1, field2:val2}\r\n\tNum: Num,\t\t\t\t\t// [0-9]\r\n\tStr: Str,\t\t\t\t\t// \"\"\r\n\tBool: Bool,\t\t\t\t\t// true\r\n\tCall: Call,\t\t\t\t\t// field1()\r\n\tReference: Reference,\t\t\t\t// field1\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tExprInterface,\r\n\tLexer,\r\n\tContexts\r\n};\r\nexport {\r\n\tAbstraction,\r\n\tArr,\r\n\tArguments,\r\n\tAssertion,\r\n\tAssignment,\r\n\tBool,\r\n\tCall,\r\n\tComments,\r\n\tComparison,\r\n\tCondition,\r\n\tDeletion,\r\n\tFunc,\r\n\tMath,\r\n\tNum,\r\n\tObj,\r\n\tPresence,\r\n\tReference,\r\n\tReturn,\r\n\tStr,\r\n\tStatements\r\n};\r\nexport {\r\n\tAbstractionInterface,\r\n\tArrInterface,\r\n\tArgumentsInterface,\r\n\tAssertionInterface,\r\n\tAssignmentInterface,\r\n\tBoolInterface,\r\n\tCallInterface,\r\n\tCommentsInterface,\r\n\tComparisonInterface,\r\n\tConditionInterface,\r\n\tDeletionInterface,\r\n\tFuncInterface,\r\n\tMathInterface,\r\n\tNumInterface,\r\n\tObjInterface,\r\n\tPresenceInterface,\r\n\tReferenceInterface,\r\n\tReturnInterface,\r\n\tStrInterface,\r\n\tStatementsInterface\r\n};\r\nexport default Jsen;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isString from '../js/isString.js';\r\n\r\n/**\r\n * Return an object for the given pair(s) of input.\r\n *\r\n * @param string|array \t\t\tkey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nexport default function(key, val = null) {\r\n\tvar obj = {};\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(key)) {\r\n\t\t\tobj[key] = val;\r\n\t\t} else if (_isArray(key) && _isArray(val)) {\r\n\t\t\tkey.forEach((k, i) => obj[k] = val[i]);\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@web-native-js/commons/obj/each.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Event class\r\n * ---------------------------\r\n */\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param array|object\t\ttarget\r\n\t * @param object\t\t\tdetails\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(target, details = {}) {\r\n\t\tthis.$ = {};\r\n\t\tthis.$.target = target;\r\n\t\tthis.$.details = details;\r\n\t\t_each(details, (prop, value) => {\r\n\t\t\tif (prop !== '$') {\r\n\t\t\t\tObject.defineProperty(this, prop, {value});\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the \"target\" object.\r\n\t *\r\n\t * @return array|object\r\n\t */\r\n\tget target() {\r\n\t\treturn this.$.target;\r\n\t}\r\n\r\n\t/**\r\n\t * Gets the \"details\" object.\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tget details() {\r\n\t\treturn this.$.details;\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The QueryEvent class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Event {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param array|object\t\ttarget\r\n\t * @param object\t\t\tdetails\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(target, details = {}) {\r\n\t\tsuper(target, details);\r\n\t}\r\n};","\r\n/**\r\n * ---------------------------\r\n * The Fireable class\r\n * ---------------------------\r\n */\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Sets a \"disconnected\" flag on the Fireable.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tdisconnect() {\r\n\t\tthis.disconnected = true;\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _intersect from '@web-native-js/commons/arr/intersect.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport Fireable from './Fireable.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Firebase class\r\n * ---------------------------\r\n */\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor() {\r\n\t\tthis.fireables = [];\r\n\t\tthis.currentlyFiringEvents = [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds an Fireable instance\r\n\t * with optional tags.\r\n\t *\r\n\t * @param Fireable\t\t\tfireable\r\n\t *\r\n\t * @return Fireable\r\n\t */\r\n\taddFireable(fireable) {\r\n\t\tthis.fireables.push(fireable);\r\n\t\treturn fireable;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Removes an Fireable instance\r\n\t * with optional tags.\r\n\t *\r\n\t * @param Fireable\t\t\tfireable\r\n\t * @param array\t\t\t\ttags\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tremoveFireable(fireable, tags = []) {\r\n\t\tthis.fireables = this.fireables.filter(_fireable => _fireable !== fireable);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds the Observer instances\r\n\t * with the given query parameters.\r\n\t *\r\n\t * @param object\t\t\tquery\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfindFireables(query) {\r\n\t\treturn this.fireables.filter(observer => {\r\n\t\t\treturn (!query.handler || observer.handler === query.handler) && (!query.params || (\r\n\t\t\t\t(!query.params.type || observer.params.type === query.params.type)\r\n\t\t\t\t&& (!query.params.tags || _intersect(observer.params.tags || [], query.params.tags).length === query.params.tags.length)\r\n\t\t\t));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Create an object's firebase.\r\n\t *\r\n\t * @param array|object\tobject\r\n\t * @param string\t\ttype\r\n\t *\r\n\t * @return Firebase\r\n\t */\r\n\tstatic createForTarget (object, type, Base) {\r\n\t\tif (object && _isTypeObject(object)) {\r\n\t\t\tvar firebases;\r\n\t\t\tif (!(firebases = object[firebaseKey])) {\r\n\t\t\t\tfirebases = {};\r\n\t\t\t\tObject.defineProperty(object, firebaseKey, {\r\n\t\t\t\t\tget:() => firebases,\r\n\t\t\t\t\tset:value => {\r\n\t\t\t\t\t\tif (value !== firebases) {\r\n\t\t\t\t\t\t\tthrow new Error('Attempt to overwrite the \"' + firebaseKey + '\" special property!');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t},\r\n\t\t\t\t\tenumerable:false,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\tfirebases[type] = new Base;\r\n\t\t\treturn firebases[type];\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns an object's firebase.\r\n\t *\r\n\t * @param array|object\tobject\r\n\t * @param string\t\ttype\r\n\t *\r\n\t * @return Firebase\r\n\t */\r\n\tstatic getForTarget(object, type) {\r\n\t\tvar firebases;\r\n\t\tif (object && _isTypeObject(object) && (firebases = object[firebaseKey])) {\r\n\t\t\treturn firebases[type];\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @var string\r\n */\r\nconst firebaseKey = '< r e f l e c t >';\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport QueryEvent from './QueryEvent.js';\r\nimport Fireable from './Fireable.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Trap class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Fireable {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param function\t\thandler\r\n\t * @param object\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(handler, params = {}) {\r\n\t\tsuper();\r\n\t\tthis.handler = handler;\r\n\t\tthis.params = params;\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * Calls the observer's handler function\r\n\t * on matching with the event's fields.\r\n\t *\r\n\t * @param MutationEvent\t\t\t \tevt\r\n\t * @param function\t\t\t\t\tnext\r\n\t * @param mixed\t\t\t\t\t \ttotal\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tfire(evt, next, total) {\r\n\t\tif (this.disconnected || (this.params.type && this.params.type !== evt.type)) {\r\n\t\t\treturn next(..._arrFrom(arguments).slice(2));\r\n\t\t}\r\n\t\treturn this.handler(evt.target, total, next, evt);\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _even from '@web-native-js/commons/obj/even.js';\r\nimport QueryEvent from './QueryEvent.js';\r\nimport Firebase from './Firebase.js';\r\nimport Trap from './Trap.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nexport default class TrapBase extends Firebase {\r\n\t\r\n\t/**\r\n\t * Fires all observers with the given evt (change).\r\n\t *\r\n\t * @param Event\t\t\t\tevt\r\n\t * @param function\t\t\tdefaultHandler\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tfire(evt, defaultHandler = null) {\r\n\t\tif (this.currentlyFiringEvents.filter(e => e.type === evt.type && e.query === evt.query).length) {\r\n\t\t\treturn defaultHandler ? defaultHandler() : undefined;\r\n\t\t}\r\n\t\tthis.currentlyFiringEvents.push(evt);\r\n\t\tconst next = (index, ..._args) => {\r\n\t\t\tvar trap = this.fireables[index];\r\n\t\t\tif (trap) {\r\n\t\t\t\treturn trap.fire(evt, (...args) => {\r\n\t\t\t\t\treturn next(index + 1, ...args);\r\n\t\t\t\t}/*next*/, ..._args);\r\n\t\t\t}\r\n\t\t\treturn defaultHandler ? defaultHandler(..._args) : _args[0];\r\n\t\t};\r\n\t\tvar value = next(0);\r\n\t\tthis.currentlyFiringEvents.pop();\r\n\t\treturn value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic createForTarget(object) {\r\n\t\treturn super.createForTarget(object, 'traps', TrapBase);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic getForTarget(object) {\r\n\t\treturn super.getForTarget(object, 'traps');\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport _isObject from '@web-native-js/commons/js/isObject.js';\r\nimport _even from '@web-native-js/commons/obj/even.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The MutationEvent class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Event {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param array|object\t\ttarget\r\n\t * @param object\t\t\tdetails\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(target, details = {}) {\r\n\t\tif (details.data) {\r\n\t\t\tdetails.fields = Object.keys(details.data);\r\n\t\t}\r\n\t\tsuper(target, details);\r\n\t\t// -----------------------\r\n\t\tif (this.srcEvt) {\r\n\t\t\tthis.dataEven = this.srcEvt.dataEven;\r\n\t\t\tthis.originatingTarget = this.srcEvt.originatingTarget;\r\n\t\t\tthis.originatingType = this.srcEvt.originatingType;\r\n\t\t\tthis.originatingFields = [];\r\n\t\t\tthis.originatingData = {};\r\n\t\t\tthis._originatingData = {};\r\n\t\t\tvar field = this.fields[0];\r\n\t\t\tObject.keys(this.srcEvt.originatingData).forEach(path => {\r\n\t\t\t\tvar _path = field + '.' + path;\r\n\t\t\t\tthis.originatingFields.push(_path);\r\n\t\t\t\tthis.originatingData[_path] = this.srcEvt.originatingData[path];\r\n\t\t\t\tthis._originatingData[_path] = this.srcEvt._originatingData[path];\r\n\t\t\t});\r\n\t\t\tthis.originatingCreated = this.srcEvt.originatingCreated;\r\n\t\t\tthis.originatingDeleted = this.srcEvt.originatingDeleted;\r\n\t\t} else {\r\n\t\t\tthis.dataEven = _even(this.data, this._data, true/*assertion*/, 2/*depth*/);\r\n\t\t\tthis.originatingTarget = this.target;\r\n\t\t\tthis.originatingType = this.type;\r\n\t\t\tthis.originatingFields = this.fields;\r\n\t\t\tthis.originatingData = this.data;\r\n\t\t\tthis._originatingData = this._data;\r\n\t\t\tthis.originatingCreated = this.created;\r\n\t\t\tthis.originatingDeleted = this.deleted;\r\n\t\t}\r\n\t\t// -----------------------\r\n\t\tthis.$.propagationStopped = false;\r\n\t\tthis.$.defaultPrevented = false;\r\n\t\tthis.$.promisesInstance = null;\r\n\t\tthis.$.promises = [];\r\n\t}\r\n\r\n\t/**\r\n\t * -----------------------\r\n\t * RESPONSE HANDLERS\r\n\t * -----------------------\r\n\t */\r\n\r\n\t/**\r\n\t * Stops the evnt from reaching other listeners.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstopPropagation() {\r\n\t\tthis.$.propagationStopped = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if stopPropagation() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget propagationStopped() {\r\n\t\treturn this.$.propagationStopped;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a disposition that asks event initiator not to\r\n\t * proceed with default action.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpreventDefault() {\r\n\t\tthis.$.defaultPrevented = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if preventDefault() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget defaultPrevented() {\r\n\t\treturn this.$.defaultPrevented;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a Promise disposition.\r\n\t *\r\n\t * @param Promise\tpromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpromise(promise) {\r\n\t\tif (!(promise instanceof Promise)) {\r\n\t\t\tthrow new Error('Event.promise() must be called with a Promise.');\r\n\t\t}\r\n\t\tthis.$.promises.push(promise);\r\n\t\tthis.$.promisesInstance = null;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) returns all promises.\r\n\t *\r\n\t * @return Promise|null\r\n\t */\r\n\tget promises() {\r\n\t\tif (!this.$.promisesInstance && this.$.promises.length) {\r\n\t\t\tthis.$.promisesInstance = Promise.all(this.$.promises);\r\n\t\t}\r\n\t\treturn this.$.promisesInstance;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Evaluates the given disposition value and\r\n\t * calls an appropriate disposition method.\r\n\t *\r\n\t * @params mixed \trspns\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tresponse(rspns) {\r\n\t\tvar proms;\r\n\t\tvar isEvent = _isObject(rspns) && !_isUndefined(rspns.propagationStopped) && !_isUndefined(rspns.defaultPrevented)\r\n\t\tif ((rspns === false) || (isEvent && rspns.propagationStopped)) {\r\n\t\t\tthis.stopPropagation();\r\n\t\t} else if ((rspns === false) || (isEvent && rspns.defaultPrevented)) {\r\n\t\t\tthis.preventDefault();\r\n\t\t} else if ((rspns instanceof Promise && (proms = rspns))\r\n\t\t|| (isEvent && (proms = rspns.promises))) {\r\n\t\t\tthis.promise(proms);\r\n\t\t}\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _even from '@web-native-js/commons/obj/even.js';\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _intersect from '@web-native-js/commons/arr/intersect.js';\r\nimport _concatUnique from '@web-native-js/commons/arr/concatUnique.js';\r\nimport _exclude from '@web-native-js/commons/arr/exclude.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport _isNull from '@web-native-js/commons/js/isNull.js';\r\nimport MutationEvent from './MutationEvent.js';\r\nimport Firebase from './Firebase.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nexport default class ObserverBase extends Firebase {\r\n\t\r\n\t/**\r\n\t * Finds the Observer instances\r\n\t * with the given query parameters.\r\n\t *\r\n\t * @param object\t\t\tquery\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfindFireables(query) {\r\n\t\treturn super.findFireables(query).filter(observer => {\r\n\t\t\treturn _isNull(query.fields) || _isUndefined(query.fields) || _even(_arrFrom(observer.fields), _arrFrom(query.fields));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fires all observers with the given evt (change).\r\n\t *\r\n\t * @param Event\t\t\t\tevt\r\n\t *\r\n\t * @return Event\r\n\t */\r\n\tfire(evt) {\r\n\t\tif (this.currentlyFiringEvents.filter(e => e.type === evt.type && e.fields === evt.fields).length) {\r\n\t\t\treturn evt;\r\n\t\t}\r\n\t\tthis.currentlyFiringEvents.push(evt);\r\n\t\tthis.fireables.forEach(observer => {\r\n\t\t\tif (evt.propagationStopped || (observer.params.type && observer.params.type !== evt.type)) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tobserver.fire(evt);\r\n\t\t});\r\n\t\tthis.currentlyFiringEvents.pop();\r\n\t\treturn evt;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic createForTarget(object) {\r\n\t\treturn super.createForTarget(object, 'observers', ObserverBase);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic getForTarget(object) {\r\n\t\treturn super.getForTarget(object, 'observers');\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from '@web-native-js/commons/js/isNull.js';\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _isUndefined from '@web-native-js/commons/js/isUndefined.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\n\r\n/**\r\n * Removes an observer from an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param string|array|function\t\tfields\r\n * @param function\t\t\t\t\toriginalCallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return void\r\n */\r\nexport default function(object, fields, originalCallback = null, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tif (_isFunction(fields) || _isNull(fields) || _isUndefined(fields)) {\r\n\t\tparams = arguments.length > 2 ? originalCallback : {};\r\n\t\toriginalCallback = fields;\r\n\t\tfields = null;\r\n\t}\r\n\tvar firebase;\r\n\tif (firebase = ObserverBase.getForTarget(object)) {\r\n\t\tfirebase.findFireables({handler:originalCallback, fields, params}).forEach(observer => {\r\n\t\t\tfirebase.removeFireable(observer);\r\n\t\t});\r\n\t}\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport unobserve from './unobserve.js';\r\n\r\n/**\r\n * Unbubble helper\r\n *\r\n * @param array|object\ttarget\r\n * @param string\t\tfield\r\n * @param array|object\tobject\r\n *\r\n * @return void\r\n */\r\nexport default function(target, field, object) {\r\n\tunobserve(object, null, {tags:['#e-bubbling', target]});\r\n}\r\n","\r\n/**\r\n * Returns the val's type.\r\n *\r\n * @param string \tval\r\n *\r\n * @return string\r\n */\r\nexport default function(val) {\r\n\treturn typeof val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isUndefined from '../js/isUndefined.js';\r\nimport _isNull from '../js/isNull.js';\r\nimport _arrFrom from '../arr/from.js';\r\n\r\n/**\r\n * Retrieves the value at the given path.\r\n *\r\n * A return value of undefined is ambiguous, and can mean either that the\r\n * path does not exist, or that the path actually exists but with a value of undefined. If it is required to\r\n * know whether the path actually exists, pass an object as a third argument.\r\n * This object will have an \"exists\" key set to true/false.\r\n *\r\n * @param object \t\t\t\tctxt\r\n * @param array \t\t\t\tpath\r\n * @param object \t\t\t\ttrap\r\n * @param object \t\t\t\treciever\r\n *\r\n * @return mixed\r\n */\r\nexport default function(ctxt, path, trap = {}, reciever = {}) {\r\n\tpath = _arrFrom(path).slice();\r\n\tvar _ctxt = ctxt;\r\n\twhile(!_isUndefined(_ctxt) && !_isNull(_ctxt) && path.length) {\r\n\t\tvar _key = path.shift();\r\n\t\tif (!(trap.get ? trap.get(_ctxt, _key) : (_isTypeObject(_ctxt) ? _key in _ctxt : _ctxt[_key]))) {\r\n\t\t\treciever.exists = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_ctxt = trap.get ? trap.get(_ctxt, _key) : _ctxt[_key];\r\n\t}\r\n\treciever.exists = true;\r\n\treturn _ctxt;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _crossJoin from '@web-native-js/commons/arr/crossJoin.js';\r\nimport _pushUnique from '@web-native-js/commons/arr/pushUnique.js';\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _strAfter from '@web-native-js/commons/str/after.js';\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _commonsGet from '@web-native-js/commons/obj/get.js';\r\nimport Fireable from './Fireable.js';\r\nimport MutationEvent from './MutationEvent.js';\r\nimport reflexGet from '../get.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Observer class\r\n * ---------------------------\r\n */\r\n\r\nexport default class extends Fireable {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @param function\t\thandler\r\n\t * @param string|array\tfields\r\n\t * @param object\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(handler, fields = null, params = {}) {\r\n\t\tsuper();\r\n\t\tthis.handler = handler;\r\n\t\tthis.fields = fields;\r\n\t\tthis.params = params;\r\n\t\t// -----------------------\r\n\t\tthis.fieldsArray = _arrFrom(this.fields);\r\n\t\tthis.isDynamicField = this.fieldsArray.filter(\r\n\t\t\tfield => field.indexOf('..') > -1 || field.startsWith('.') || field.endsWith('.')\r\n\t\t).length;\r\n\t\tif (this.isDynamicField && this.fieldsArray.length > 1) {\r\n\t\t\tthrow new Error('Only one \"Dynamic Field\" must be observed at a time! \"' + this.fieldsArray.join(', ') + '\" have been bound together.');\r\n\t\t}\r\n\r\n\t}\r\n\t\r\n\t/**\r\n\t * Calls the observer's handler function\r\n\t * on matching with the event's fields.\r\n\t *\r\n\t * @param MutationEvent\t\t\t \tevt\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tfire(evt) {\r\n\t\tif (this.disconnected || (this.params.type && this.params.type !== evt.type)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (evt.dataEven && this.params.diff !== false) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.fireCallback(evt, fields => {\r\n\t\t\tif (fields) {\r\n\t\t\t\t// Call listener...\r\n\t\t\t\tvar data = [];\r\n\t\t\t\tvar _data = [];\r\n\t\t\t\tfields.forEach(field => {\r\n\t\t\t\t\t// --------------------------\r\n\t\t\t\t\t// The NEW/OLD values of the change of field which could be a path\r\n\t\t\t\t\tvar fieldData = evt.originatingFields.reduce((fieldData, originatingField) => {\r\n\t\t\t\t\t\t// So field is the exact originatingField path?\r\n\t\t\t\t\t\tvar value = evt.originatingData[originatingField];\r\n\t\t\t\t\t\tvar _value = evt._originatingData[originatingField];\r\n\t\t\t\t\t\tif (!fieldData && field === originatingField) {\r\n\t\t\t\t\t\t\treturn [value, _value];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// Field matches, but is deeper than, originatingField path?\r\n\t\t\t\t\t\tif (!fieldData && (field + '.').startsWith((originatingField + '.'))) {\r\n\t\t\t\t\t\t\tvar fieldQuery = _strAfter(field, originatingField + '.');\r\n\t\t\t\t\t\t\treturn [\r\n\t\t\t\t\t\t\t\t// Notice we're using _commonsGet to dig the path\r\n\t\t\t\t\t\t\t\t// but with reflexGet as trap for \"reactive getting\"\r\n\t\t\t\t\t\t\t\t_commonsGet(value, fieldQuery.split('.'), {get:reflexGet}),\r\n\t\t\t\t\t\t\t\t_commonsGet(_value, fieldQuery.split('.'), {get:reflexGet})\r\n\t\t\t\t\t\t\t];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn fieldData;\r\n\t\t\t\t\t}, null);\r\n\t\t\t\t\t// --------------------------\r\n\t\t\t\t\tif (fieldData) {\r\n\t\t\t\t\t\tdata.push(fieldData.shift());\r\n\t\t\t\t\t\t_data.push(fieldData.shift());\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar currentValue = _commonsGet(evt.target, _isString(field) ? field.split('.') : field, {get:reflexGet});\r\n\t\t\t\t\t\tdata.push(currentValue);\r\n\t\t\t\t\t\t_data.push(currentValue);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\treturn _isArray(this.fields) // NOTE:we're asking the original format!\r\n\t\t\t\t\t? evt.response(this.handler(data, _data, evt))\r\n\t\t\t\t\t: evt.response(this.handler(data[0], _data[0], evt));\r\n\t\t\t}\r\n\t\t\tvar data = {};\r\n\t\t\tvar _data = {};\r\n\t\t\tevt.fields.forEach(field => {\r\n\t\t\t\t// Remeber that evt.originatingData might actually be bubbling\r\n\t\t\t\t// in which case we don't expect to see eventName key.\r\n\t\t\t\tvar currentValue = field in evt.data \r\n\t\t\t\t\t? evt.data[field] \r\n\t\t\t\t\t: reflexGet(evt.target, field);\r\n\t\t\t\tvar prevValue = field in evt._data\r\n\t\t\t\t\t? evt._data[field] \r\n\t\t\t\t\t: currentValue;\r\n\t\t\t\tdata[field] = currentValue;\r\n\t\t\t\t_data[field] = prevValue;\r\n\t\t\t});\r\n\t\t\t// Call listener...\r\n\t\t\treturn evt.response(this.handler(data, _data, evt));\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Validates a proposed fire operation.\r\n\t *\r\n\t * @param MutationEvent\t\t \tevt\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tfireCallback(evt, callback) {\r\n\t\tif (this.fieldsArray.length) {\r\n\t\t\tvar dynamicFieldOutcomes = [];\r\n\t\t\tvar matches = this.fieldsArray.filter((observedField, i) => {\r\n\t\t\t\tdynamicFieldOutcomes[i] = [];\r\n\t\t\t\treturn evt.originatingFields.filter(inputOriginatingField => {\r\n\t\t\t\t\tvar inputOriginatingFieldSplit = inputOriginatingField.split('.');\r\n\t\t\t\t\tvar observedDynamicFieldOutcome = this.isDynamicField \r\n\t\t\t\t\t\t? observedField.split('.').map((seg, k) => seg || inputOriginatingFieldSplit[k] || '').join('.')\r\n\t\t\t\t\t\t: observedField;\r\n\t\t\t\t\t_pushUnique(dynamicFieldOutcomes[i], observedDynamicFieldOutcome);\r\n\t\t\t\t\treturn (observedDynamicFieldOutcome === inputOriginatingField\r\n\t\t\t\t\t\t|| (this.params.observeUp !== false && (observedDynamicFieldOutcome + '.').startsWith(inputOriginatingField + '.'))\r\n\t\t\t\t\t\t|| (this.params.observeDown && (inputOriginatingField + '.').startsWith(observedDynamicFieldOutcome + '.'))\r\n\t\t\t\t\t) && (!this.isDynamicField || !observedDynamicFieldOutcome.split('.').filter(seg => !seg).length);\r\n\t\t\t\t}).length;\r\n\t\t\t}).length;\r\n\t\t\tif (matches) {\r\n\t\t\t\t_crossJoin(dynamicFieldOutcomes).forEach(callback);\r\n\t\t\t}\r\n\t\t} else if (evt.fields === evt.originatingFields || this.params.observeDown) {\r\n\t\t\tcallback();\r\n\t\t}\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from './from.js';\r\n\r\n/**\r\n * Accepts a list of column and joins them to a table.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nexport default function(arr) {\r\n\treturn arr.reduce((currTable, column) => {\r\n\t\tvar newTable = [];\r\n\t\tcurrTable.forEach(row => {\r\n\t\t\t_arrFrom(column).forEach(column => {\r\n\t\t\t\tvar _row = row.slice();\r\n\t\t\t\t_row.push(column);\r\n\t\t\t\tnewTable.push(_row);\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn newTable;\r\n\t}, [[]]);\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _getType from '@web-native-js/commons/js/getType.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport Observer from './internal/Observer.js';\r\n\r\n/**\r\n * Adds an observer to an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param string|array|function\t\tfields\r\n * @param function\t\t\t\t\tcallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return Observer\r\n */\r\nexport default function(object, fields, callback = null, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tif (_isFunction(fields)) {\r\n\t\tparams = arguments.length > 2 ? callback : {};\r\n\t\tcallback = fields;\r\n\t\tfields = null;\r\n\t}\r\n\tif (!_isFunction(callback)) {\r\n\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t}\r\n\tvar firebase;\r\n\tif (!(firebase = ObserverBase.getForTarget(object))) {\r\n\t\tfirebase = ObserverBase.createForTarget(object);\r\n\t}\r\n\treturn firebase.addFireable(new Observer(callback, fields, params));\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _objFrom from '@web-native-js/commons/obj/from.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport observe from './observe.js';\r\n\r\n/**\r\n * Bubble helper\r\n *\r\n * @param array|object\ttarget\r\n * @param string\t\tfield\r\n * @param array|object\tobject\r\n *\r\n * @return void\r\n */\r\nexport default function(target, field, object) {\r\n\tvar firebase;\r\n\tobserve(object, (entries, _entries, e) => {\r\n\t\tif (firebase = ObserverBase.getForTarget(target)) {\r\n\t\t\tvar base = _objFrom(field, object);\r\n\t\t\treturn firebase.fire(new MutationEvent(target, {type:e.type, bubbling:true, data:base, _data:base, srcEvt:e}));\r\n\t\t}\r\n\t}, {observeDown:true, tags:['#e-bubbling', target]});\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _copy from '@web-native-js/commons/obj/copy.js';\r\nimport _merge from '@web-native-js/commons/obj/merge.js';\r\nimport _unique from '@web-native-js/commons/arr/unique.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport disconnect from './disconnect.js';\r\nimport connect from './connect.js';\r\n\r\n/**\r\n * Executes a callback function on a target in \"mutation\" mode.\r\n * Fires any observers that may be bound to target on recorded changes.\r\n *\r\n * @param array\t\t\ttargets\r\n * @param function\t\tcallback\r\n * @param array\t\t\tkeys\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return array|Event\r\n */\r\nexport default function(targets, callback, keys = [], returnEvent = false) {\r\n\tvar context = targets.map((target, i) => {\r\n\t\tif (!target || !_isTypeObject(target)) {\r\n\t\t\tthrow new Error('Target must be of type object!');\r\n\t\t}\r\n\t\treturn {\r\n\t\t\ttarget,\r\n\t\t\ttargetCopy: _copy(target, keys),\r\n\t\t\tsetData: {},\r\n\t\t\t_setData: {},\r\n\t\t\tdelData: {}, \r\n\t\t\t_delData: {},\r\n\t\t\tcreated: [],\r\n\t\t\tdeleted: [],\r\n\t\t};\r\n\t});\r\n\t// ---------------------------------\r\n\tvar result = callback(...targets);\r\n\t// ---------------------------------\r\n\tcontext.map(cntxt => {\r\n\t\tvar initialKeys = Object.keys(cntxt.targetCopy);\r\n\t\tvar currentKeys = Object.keys(cntxt.target);\r\n\t\tvar changedKeys = _unique(initialKeys.concat(currentKeys)).filter(key => {\r\n\t\t\tif ((keys.length && !keys.includes(key)) \r\n\t\t\t|| (_isArray(cntxt.target) && (key === 'length' || key === '< r e f l e c t >'))) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tif (!currentKeys.includes(key)) {\r\n\t\t\t\tcntxt._delData[key] = cntxt.targetCopy[key];\r\n\t\t\t\tcntxt.delData[key] = undefined;\r\n\t\t\t\tcntxt.deleted.push(key);\r\n\t\t\t} else {\r\n\t\t\t\tcntxt._setData[key] = cntxt.targetCopy[key];\r\n\t\t\t\tcntxt.setData[key] = cntxt.target[key];\r\n\t\t\t\tif (!initialKeys.includes(key)) {\r\n\t\t\t\t\tcntxt.created.push(key);\r\n\t\t\t\t} \r\n\t\t\t}\r\n\t\t\tif (cntxt.targetCopy[key] !== cntxt.target[key]) {\r\n\t\t\t\t// Unobserve outgoing value for bubbling\r\n\t\t\t\tif (cntxt.targetCopy[key] && _isTypeObject(cntxt.targetCopy[key])) {\r\n\t\t\t\t\tdisconnect(cntxt.target, key, cntxt.targetCopy[key]);\r\n\t\t\t\t}\r\n\t\t\t\t// Observe incoming value for bubbling\r\n\t\t\t\tif (cntxt.target[key] && _isTypeObject(cntxt.target[key])) {\r\n\t\t\t\t\tconnect(cntxt.target, key, cntxt.target[key]);\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t});\r\n\t\t// ---------------------------------\r\n\t\tvar evt, mutationBase;\r\n\t\tif (returnEvent || (mutationBase = ObserverBase.getForTarget(cntxt.target))) {\r\n\t\t\tevt = new MutationEvent(cntxt.target, {\r\n\t\t\t\ttype:'transaction', \r\n\t\t\t\tdata:_merge(cntxt.setData, cntxt.delData),\r\n\t\t\t\t_data:_merge(cntxt._setData, cntxt._delData),\r\n\t\t\t\tcreated:cntxt.created,\r\n\t\t\t\tdeleted:cntxt.deleted\r\n\t\t\t});\r\n\t\t\tif (mutationBase) {\r\n\t\t\t\tif (Object.keys(cntxt.delData).length) {\r\n\t\t\t\t\tevt.response(mutationBase.fire(\r\n\t\t\t\t\t\tnew MutationEvent(cntxt.target, {type:'del', data:cntxt.delData, _data:cntxt._delData, deleted:cntxt.deleted})\r\n\t\t\t\t\t));\r\n\t\t\t\t}\r\n\t\t\t\tif (Object.keys(cntxt.setData).length) {\r\n\t\t\t\t\tevt.response(mutationBase.fire(\r\n\t\t\t\t\t\tnew MutationEvent(cntxt.target, {type:'set', data:cntxt.setData, _data:cntxt._setData, created:cntxt.created})\r\n\t\t\t\t\t));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn returnEvent ? evt : changedKeys;\r\n\t});\r\n\treturn result;\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _objFrom from '@web-native-js/commons/obj/from.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _isNumeric from '@web-native-js/commons/js/isNumeric.js';\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport transaction from './transaction.js';\r\n\r\n/**\r\n * Runs a \"get\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeys\r\n *\r\n * @return mixed\r\n */\r\nexport default function(target, keys) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute any \"get\" traps, otherwise \"get\" the default way\r\n\tvar value, trapBase, defaultGet = function(_value) {\r\n\t\treturn arguments.length ? _value : (_isArray(keys) ? _objFrom(keys, target) : target[keys]);\r\n\t};\r\n\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\tvalue = trapBase.fire(new QueryEvent(target, {type:'get', query:keys}), defaultGet);\r\n\t} else {\r\n\t\tvalue = defaultGet();\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute array methods in \"mutation\" mode\r\n\tif (_isArray(target) && !_isNumeric(keys) && _isFunction(value)) {\r\n\t\treturn function reflexArrayMethodWrapper(...args) {\r\n\t\t\treturn transaction([target], () => {\r\n\t\t\t\treturn value.apply(target, args);\r\n\t\t\t});\r\n\t\t};\r\n\t}\r\n\treturn value;\r\n}\r\n","\r\n/**\r\n * Tells if ALL items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nexport default function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest && callback(itm), true);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\n\r\n/**\r\n * Runs an \"in\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string\t\tkey\r\n *\r\n * @return bool\r\n */\r\nexport default function(target, key) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute any \"has\" traps, otherwise \"test\" the default way\r\n\tvar trapBase, defaultHas = function(_state) {\r\n\t\treturn arguments.length ? _state : (key in target);\r\n\t};\r\n\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\treturn trapBase.fire(new QueryEvent(target, {type:'has', query:key}), defaultHas);\r\n\t}\r\n\treturn defaultHas();\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _all from '@web-native-js/commons/arr/all.js';\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _isNumber from '@web-native-js/commons/js/isNumber.js';\r\nimport _isObject from '@web-native-js/commons/js/isObject.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport disconnect from './disconnect.js';\r\nimport connect from './connect.js';\r\nimport reflexHas from './has.js';\r\n\r\n/**\r\n * Executes a \"_setProp\" type of operation on a target.\r\n * Fires any observers for the specific type that may be bound to target.\r\n *\r\n * @param bool\t\t\tdefine\r\n * @param array|object\ttarget\r\n * @param string|array\tkeysOrPayload\r\n * @param mixed\t\t\tvalue\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(define, target, keysOrPayload, value = null, returnEvent = false) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\tvar keys = keysOrPayload, _data = {}, data = {}, created = [];\r\n\tvar handleSet = (key, value) => {\r\n\t\t_data[key] = target[key];\r\n\t\tif (!reflexHas(target, key)) {\r\n\t\t\tcreated.push(key);\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\tvar descriptor;\r\n\t\tif (define) {\r\n\t\t\tdescriptor = value || {};\r\n\t\t\tvalue = descriptor.value;\r\n\t\t}\r\n\t\t// Execute any \"set\" traps, otherwise \"set\" the default way\r\n\t\tvar success, trapBase, defaultSet = function(_success) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\tif (descriptor) {\r\n\t\t\t\t\tObject.defineProperty(target, key, descriptor);\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttarget[key] = value;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn _success;\r\n\t\t};\r\n\t\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\t\tvar details = descriptor \r\n\t\t\t\t? {type:'define', query:key, descriptor} \r\n\t\t\t\t: {type:'set', query:key, value};\r\n\t\t\tsuccess = trapBase.fire(new QueryEvent(target, details), defaultSet);\r\n\t\t} else {\r\n\t\t\tsuccess = defaultSet();\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\tif (success) {\r\n\t\t\tdata[key] = value;\r\n\t\t\tif (data[key] !== _data[key]) {\r\n\t\t\t\t// Unobserve outgoing value for bubbling\r\n\t\t\t\tif (_data[key] && _isTypeObject(_data[key])) {\r\n\t\t\t\t\tdisconnect(target, key, _data[key]);\r\n\t\t\t\t}\r\n\t\t\t\t// Observe incoming value for bubbling\r\n\t\t\t\tif (data[key] && _isTypeObject(data[key])) {\r\n\t\t\t\t\tconnect(target, key, data[key]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn success;\r\n\t};\r\n\t// ---------------------------------\r\n\tvar successStates = [];\r\n\tif (_isArray(keys) || ((_isString(keys) || _isNumber(keys)) && (keys = _arrFrom(keys)))) {\r\n\t\tsuccessStates = keys.map(key => handleSet(key, value))\r\n\t} else if (_isObject(keysOrPayload)) {\r\n\t\tsuccessStates = Object.keys(keysOrPayload).map(key => handleSet(key, keysOrPayload[key]))\r\n\t\tif (arguments.length > 2) {\r\n\t\t\treturnEvent = value;\r\n\t\t}\r\n\t}\r\n\t// ---------------------------------\r\n\tvar evt, mutationBase;\r\n\tif (returnEvent || (mutationBase = ObserverBase.getForTarget(target))) {\r\n\t\tevt = new MutationEvent(target, {type:'set', data, _data, created});\r\n\t\tif (mutationBase && Object.keys(data).length) {\r\n\t\t\tmutationBase.fire(evt);\r\n\t\t}\r\n\t}\r\n\treturn returnEvent ? evt : _all(successStates, state => state);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _setProp from './_setProp.js';\r\n\r\n/**\r\n * Executes a \"set\" operation on a target.\r\n * Fires any observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeysOrPayload\r\n * @param mixed\t\t\tvalue\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(target, keysOrPayload, value = null, returnEvent = false) {\r\n\treturn _setProp(false/*define*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport reflexGet from './get.js';\r\nimport reflexSet from './set.js';\r\n\r\n/**\r\n * Initializes \"Reflxive getter/setter\" traps on the target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeys\r\n *\r\n * @return void\r\n */\r\nexport default function(target, keys) {\r\n\t_arrFrom(keys).forEach(key => {\r\n\t\tvar value = target[key], onGetFire, onSetFire;\r\n\t\tvar currentDescriptor = Object.getOwnPropertyDescriptor(target, key)\r\n\t\t|| {enumerable: key in target ? false/*existing but hidden*/ : true};\r\n\t\tif ('value' in currentDescriptor) {\r\n\t\t\tdelete currentDescriptor.value;\r\n\t\t}\r\n\t\tif ('writable' in currentDescriptor) {\r\n\t\t\tdelete currentDescriptor.writable;\r\n\t\t}\r\n\t\tcurrentDescriptor.get = () => {\r\n\t\t\tif (onGetFire) {\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tonGetFire = true;\r\n\t\t\tvar _value = reflexGet(target, key);\r\n\t\t\tonGetFire = false;\r\n\t\t\treturn _value;\r\n\t\t};\r\n\t\tcurrentDescriptor.set = newValue => {\r\n\t\t\tif (onSetFire) {\r\n\t\t\t\tvalue = newValue;\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tonSetFire = true;\r\n\t\t\tvar rspns = reflexSet(target, key, newValue);\r\n\t\t\tonSetFire = false;\r\n\t\t\treturn true;\r\n\t\t};\r\n\t\tObject.defineProperty(target, key, currentDescriptor);\r\n\t});\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\n\r\n/**\r\n * Runs a \"getProps\" type of query operation on a target.\r\n * Fires any observers for the specific type that may be bound to target.\r\n *\r\n * @param bool\t\t\townKeys\r\n * @param array|object\ttarget\r\n *\r\n * @return array\r\n */\r\nexport default function(ownKeys, target) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\t// Execute any \"keys\" traps, otherwise \"test\" the default way\r\n\tvar trapBase, defaultKeys = function(_keys) {\r\n\t\treturn arguments.length ? _keys : (\r\n\t\t\townKeys ? Object.getOwnPropertyNames(target) : Object.keys(target)\r\n\t\t);\r\n\t};\r\n\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\treturn trapBase.fire(new QueryEvent(target, {type:ownKeys ? 'ownKeys' : 'keys'}), defaultKeys);\r\n\t}\r\n\treturn defaultKeys();\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _getProps from './_getProps.js';\r\n\r\n/**\r\n * Runs a \"keys\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n *\r\n * @return array\r\n */\r\nexport default function(target) {\r\n\treturn _getProps(false/*ownKeys*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _getType from '@web-native-js/commons/js/getType.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport Trap from './internal/Trap.js';\r\n\r\n/**\r\n * Adds a trap to an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param function\t\t\t\t\tcallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return Trap\r\n */\r\nexport default function(object, callback, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tif (!_isFunction(callback)) {\r\n\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t}\r\n\tvar firebase;\r\n\tif (!(firebase = TrapBase.getForTarget(object))) {\r\n\t\tfirebase = TrapBase.createForTarget(object);\r\n\t}\r\n\treturn firebase.addFireable(new Trap(callback, params));\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _setProp from './_setProp.js';\r\n\r\n/**\r\n * Executes a \"set\" operation on a target.\r\n * Fires any observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeysOrPayload\r\n * @param mixed\t\t\tvalue\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(target, keysOrPayload, value = null, returnEvent = false) {\r\n\treturn _setProp(true/*define*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _all from '@web-native-js/commons/arr/all.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\nimport TrapBase from './internal/TrapBase.js';\r\nimport disconnect from './disconnect.js';\r\nimport reflexHas from './has.js';\r\n\r\n/**\r\n * Executes a \"delete\" operation on a target.\r\n * Fires any observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n * @param string|array\tkeys\r\n * @param bool\t\t\treturnEvent\r\n *\r\n * @return bool|Event\r\n */\r\nexport default function(target, keys, returnEvent = false) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\tvar keys = _arrFrom(keys), _data = {}, data = {}, deleted = [];\r\n\tvar successStates = keys.map(key => {\r\n\t\t_data[key] = target[key];\r\n\t\tif (reflexHas(target, key)) {\r\n\t\t\tdeleted.push(key);\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\t// Execute any \"del\" traps, otherwise \"del\" the default way\r\n\t\tvar success, trapBase, defaultDel = function(_success) {\r\n\t\t\tif (!arguments.length) {\r\n\t\t\t\tdelete target[key];\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn _success;\r\n\t\t};\r\n\t\tif (trapBase = TrapBase.getForTarget(target)) {\r\n\t\t\tsuccess = trapBase.fire(new QueryEvent(target, {type:'del', query:key}), defaultDel);\r\n\t\t} else {\r\n\t\t\tsuccess = defaultDel();\r\n\t\t}\r\n\t\t// ---------------------------------\r\n\t\tif (success) {\r\n\t\t\tdata[key] = undefined;\r\n\t\t\t// Unobserve outgoing value for bubbling\r\n\t\t\tif (_data[key] && _isTypeObject(_data[key])) {\r\n\t\t\t\tdisconnect(target, key, _data[key]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn success;\r\n\t});\r\n\t// ---------------------------------\r\n\tvar evt, mutationBase;\r\n\tif (returnEvent || (mutationBase = ObserverBase.getForTarget(target))) {\r\n\t\tevt = new MutationEvent(target, {type:'del', data, _data, deleted});\r\n\t\tif (mutationBase && Object.keys(data).length) {\r\n\t\t\tmutationBase.fire(evt);\r\n\t\t}\r\n\t}\r\n\treturn returnEvent ? evt : _all(successStates, state => state);\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport build from './build.js';\r\nimport observe from './observe.js';\r\nimport unobserve from './unobserve.js';\r\nimport trap from './trap.js';\r\nimport untrap from './untrap.js';\r\nimport def from './def.js';\r\nimport set from './set.js';\r\nimport del from './del.js';\r\nimport connect from './connect.js';\r\nimport disconnect from './disconnect.js';\r\nimport transaction from './transaction.js';\r\nimport get from './get.js';\r\nimport has from './has.js';\r\nimport init from './init.js';\r\nimport keys from './keys.js';\r\nimport ownKeys from './ownKeys.js';\r\nimport MutationEvent from './internal/MutationEvent.js';\r\nimport QueryEvent from './internal/QueryEvent.js';\r\n\r\n// Now we'll mimick standard Trap properties\r\n// so that can be used as standard Trap out of the box.\r\nconst deleteProperty = del;\r\nconst defineProperty = def;\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default {\r\n\tbuild,\r\n\tobserve,\r\n\tunobserve,\r\n\ttrap,\r\n\tuntrap,\r\n\tdef,\r\n\tdefineProperty,\r\n\tset,\r\n\tdel,\r\n\tdeleteProperty,\r\n\tconnect,\r\n\tdisconnect,\r\n\ttransaction,\r\n\tget,\r\n\thas,\r\n\tinit,\r\n\tkeys,\r\n\townKeys,\r\n\t// Events\r\n\tMutationEvent,\r\n\tQueryEvent,\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport init from './init.js';\r\nimport reflexKeys from './keys.js';\r\nimport reflexGet from './get.js';\r\nimport connect from './connect.js';\r\n\r\n/**\r\n * Recursively \"connects\" an object's members to the object\r\n * for reflex actions.\r\n *\r\n * @param array|object\ttarget\r\n * @param bool\t\t\t_init\r\n *\r\n * @return void\r\n */\r\nexport default function build(target, _init = false) {\r\n\tif (!target || !_isTypeObject(target)) {\r\n\t\tthrow new Error('Target must be of type object!');\r\n\t}\r\n\t// ---------------------------------\r\n\tvar keys = reflexKeys(target);\r\n\tkeys.forEach(key => {\r\n\t\tvar value = reflexGet(target, key);\r\n\t\tif (_isTypeObject(value) && value) {\r\n\t\t\tconnect(target, key, value);\r\n\t\t\tbuild(value, _init);\r\n\t\t}\r\n\t});\r\n\tif (_init) {\r\n\t\tinit(target, keys);\r\n\t}\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport ObserverBase from './internal/ObserverBase.js';\r\n\r\n/**\r\n * Removes a trap from an object's firebase.\r\n *\r\n * @param array|object\t\t\t\tobject\r\n * @param function\t\t\t\t\toriginalCallback\r\n * @param object\t\t\t\t\tparams\r\n *\r\n * @return void\r\n */\r\nexport default function(object, originalCallback, params = {}) {\r\n\tif (!object || !_isTypeObject(object)) {\r\n\t\tthrow new Error('Object must be of type object!');\r\n\t}\r\n\tvar firebase;\r\n\tif (firebase = ObserverBase.getForTarget(object)) {\r\n\t\tfirebase.findFireables({handler:originalCallback, params}).forEach(trap => {\r\n\t\t\tfirebase.removeFireable(trap);\r\n\t\t});\r\n\t}\r\n}\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _getProps from './_getProps.js';\r\n\r\n/**\r\n * Runs a \"ownKeys\" query operation on a target.\r\n * Fires any such query observers that may be bound to target.\r\n *\r\n * @param array|object\ttarget\r\n *\r\n * @return array\r\n */\r\nexport default function(target) {\r\n\treturn _getProps(true/*ownKeys*/, ...arguments);\r\n}\r\n","\r\n/**\r\n * -----------------\r\n * Static parameters\r\n * used across CHTML\r\n * -----------------\r\n */\r\nexport default {\r\n\tenv: 'server',\r\n\tcontext:{},\r\n\tfactory:null,\r\n\tattrMap: {\r\n\t\tmodel: 'chtml-model',\r\n\t\trelated: 'chtml-rel',\r\n\t\tbindings: 'chtml-bindings',\r\n\t\tnamespace: 'chtml-ns',\r\n\t\tsuperrole: 'chtml-role',\r\n\t\tsubrole: 'chtml-role',\r\n\t\tnocompose: ['nocompose', 'shadow',],\r\n\t\tbundle: 'chtml-bundle',\r\n\t},\r\n\ttagMap: {\r\n\t\tjsen: 'script[type=\"text/jsen\"]',\r\n\t\tjsenp: 'script[type=\"text/jsenp\"]',\r\n\t\tbundle: 'template[is=\"chtml-bundle\"]',\r\n\t\timport: 'chtml-import',\r\n\t},\r\n\tremodelCallback:null,\r\n\tdataKey:'$',\r\n\tglobalParamsAttrs:[\r\n\t\t'related', \r\n\t\t'bindings',\r\n\t],\r\n\thideDefsheet:true,\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport globalParams from '../params.js';\r\n\r\n/**\r\n * Creates or finds a DOM element from source.\r\n *\r\n * @param string\t\tsource\r\n * @param object\t\tcontextDocument\r\n *\r\n * @return HTMLElement\r\n */\r\nexport default function(source, contextDocument = null) {\r\n\tcontextDocument = contextDocument || globalParams.context.document;\r\n\tif (contextDocument) {\r\n\t\tvar el;\r\n\t\tif (source.trim().startsWith('<')) {\r\n\t\t\t// Create a node from markup\r\n\t\t\tvar temp = contextDocument.createElement('div');\r\n\t\t\ttemp.innerHtml = source;\r\n\t\t\tel = temp.firstChild;\r\n\t\t} else {\r\n\t\t\tel = contextDocument.querySelector(source);\r\n\t\t}\r\n\t\treturn el;\r\n\t}\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _unique from '@web-native-js/commons/arr/unique.js';\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport recomposeDirectives from './recomposeDirectives.js';\r\nimport globalParams from '../params.js';\r\n\r\n/**\r\n * Composes definitions (related, directives) from elFrom into elTo.\r\n *\r\n * @param HTMLElement\t\t\t\telFrom\r\n * @param HTMLElement\t\t\t\telTo\r\n * @param string\t\t\t\t\tappendOrPrepend\r\n * @param array\t\t\t\t\t\tnorecompose\r\n *\r\n * @return HTMLElement\r\n */\r\nexport default function(elFrom, elTo, appendOrPrepend, norecompose = []) {\r\n\tnorecompose = norecompose.concat([globalParams.attrMap.namespace, ...globalParams.attrMap.nocompose]);\r\n\tif (elTo.hasAttribute('norecompose')) {\r\n\t\tnorecompose = norecompose.concat((elTo.getAttribute('norecompose') || '*').split(' ').map(val => val.trim()));\r\n\t}\r\n\t// ----------------------------\r\n\t// Custom Composition...\r\n\t// ----------------------------\r\n\tif (_isFunction(globalParams.recomposeCallback)) {\r\n\t\tvar disposition = globalParams.recomposeCallback(elFrom, elTo, appendOrPrepend, norecompose);\r\n\t\tif (disposition === false) {\r\n\t\t\treturn false;\r\n\t\t} else if (_isString(disposition) || _isArray(disposition)) {\r\n\t\t\tnorecompose = norecompose.concat(disposition);\r\n\t\t}\r\n\t}\r\n\t// ----------------------------\r\n\t// Merge list attributes...\r\n\t// ----------------------------\r\n\t_unique([globalParams.attrMap.superrole, globalParams.attrMap.subrole, 'role', 'class']).forEach(type => {\r\n\t\tvar b_attr, a_attr;\r\n\t\tif (!norecompose.includes(type) && !norecompose.includes('*') && (b_attr = elFrom.getAttribute(type))) {\r\n\t\t\tif (a_attr = elTo.getAttribute(type)) {\r\n\t\t\t\tvar jointList = appendOrPrepend === 'prepend' ? [b_attr, a_attr] : [a_attr, b_attr];\r\n\t\t\t} else {\r\n\t\t\t\tvar jointList = [b_attr];\r\n\t\t\t}\r\n\t\t\telTo.setAttribute(type, _unique(jointList.join(' ').split(' ').map(r => r.trim())).join(' '));\r\n\t\t\tnorecompose.push(type);\r\n\t\t}\r\n\t});\r\n\t// ----------------------------\r\n\t// Merge definition attributes...\r\n\t// ----------------------------\r\n\tglobalParams.globalParamsAttrs.map(attr => globalParams.attrMap[attr]).concat('style').forEach(type => {\r\n\t\tvar b_attr, a_attr;\r\n\t\tif (!norecompose.includes(type) && !norecompose.includes('*') && (b_attr = elFrom.getAttribute(type))) {\r\n\t\t\tif (a_attr = elTo.getAttribute(type)) {\r\n\t\t\t\tvar jointDefs = appendOrPrepend === 'prepend' ? [b_attr, a_attr] : [a_attr, b_attr];\r\n\t\t\t\tif (!jointDefs[0].trim().endsWith(';')) {\r\n\t\t\t\t\tjointDefs[0] = jointDefs[0] + ';';\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tvar jointDefs = [b_attr];\r\n\t\t\t}\r\n\t\t\telTo.setAttribute(type, jointDefs.join(' '));\r\n\t\t\tnorecompose.push(type);\r\n\t\t}\r\n\t});\r\n\t// ----------------------------\r\n\t// Port all other attributes...\r\n\t// ----------------------------\r\n\tfor (var i = 0; i < elFrom.attributes.length; i ++) {\r\n\t\tvar attr = elFrom.attributes[i];\r\n\t\tif (!norecompose.includes(attr.name) && !norecompose.includes('*') && !elTo.hasAttribute(attr.name)) {\r\n\t\t\telTo.setAttribute(attr.name, attr.value);\r\n\t\t\tnorecompose.push(attr.name);\r\n\t\t}\r\n\t}\r\n\t// ----------------------------\r\n\t// For data blocks...\r\n\t// ----------------------------\r\n\tif (!norecompose.includes('@cps') && !norecompose.includes('*')) {\r\n\t\tvar elToDefs = _arrFrom((elTo.shadowRoot || elTo).children)\r\n\t\t\t.filter(node => node.matches(globalParams.tagMap.jsenp));\r\n\t\tvar elFromDefs = _arrFrom((elFrom.shadowRoot || elFrom).children)\r\n\t\t\t.filter(node => node.matches(globalParams.tagMap.jsenp));\r\n\t\tif (elFromDefs.length) {\r\n\t\t\tif (elToDefs.length) {\r\n\t\t\t\telToDefs[0][appendOrPrepend](elFromDefs[0].textContent);\r\n\t\t\t} else {\r\n\t\t\t\telTo.prepend(elFromDefs[0].cloneNode(true));\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn elTo;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport recomposeNodes from './recomposeNodes.js';\r\nimport recomposeDirectives from './recomposeDirectives.js';\r\nimport globalParams from '../params.js';\r\n\r\n/**\r\n * Composes a component from a super component.\r\n *\r\n * All definitions (related, directives) will be inherited.\r\n * If the idea is to import, the super component's element will be returned,\r\n * (On import, nodes in component (as defined, if) will be uploaded into slots in the super component.)\r\n *\r\n * @param HTMLElement\t\t\t\telTo\r\n * @param HTMLElement\t\t\t\telFrom\r\n *\r\n * @return HTMLElement\r\n */\r\nexport default function(elFrom, elTo) {\r\n\tif (elTo.matches(globalParams.tagMap.import)) {\r\n\t\treturn recomposeNodes(elTo/*from import actually*/, elFrom/*to element actually*/);\r\n\t}\r\n\t// We will append defs from the elFrom into elTo\r\n\treturn recomposeDirectives(elFrom, elTo, 'prepend');\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport recomposeDirectives from './recomposeDirectives.js';\r\nimport globalParams from '../params.js';\r\n\t\r\n/**\r\n * Composes a component from a super component.\r\n *\r\n * All definitions (related, directives) will be inherited.\r\n * If the idea is to import, the super component's element will be returned,\r\n * (On import, nodes in component (as defined, if) will be uploaded into slots in the super component.)\r\n *\r\n * @param HTMLElement\t\t\t\telFrom\r\n * @param HTMLElement\t\t\t\telTo\r\n *\r\n * @return HTMLElement\r\n */\r\nexport default function(elFrom, elTo) {\r\n\telTo = elTo.cloneNode(true);\r\n\tvar elFromNs = elFrom.getAttribute(globalParams.attrMap.namespace);\r\n\tvar elToNs = elTo.getAttribute(globalParams.attrMap.namespace);\r\n\tvar elToRoles = (elTo.getAttribute(globalParams.attrMap.superrole) || '').split(' ').map(r => r.trim());\r\n\t// -------------------------\r\n\t// So we concat() the role attribute\r\n\t// -------------------------\r\n\telTo.setAttribute(globalParams.attrMap.namespace, elFromNs);\r\n\t// We will prepend defs from the elFrom into elTo\r\n\trecomposeDirectives(elFrom, elTo, 'append');\r\n\t// -------------------------\r\n\t// Upload nodes into elTo just the way slots work in Web Compoonents\r\n\t// -------------------------\r\n\t_arrFrom((elFrom.shadowRoot || elFrom).children).forEach((replacementNode, i) => {\r\n\t\tif (replacementNode.matches(globalParams.tagMap.jsenp)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treplacementNode = replacementNode.cloneNode(true);\r\n\t\tvar applicableContextRoles = [], applicableReplacementNodeRoles = [];\r\n\t\tvar replacementNodeRoles = (replacementNode.getAttribute(globalParams.attrMap.subrole) || '').split(' ').map(r => r.trim());\r\n\t\treplacementNodeRoles.forEach(replacementNodeRole => {\r\n\t\t\tvar _applicableContextRoles = elToRoles.filter(contextRole => replacementNodeRole.startsWith(contextRole + '-'));\r\n\t\t\tif (_applicableContextRoles.length) {\r\n\t\t\t\tapplicableContextRoles.push(_applicableContextRoles[0]);\r\n\t\t\t\tapplicableReplacementNodeRoles.push(replacementNodeRole);\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar CSSEscape = globalParams.context.CSS ? globalParams.context.CSS.escape : str => str;\r\n\t\tif (applicableContextRoles.length) {\r\n\t\t\tvar slotNodes;\r\n\t\t\tvar contextSelector = applicableContextRoles.map(contextRole => '[' + CSSEscape(globalParams.attrMap.superrole) + '~=\"' + contextRole + '\"]');\r\n\t\t\tvar slotNodeSelector = applicableReplacementNodeRoles.map(replacementNodeRole => '[' + CSSEscape(globalParams.attrMap.subrole) + '~=\"' + replacementNodeRole + '\"]');\r\n\t\t\tif ((elTo.shadowRoot && (slotNodes = elTo.shadowRoot.querySelectorAll(slotNodeSelector)))\r\n\t\t\t|| ((slotNodes = elTo.querySelectorAll(slotNodeSelector)).length === 1 && slotNodes[0].closest(contextSelector) === elTo)) {\r\n\t\t\t\t// We will prepend defs from the slot node into replacement node\r\n\t\t\t\trecomposeDirectives(slotNodes[0], replacementNode, 'prepend');\r\n\t\t\t\t// Port to target...\r\n\t\t\t\tslotNodes[0].replaceWith(replacementNode);\r\n\t\t\t} else {\r\n\t\t\t\tthrow new Error('Composition Error: Node #' + i + ' (at ' + elFromNs + ') must match exactly one targetNode in ' + elToNs + '! (' + slotNodes.length + ' matched)');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\telTo.append(replacementNode);\r\n\t\t}\r\n\t});\r\n\treturn elTo;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Matrix loader\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class Matrix {\r\n\t\r\n\t/**\r\n\t * Creates a new Matrix instance.\r\n\t *\r\n\t * @param array \t\t\tsources\r\n\t * @param string|array \t\tnamespace\r\n\t * @param function \t\t\tgetter\r\n\t * @param MatrixInterface\tcarry\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(sources, namespace, getter, carry = null) {\r\n\t\tthis.sources = _arrFrom(sources);\r\n\t\tthis.namespace = _arrFrom(namespace);\r\n\t\tthis.getter = getter;\r\n\t\tthis.carry = carry;\r\n\t\tthis.collections = {};\r\n\t\tthis.value;\r\n\t}\r\n\r\n\t/**\r\n\t * Enters into a sub collection if exists.\r\n\t *\r\n\t * @param string \t\t\tname\r\n\t *\r\n\t * @return MatrixInterface\r\n\t */\r\n\tenter(name) {\r\n\t\tif (!(name in this.collections)) {\r\n\t\t\tthis.collections[name] = new Matrix(\r\n\t\t\t\tthis.sources, \r\n\t\t\t\tthis.namespace.concat(name),\r\n\t\t\t\tthis.getter,\r\n\t\t\t\tthis \r\n\t\t\t);\r\n\t\t}\r\n\t\treturn this.collections[name];\r\n\t}\r\n\r\n\t/**\r\n\t * Leaves the current current collection into the super collection if exists.\r\n\t *\r\n\t * @return MatrixInterface\r\n\t */\r\n\tleave() {\r\n\t\treturn this.carry;\r\n\t}\r\n\r\n\t/**\r\n\t * Lazy-loads a property from sources.\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget() {\r\n\t\tif (!this.value) {\r\n\t\t\tvar namespace = this.namespace.slice();\r\n\t\t\tvar value = this.carry ? this.carry.get() : null;\r\n\t\t\tthis.sources.forEach((source, i) => {\r\n\t\t\t\tif (value = this.getter.call(null, source, namespace, value, i)) {\r\n\t\t\t\t\tthis.value = value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this.value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds the most-specific module for the given namespace from sources.\r\n\t *\r\n\t * @param sting\t\t\t\t\tnamespace\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tfind(namespace) {\r\n\t\tvar nsArray = namespace.split('/');\r\n\t\tvar subMatrix, nsKey, nsDrill = this;\r\n\t\twhile((nsKey = nsArray.shift()) && (nsDrill = nsDrill.enter(nsKey))) {\r\n\t\t\tsubMatrix = nsDrill; \r\n\t\t}\r\n\t\t// Clone now...\r\n\t\tvar el = subMatrix.get();\r\n\t\tif (el) {\r\n\t\t\treturn el.cloneNode(true);\r\n\t\t}\r\n\t}\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen, {\r\n\tArgumentsInterface,\r\n\tArguments,\r\n\tLexer\r\n} from '@web-native-js/jsen';\r\nimport _last from '@web-native-js/commons/arr/last.js';\r\nimport _copy from '@web-native-js/commons/obj/copy.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class Rule {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(key, value, flag = null) {\r\n\t\tthis.key = key;\r\n\t\tthis.value = value;\r\n\t\tthis.flag = flag;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.key + ': ' + this.value + (this.flag ? ' ' + this.flag : '');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Serializes the expression to a JSEN expression.\r\n\t *\r\n\t * @param bool\t\tallowChaining\r\n\t *\r\n\t * @return string\r\n\t */\r\n\ttoJsenString(allowChaining = false) {\r\n\t\tvar argsExpr = (allowChaining === false || !this.value.trim().startsWith('(') ? [this.value] : Lexer.split(this.value, ['.']))\r\n\t\t\t.map(expr => Jsen.parse(expr, [Arguments], {assert:false}) || Jsen.parse(expr));\r\n\t\tif (argsExpr.length !== argsExpr.filter(a => a).length) {\r\n\t\t\tthis.error('Malformed argument in the CPS expression: ' + this.toString());\r\n\t\t\treturn;\r\n\t\t}\r\n\t\treturn this.key + (argsExpr.length > 1 || argsExpr[0] instanceof ArgumentsInterface ? argsExpr.join('.') : '(' + argsExpr[0].toString() + ')');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return Rule\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\tif (expr) {\r\n\t\t\tvar _opts = _copy(opts);\r\n\t\t\t_opts.limit = 1;\r\n\t\t\tvar ruleSplit = Lexer.split(expr, [':'], _opts);\r\n\t\t\tif (ruleSplit.length < 2) {\r\n\t\t\t\tthrow new Error('Malformed rule: ' + expr);\r\n\t\t\t}\r\n\t\t\tvar key = ruleSplit.shift().trim();\r\n\t\t\tvar value, flag, vf = Lexer.split(ruleSplit.shift().trim(), [' '], opts);\r\n\t\t\tif (vf.length > 1) {\r\n\t\t\t\tif (Rule.flags.includes(_last(vf).trim().toLowerCase())) {\r\n\t\t\t\t\tflag = vf.pop().trim().toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvalue = vf.join(' ');\r\n\t\t\treturn new Rule(key, value, flag);\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nRule.flags = [\r\n\t'!important',\r\n\t'!fallback',\r\n];","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen, {\r\n\tLexer\r\n} from '@web-native-js/jsen';\r\nimport _wrapped from '@web-native-js/commons/str/wrapped.js';\r\nimport _unwrap from '@web-native-js/commons/str/unwrap.js';\r\nimport Rule from './Rule.js';\r\nimport globalParams from '../params.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class RuleSheet {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(atRules = []) {\r\n\t\tthis.atRules = atRules;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.atRules.map(atRule => {\r\n\t\t\treturn [\r\n\t\t\t\t'@' + atRule.name,\r\n\t\t\t\tatRule.specifiers.join(' '),\r\n\t\t\t\t(atRule.condition || '').toString(context),\r\n\t\t\t\t\"{\\r\\n\\t\" + atRule.body.map(rule => rule.toString(context)).join(\";\\r\\n\\t\") + \"\\r\\n}\",\r\n\t\t\t].filter(a => a).join(' ');\r\n\t\t}).join(\"\\r\\n\");\r\n\t}\r\n\t \r\n\t/**\r\n\t * Returns a flat list of rules whose\r\n\t * atRule block passes the filter.\r\n\t *\r\n\t * @param function\tcallback\r\n\t * @param bool\t\trewriteWithAtRuleCondition\r\n\t * @param bool\t\truleChaining\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfilter(callback, rewriteWithAtRuleCondition = false, ruleChaining = false) {\r\n\t\tvar rules = [];\r\n\t\t// -------------------\r\n\t\t// BLOCK FILTERING\r\n\t\t// -------------------\r\n\t\tthis.atRules.filter(callback).forEach(atRule => {\r\n\t\t\tvar atRuleConditionAbs;\r\n\t\t\tif (rewriteWithAtRuleCondition) {\r\n\t\t\t\tatRuleConditionAbs = atRule.condition\r\n\t\t\t\t\t// Prepend each reference with the atRule.name as context\r\n\t\t\t\t\t? atRule.condition.toString(atRule.name)\r\n\t\t\t\t\t// Use the atRule.name as a condition\r\n\t\t\t\t\t: atRule.name;\r\n\t\t\t}\r\n\t\t\tatRuleConditionAbs = Jsen.parse(atRuleConditionAbs);\r\n\t\t\tatRule.body.forEach(rule => {\r\n\t\t\t\trules.push({\r\n\t\t\t\t\trule,\r\n\t\t\t\t\tatRuleName:atRule.name,\r\n\t\t\t\t\tatRuleCondition:atRule.condition,\r\n\t\t\t\t\tatRuleConditionAbs:atRuleConditionAbs,\r\n\t\t\t\t\tatRuleSpecifiers:atRule.specifiers,\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\t\t// -------------------\r\n\t\t// CASCADING AND OVERRIDING\r\n\t\t// -------------------\r\n\t\trules.reduce((build, current) => {\r\n\t\t\tbuild.forEach(existing => {\r\n\t\t\t\tif (existing.isDuplicate || existing.overridden) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar key_a = existing.rule.key.toString();\r\n\t\t\t\tvar value_a = existing.rule.value.toString();\r\n\t\t\t\tvar value_aUnwrapped = _wrapped(value_a, '(', ')') ? _unwrap(value_a, '(', ')') : value_a;\r\n\t\t\t\tvar key_b = current.rule.key.toString();\r\n\t\t\t\tvar value_b = current.rule.value.toString();\r\n\t\t\t\tvar value_bUnwrapped = _wrapped(value_b, '(', ')') ? _unwrap(value_b, '(', ')') : value_b;\r\n\t\t\t\tvar incase_a = (existing.rule.flag || '').toLowerCase() === '!fallback';\r\n\t\t\t\tvar important_a = (existing.rule.flag || '').toLowerCase() === '!important';\r\n\t\t\t\tvar incase_b = (current.rule.flag || '').toLowerCase() === '!fallback';\r\n\t\t\t\tvar important_b = (current.rule.flag || '').toLowerCase() === '!important';\r\n\t\t\t\tif (key_a === key_b) {\r\n\t\t\t\t\tif ((value_a === value_b || value_aUnwrapped === value_bUnwrapped) \r\n\t\t\t\t\t&& (important_a === important_b || incase_a === incase_b)) {\r\n\t\t\t\t\t\tcurrent.isDuplicate = true;\r\n\t\t\t\t\t} else if (important_b || incase_a) {\r\n\t\t\t\t\t\texisting.overridden = true;\r\n\t\t\t\t\t} else if ((important_a || incase_b)) {\r\n\t\t\t\t\t\tcurrent.overridden = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn build.concat([current]);\r\n\t\t}, []);\r\n\t\t// -------------------\r\n\t\t// FINAL FILTERING AND PARSING\r\n\t\t// -------------------\r\n\t\treturn rules.filter(ruleObj => !ruleObj.isDuplicate && !ruleObj.overridden).map(ruleObj => {\r\n\t\t\tvar ruleToJsen = ruleObj.rule.toJsenString(ruleChaining);\r\n\t\t\tif (ruleObj.atRuleConditionAbs) {\r\n\t\t\t\tvar finalRule = '(' + ruleObj.atRuleConditionAbs + ') && \"SEPARATOR\" ? (' + ruleToJsen + ') : return'\r\n\t\t\t} else {\r\n\t\t\t\tvar finalRule = ruleToJsen\r\n\t\t\t}\r\n\t\t\truleObj.finalRule = Jsen.parse(finalRule);\r\n\t\t\treturn ruleObj;\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\texpr = expr.trim();\r\n\t\tvar splits = Lexer.split(expr, ['@'], opts).slice(1)/*the empty first array*/.map(atRule => {\r\n\t\t\tvar atRuleSplits = Lexer.split(atRule.trim(), [' '], opts).filter(part => part.trim());\r\n\t\t\t// Obtain the parts\r\n\t\t\tvar name = atRuleSplits.shift().trim(), specifiers = [], condition, body = atRuleSplits.pop().trim();\r\n\t\t\t// We determine specifiers and condition from whatever may remain in atRuleSplits\r\n\t\t\twhile(atRuleSplits.length && !atRuleSplits[0].trim().startsWith('(')) {\r\n\t\t\t\t// We have a specifiers\r\n\t\t\t\tspecifiers.push(atRuleSplits.shift());\r\n\t\t\t}\r\n\t\t\t// Any atRuleSplits?\r\n\t\t\tif (atRuleSplits.length) {\r\n\t\t\t\tcondition = Jsen.parse(atRuleSplits.join(' ').trim());\r\n\t\t\t}\r\n\t\t\t// Body must be in curly braces\r\n\t\t\tif (!name || !_wrapped(body, '{', '}')) {\r\n\t\t\t\tthrow new Error('Malformed @rule: ' + expr);\r\n\t\t\t}\r\n\t\t\tbody = Lexer.split(_unwrap(body, '{', '}'), [';'], opts).filter(rule => rule.trim()).map(rule => Rule.parse(rule.trim()));\r\n\t\t\treturn {\r\n\t\t\t\tname,\r\n\t\t\t\tspecifiers,\r\n\t\t\t\tcondition,\r\n\t\t\t\tbody,\r\n\t\t\t};\r\n\t\t});\r\n\t\tif (splits.length) {\r\n\t\t\treturn new RuleSheet(splits);\r\n\t\t}\r\n\t}\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects into first array/object but only when not set;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(...objs) {\r\n\treturn _mergeCallback(objs, (key, obj1, obj2) => {\r\n\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\tif (obj1.indexOf(obj2[key]) === -1) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else if (!(key in obj1)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '@web-native-js/commons/js/isObject.js';\r\nimport _pushUnique from '@web-native-js/commons/arr/pushUnique.js';\r\nimport _intersect from '@web-native-js/commons/arr/intersect.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The HTML Context Model Schema.\r\n\t// @see https://html.spec.whatwg.org/multipage\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\n/**\r\n * @object\r\n */\r\nconst Schema = {\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\tstd: {\r\n\t\t/**\r\n\t\t * @uncategorized\r\n\t\t */\r\n\t\thtml: {\r\n\t\t\ttype: ['#sectioning-root'],\r\n\t\t\tmodel: ['head', 'body'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcaption: {\r\n\t\t\tmodel: ['#flow', '!table'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcol: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tcolgroup: {\r\n\t\t\tmodel: [{'colgroup[span]': ['#nothing']}, {':not(colgroup[span])': ['col', 'template']}],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tdd: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'definition',\r\n\t\t},\r\n\t\tdt: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tfigcaption: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thead: {\r\n\t\t\tmodel: ['#metadata'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlegend: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tli: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'listitem',\r\n\t\t},\r\n\t\toptgroup: {\r\n\t\t\tmodel: ['option', '#script-supporting'],\r\n\t\t\timplicitRole: 'group',\r\n\t\t},\r\n\t\toption: {\r\n\t\t\tmodel: [{'option[label][value]': ['#nothing']}, {'option[label]:not(option[value])': ['#text']}, {':not(option[label])': ['#text']}],\r\n\t\t},\r\n\t\tparam: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\trp: {\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\trt: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsource: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tsummary: {\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#phrasing', '#heading'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttrack: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttbody: {\r\n\t\t\tmodel: ['#script-supporting', 'tr'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t},\r\n\t\ttfoot: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tthead: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttr: {\r\n\t\t\tmodel: ['#script-supporting', 'td', 'th'],\r\n\t\t},\r\n\t\t/**\r\n\t\t * @categorized\r\n\t\t */\r\n\t\ta: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'a[href]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#interactive', '!a'],\r\n\t\t},\r\n\t\tabbr: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing',],\r\n\t\t},\r\n\t\taddress: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer', '!address',],\r\n\t\t},\r\n\t\t// If a child of <map>\r\n\t\tarea: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tarticle: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'article',\r\n\t\t\tacceptableRoles: ['application', 'article', 'document', 'main',],\r\n\t\t},\r\n\t\taside: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'complementary',\r\n\t\t\tacceptableRoles: ['complementary', 'note', 'search',],\r\n\t\t},\r\n\t\taudio: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'audio[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(audio[src])': ['source']}],\r\n\t\t},\r\n\t\tb: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbase: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbdi: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbdo: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tblockquote: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\tbody: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow', '@banner', '@contentinfo', '@complementary', '@main'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tbutton: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#phrasing', '!#interactive'],\r\n\t\t},\r\n\t\tcanvas: {\r\n\t\t\ttype: ['#embedded', '#flow', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#transparent', '!#interactive', 'a', 'img[usemap]', 'button', 'input[type=\"button\"]', 'input[type=\"radio\"]', 'input[type=\"checkbox\"]', 'select[multiple]', 'select[size>=1]', /*has tabindex but not #interactive*/'[tabindex]!#interactive'],\r\n\t\t},\r\n\t\tcite: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tcode: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdata: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdatalist: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '#script-supporting', 'option'],\r\n\t\t},\r\n\t\tdel: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tdetails: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow', 'summary'],\r\n\t\t},\r\n\t\tdfn: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '!dfn'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tdialog: {\r\n\t\t\ttype: ['#flow', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'dialog',\r\n\t\t},\r\n\t\tdiv: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [{'dl > div': ['dt', 'dd']}, {':not(dl > div)': ['#flow']}],\r\n\t\t},\r\n\t\tdl: {\r\n\t\t\t/*complicated*/\r\n\t\t\ttype: ['#flow', /*{:contains(> * name-value group): ['#palpable']}*/],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#script-supporting', 'dl', 'dt', 'div'],\r\n\t\t},\r\n\t\tem: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tembed: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tfieldset: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['legend', '#flow'],\r\n\t\t},\r\n\t\tfigure: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['#flow', 'figcaption'],\r\n\t\t\timplicitRole: 'figure',\r\n\t\t},\r\n\t\tfooter: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['contentinfo',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tform: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!form'],\r\n\t\t},\r\n\t\th1: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th2: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th3: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th4: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th5: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th6: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\theader: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['banner',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thgroup: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', '#script-supporting'],\r\n\t\t},\r\n\t\thr: {\r\n\t\t\ttype: ['#flow'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\timplicitRole: 'separator',\r\n\t\t},\r\n\t\ti: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tiframe: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\timg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'img[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tinput: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'input:not([type!=\"hidden\"])': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tins: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tkbd: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tlabel: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!label'],\r\n\t\t},\r\n\t\tlink: {\r\n\t\t\ttype: ['#metadata', {'body link': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tmain: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'main',\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tmap: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmark: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmath: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\tmenu: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tmeta: {\r\n\t\t\ttype: ['#metadata', {'meta[itemprop]': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tnames: ['application-name', 'author', 'description', 'generator', 'keywords', 'referrer', 'theme-color'],\r\n\t\t},\r\n\t\tmeter: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tnav: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'navigation',\r\n\t\t\tacceptableRoles: ['navigation',],\r\n\t\t},\r\n\t\tnoscript: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing'], \r\n\t\t\tmodel: [{'head link': ['style', 'meta', 'link']}, {':not(head link)': ['#transparent', '!noscript']}],\r\n\t\t},\r\n\t\tobject: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'object[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', 'param'],\r\n\t\t},\r\n\t\tol: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\toutput: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tp: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tpicture: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing'], \r\n\t\t\tmodel: ['source', 'img', '#acript-supporting'],\r\n\t\t},\r\n\t\tpre: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tprogress: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!progress'],\r\n\t\t},\r\n\t\tq: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\truby: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'],\r\n\t\t\t/*complicated*/ \r\n\t\t\tmodel: ['rp', 'rt'],\r\n\t\t},\r\n\t\ts: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsamp: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tscript: {\r\n\t\t\ttype: ['#flow', '#metadata', '#phrasing', '#acript-supporting'], \r\n\t\t\tmodel: [{'script[src]': []}],\r\n\t\t},\r\n\t\tsection: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'region',\r\n\t\t\tacceptableRoles: ['alert', 'alertdialog', 'application', 'contentinfo', 'dialog', 'document', 'log', 'main', 'marquee', 'region', 'search', 'status',],\r\n\t\t},\r\n\t\tselect: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['option', 'optgroup', '#acript-supporting'],\r\n\t\t},\r\n\t\tslot: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tsmall: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tspan: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstrong: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstyle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\tsub: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsup: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsvg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\ttable: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['caption', 'colgroup', 'thead', 'tbody', 'tr', 'tfoot', '#script-supporting'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\ttemplate: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing', '#script-supporting'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttextarea: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\ttime: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: [{'time[datetime]': ['#phrasing']}, {':not(time[datetime])': ['#text']}],\r\n\t\t},\r\n\t\ttitle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tu: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tul: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tvar: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tvideo: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'video[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(video[src])': ['source']}],\r\n\t\t},\r\n\t\twbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\taria: {\r\n\t\tbanner: {\r\n\t\t\ttype: ['@banner'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcontentinfo: {\r\n\t\t\ttype: ['@contentinfo'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcomplementary: {\r\n\t\t\ttype: ['@complementary'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tnavigation: {\r\n\t\t\ttype: ['@navigation'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlist: {\r\n\t\t\ttype: ['@list'], \r\n\t\t},\r\n\t\tlistitem: {\r\n\t\t\ttype: ['@listitem'], \r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic content model for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetContentModelFor(el) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\treturn Schema.std[elTagName] ? Schema.expandRules(el, Schema.std[elTagName].model || []) : [];\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic categories for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param bool\t\t\t\t\t\troleInclusive\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetCategoriesFor(el, roleInclusive = true) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\tvar elSchema = Schema.std[elTagName] || Schema.aria[elTagName] || {};\r\n\t\tvar currentElCategories = [];\r\n\t\tif (roleInclusive && !el.nodeName.startsWith('#') \r\n\t\t&& (el.hasAttribute('role') || elSchema.implicitRole)) {\r\n\t\t\t// Current el's impliable/acceptable roles\r\n\t\t\t// (These take precedence over native semantics)\r\n\t\t\tif (el.hasAttribute('role')) {\r\n\t\t\t\tvar definedRoles = el.getAttribute('role').split(' ');\r\n\t\t\t\tel.getAttribute('role').split(' ').forEach(role => {\r\n\t\t\t\t\tif (elSchema && elSchema.acceptableRoles && !elSchema.acceptableRoles.includes(role)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\trole = role.trim();\r\n\t\t\t\t\tcurrentElCategories.push('@' + role);\r\n\t\t\t\t\tif (Schema.aria[role] && Schema.aria[role].type) {\r\n\t\t\t\t\t\tcurrentElCategories = currentElCategories.concat(Schema.expandRules(el, Schema.aria[role].type || []));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (elSchema.implicitRole) {\r\n\t\t\t\t_pushUnique(currentElCategories, '@' + elSchema.implicitRole, elTagName);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Current node's categories/tagname\r\n\t\t\tvar currentElCategories = _pushUnique(Schema.expandRules(el, elSchema.type || []), elTagName);\r\n\t\t}\r\n\t\treturn currentElCategories;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node belongs in the context's content model\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tcontext\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInContentModel(context, node) {\r\n\t\tvar contextModel = context instanceof HTMLElement \r\n\t\t\t? Schema.getContentModelFor(context)\r\n\t\t\t: context;\r\n\t\tvar nodeCategories = node instanceof HTMLElement \r\n\t\t\t? Schema.getCategoriesFor(node)\r\n\t\t\t: node;\r\n\t\tif (_intersect(contextModel, ['#nothing', '#text']).length) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar valid;\r\n\t\t// So current content model has to list either this node's categories,\r\n\t\t// tagname, or impliable/acceptable roles\r\n\t\tcontextModel.forEach(allowedNode => {\r\n\t\t\tif (allowedNode.startsWith('!')) {\r\n\t\t\t\tvar disallowedNode = allowedNode.substr(1);\r\n\t\t\t\tif (nodeCategories.includes(disallowedNode)) {\r\n\t\t\t\t\tvalid = false;\r\n\t\t\t\t}\r\n\t\t\t} else if (valid !== false) {\r\n\t\t\t\tif (nodeCategories.includes(allowedNode)) {\r\n\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn valid && true;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node is associated to the context directly\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tscope\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t * @param object\t\t\t\t\tnodeSchema\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInScopeAs(scope, node, nodeSchema = null) {\r\n\t\tvar contextCategories = Schema.getCategoriesFor(scope);\r\n\t\tvar closest, current = node, nodeModel;\r\n\t\twhile (!closest && (current = current.parentNode)) {\r\n\t\t\tif (_intersect(contextCategories, Schema.getCategoriesFor(current)).length\r\n\t\t\t\t&& Schema.assertNodeBelongsInContentModel(current, nodeSchema ? (nodeSchema.type || node) : node)\r\n\t\t\t) {\r\n\t\t\t\tclosest = current;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn closest === scope;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Flattens the schema rules for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param array\t\t\t\t\t\trules\r\n\t *\r\n\t * @return array\r\n\t */\r\n\texpandRules(el, rules) {\r\n\t\tvar rles = rules.reduce((categories, rule) => {\r\n\t\t\tif (_isObject(rule)) {\r\n\t\t\t\tif (el.matches(Object.keys(rule)[0])) {\r\n\t\t\t\t\tcategories = categories.concat(Object.values(rule)[0]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcategories.push(rule);\r\n\t\t\t}\r\n\t\t\treturn categories;\r\n\t\t}, []);\r\n\t\tif (rles.includes('#sectioning-root')) {\r\n\t\t\trles.push('#sectioning-content');\r\n\t\t}\r\n\t\treturn rles;\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Schema;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen from '@web-native-js/jsen';\r\nimport Reflex from '@web-native-js/reflex';\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _isArray from '@web-native-js/commons/js/isArray.js';\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _inherit from '@web-native-js/commons/obj/inherit.js';\r\nimport _each from '@web-native-js/commons/obj/each.js';\r\nimport _before from '@web-native-js/commons/str/before.js';\r\nimport disconnectedCallback from './disconnectedCallback.js';\r\nimport createElement from './createElement.js';\r\nimport schema from './schema.js';\r\nimport globalParams from '../params.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n push, observe bare class, return proxy if, \r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class Core {\r\n\r\n\t/**\r\n\t * Initializes the new Chtml instance.\r\n\t *\r\n\t * @param document|HTMLElement\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tObject.defineProperty(this, 'params', {\r\n\t\t\tvalue:_inherit(globalParams, params),\r\n\t\t});\r\n\t\tObject.defineProperty(this, '_el', {value:el, enumerable:true,});\r\n\t\tObject.defineProperty(this, 'el', {\r\n\t\t\tvalue:el.nodeName === '#document' ? el.querySelector('html') : el,\r\n\t\t\tenumerable:true,\r\n\t\t});\r\n\t\t\r\n\t\t// ------------\r\n\t\t// ROLES\r\n\t\t// ------------\r\n\t\t\r\n\t\tconst roles = (el.getAttribute(globalParams.attrMap.superrole) || '')\r\n\t\t\t.split(' ').map(r => r.trim()).filter(r => r);\r\n\t\tObject.defineProperty(this, 'roles', {value:roles, enumerable:true,});\r\n\t\t\r\n\t\t// ------------\r\n\t\t// MODEL\r\n\t\t// ------------\r\n\t\t\r\n\t\tconst model = {};\r\n\t\tReflex.defineProperty(this, 'model', {value:model, enumerable:true,});\r\n\t\tReflex.trap(model, (model, prev, next, e) => {\r\n\t\t\treturn next(prev || this.getNodes(e.query));\r\n\t\t}, {type:'get'});\r\n\t\t// The following nodes, being prelisted,\r\n\t\t// can be accessed dynamically\r\n\t\tconst modelRoles = (el.getAttribute(globalParams.attrMap.model) || '')\r\n\t\t\t.split(' ').map(r => r.trim()).filter(r => r);\r\n\t\tReflex.init(this.model, modelRoles);\r\n\t\t\r\n\t\t\r\n\t\t// ------------\r\n\t\t// RELATED NODES\r\n\t\t// ------------\r\n\t\t\r\n\t\tconst _related = (el.getAttribute(globalParams.attrMap.related) || '').replace(/\\;/g, ',');\r\n\t\tvar related = Jsen.parse('{' + _related.trim() + '}').eval();\r\n\t\tObject.defineProperty(this, 'related', {value:related, enumerable:true,});\r\n\t\tObject.freeze(this.related);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Gets a node or list of nodes.\r\n\t *\r\n\t * @param string|int|array\t nodeNames\r\n\t *\r\n\t * @return Chtml|array|object\r\n\t */\r\n\tgetNodes(nodeNames) {\r\n\t\t_arrFrom(nodeNames).forEach(nodeName => {\r\n\t\t\tif (nodeName in this.model && this.model instanceof Core) {\r\n\t\t\t\t// Arrays must not be reused!\r\n\t\t\t\t// Their sources of nodes cant be guaranteed to be same.\r\n\t\t\t\t// this.model[nodeName] could also be an empty getter/setter\r\n\t\t\t\t// So the instanceof is the way to go for both problems\r\n\t\t\t\treturn this.model[nodeName];\r\n\t\t\t}\r\n\t\t\tvar node;\r\n\t\t\tif ((node = this.getRelatedNode(nodeName))\r\n\t\t\t|| (node = this.getExplicitNode(nodeName))\r\n\t\t\t|| (node = this.getImplicitNode(nodeName))) {\r\n\t\t\t\tthis.addNode(nodeName, node);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn _isArray(nodeNames) ? _objFrom(nodeNames, this.model) : this.model[nodeNames];\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to resolve a node as related node.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|ChtmlInterface\r\n\t */\r\n\tgetRelatedNode(requestNodeName) {\r\n\t\tvar node;\r\n\t\tif (node = this.related[requestNodeName]) {\r\n\t\t\tif (_isFunction(node)) {\r\n\t\t\t\tnode = node(this.el, requestNodeName);\r\n\t\t\t\tif (!_isString(node) && !(node instanceof globalParams.context.HTMLElement)) {\r\n\t\t\t\t\tthrow new Error('The callback for node \"' + requestNodeName + '\" returned an invalid type.');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (_isString(node)) {\r\n\t\t\t\t// Markup or plain selector string....\r\n\t\t\t\tnode = createElement(node);\r\n\t\t\t}\r\n\t\t\tif (!(node instanceof globalParams.context.HTMLElement)) {\r\n\t\t\t\tthrow new Error('\"' + requestNodeName + '\" could not be resolved to a valid node instance.');\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from explicit model.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tgetExplicitNode(requestNodeName) {\r\n\t\t// If given a rolecase, we can perform a query if we understand the semantics.\r\n\t\tif ((this.roles && this.roles.length)\r\n\t\t|| (this.roles = (this.el.getAttribute(globalParams.attrMap.superrole) || '').replace('  ', ' ').split(' ')).length) {\r\n\t\t\tvar roles = globalParams.rolecase ? [globalParams.rolecase] : this.roles;\r\n\t\t\t// Find matches...\r\n\t\t\tvar CSSEscape = globalParams.context.CSS ? globalParams.context.CSS.escape : str => str;\r\n\t\t\treturn roles.reduce((matchedNode, role) => {\r\n\t\t\t\tif (!matchedNode) {\r\n\t\t\t\t\tvar closestSuperSelector = '[' + CSSEscape(globalParams.attrMap.superrole) + '~=\"' + role + '\"]';\r\n\t\t\t\t\tvar nodeSelector = '[' + CSSEscape(globalParams.attrMap.subrole) + '~=\"' + role + '-' + requestNodeName + '\"]';\r\n\t\t\t\t\tvar closestSuper, _matchedNode;\r\n\t\t\t\t\tif ((_matchedNode = (this.el.shadowRoot || this.el).querySelector(nodeSelector))\r\n\t\t\t\t\t// If this.el has a shadowRoot, we don't expect _matchedNode to be able to find is superRole element.\r\n\t\t\t\t\t// If it finds one, then its not for the curren superRole element.\r\n\t\t\t\t\t&& ((this.el.shadowRoot && !(_matchedNode.parentNode.closest && _matchedNode.parentNode.closest(closestSuperSelector)))\r\n\t\t\t\t\t// _matchedNode must find this.el as its superRole element to qualify.\r\n\t\t\t\t\t\t|| (!this.el.shadowRoot && _matchedNode.parentNode && (closestSuper = _matchedNode.parentNode.closest(closestSuperSelector)) && closestSuper.isSameNode(this.el))\r\n\t\t\t\t\t)) {\r\n\t\t\t\t\t\tmatchedNode = _matchedNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn matchedNode;\r\n\t\t\t}, null);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from implicit model.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|array\r\n\t */\r\n\tgetImplicitNode(requestNodeName) {\r\n\t\tif (requestNodeName.match(/[^a-zA-Z0-9\\-]/)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Use schema...\r\n\t\tvar nodeSchema, nodeSelector = [];\r\n\t\tvar tries = [];\r\n\t\tif (schema.aria[requestNodeName]) {\r\n\t\t\ttries.push({\r\n\t\t\t\tschema: schema.aria[requestNodeName],\r\n\t\t\t\tselector: ['[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\ttries.push({\r\n\t\t\t\tschema: schema.std[requestNodeName] || schema.aria[requestNodeName],\r\n\t\t\t\tselector: [requestNodeName, '[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t}\r\n\t\t_each(schema.std, (tagname, schema) => {\r\n\t\t\tif (schema.implicitRole === requestNodeName) {\r\n\t\t\t\ttries.push({\r\n\t\t\t\t\tschema: schema,\r\n\t\t\t\t\tselector: [tagname],\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar matches = null;\r\n\t\ttries.forEach(trie => {\r\n\t\t\t(this.el.shadowRoot || this.el).querySelectorAll(trie.selector.join(',')).forEach(node => {\r\n\t\t\t\tif (schema.assertNodeBelongsInScopeAs(this.el, node, trie.schema)) {\r\n\t\t\t\t\tif (trie.schema && trie.schema.singleton) {\r\n\t\t\t\t\t\tmatches = node;\r\n\t\t\t\t\t} else if (!matches || _isArray(matches)) {\r\n\t\t\t\t\t\tmatches = matches || [];\r\n\t\t\t\t\t\tmatches.push(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn matches;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds a node instance.\r\n\t *\r\n\t * @param string|int\t nodeName\r\n\t * @param mixed\t\t\t node\r\n\t *\r\n\t * @return Core\r\n\t */\r\n\taddNode(nodeName, node) {\r\n\t\tvar nodeComponent, factory = globalParams.factory || ((el, params) => new Core(el, params));\r\n\t\tif (_isArray(node)) {\r\n\t\t\t// Still set the collection as node, even tho it wont be reused.\r\n\t\t\tnodeComponent = node.map(_node => factory(_node, this.params));\r\n\t\t} else {\r\n\t\t\tnodeComponent = factory(node, this.params);\r\n\t\t\t// We'll remove from model at the\r\n\t\t\t// time it leaves the DOM\r\n\t\t\tdisconnectedCallback(node, () => {\r\n\t\t\t\tReflex.del(this.model, nodeName);\r\n\t\t\t});\r\n\t\t}\r\n\t\tReflex.set(this.model, nodeName, nodeComponent);\r\n\t\treturn nodeComponent;\r\n\t}\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport globalParams from '../params.js';\r\n\r\n/**\r\n * Creates a MutationObserver that fires when\r\n * the element leaves the DOM.\r\n *\r\n * @param string\t\t\t\t\t\tinput\r\n * @param function\t\t\t\t\tcallback\r\n *\r\n * @return void\r\n */\r\nexport default function disconnectedCallback(el, callback) {\r\n\tif (el.parentNode && globalParams.context.MutationObserver) {\r\n\t\tvar called = false;\r\n\t\tvar observer = new globalParams.context.MutationObserver(mutations => {\r\n\t\t\tmutations.forEach(m => {\r\n\t\t\t\tif (!called && _arrFrom(m.removedNodes).includes(el)) {\r\n\t\t\t\t\tcalled = true;\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\tobserver.observe(el.parentNode, {childList:true});\r\n\t\tdisconnectedCallback(el.parentNode, () => {\r\n\t\t\tif (!called) {\r\n\t\t\t\tcalled = true;\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen from '@web-native-js/jsen';\r\nimport Reflex from '@web-native-js/reflex';\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport _isTypeObject from '@web-native-js/commons/js/isTypeObject.js';\r\nimport _isString from '@web-native-js/commons/js/isString.js';\r\nimport _isFunction from '@web-native-js/commons/js/isFunction.js';\r\nimport _isNumeric from '@web-native-js/commons/js/isNumeric.js';\r\nimport _unique from '@web-native-js/commons/arr/unique.js';\r\nimport _following from '@web-native-js/commons/arr/following.js';\r\nimport _before from '@web-native-js/commons/str/before.js';\r\nimport _beforeLast from '@web-native-js/commons/str/beforeLast.js';\r\nimport createElement from './core/createElement.js';\r\nimport defineBundleElements from './composing/defineBundleElements.js';\r\nimport defineImportElements from './composing/defineImportElements.js';\r\nimport createBundleMatrix from './composing/createBundleMatrix.js';\r\nimport parseNamespace from './composing/parseNamespace.js';\r\nimport recompose from './composing/recompose.js';\r\nimport RuleSheet from './directive/RuleSheet.js';\r\nimport Core from './core/Core.js';\r\nimport globalParams from './params.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class Chtml extends Core {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper(el, params);\r\n\t\t\r\n\t\t// ------------\r\n\t\t// NAMESPACE\r\n\t\t// ------------\r\n\t\t\r\n\t\tconst namespaceParse = parseNamespace(el.getAttribute(globalParams.attrMap.namespace) || '');\r\n\t\tObject.defineProperty(this, 'namespace', {value:namespaceParse.namespace, enumerable:true,});\r\n\t\t\r\n\t\t// ------------\r\n\t\t// BINDINGS\r\n\t\t// ------------\r\n\t\t\r\n\t\tconst bindings = [];\r\n\t\tReflex.defineProperty(this, 'bindings', {value:bindings, enumerable:true,});\r\n\t\tvar stringifyEach = list => _unique(list.map(expr => _before(_before(expr.toString(), '['), '(')));\r\n\t\tReflex.observe(this.bindings, (entries, exits, e) => {\r\n\t\t\tObject.keys(entries).forEach(k => {\r\n\t\t\t\t// ------------\r\n\t\t\t\t// Unbind exits\r\n\t\t\t\tif (exits[k]) {\r\n\t\t\t\t\tReflex.unobserve(this, null, null, {tags:[exits[k]]});\r\n\t\t\t\t}\r\n\t\t\t\t// ------------\r\n\t\t\t\t// Bind entries\r\n\t\t\t\tif (entries[k]) {\r\n\t\t\t\t\tif (this.autoEval !== false) {\r\n\t\t\t\t\t\tentries[k].eval(this, {get:Reflex.get});\r\n\t\t\t\t\t}\r\n\t\t\t\t\tReflex.observe(this, stringifyEach(entries[k].meta.vars), (newState, oldState, e) => {\r\n\t\t\t\t\t\tvar evalReturn = entries[k].eval(this, {get:Reflex.get});\r\n\t\t\t\t\t\t// If the result of this evaluation is false,\r\n\t\t\t\t\t\t// e.stopPropagation will be called and subsequent expressions\r\n\t\t\t\t\t\t// will not be evaluated. So we must not allow false to be returned.\r\n\t\t\t\t\t\t// All expressions are meant to be evaluated in parallel, independent of each other.\r\n\t\t\t\t\t\tif (evalReturn !== false) {\r\n\t\t\t\t\t\t\treturn evalReturn;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}, {tags:['#binding', entries[k]], diff:globalParams.diff});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\t// ------------\r\n\t\tif (!(this.dataBlockScript = _arrFrom(el.children).filter(node => node.matches(globalParams.tagMap.jsenp))[0])\r\n\t\t|| !(this.rulesheet = RuleSheet.parse((this.dataBlockScript.textContent || '').trim()))) {\r\n\t\t\tthis.rulesheet = new RuleSheet;\r\n\t\t}\r\n\t\t// ------------\r\n\t\tvar applicableRules = this.rulesheet.filter(ruleObj => {\r\n\t\t\treturn ruleObj.name === 'bindings' && (!ruleObj.specifiers.length || ruleObj.specifiers.includes(globalParams.env));\r\n\t\t}, true/*rewriteWithAtRuleCondition*/, globalParams.ruleChaining);\r\n\t\t// ------------\r\n\t\tvar bindingsPush = Reflex.get(this.bindings, 'push');\r\n\t\tapplicableRules.forEach(ruleObj => {\r\n\t\t\tthis.autoEval = globalParams.initialRendering;\r\n\t\t\tbindingsPush(ruleObj.finalRule);\r\n\t\t\tthis.autoEval = true;\r\n\t\t});\r\n\t\t// ------------\r\n\t\tif (this.dataBlockScript && globalParams.hideDefsheet) {\r\n\t\t\tthis.dataBlockScript.remove();\r\n\t\t}\r\n\t\t// ------------\r\n\t\t\r\n\t\t// ------------\r\n\t\t// MIRROR\r\n\t\t// ------------\r\n\t\t\r\n\t\t// Setup mirror\r\n\t\tReflex.observe(this, globalParams.dataKey, (data, _data, e) => {\r\n\t\t\tif (namespaceParse.subnamespace) {\r\n\t\t\t\tif (_isTypeObject(data) && data) {\r\n\t\t\t\t\t// Mirror\r\n\t\t\t\t\tReflex.observe(data, changes => {\r\n\t\t\t\t\t\treturn this.remodel(data, namespaceParse.subnamespace, globalParams.remodelCallback);\r\n\t\t\t\t\t}, {tags:['#mirror', this]});\r\n\t\t\t\t}\r\n\t\t\t\tif (_isTypeObject(_data) && _data) {\r\n\t\t\t\t\t// Unmirror\r\n\t\t\t\t\tReflex.unobserve(_data, null, null, {tags:['#mirror', this]});\r\n\t\t\t\t}\r\n\t\t\t\t// Initial Sync...\r\n\t\t\t\treturn this.remodel(data, namespaceParse.subnamespace, globalParams.remodelCallback);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a (reactive) context object or logical object to the instance.\r\n\t *\r\n\t * @param object \t\tcontext\r\n\t *\r\n\t * @return Event\r\n\t */\r\n\tbind(context) {\r\n\t\treturn Reflex.set(this, globalParams.dataKey, context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Clears the instance of its context.\r\n\t *\r\n\t * @return Event\r\n\t */\r\n\tunbind() {\r\n\t\treturn Reflex.del(this, globalParams.dataKey);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a (reactive) list context to the instance.\r\n\t * Childnodes will be automatically created/removed per key.\r\n\t *\r\n\t * @param array \t\tsrcModel\r\n\t * @param string \t\tsubnamespace\r\n\t * @param function \t\tremodelCallback\r\n\t *\r\n\t * @return Reflex.MutationEvent\r\n\t */\r\n\tremodel(srcModel, subnamespace, remodelCallback = null) {\r\n\t\tvar e = new Reflex.MutationEvent(this.el, {type:'remodelling'});\r\n\t\t_unique(Reflex.keys(srcModel).concat(Reflex.keys(this.model))).forEach(nodeName => {\r\n\t\t\tnodeName = _isNumeric(nodeName) ? parseInt(nodeName) : nodeName;\r\n\t\t\tvar existingNode = this.getNodes(nodeName);\r\n\t\t\tvar rspns;\r\n\t\t\tif (Reflex.has(srcModel, nodeName)) {\r\n\t\t\t\tvar isNewNode = false;\r\n\t\t\t\tif (!existingNode) {\r\n\t\t\t\t\tvar nodeNamespaceArray = subnamespace.split('//');\r\n\t\t\t\t\t// Create a namespace hash...\r\n\t\t\t\t\tnodeNamespaceArray[0] += '/' + nodeName;\r\n\t\t\t\t\tvar nodeEl = Chtml.import(nodeNamespaceArray.join('//'));\r\n\t\t\t\t\tif (nodeEl) {\r\n\t\t\t\t\t\tvar following = _following(Reflex.keys(srcModel), nodeName + ''/*numeric nodeName needs this*/, true/*length*/)\r\n\t\t\t\t\t\t\t.reduce((closest, _nodeName) => closest || this.getNodes(_nodeName), null);\r\n\t\t\t\t\t\tif (following) {\r\n\t\t\t\t\t\t\tfollowing.el.before(nodeEl);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.el.append(nodeEl);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\texistingNode = this.addNode(nodeName, nodeEl);\r\n\t\t\t\t\t\tisNewNode = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (existingNode) {\r\n\t\t\t\t\tif (_isFunction(remodelCallback)) {\r\n\t\t\t\t\t\trspns = remodelCallback(existingNode, Reflex.get(srcModel, nodeName), nodeName, isNewNode);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\trspns = existingNode.bind(Reflex.get(srcModel, nodeName));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (existingNode) {\r\n\t\t\t\tif (_isFunction(remodelCallback)) {\r\n\t\t\t\t\trspns = remodelCallback(existingNode, nodeName);\r\n\t\t\t\t} else {\r\n\t\t\t\t\trspns = existingNode.unbind();\r\n\t\t\t\t}\r\n\t\t\t\tvar remove = () => {\r\n\t\t\t\t\texistingNode.destroy();\r\n\t\t\t\t\texistingNode.el.remove();\r\n\t\t\t\t};\r\n\t\t\t\tif (rspns instanceof Promise) {\r\n\t\t\t\t\trspns.then(remove).catch(remove);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tremove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\te.response(rspns);\r\n\t\t});\r\n\t\treturn e;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Frees the instance of observed bindings.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tdestroy() {\r\n\t\tthis.bindings.forEach(\r\n\t\t\tbinding => Reflex.unobserve(this, null, null, {tags:['#binding', binding]})\r\n\t\t);\r\n\t\tif (this.dataBlockScript && globalParams.hideDefsheet) {\r\n\t\t\tthis.prepend(this.dataBlockScript);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------\r\n\t * INSTANCE-RELATED METHODS\r\n\t * -------------------\r\n\t */\r\n\t\r\n\t/**\r\n\t * The \"init\" function.\r\n\t * Gives CHTML a global window context\r\n\t * and lets it perform other necessary initializations.\r\n\t *\r\n\t * @param object\tcontextWindow\r\n\t * @param array\t\tbundleElements\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic init(contextWindow, bundleElements = []) {\r\n\t\t\r\n\t\tglobalParams.context = contextWindow;\r\n\t\t// Window must be set above... before this\r\n\t\tdefineBundleElements();\r\n\t\t\r\n\t\t// ------------------\r\n\t\t// Chtml.contentLoadedPromise\r\n\t\t// ------------------\r\n\t\tChtml.contentLoadedPromise = new Promise(resolve => {\r\n\t\t\tif (contextWindow.document.readyState === 'complete') {\r\n\t\t\t\tresolve(); return;\r\n\t\t\t}\r\n\t\t\tcontextWindow.document.addEventListener('DOMContentLoaded', resolve, false);\r\n\t\t\tcontextWindow.addEventListener('load', resolve, false);\r\n\t\t});\r\n\t\t\r\n\t\t// ------------------\r\n\t\t// globalParams.bundles\r\n\t\t// Chtml.loadingBundlesPromise\r\n\t\t// ------------------\r\n\t\tglobalParams.bundles = createBundleMatrix(bundleElements, loadingBundlesPromise => {\r\n\t\t\tChtml.loadingBundlesPromise = loadingBundlesPromise;\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tdefineImportElements(loadingBundlesPromise);\r\n\t\t\t}, 0);\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * The \"ready\" function.\r\n\t * Calls us when it becomes safe to run bundle-related code.\r\n\t *\r\n\t * @param function\t\t\tcallback\r\n\t * @param bool\t\t\t\twaitForBundles\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic ready(callback, waitForBundles = true) {\r\n\t\tChtml.contentLoadedPromise.then(() => {\r\n\t\t\tif (!waitForBundles) {\r\n\t\t\t\tcallback(); return;\r\n\t\t\t}\r\n\t\t\tChtml.loadingBundlesPromise.then(callback);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a Chtml over a root resolved from definition or markup string.\r\n\t *\r\n\t * @param string|document|HTMLElement\tinput\r\n\t * @param object\t\t\t\t\t\tparams\r\n\t * @param bool\t\t\t\t\t\t\tresolveInheritance\r\n\t * @param object\t\t\t\t\t\tStatic\r\n\t *\r\n\t * @return Chtml\r\n\t */\r\n\tstatic from(input, params = {}, resolveInheritance = true, Static = Chtml) {\r\n\t\t// -----------------------------\r\n\t\t// Resolve element from input\r\n\t\t// -----------------------------\r\n\t\tvar el = input;\r\n\t\tif (_isString(input) && !input.trim().startsWith('<') && input.indexOf('/') !== -1) {\r\n\t\t\tif (!(el = Chtml.import(_before(input, '//')))) {\r\n\r\n\t\t\t\tthrow new Error('No element found on the namespace \"' + input + '\"!');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (_isString(input)) {\r\n\t\t\t\tif (!(el = createElement(input))) {\r\n\t\t\t\t\tthrow new Error('Could not resolve the string \"' +input + '\" to an element!');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (resolveInheritance) {\r\n\t\t\t\tvar ns, superNs, superEl, isImport = el.matches(globalParams.tagMap.import);\r\n\t\t\t\tif ((ns = _before(el.getAttribute(globalParams.attrMap.namespace) || '', '//'))\r\n\t\t\t\t// The entire namespace is used for elements of type import.\r\n\t\t\t\t// The supernamespace is used for normal elements\r\n\t\t\t\t&& ((isImport && (superNs = ns)) || (superNs = _beforeLast(ns, '/')) && superNs.indexOf('/') > -1)\r\n\t\t\t\t&& (superEl = Chtml.import(superNs))) {\r\n\t\t\t\t\tvar _el = el;\r\n\t\t\t\t\tel = recompose(superEl, el);\r\n\t\t\t\t\tif (isImport) {\r\n\t\t\t\t\t\t_el.replaceWith(el);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (ns) {\r\n\t\t\t\t\tconsole.warn('Namespace resolution failed: ' + ns);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn new Static(el, params);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Imports a module from bundles.\r\n\t *\r\n\t * @param string\t\t\t\t\t\tnamespace\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic import(namespace) {\r\n\t\tif (globalParams.bundles) {\r\n\t\t\treturn globalParams.bundles.find(namespace);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * Create the factory used in Core\r\n */\r\nglobalParams.factory = Chtml.from;","\r\n/**\r\n * @imports\r\n */\r\nimport _before from '@web-native-js/commons/str/before.js';\r\nimport _after from '@web-native-js/commons/str/after.js';\r\n\r\n\r\n/**\r\n * Parses an element's CHTML namespace.\r\n * This explains how an element's namespace is used in CHTML.\r\n *\r\n * @param string\t\t\t\t\tnamespaceStr\r\n *\r\n * @return object\r\n */\r\nexport default function(namespaceStr) {\r\n\tvar namespaceParse = {roadmap:namespaceStr};\r\n\tif (namespaceParse.roadmap) {\r\n\t\tnamespaceParse.namespace = _before(namespaceParse.roadmap, '//');\r\n\t\tnamespaceParse.subnamespace = _after(namespaceParse.roadmap, '//');\r\n\t\t// In case this is the /// spot...\r\n\t\tif (namespaceParse.subnamespace.startsWith('/')) {\r\n\t\t\tnamespaceParse.subnamespace = _after(namespaceParse.subnamespace, '/');\r\n\t\t}\r\n\t\tif (namespaceParse.subnamespace.endsWith('//') && namespaceParse.subnamespace.indexOf('///') === -1) {\r\n\t\t\tnamespaceParse.subnamespace = namespaceParse.subnamespace + namespaceParse.namespace + '//';\r\n\t\t}\r\n\t}\r\n\treturn namespaceParse;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isUndefined from '../js/isUndefined.js';\r\n\r\n/**\r\n * 1. Returns the ENTRY following (either the FIRST or the LAST instance of) the reference.\r\n * 2. Returns A NUMBER OF ENTRIES counting forwards from (either the FIRST or the LAST instance of) the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n * @param bool\t \tlastReference\r\n *\r\n * @return mixed|array\r\n */\r\nexport default function(arr, reference, length = false, rotate = false, lastReference = false) {\r\n\tif (arr.indexOf(reference) === -1) {\r\n\t\treturn length ? [] : undefined;\r\n\t}\r\n\tvar amount = length === true ? arr.length - 1 : (length === false ? 1 : length);\r\n\tvar from = lastReference ? arr.lastIndexOf(reference) + 1 : arr.indexOf(reference) + 1;\r\n\tvar after = !_isUndefined(reference) ? arr.slice(from, from + amount) : [];\r\n\tif (rotate && after.length < amount && after.length < arr.length) {\r\n\t\tafter = after.concat(arr.slice(0, amount - after.length));\r\n\t};\r\n\treturn length ? after : after[0];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _before from '@web-native-js/commons/str/before.js';\r\nimport recompose from './recompose.js';\r\nimport globalParams from '../params.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The client-build entry\r\n * ---------------------------\r\n */\r\nexport default function() {\r\n\t\r\n\tconst Window = globalParams.context;\r\n\r\n\t/**\r\n\t * Define the customized built-in template element\r\n\t * that supports remote content.\r\n\t */\r\n\tWindow.customElements.define(globalParams.attrMap.bundle, class extends Window.HTMLTemplateElement {\r\n\t\r\n\t\t/**\r\n\t\t * This handles both triggers remote loading\r\n\t\t * when so defined.\r\n\t\t *\r\n\t\t * @param string\tname\r\n\t\t * @param string\toldValue\r\n\t\t * @param string\tnewValue\r\n\t\t *\r\n\t\t * @return void\r\n\t\t */\r\n\t\tattributeChangedCallback(name, oldValue, newValue) {\r\n\t\t\tif (newValue) {\r\n\t\t\t\tthis.load();\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\t/**\r\n\t\t * Attempt to load remote content if so defined.\r\n\t\t *\r\n\t\t * @return void\r\n\t\t */\r\n\t\tload() {\r\n\t\t\tvar src = this.getAttribute('src');\r\n\t\t\tif (src && this.content.children.length) {\r\n\t\t\t\tconsole.warn('A CHTML bundle must define only either a remote content or local content! Bundle ignored.');\r\n\t\t\t} else if (src) {\r\n\t\t\t\t// Missing in jsdom\r\n\t\t\t\tif (Window.fetch) {\r\n\t\t\t\t\tWindow.fetch(src).then(response => {\r\n\t\t\t\t\t\treturn response.ok ? response.text() : Promise.reject(response.statusText);\r\n\t\t\t\t\t}).then(content => {\r\n\t\t\t\t\t\tthis.innerHTML = content;\r\n\t\t\t\t\t\t// Dispatch the event.\r\n\t\t\t\t\t\tthis.dispatchEvent(new Window.Event('bundleloadsuccess'));\r\n\t\t\t\t\t}).catch(error => {\r\n\t\t\t\t\t\t// Dispatch the event.\r\n\t\t\t\t\t\tconsole.warn('Error fetching the bundle at ' + src + '. (' + error + ')');\r\n\t\t\t\t\t\tthis.dispatchEvent(new Window.Event('bundleloaderror'));\r\n\t\t\t\t\t});\r\n\t\t\t\t} else {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t// Otherwise, this event will fire BEFORE the code that binds to it\r\n\t\t\t\t\t\tthis.dispatchEvent(new Window.Event('bundleloadsuccess'));\r\n\t\t\t\t\t}, 0);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\t/**\r\n\t\t * The attributes we want to observe.\r\n\t\t *\r\n\t\t * @return array\r\n\t\t */\r\n\t\tstatic get observedAttributes() {\r\n\t\t\treturn ['src'];\r\n\t\t}\r\n\t}, {extends: 'template'});\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _divide from '@web-native-js/commons/arr/divide.js';\r\nimport globalParams from '../params.js';\r\nimport recompose from './recompose.js';\r\nimport Matrix from './Matrix.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The client-build entry\r\n * ---------------------------\r\n */\r\nexport default function(bundleElements, promiseReciever = null) {\r\n\t\r\n\tvar [loadingBundles, readyBundles] = _divide(bundleElements, b => b instanceof Promise);\r\n\tconst loadingBundlesPromise = Promise.all(loadingBundles).then(fetchedBundles => {\r\n\t\treadyBundles.push(...fetchedBundles);\r\n\t\tloadingBundles = [];\r\n\t});\r\n\tif (promiseReciever) {\r\n\t\tpromiseReciever(loadingBundlesPromise);\r\n\t}\r\n\tvar warnedEarlyBundleAccess;\r\n\tconst anticyclicBundlesQuery = [];\r\n\tconst bundleMatrix = new Matrix(readyBundles/*sources*/, []/*namespace*/, (bundle, namespace, superEl, bundleIndex) => {\r\n\t\tvar _namespace = namespace.join('/');\r\n\t\t// ------------------\r\n\t\t// Is the current import process trying to be cyclic?\r\n\t\t// We move one-level up the namespace hierarchy.\r\n\t\tif (anticyclicBundlesQuery.includes(_namespace)) {\r\n\t\t\treturn bundleMatrix.find(namespace.slice(0, -1).join('/'));\r\n\t\t}\r\n\t\tanticyclicBundlesQuery.push(_namespace);\r\n\t\t// ------------------\r\n\t\t// Is someone trying to import while bundles are still loading?\r\n\t\tif (loadingBundles.length && !warnedEarlyBundleAccess) {\r\n\t\t\twarnedEarlyBundleAccess = true;\r\n\t\t\tconsole.warn('Remote bundles are still loading at this time! You should probabbly wrap bundle-dependent code within Chtml.ready(callback[, true/*waitForBundles*/]).');\r\n\t\t}\r\n\t\t// ------------------\r\n\t\t// We query now...\r\n\t\tvar CSSEscape = globalParams.context.CSS \r\n\t\t\t? globalParams.context.CSS.escape \r\n\t\t\t: str => str;\r\n\t\tvar el = bundle.content.querySelector('[' + CSSEscape(globalParams.attrMap.namespace) + '=\"' + _namespace + '\"]');\r\n\r\n\t\tif (el && superEl) {\r\n\t\t\ttry {\r\n\t\t\t\tvar norecompose = [];\r\n\t\t\t\tif (bundle.hasAttribute('norecompose')) {\r\n\t\t\t\t\tnorecompose = (bundle.getAttribute('norecompose') || '*').split(' ').map(val => val.trim());\r\n\t\t\t\t}\r\n\t\t\t\tel = recompose(superEl, el, 'prepend', norecompose);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error('[Inheritance error at source #' + bundleIndex + ']: ' + e.message);\r\n\t\t\t}\r\n\t\t\tanticyclicBundlesQuery.pop();\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\t// ------------------\r\n\t\t// Update cyclicism... lol\r\n\t\tanticyclicBundlesQuery.pop();\r\n\t\t// ------------------\r\n\t\t// If there was no module with the requested namespace\r\n\t\t// we return the super module\r\n\t\treturn el ? el.cloneNode(true) : (\r\n\t\t\tsuperEl ? superEl.cloneNode(true) : null\r\n\t\t);\r\n\t}/*getter*/);\r\n\t\r\n\treturn bundleMatrix;\r\n};\r\n","\r\n/**\r\n * Makes a separation between items that pass a callback test and those that fail.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n * @param function\t\t\t\tcallback\r\n *\t *\r\n * @return array\r\n */\r\nexport default function(arr, callback) {\r\n\tvar passes = [];\r\n\tvar failures = [];\r\n\tvar length = arr.length;\r\n\tfor (var i = 0; i < length; i++) {\r\n\t\tif (callback(arr[i])) {\r\n\t\t\tpasses.push(arr[i]);\r\n\t\t} else {\r\n\t\t\tfailures.push(arr[i]);\r\n\t\t};\r\n\t};\r\n\treturn [passes, failures];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _before from '@web-native-js/commons/str/before.js';\r\nimport recompose from './recompose.js';\r\nimport globalParams from '../params.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The client-build entry\r\n * ---------------------------\r\n */\r\nexport default function(loadingBundlesPromise) {\r\n\t\r\n\tconst Window = globalParams.context;\r\n\t\t\t\t\r\n\t/**\r\n\t * Define the custom import element\r\n\t */\r\n\tWindow.customElements.define(globalParams.tagMap.import, class extends Window.HTMLElement {\r\n\t\r\n\t\t/**\r\n\t\t * Tests if conditions are right to resolve the import.\r\n\t\t *\r\n\t\t * @return bool\r\n\t\t */\r\n\t\tshouldResolve() {\r\n\t\t\treturn !this.hasAttribute('ondemand')\r\n\t\t\t\t&& !this.closest('template')\r\n\t\t\t\t&& !this.closest(globalParams.tagMap.import + '[ondemand]');\r\n\t\t}\r\n\t\r\n\t\t/**\r\n\t\t * This triggers self-replacement\r\n\t\t * when so defined.\r\n\t\t *\r\n\t\t * @return void\r\n\t\t */\r\n\t\tconnectedCallback() {\r\n\t\t\tthis.processed = false;\r\n\t\t\tif (this.shouldResolve()) {\r\n\t\t\t\tthis.resolve();\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\t/**\r\n\t\t * This triggers self-replacement\r\n\t\t * when so defined.\r\n\t\t *\r\n\t\t * @param string\tname\r\n\t\t * @param string\toldValue\r\n\t\t * @param string\tnewValue\r\n\t\t *\r\n\t\t * @return void\r\n\t\t */\r\n\t\tattributeChangedCallback(name, oldValue, newValue) {\r\n\t\t\tif (this.shouldResolve()) {\r\n\t\t\t\tthis.resolve();\r\n\t\t\t}\r\n\t\t}\r\n\t\r\n\t\t/**\r\n\t\t * Attempt self-replacement if so defined.\r\n\t\t *\r\n\t\t * @return void\r\n\t\t */\r\n\t\tresolve() {\r\n\t\t\tif (!this.parentNode) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tloadingBundlesPromise.then(() => {\r\n\t\t\t\tvar replacement, namespace, namespaceAttr = globalParams.attrMap.namespace;\r\n\t\t\t\tif ((namespace = _before(this.getAttribute(namespaceAttr) || '', '//'))\r\n\t\t\t\t&& (namespace !== this.__namespace)) {\r\n\t\t\t\t\tthis.__namespace = namespace;\r\n\t\t\t\t\tif (!globalParams.bundles || !(replacement = globalParams.bundles.find(namespace))) {\r\n\t\t\t\t\t\tthis.innnerText = 'No element found on the namespace \"' + namespace + '\"!';\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvar resolved = recompose(this, replacement);\r\n\t\t\t\t\t\tif (this.hasAttribute('shadow')) {\r\n\t\t\t\t\t\t\tif (!this.parentNode.shadowRoot) {\r\n\t\t\t\t\t\t\t\tthis.parentNode.attachShadow({mode: 'open'});\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tthis.parentNode.shadowRoot.append(resolved);\r\n\t\t\t\t\t\t\tthis.remove();\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.replaceWith(resolved);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\r\n\t\t/**\r\n\t\t * The attributes we want to observe.\r\n\t\t *\r\n\t\t * @return array\r\n\t\t */\r\n\t\tstatic get observedAttributes() {\r\n\t\t\treturn ['ondemand', globalParams.attrMap.namespace];\r\n\t\t}\r\n\t});\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@web-native-js/commons/arr/from.js';\r\nimport Jsen from '@web-native-js/jsen';\r\nimport Reflex from '@web-native-js/reflex';\r\nimport params from './params.js';\r\nimport Chtml from './Chtml.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The client-build entry\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Configure CHTM with\r\n * a global window.\r\n */\r\nvar bundles = _arrFrom(document.querySelectorAll(params.tagMap.bundle)).reverse();\r\nChtml.init(window, bundles.map(b => {\r\n\tif (b.hasAttribute('src') && !b.content.children.length) {\r\n\t\treturn new Promise(resolve => {\r\n\t\t\tb.addEventListener('bundleloadsuccess', () => resolve(b));\r\n\t\t\tb.addEventListener('bundleloaderror', () => resolve(b));\r\n\t\t});\r\n\t}\r\n\treturn b;\r\n}));\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tJsen,\r\n\tReflex,\r\n\tparams,\r\n};\r\nexport default Chtml;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Chtml from './index.js';\r\nimport Reflex from '@web-native-js/reflex';\r\nimport Jsen from '@web-native-js/jsen';\r\n\r\n// As globals\r\nif (!window.WebNative) {\r\n\twindow.WebNative = {};\r\n}\r\nwindow.WebNative.Chtml = Chtml;\r\nwindow.WebNative.Chtml.Reflex = Reflex;\r\nwindow.WebNative.Chtml.Jsen = Jsen;\r\n"],"sourceRoot":""}