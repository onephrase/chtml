{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../commons/src/Str.js","webpack:///../commons/src/Obj.js","webpack:///../commons/src/Js.js","webpack:///../commons/src/Arr.js","webpack:///./src/Schema.js","webpack:///./src/Def/Matrix.js","webpack:///../jsen/src/ExprInterface.js","webpack:///../jsen/src/Expr/AssignmentInterface.js","webpack:///../jsen/src/Expr/ReferenceInterface.js","webpack:///../jsen/src/Expr/DeletionInterface.js","webpack:///../jsen/src/Expr/CallInterface.js","webpack:///../jsen/src/Jsen.js","webpack:///../jsen/src/Lexer.js","webpack:///../jsen/src/Contexts.js","webpack:///../jsen/src/Expr/AbstractionInterface.js","webpack:///../jsen/src/Expr/Abstraction.js","webpack:///../jsen/src/Expr/ArrInterface.js","webpack:///../jsen/src/Expr/Arr.js","webpack:///../jsen/src/Expr/ArgumentsInterface.js","webpack:///../jsen/src/Expr/Arguments.js","webpack:///../jsen/src/Expr/AssertionInterface.js","webpack:///../jsen/src/Expr/Assertion.js","webpack:///../jsen/src/Expr/Assignment.js","webpack:///../jsen/src/Expr/BoolInterface.js","webpack:///../jsen/src/Expr/Bool.js","webpack:///../jsen/src/Expr/Call.js","webpack:///../jsen/src/Expr/CommentsInterface.js","webpack:///../jsen/src/Expr/Comments.js","webpack:///../jsen/src/Expr/ComparisonInterface.js","webpack:///../jsen/src/Expr/Comparison.js","webpack:///../jsen/src/Expr/ConditionInterface.js","webpack:///../jsen/src/Expr/Condition.js","webpack:///../jsen/src/Expr/Deletion.js","webpack:///../jsen/src/Expr/FuncInterface.js","webpack:///../jsen/src/Expr/Func.js","webpack:///../jsen/src/Expr/MathInterface.js","webpack:///../jsen/src/Expr/Math.js","webpack:///../jsen/src/Expr/NumInterface.js","webpack:///../jsen/src/Expr/Num.js","webpack:///../jsen/src/Expr/ObjInterface.js","webpack:///../jsen/src/Expr/Obj.js","webpack:///../jsen/src/Expr/Reference.js","webpack:///../jsen/src/Expr/ReturnInterface.js","webpack:///../jsen/src/Expr/Return.js","webpack:///../jsen/src/Expr/StatementsInterface.js","webpack:///../jsen/src/Expr/Statements.js","webpack:///../jsen/src/Expr/StrInterface.js","webpack:///../jsen/src/Expr/Str.js","webpack:///../commons/src/Num.js","webpack:///../commons/src/index.js","webpack:///../jsen/src/index.js","webpack:///../observable/src/Event.js","webpack:///../observable/src/EventController.js","webpack:///../observable/src/Observable.js","webpack:///../observable/src/index.js","webpack:///./src/Def/Def.js","webpack:///./src/Def/DefBlock.js","webpack:///./src/Def/DefSheet.js","webpack:///./src/ChtmlCore.js","webpack:///./src/Chtml.js","webpack:///./src/index.js","webpack:///./src/browser-entry.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","_wrapped","subject","openingTag","closingTag","startsWith","endsWith","_unwrap","_after","_before","search","beforeLast","pos","lastIndexOf","indexOf","substr","afterLast","length","_afterLast","_toTitle","str","strict","replace","txt","charAt","toUpperCase","undefined","toLowerCase","_toCamel","fromStart","_fromCamel","delimiter","split","join","_matches","lllll","_from","val","obj","arguments","_isString","_isArray","forEach","k","_with","entriesOrKey","_merge","_isObject","_each","callback","returnValue","_isTypeObject","keys","_isNumeric","parseFloat","_get","ctxt","path","reciever","detectObservables","slice","_ctxt","_isUndefined","_isNull","_key","shift","isObsvble","_isObservable","has","exists","_set","buildTree","target","_isFunction","_unset","reduceTree","success","lastKey","pop","_obj","_isset","_first","_last","_sample","amount","_rand","_copy","_find","deep","values","subKey","reduce","prev","curr","concat","_getAllPropertyNames","until","keysAll","_getPrototypeChain","_pushUnique","getOwnPropertyNames","prototypalChain","push","getPrototypeOf","_copyPlain","filter","_mergeCallback","obj1","obj2","depth","objs","_inherit","_replace","replaceIntoEmptyObj","_even","assertion","result","_compareCallback","v1","v2","_match","netMatch","_diff","netDiff","_percentageMatch","a","b","_percentageDiff","deepProps","isReplace","withSymbols","Error","valAtObj1","valAtObj2","getOwnPropertyDescriptor","netComparison","contrast","returnOnFirstFalse","contn","testPass","_isBoolean","_isNumber","isNaN","Array","isArray","_isTypeArray","_isTypeFunction","toString","_isClass","test","Function","_isEmpty","_getType","input","_all","method","_proxy","trap","trapByCommons","prop","Proxy","_isProxy","__proxyTargetByCommons","_getProxyTarget","instance","_getProxyTrap","__proxyTrapByCommons","_mixin","classes","Traps","Base","supersMap","Mixin","args","super","prototypes","_class","supers","this","supersReturnValues","supr","_instanceof","classB","mixinTest","classA","prevAns","constructor","arr","count","itm","firsts","reverse","_avg","_sum","_max","Math","max","_min","min","rand","floor","random","total","v","_slice","offset","lengthOrOffset2","_preceding","reference","rotate","lastReference","from","before","_following","after","_precedingLast","_followingLast","_between","reference2","rtl","to","_intersect","arr2","val1","val2","_difference","_filter","_divide","passes","failures","_flatten","withObjects","acc","_sort","order","_arr","index","sort","localeCompare","trim","map","_unique","self","items","_concatUnique","arrs","_remove","limit","splice","_exclude","itms","replacements","_concatBefore","secondHalf","_concatAfter","_concatBeforeLast","_concatAfterLast","prevTest","_any","_inSequence","timing","sync","delay","delayAlways","Promise","resolve","reject","advance","setTimeout","ret","then","catch","Schema","std","html","type","model","singleton","caption","col","colgroup","dd","implicitRole","dt","figcaption","head","legend","li","optgroup","option","param","rp","rt","source","summary","track","tbody","td","tfoot","thead","tr","abbr","address","area","article","acceptableRoles","aside","audio","base","bdi","bdo","blockquote","body","br","button","canvas","cite","code","data","datalist","del","details","dfn","dialog","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","img","ins","kbd","label","link","main","mark","math","menu","meta","names","meter","nav","noscript","ol","output","picture","pre","progress","q","ruby","samp","script","section","select","slot","small","span","strong","style","sub","sup","svg","table","template","textarea","time","title","u","ul","var","video","wbr","aria","banner","contentinfo","complementary","navigation","list","listitem","el","elTagName","nodeName","expandRules","roleInclusive","elSchema","currentElCategories","hasAttribute","getAttribute","role","includes","context","node","valid","contextModel","HTMLElement","getContentModelFor","nodeCategories","getCategoriesFor","allowedNode","disallowedNode","scope","nodeSchema","closest","contextCategories","current","parentNode","assertNodeBelongsInContentModel","rules","rles","categories","rule","matches","Matrix","sources","namespace","carry","collections","subMatrix","nsKey","nsArray","nsDrill","enter","cloneNode","Expr","jsenType","Super","comments","vars","Interface","ExprInterface","Jsen","expr","Parsers","params","Static","parsers","grammars","varsScope","parsed","parse","_expr","_Parsers","ReferenceInterface","CallInterface","explain","console","log","AssignmentInterface","DeletionInterface","mutates","assert","Lexer","delims","options","$cache","lex","tokens","$str","$options","blocks","$blocks","quotes","$quotes","$comments","runtime","nesting","maxDepth","matchesi","cache","_evalCharsAt","charWidth","commentTest","quoteTest","nestingTest","openComment","_testQuotes","openQuote","_testComments","ending","_push","chars","starting","preserveComments","_testNesting","stopChar","_testChars","stopChars","stopCharForward","matchedDelim","preserveDelims","quote","block","match","RegExp","testList","useRegex","ci","splitSeries","regParse","Abstraction","AbstractionInterface","eval","parseCallback","Arr","ArrInterface","exprs","newExprs","exprA","uniqueSoFar","exprB","even","Arguments","ArgumentsInterface","arg","Assertion","AssertionInterface","logic","operators","isOr","or","isNor","nor","isAnd","and","isNand","nand","lastResult","trues","Assignment","operator","getEval","Contexts","Bool","BoolInterface","state","Call","_contexts","__contexts","cntxt","utils","handler","Num","Str","Obj","unshift","Comments","CommentsInterface","_comments","commentPlacement","splits","_beforeLast","line","commenta","Comparison","ComparisonInterface","operand1","operand2","compare","oper","allItemsMatch","entry1Keys","entry2Keys","allEntriesMatch","exact","is","isNull","equalsTo","notEqualsTo","relative","lesserThan","greaterThan","lesserThanOrEqualsTo","greaterThanOrEqualsTo","between","partial","contains","any","in","Condition","ConditionInterface","onTrue","onFalse","Deletion","red","Func","FuncInterface","paramters","statements","wrappings","parentParams","ownParams","nameInParent","nameInSelf","defaultValInParent","defaultValInSelf","localContext","defaultVal","multipleContexts","headNoWrap","bodyNoWrap","funcHead","funcBody","paramSplit","MathInterface","currentTotal","NumInterface","int","dec","parseInt","ObjInterface","entries","_entriesSplit","entry","Reference","backticks","sourceContext","parts","subjectContext","separator","nameSplit","isContext","Return","ReturnInterface","exprLc","Statements","StatementsInterface","stmts","delim","StrInterface","_closest","num","byKey","abs","_fromWords","text","strtr","zero","one","two","three","four","five","six","seven","eight","nine","ten","eleven","twelve","thirteen","fourteen","fifteen","sixteen","seventeen","eighteen","nineteen","twenty","thirty","forty","fourty","fifty","sixty","seventy","eighty","ninety","hundred","thousand","million","billion","tmp","sum","last","part","standardize","prefix","funcName","rename","Js","$","isPropagationStopped","isDefaultPrevented","promises","promise","all","listeners","eventNames","tag","listener","remove","removeCallback","eventsAll","e","currentlyFiring","eventNamesAntiRecursion","listenerParams","listenerEventNames","listenerEventName","bubbling","allowBubbling","firingEventName","_shouldFire","proms","dispostn","_doFire","stopPropagation","preventDefault","_context","_data","eventName","Observable","bubblers","_state","_incoming","offsetParent","addListener","removeListener","changedProps","_outgoing","_value","observersDisposition","fire","exits","props","methodPrefix","ownMethod","asOwnMethod","getOffsetParent","parent","copy","apply","changedKeys","exprObj","jsenGetter","caller","error","CACHE","_CACHE","existsReciever","_existsReciever","existence","diff","diffing","pulse","unobserve","setOffsetParent","observe","_getBubbler","changes","_changes","_e","subFieldName","msg","strictDebug","proxy","set","deleteProperty","ownKeys","descriptor","getOwnPropertySymbols","Def","flag","opts","_opts","defSplit","vf","flags","DefBlock","add","withDuplicate","withOverRidden","isDuplicate","overridden","def","newDef","existingDef","key_a","value_a","value_aUnwrapped","key_b","value_b","value_bUnwrapped","incase_a","important_a","incase_b","important_b","DefSheet","defBlock","defSheet","applyTo","ChtmlCore","root","querySelector","parseNamespace","defs","parseCascadedDefSheet","init","free","getCpsBlock","directive","bindingsListeners","binding","observeOnly","listenerObj","newState","oldState","evalReturn","cleanCopy","componentCallback","dataBlockScript","attrCache","attributeMap","related","bindings","attrValue","removeAttribute","children","elementMap","defsheet","$defs","setAttribute","prepend","asDirectives","cpsBlockDefs","directives","argsExpr","chainableDirectives","_directive","explainJsen","requestNodeName","computeQuery","computedRelated","toElement","roles","superrole","rolecase","matchedNode","closestSuper","_matchedNode","closestSuperSelector","nodeSelector","subrole","shadowRoot","isSameNode","tries","schema","selector","tagname","trie","querySelectorAll","assertNodeBelongsInScopeAs","_node","drilldown","alias","nodeCallback","disconnectedCallback","getRelatedNode","implicitOnly","getExplicitNode","explicitOnly","getImplicitNode","createNode","namespaceParse","roadmap","subnamespace","attr","textContent","elTo","elFrom","import","elToNs","elFromNs","elFromRoles","recomposeDefs","replacementNode","applicableContextRoles","applicableReplacementNodeRoles","replacementNodeRole","_applicableContextRoles","contextRole","slotNodes","contextSelector","slotNodeSelector","replaceWith","append","appendOrPrepend","norecompose","nocompose","recomposeCallback","disposition","b_attr","a_attr","jointList","jointDefs","attributes","elToDefs","elFromDefs","document","temp","createElement","innerHtml","firstChild","called","MutationObserver","mutations","removedNodes","childList","bundle","Chtml","dataKey","populate","itemCallback","listContext","onlyKeys","item","unbindReturn","isNewItem","itemNamespaceArray","itemEl","following","_k","resolveInheritance","bundles","superNs","superEl","isImport","_el","recompose","warn","find","window","contentLoadedPromise","readyState","addEventListener","ready","waitForBundles","initObj","loadingBundlesPromise","remoteBundles","loadingBundles","warnedEarlyBundleAccess","content","anticyclicBundlesQuery","bundleIndex","_namespace","message","customElements","define","HTMLTemplateElement","oldValue","newValue","load","src","fetch","response","ok","statusText","innerHTML","dispatchEvent","Event","extends","processed","shouldResolve","replacement","namespaceAttr","__namespace","resolved","attachShadow","innnerText","OnePhrase"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","\r\n/**\r\n * ---------------------------\r\n * String utils\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Tells if the string is warapped with the given opening and closing tags.\r\n *\r\n * @param  string  subject\r\n * @param  string  openingTag\r\n * @param  string  closingTag\r\n *\r\n * @return bool\r\n */\r\nconst _wrapped = function(subject, openingTag, closingTag) {\r\n\treturn subject.startsWith(openingTag) && subject.endsWith(closingTag);\r\n};\r\n\r\n/**\r\n * Returns the string without the given opening and closing tags.\r\n *\r\n * @param  string  subject\r\n * @param  string  openingTag\r\n * @param  string  closingTag\r\n *\r\n * @return string\r\n */\r\nconst _unwrap = function(subject, openingTag, closingTag) {\r\n\treturn _beforeLast(_after(subject, openingTag), closingTag);\r\n};\r\n\r\n/**\r\n * Return the part of a string before a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   beforeLast\r\n *\r\n * @return string\r\n */\r\nconst _before = function(subject, search, beforeLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = beforeLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn subject;\r\n\t}\r\n\treturn subject.substr(0, pos);\r\n};\r\n\r\n/**\r\n * Return the part of a string before last occurence of a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n *\r\n * @return string\r\n */\r\nconst _beforeLast = function(subject, search) {\r\n\treturn _before(subject, search, true);\r\n};\r\n\r\n/**\r\n * Return the remainder of a string after a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   afterLast\r\n *\r\n * @return string\r\n */\r\nconst _after = function(subject, search, afterLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = afterLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn '';\r\n\t}\r\n\treturn subject.substr(pos + search.length);\r\n};\r\n\r\n/**\r\n * Return the remainder of a string after last occurence of a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n *\r\n * @return string\r\n */\r\nconst _afterLast = function(subject, search) {\r\n\treturn _after(subject, search, true);\r\n}\r\n \r\n/**\r\n * Converts a string to title case.\r\n *\r\n * @param string \tstr\r\n * @param bool \t\tstrict\r\n *\r\n * @return string\r\n */\r\nconst _toTitle = function(str, strict) {\r\n\tif (typeof str !== 'string') {\r\n\t\treturn str;\r\n\t}\r\n\treturn str.replace(/\\w\\S*/g,  function(txt) { return txt.charAt(0).toUpperCase() + ((typeof strict !== undefined && strict) ? txt.substr(1).toLowerCase() : txt.substr(1)); })\r\n};\r\n\r\n/**\r\n * Makes a string camel-cased.\r\n *\r\n * @param string \tstr\r\n * @param bool\t \tfromStart\r\n *\r\n * @return string\r\n */\r\nconst _toCamel = function(str, fromStart) {\r\n\t// Make disting words\r\n\tstr = _toTitle(str.replace(/-/g, ' ')).replace(/ /g, '');\r\n\treturn fromStart ? str : str[0].toLowerCase() + str.substr(1);\r\n};\r\n\r\n/**\r\n * Splits a camel-cased string.\r\n *\r\n * @param string \tstr\r\n * @param string \tdelimiter\r\n *\r\n * @return string\r\n */\r\nconst _fromCamel = function(str, delimiter) {\r\n\treturn str === undefined ? '' : str.split(/(?=[A-Z])/).join(delimiter ? delimiter : ' '); // positive lookahead to keep the capital letters\r\n};\r\n\r\n/**\r\n * ReMatches a string against another string.\r\n *\r\n * @param string \tstr\r\n * @param string \tdelimiter\r\n *\r\n * @return string\r\n */\r\nconst _matches = function(str, delimiter) {\r\n\treturn lllll;\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\t_wrapped,\r\n\t_unwrap,\r\n\t_before,\r\n\t_beforeLast,\r\n\t_after,\r\n\t_afterLast,\r\n\t_toTitle,\r\n\t_toCamel,\r\n\t_fromCamel,\r\n\t_matches\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isArray,\r\n\t_isBoolean,\r\n\t_isFunction,\r\n\t_isNumeric,\r\n\t_isObject,\r\n\t_isString,\r\n\t_isNull,\r\n\t_isTypeObject,\r\n\t_isObservable,\r\n\t_isUndefined,\r\n} from './Js.js';\r\nimport {\r\n\t_from as _arr_from,\r\n\t_first as _arr_first,\r\n\t_last as _arr_last,\r\n\t_pushUnique,\r\n\t_rand,\r\n} from './Arr.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Object utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n \r\n/**\r\n * Return an object for the given pair(s) of input.\r\n *\r\n * @param string|array \t\t\tkey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nconst _from = function(key, val = null) {\r\n\tvar obj = {};\r\n\tif (arguments.length === 2) {\r\n\t\tif (_isString(key)) {\r\n\t\t\tobj[key] = val;\r\n\t\t} else if (_isArray(key) && _isArray(val)) {\r\n\t\t\tkey.forEach((k, i) => obj[k] = val[i]);\r\n\t\t}\r\n\t}\r\n\treturn obj;\r\n};\r\n \r\n/**\r\n * Return the input object with additional entries.\r\n *\r\n * @param object\t \t\t\tobj\r\n * @param string|array \t\t\tentriesOrKey\r\n * @param mixed|array\t\t\tval \r\n *\r\n * @return object\r\n */\r\nconst _with = function(obj, entriesOrKey, val = null) {\r\n\treturn _merge(obj, _isObject(entriesOrKey) ? entriesOrKey : _from(entriesOrKey, val));\r\n};\r\n \r\n/**\r\n * Loops thru obj flatly with a callback function.\r\n * Stops when callback returns a non-undefined value.\r\n *\r\n * @param array|object \t\t\tobj \t\t\tThe array or object to iterate.\r\n * @param function \t\t\t\tcallback \t\tThe callback function.\r\n *\r\n * @return mixed|null\t\t\tAny non-null return from callback\r\n */\r\nconst _each = function(obj, callback) {\r\n\tvar returnValue = undefined;\r\n\tif (_isTypeObject(obj)) {\r\n\t\tObject.keys(obj).forEach(k => {\r\n\t\t\tif (returnValue !== false) {\r\n\t\t\t\treturnValue = callback(_isNumeric(k) ? parseFloat(k) : k, obj[k]);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn returnValue;\r\n};\r\n\t\r\n/**\r\n * Retrieves the value at the given path.\r\n *\r\n * A return value of undefined is ambiguous, and can mean either that the\r\n * path does not exist, or that the path actually exists but with a value of undefined. If it is required to\r\n * know whether the path actually exists, pass an object as a third argument.\r\n * This object will have an \"exists\" key set to true/false\r\n *\r\n * @param object \t\t\t\tctxt\r\n * @param array \t\t\t\tpath\r\n * @param object \t\t\t\treciever\r\n * @param object \t\t\t\tdetectObservables\r\n *\r\n * @return mixed\r\n */\r\nconst _get = function(ctxt, path, reciever = {}, detectObservables = true) {\r\n\tpath = _arr_from(path).slice();\r\n\tvar _ctxt = ctxt;\r\n\twhile(!_isUndefined(_ctxt) && !_isNull(_ctxt) && path.length) {\r\n\t\tvar _key = path.shift();\r\n\t\tvar isObsvble = detectObservables && _isObservable(_ctxt);\r\n\t\tif (!(isObsvble ? _ctxt.has(_key) : (_key in _ctxt))) {\r\n\t\t\treciever.exists = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_ctxt = isObsvble ? _ctxt.get(_key) : _ctxt[_key];\r\n\t}\r\n\treciever.exists = true;\r\n\treturn _ctxt;\r\n};\r\n\t\r\n/**\r\n * Sets a value to the given path.\r\n *\r\n * @param object \t\t\t\tobj\r\n * @param array \t\t\t\tpath\r\n * @param mixed \t\t\t\tval\r\n * @param object|function \t\tbuildTree\r\n *\r\n * @return bool\r\n */\r\nconst _set = function(obj, path, val, buildTree = {}) {\r\n\tpath = _arr_from(path);\r\n\tvar target = obj;\r\n\tfor(var i = 0; i < path.length; i ++) {\r\n\t\tif (i < path.length - 1) {\r\n\t\t\tif (!_isTypeObject(target) && !_isFunction(target)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (!_isTypeObject(target[path[i]])) {\r\n\t\t\t\tif (!buildTree) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\ttarget[path[i]] = _isFunction(buildTree) ? buildTree(i) : buildTree;\r\n\t\t\t}\r\n\t\t\ttarget = target[path[i]];\r\n\t\t} else {\r\n\t\t\ttarget[path[i]] = val;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n};\r\n\t\r\n/**\r\n * Unsets a value from the given path.\r\n *\r\n * @param object \t\t\t\tobj\r\n * @param array \t\t\t\tpath\r\n * @param bool|function \t\treduceTree\r\n *\r\n * @return bool\r\n */\r\nconst _unset = function(obj, path, reduceTree = false) {\r\n\tpath = _arr_from(path);\r\n\tvar success = false;\r\n\tdo {\r\n\t\tvar lastKey = path.pop();\r\n\t\tvar lastKey = lastKey === ''/*null*/ ? 0 : lastKey;\r\n\t\tvar _obj = obj;\r\n\t\tif (path.length) {\r\n\t\t\t_obj = _get(obj, path);\r\n\t\t}\r\n\t\tif ((_isTypeObject(_obj) || _isFunction(_obj)) && lastKey in _obj) {\r\n\t\t\tdelete _obj[lastKey];\r\n\t\t\tsuccess = true;\r\n\t\t}\r\n\t} while (success && reduceTree && path.length && (_isTypeObject(_obj) || _isFunction(_obj)) && !Object.keys(_obj).length);\r\n\treturn success;\r\n};\r\n\t\r\n/**\r\n * Tells if the given path exists.\r\n *\r\n * @param object \t\t\t\tobj\r\n * @param array \t\t\t\tpath\r\n *\r\n * @return bool\r\n */\r\nconst _isset = function(obj, path) {\r\n\tvar reciever = {};\r\n\t_get(obj, path, reciever);\r\n\treturn reciever.exists;\r\n};\r\n\r\n/**\r\n * Returns the FIRST ENTRY.\r\n *\r\n * @param array|object \tobj\r\n *\r\n * @return mixed\r\n */\r\nconst _first = function(obj) {\r\n\treturn _isArray(obj) ? _arr_first(obj) : obj[Object.keys(obj)[0]];\r\n};\r\n\r\n/**\r\n * Returns the LAST ENTRY.\r\n *\r\n * @param array|object \tobj\r\n *\r\n * @return mixed\r\n */\r\nconst _last = function(obj) {\r\n\treturn _isArray(obj) ? _arr_last(obj) : obj[_arr_last(Object.keys(obj))];\r\n};\r\n\r\n/**\r\n * Returns a random subset of object.\r\n *\r\n * @param array|object \tobj\r\n * @param int\t\t \tamount\r\n *\r\n * @return array|object\r\n */\r\nconst _sample = function(obj, amount = 1) {\r\n\treturn _isArray(obj) ? _rand(obj) : _copy(obj, _rand(Object.keys(obj), amount));\r\n};\r\n\r\n/**\r\n * Finds a value in an array/object and returns the key (or path when found deep).\r\n *\r\n * @param array}object \tobj\r\n * @param function\t\tcallback\r\n * @param bool\t\t\tdeep\r\n *\r\n * @return number|string|array\r\n */\r\nconst _find = function(obj, callback, deep = false) {\r\n\tvar keys = null;\r\n\tvar values = obj;\r\n\tif (!_isArray(obj)) {\r\n\t\tkeys = Object.keys(obj);\r\n\t\tvalues = Object.values(obj);\r\n\t}\r\n\tvar subKey = undefined;\r\n\tvar value = values.reduce((prev, curr) => {\r\n\t\tif (subKey === undefined) {\r\n\t\t\tif (callback(curr, prev)) {\r\n\t\t\t\treturn curr;\r\n\t\t\t}\r\n\t\t\tif (deep && (_isTypeObject(curr) || _isFunction(curr)) && (subKey = _find(curr, callback, deep)) !== undefined) {\r\n\t\t\t\treturn curr;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn prev;\r\n\t}, undefined);\r\n\tif (value !== undefined) {\r\n\t\tvar key = keys ? keys[values.indexOf(value)] : values.indexOf(value);\r\n\t\treturn subKey !== undefined ? [key].concat(_arr_from(subKey)) : key;\r\n\t}\r\n};\r\n\r\n/**\r\n * Eagerly retrieves object members all down the prototype chain.\r\n *\r\n * @param object\t \tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return array\r\n */\r\nconst _getAllPropertyNames = function(obj, until) {\r\n\tvar keysAll = [];\r\n\t_getPrototypeChain(obj, until).forEach(obj => {\r\n\t\t_pushUnique(keysAll, ...Object.getOwnPropertyNames(obj));\r\n\t});\r\n\treturn keysAll;\r\n};\r\n\r\n/**\r\n * Returns the prototype chain.\r\n *\r\n * @param object \t\tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return bool\r\n */\r\nconst _getPrototypeChain = function(obj, until) {\r\n\tuntil = until || Object.prototype;\r\n\tuntil = until && !_isArray(until) ? [until] : until;\r\n\t// We get the chain of inheritance\r\n\tvar prototypalChain = [];\r\n\tvar obj = obj;\r\n\twhile((obj && (!until || until.indexOf(obj) < 0) && obj.name !== 'default')) {\r\n\t\tprototypalChain.push(obj);\r\n\t\tobj = obj ? Object.getPrototypeOf(obj) : null;\r\n\t}\r\n\treturn prototypalChain;\r\n};\r\n\r\n/**\r\n * Copies only properties of an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tonly\r\n * @param array\t\t \texcept\r\n *\r\n * @return object\r\n */\r\nconst _copyPlain = function(obj, filter = []) {\r\n\treturn _mergeCallback([{}, obj], (key, obj1, obj2) => {\r\n\t\tif (!_isFunction(obj2[key])) {\r\n\t\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t\t}\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n\r\n/**\r\n * Copies an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tfilter\r\n *\r\n * @return object\r\n */\r\nconst _copy = function(obj, filter = []) {\r\n\tvar depth = 0;\r\n\tif (_isNumeric(arguments[0]) && _isTypeObject(arguments[1])) {\r\n\t\tdepth = arguments[0];\r\n\t\tobj = arguments[1];\r\n\t\tfilter = arguments[2] || [];\r\n\t}\r\n\treturn _mergeCallback([depth, {}, obj], (key, obj1, obj2) => {\r\n\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nconst _merge = function(...objs) {\r\n\treturn _mergeCallback(objs, (k, obj1, obj2) => {\r\n\t\treturn true;\r\n\t});\r\n};\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects into first array/object but only when not set;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nconst _inherit = function(...objs) {\r\n\treturn _mergeCallback(objs, (key, obj1, obj2) => {\r\n\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\tif (obj1.indexOf(obj2[key]) === -1) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else if (!(key in obj1)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n};\r\n\r\n/**\r\n  * Replaces properties of first array/object with values from subsequent arrays/objects;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nconst _replace = function(...objs) {\r\n\tvar replaceIntoEmptyObj = Object.keys(objs[0]).length === 0;\r\n\treturn _mergeCallback(objs, (key, obj1, obj2, i) => {\r\n\t\tif ((key in obj1) || (replaceIntoEmptyObj && i === 0)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}, false/*deepProps*/, true/*isReplace*/);\r\n};\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n * @param int\t\t\t\tdepth\r\n *\r\n * @return bool\r\n */\r\nconst _even = function(obj1, obj2, assertion = true, depth = 1) {\r\n\tif ((_isArray(obj1) && _isArray(obj2) && obj1.length !== obj2.length)\r\n\t|| (_isObject(obj1) && _isObject(obj2) && Object.keys(obj1).length !== Object.keys(obj2).length)) {\r\n\t\treturn false;\r\n\t}\r\n\tvar result = _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif (depth > 0 && ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2)))) {\r\n\t\t\treturn _even(v1, v2, assertion, depth - 1);\r\n\t\t}\r\n\t\treturn _isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion;\r\n\t}, false/*netComparison*/, false/*contrast*/, true/*returnOnFirstFalse*/);\r\n\treturn _isArray(result) ? result.length === obj1.length\r\n\t\t: (_isObject(result) ? Object.keys(result).length === Object.keys(obj1).length : result);\r\n};\r\n\r\n/**\r\n * Gets the match(es) between (members of) two objects;\r\n * optionally with custom assertion.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetMatch\r\n *\r\n * @return object|undefined\r\n */\r\nconst _match = function(obj1, obj2, assertion = true, netMatch = true) {\r\n\treturn _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2))) {\r\n\t\t\treturn _match(v1, v2, assertion, netMatch);\r\n\t\t}\r\n\t\treturn _isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion;\r\n\t}, netMatch/*netComparison*/);\r\n};\r\n\r\n/**\r\n * Gets the difference(s) between (members of) two objects;\r\n * optionally with custom assertion.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetDiff\r\n *\r\n * @return object|undefined\r\n */\r\nconst _diff = function(obj1, obj2, assertion = true, netDiff = true) {\r\n\treturn _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2))) {\r\n\t\t\treturn _diff(v1, v2, assertion, netDiff);\r\n\t\t}\r\n\t\treturn _isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion;\r\n\t}, netDiff/*netComparison*/, true/*contrast*/);\r\n};\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n *\r\n * @return bool\r\n */\r\nconst _percentageMatch = function(obj1, obj2, assertion = true) {\r\n\tvar result = _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2))) {\r\n\t\t\treturn _percentageMatch(v1, v2, assertion);\r\n\t\t}\r\n\t\treturn (_isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion) ? 1 : 0;\r\n\t}, false/*netComparison*/, false/*contrast*/, true/*returnOnFirstFalse*/);\r\n\tvar values = _isObject(result) ? Object.values(result) : result;\r\n\treturn values.reduce((a, b) => a + b, 0) / values.length;\r\n};\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n *\r\n * @return bool\r\n */\r\nconst _percentageDiff = function(obj1, obj2, assertion = false) {\r\n\treturn 1 - _percentageMatch(obj1, obj2, assertion);\r\n};\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nconst _mergeCallback = function(objs, callback, deepProps = false, isReplace = false, withSymbols = false) {\r\n\tvar depth = 0;\r\n\tvar obj1 = objs.shift();\r\n\tif (_isNumeric(obj1) || obj1 === true || obj1 === false) {\r\n\t\tdepth = obj1;\r\n\t\tobj1 = objs.shift();\r\n\t}\r\n\tif (!objs.length) {\r\n\t\tthrow new Error('_merge() requires two or more array/objects.');\r\n\t}\r\n\tobjs.forEach((obj2, i) => {\r\n\t\tif (!_isTypeObject(obj2) && !_isFunction(obj2)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t(deepProps ? _getAllPropertyNames(obj2) : Object.getOwnPropertyNames(obj2)).forEach(key => {\r\n\t\t\tvar valAtObj1 = obj1[key];\r\n\t\t\tvar valAtObj2 = obj2[key];\r\n\t\t\tif (((_isArray(valAtObj1) && _isArray(valAtObj2)) || (_isObject(valAtObj1) && _isObject(valAtObj2))) \r\n\t\t\t&& (depth === true || depth > 0)) {\r\n\t\t\t\t// RECURSE...\r\n\t\t\t\tobj1[key] = _isArray(valAtObj1) && _isArray(valAtObj2) ? [] : {};\r\n\t\t\t\t_mergeCallback([_isNumeric(depth) ? depth - 1 : depth, obj1[key], valAtObj1, valAtObj2], callback, deepProps, isReplace);\r\n\t\t\t} else if (callback(key, obj1, obj2, i)) {\r\n\t\t\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\t\t\tif (isReplace) {\r\n\t\t\t\t\t\tobj1[key] = valAtObj2;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj1.push(valAtObj2);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (withSymbols) {\r\n\t\t\t\t\tObject.defineProperty(obj1, key, Object.getOwnPropertyDescriptor(obj2, key));\r\n\t\t\t\t} else {\r\n\t\t\t\t\tobj1[key] = obj2[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\treturn obj1;\r\n};\r\n\r\n/**\r\n * Gets the match(es) between (members of) two values;\r\n * assertion optionally custom.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetComparison\r\n * @param bool\t\t\t\tcontrast\r\n * @param bool\t\t\t\treturnOnFirstFalse\r\n *\r\n * @return bool|array|object\r\n */\r\nconst _compareCallback = function(obj1, obj2, assertion = true, netComparison = true, contrast = false, returnOnFirstFalse = false) {\r\n\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\tvar result = [];\r\n\t\tvar contn = true;\r\n\t\tobj1.forEach(v1 => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = false;\r\n\t\t\t_each(obj2, (k, v2) => {\r\n\t\t\t\tif (!testPass || (netComparison && _isTypeObject(v1))) {\r\n\t\t\t\t\ttestPass = assertion(v1, v2);\r\n\t\t\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\t\t\ttestPass = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_isTypeObject(testPass) && netComparison) {\r\n\t\t\t\t\t\t// Further recursions should use this testPass as v1\r\n\t\t\t\t\t\tv1 = testPass;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult.push(netComparison ? testPass : v1);\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult.push(testPass);\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult.push(v1);\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tif (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tvar result = {};\r\n\t\tvar contn = true;\r\n\t\tObject.keys(obj1).forEach(k => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = assertion(obj1[k], obj2[k]);;\r\n\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\ttestPass = false;\r\n\t\t\t}\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult[k] = netComparison ? testPass : obj1[k];\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult[k] = testPass;\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult[k] = obj1[k];\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\t_from,\r\n\t_with,\r\n\t_each,\r\n\t_get,\r\n\t_set,\r\n\t_unset,\r\n\t_isset,\r\n\t_first,\r\n\t_last,\r\n\t_sample,\r\n\t_find,\r\n\t_getAllPropertyNames,\r\n\t_getPrototypeChain,\r\n\t_copyPlain,\r\n\t_copy,\r\n\t_merge,\r\n\t_inherit,\r\n\t_replace,\r\n\t_even,\r\n\t_match,\r\n\t_diff,\r\n\t_percentageMatch,\r\n\t_percentageDiff,\r\n\t_mergeCallback,\r\n\t_compareCallback,\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_all,\r\n\t_last,\r\n\t_slice\r\n} from './Arr.js';\r\nimport {\r\n\t_each,\r\n\t_merge,\r\n\t_mergeCallback\r\n} from './Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Typechecks and other utils\r\n * ---------------------------\r\n */\r\n \r\n/**\r\n * Tells if val is of type \"string\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isString = function(val) {\r\n\treturn typeof val === 'string';\r\n};\r\n \r\n/**\r\n * Tells if val is of type \"number\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isNumber = function(val) {\r\n\treturn typeof val === 'number';\r\n};\r\n \r\n/**\r\n * Tells if val is of type \"string\" or a numeric string.\r\n * This holds true for both numbers and numeric strings.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isNumeric = function(val) {\r\n\treturn val !== true && val !== false && val !== null && val !== '' && !isNaN(val * 1);\r\n};\r\n\r\n/**\r\n * Tells if val is of type \"array\".\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isArray = function(val) {\r\n\treturn Array.isArray(val);\r\n};\r\n\r\n/**\r\n * Tells if val is \"array-like\".\r\n * This holds true for anything that has a length property.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isTypeArray = function(val) {\r\n\treturn !_isString(val) && !_isUndefined(val.length);\r\n};\r\n\r\n/**\r\n * Tells if val is pure object.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isObject = function(val) {\r\n\treturn !Array.isArray(val) && typeof val === 'object' && val;\r\n};\r\n\r\n/**\r\n * Tells if val is of type \"object\".\r\n * This holds true for anything object, including built-ins.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isTypeObject = function(val) {\r\n\treturn Array.isArray(val) || typeof val === 'object';\r\n};\r\n \r\n/**\r\n * Tells if val is of type \"function\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nconst _isFunction = function(val) {\r\n\treturn _isTypeFunction(val) || (val && {}.toString.call(val) === '[object function]');\r\n};\r\n\r\n/**\r\n * Tells if val is of type \"function\".\r\n * This holds true for both regular functions and classes.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isTypeFunction = function(val) {\r\n\treturn typeof val === 'function';\r\n};\r\n \r\n/**\r\n * Tells if val is of type \"class\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nconst _isClass = function(val) {\r\n\treturn _isTypeFunction(val) && /^class\\s/.test(Function.prototype.toString.call(val));\r\n};\r\n \r\n/**\r\n * Tells if val is undefined or is of type \"undefined\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isUndefined = function(val) {\r\n\treturn arguments.length && (val === undefined || typeof val === 'undefined');\r\n};\r\n \r\n/**\r\n * Tells if val is undefined or is of type \"boolean\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isBoolean = function(val) {\r\n\treturn val === true || val === false;\r\n};\r\n \r\n/**\r\n * Tells if val is undefined or is null.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isNull = function(val) {\r\n\treturn val === null || val === '';\r\n};\r\n \r\n/**\r\n * Tells if val is empty in its own type.\r\n * This holds true for NULLs, UNDEFINED, FALSE, 0,\r\n * objects without keys, empty arrays.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nconst _isEmpty = function(val) {\r\n\treturn _isNull(val) || _isUndefined(val) || val === false || val === 0 \r\n\t\t|| (_isTypeObject(val) && !Object.keys(val).length);\r\n};\r\n \r\n/**\r\n * Returns the val's type.\r\n *\r\n * @param string \tval\r\n *\r\n * @return string\r\n */\r\nconst _getType = function(val) {\r\n\treturn typeof val;\r\n};\r\n\r\n/**\r\n * Tells if a given object has observability methods.\r\n *\r\n * @param mixed\t\tinput\r\n *\r\n * @return bool\r\n */\r\nconst _isObservable = function(input) {\r\n\treturn _isObject(input) && _all([\r\n\t\t'observe',\r\n\t\t'unobserve',\r\n\t\t'setOffsetParent',\r\n\t\t'getOffsetParent',\r\n\t], method => _isFunction(input[method]));\r\n};\r\n\r\n/**\r\n * Creats a proxy and keeps special reference to it.\r\n *\r\n * @param object\t target\r\n * @param object\t trap\r\n *\r\n * @return Proxy\r\n */\r\nconst _proxy = function(target, trap) {\r\n\tvar trapByCommons = {\r\n\t\tget: (target, prop) => {\r\n\t\t\tif (prop === '__proxyTargetByCommons') {\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\t\t\tif (prop === '__proxyTrapByCommons') {\r\n\t\t\t\treturn trap;\r\n\t\t\t}\r\n\t\t\treturn trap.get ? trap.get(target, prop) : target[prop];\r\n\t\t},\r\n\t};\r\n\treturn new Proxy(target, _merge({}, trap, trapByCommons));\r\n};\r\n\r\n/**\r\n * Tells if a given object instance has been proxied.\r\n *\r\n * @param mixed\t\tinput\r\n *\r\n * @return bool\r\n */\r\nconst _isProxy = function(input) {\r\n\treturn (_isObject(input) && input.__proxyTargetByCommons) || false;\r\n};\r\n\r\n/**\r\n * Returns the proxy's target object as earlier saved.\r\n *\r\n * @param mixed\t\tproxy\r\n *\r\n * @return mixed\r\n */\r\nconst _getProxyTarget = function(instance) {\r\n\treturn _isProxy(instance) ? instance.__proxyTargetByCommons : undefined;\r\n};\r\n\r\n/**\r\n * Returns the proxy's trap object as earlier saved.\r\n *\r\n * @param mixed\t\tproxy\r\n *\r\n * @return mixed\r\n */\r\nconst _getProxyTrap = function(instance) {\r\n\treturn _isProxy(instance) ? instance.__proxyTrapByCommons : undefined;\r\n};\r\n\r\n/**\r\n * A multi-inheritance implementstion.\r\n *\r\n * @param array\t \t...classes\r\n *\r\n * @return object\r\n */\r\nconst _mixin = function(...classes) {\r\n\tvar Traps = {};\r\n\tvar RetrnDirective = 'last';\r\n\tif (_isArray(arguments[0])) {\r\n\t\tclasses = arguments[0];\r\n\t\tTraps = arguments[1];\r\n\t\tif (arguments[2]) {\r\n\t\t\tRetrnDirective = arguments[2];\r\n\t\t}\r\n\t}\r\n\tvar Base = _last(classes);\r\n\tvar supersMap = {};\r\n\tvar Mixin = class extends Base {\r\n\t\tconstructor(...args) {\r\n\t\t\tsuper(...args);\r\n\t\t}\r\n\t};\r\n\t// A trap for _instanceof()\r\n\tMixin.prototypes = classes;\r\n\t// ---------------------\r\n\t// Extend (merge) properties but keep methods\r\n\tclasses.forEach(_class => {\r\n\t\t// Copy const members\r\n\t\t_mergeCallback([Mixin, _class], (key, obj1, obj2) => ['name', 'prototype', 'prototypes', 'length'].indexOf(key) === -1);\r\n\t\t_mergeCallback([Mixin.prototype, _class.prototype], (key, obj1, obj2) => {\r\n\t\t\tif (['prototype', 'prototypes'].indexOf(key) === -1) {\r\n\t\t\t\tif (_isFunction(obj2[key])) {\r\n\t\t\t\t\tif (_isArray(supersMap[key])) {\r\n\t\t\t\t\t\tsupersMap[key].push(obj2[key]);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tsupersMap[key] = [obj2[key]];\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}, true/*deepProps*/);\r\n\t});\r\n\t// Extend (proxy) methods\r\n\t_each(supersMap, (name, supers) => {\r\n\t\tif (name === 'constructor') {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// NOTE: this must not be defined as an arrow function\r\n\t\t// for the benefit of the \"this\".\r\n\t\tMixin.prototype[name] = function(...args) {\r\n\t\t\tif (Object.hasOwnProperty(Traps, name) && _isFunction(Traps[name])) {\r\n\t\t\t\t// Wrap a call to the trap...\r\n\t\t\t\t// So mixin supers are passed to traps\r\n\t\t\t\treturn Traps[name].call(this, supers, ...args);\r\n\t\t\t} else {\r\n\t\t\t\t// Call each super and return\r\n\t\t\t\t// the last one's return value\r\n\t\t\t\tvar supersReturnValues = [];\r\n\t\t\t\tsupers.forEach(supr => {\r\n\t\t\t\t\tsupersReturnValues.push(supr.call(this, ...args));\r\n\t\t\t\t})\r\n\t\t\t\treturn _last(supersReturnValues);\r\n\t\t\t}\r\n\t\t};\r\n\t});\r\n\treturn Mixin;\r\n};\r\n\r\n/**\r\n * Instanceof that supports our multi-inheritance implementstion.\r\n *\r\n * @param object\t \tobj1\r\n * @param object\t \tclassB\r\n *\r\n * @return bool\r\n */\r\nconst _instanceof = function(obj, classB) {\r\n\tif (!obj) {\r\n\t\treturn false;\r\n\t}\r\n\tif (obj instanceof classB) {\r\n\t\treturn true;\r\n\t}\r\n\tvar mixinTest = classA => {\r\n\t\twhile (classA && classA !== Function.prototype) {\r\n\t\t\tif (classA === classB || (classA.prototypes && classA.prototypes.reduce((prevAns, prototype) => prevAns || (prototype === classB) || mixinTest(prototype), false))) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tclassA = Object.getPrototypeOf(classA);\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\treturn mixinTest(obj.constructor);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\t_isString,\r\n\t_isNumber,\r\n\t_isNumeric,\r\n\t_isArray,\r\n\t_isTypeArray,\r\n\t_isObject,\r\n\t_isTypeObject,\r\n\t_isFunction,\r\n\t_isTypeFunction,\r\n\t_isClass,\r\n\t_isUndefined,\r\n\t_isBoolean,\r\n\t_isNull,\r\n\t_isEmpty,\r\n\t_getType,\r\n\t_isObservable,\r\n\t_isProxy,\r\n\t_getProxyTarget,\r\n\t_getProxyTrap,\r\n\t_proxy,\r\n\t_mixin,\r\n\t_instanceof\r\n};","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isArray,\r\n\t_isBoolean,\r\n\t_isEmpty,\r\n\t_isNumber,\r\n\t_isNumeric,\r\n\t_isObject,\r\n\t_isString,\r\n\t_isTypeArray,\r\n\t_isUndefined\r\n} from './Js.js';\r\nimport {\r\n\t_each\r\n} from './Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Array utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\n/**\r\n * Casts an array-like object to an array.\r\n *\r\n * @param mixed \tval\r\n *\r\n * @return array\r\n */\r\nconst _from = function(val) {\r\n\tif (_isArray(val)) {\r\n\t\treturn val;\r\n\t};\r\n\tif (val !== false && val !== 0 && _isEmpty(val)) {\r\n\t\treturn [];\r\n\t};\r\n\tif (_isTypeArray(val)) {\r\n\t\treturn Array.prototype.slice.call(val);\r\n\t};\r\n\tif (_isObject(val)) {\r\n\t\treturn Object.values(val);\r\n\t};\r\n\treturn [val];\r\n};\r\n\r\n/**\r\n * Returns THE FIRST ENTRY OR A NUMBER OF ENTRIES counting forward from the begining.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nconst _first = function(arr, amount = 1) {\r\n\tvar count = 0;\r\n\tarr.forEach(itm => {\r\n\t\tcount ++;\r\n\t});\r\n\tvar firsts = arr.slice(arr.length - count, amount);\r\n\treturn arguments.length > 1 ? firsts : firsts[0];\r\n};\r\n\r\n/**\r\n * Returns THE LAST ENTRY OR A NUMBER OF ENTRIES counting forward to the end.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nconst _last = function(arr, amount = 1) {\r\n\treturn arguments.length > 1\r\n\t\t? _first(arr.slice().reverse(), amount).reverse()\r\n\t\t: _first(arr.slice().reverse());\r\n};\r\n\r\n/**\r\n * Gets the average of an array of numbers.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nconst _avg = function(arr) {\r\n\treturn arr.length ? _sum(arr) / arr.length : 0;\r\n};\r\n\r\n/**\r\n * Gets the maximum of an array of numbers.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nconst _max = function(arr) {\r\n\tarr = arr.slice();\r\n\treturn arr.reduce((v1, v2) => Math.max(v1, v2), arr.shift());\r\n};\r\n\r\n/**\r\n * Gets the minimum of an array of numbers.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nconst _min = function(arr) {\r\n\tarr = arr.slice();\r\n\treturn arr.reduce((v1, v2) => Math.min(v1, v2), arr.shift());\r\n};\r\n\r\n/**\r\n * Gets one or more random values from an array.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nconst _rand = function(arr, amount = 1) {\r\n\tvar result = [];\r\n\tvar rand = null;\r\n\twhile (result.length < amount && (rand = arr[Math.floor(Math.random() * arr.length)]) && result.indexOf(rand) === -1) {\r\n\t\tresult.push(rand);\r\n\t};\r\n\treturn arguments.length > 1 ? result : result[0];\r\n};\r\n\r\n/**\r\n * Sums an array of numbers.\r\n *\r\n * @param array \tarr\r\n *\r\n * @return number\r\n */\r\nconst _sum = function(arr) {\r\n\tarr = arr.slice();\r\n\treturn arr.reduce((total, v) => total + v, arr.shift());\r\n};\r\n\r\n/**\r\n * Array slicing with support for negative offsets.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n * @param array\t \t\t\t\toffset\r\n * @param array\t \t\t\t\tlengthOrOffset2\r\n *\t *\r\n * @return array\r\n */\r\nconst _slice = function(arr, offset = 0, lengthOrOffset2 = null) {\r\n\tif (arguments.length > 1) {\r\n\t\toffset = offset < 0 ? (arr.length + offset)/*subtraction eventually*/ : offset;\r\n\t\tif (arguments.length > 2) {\r\n\t\t\tlengthOrOffset2 = lengthOrOffset2 < 0 ? (arr.length + lengthOrOffset2)/*subtraction eventually*/ - offset : lengthOrOffset2;\r\n\t\t};\r\n\t};\r\n\treturn arr.slice(offset, lengthOrOffset2);\r\n};\r\n\r\n/**\r\n * 1. Returns the ENTRY preceding (either the FIRST or the LAST instance of) the reference.\r\n * 2. Returns A NUMBER OF ENTRIES counting backwards from (either the FIRST or the LAST instance of) the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n * @param bool\t \tlastReference\r\n *\r\n * @return mixed|array\r\n */\r\nconst _preceding = function(arr, reference, length = false, rotate = false, lastReference = false) {\r\n\tif (arr.indexOf(reference) === -1) {\r\n\t\treturn length ? [] : undefined;\r\n\t}\r\n\tvar amount = length === true ? arr.length - 1 : (length === false ? 1 : length);\r\n\tvar arr = arr.slice().reverse();\r\n\tvar from = lastReference ? arr.lastIndexOf(reference) + 1 : arr.indexOf(reference) + 1;\r\n\tvar before = !_isUndefined(reference) ? arr.slice(from, from + amount) : [];\r\n\tif (rotate && before.length < amount && before.length < arr.length) {\r\n\t\tbefore = before.concat(arr.slice(0, amount - before.length));\r\n\t};\r\n\treturn length ? before : before[0];\r\n};\r\n\t\r\n/**\r\n * 1. Returns the ENTRY following (either the FIRST or the LAST instance of) the reference.\r\n * 2. Returns A NUMBER OF ENTRIES counting forwards from (either the FIRST or the LAST instance of) the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n * @param bool\t \tlastReference\r\n *\r\n * @return mixed|array\r\n */\r\nconst _following = function(arr, reference, length = false, rotate = false, lastReference = false) {\r\n\tif (arr.indexOf(reference) === -1) {\r\n\t\treturn length ? [] : undefined;\r\n\t}\r\n\tvar amount = length === true ? arr.length - 1 : (length === false ? 1 : length);\r\n\tvar from = lastReference ? arr.lastIndexOf(reference) + 1 : arr.indexOf(reference) + 1;\r\n\tvar after = !_isUndefined(reference) ? arr.slice(from, from + amount) : [];\r\n\tif (rotate && after.length < amount && after.length < arr.length) {\r\n\t\tafter = after.concat(arr.slice(0, amount - after.length));\r\n\t};\r\n\treturn length ? after : after[0];\r\n};\r\n\r\n/**\r\n * Alias of _preceding() but uses last instance of reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n *\r\n * @return mixed|array\r\n */\r\nconst _precedingLast = function(arr, reference, length = false, rotate = false) {\r\n\treturn _preceding(arr, reference, length, rotate, true/*lastReference*/);\r\n};\r\n\r\n/**\r\n * Alias of _following() but uses last instance of reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n *\r\n * @return mixed|array\r\n */\r\nconst _followingLast = function(arr, reference, length = false, rotate = false) {\r\n\treturn _following(arr, reference, length, rotate, true/*lastReference*/);\r\n};\r\n\r\n/**\r\n * Returns ALL THE ENTRIES from (either the FIRST or the LAST instance of) the given reference UNTIL reference2,\r\n * in ltr/rtl direction.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param mixed\t \treference2\r\n * @param bool\t \trtl\r\n * @param bool\t \trotate\r\n * @param bool\t \tlastReference\r\n *\r\n * @return array\r\n */\r\nconst _between = function(arr, reference, reference2, rtl = false, rotate = false, lastReference = false) {\r\n\tvar from = lastReference ? arr.lastIndexOf(reference) : arr.indexOf(reference);\r\n\tvar to = lastReference ? arr.lastIndexOf(reference2) : arr.indexOf(reference2);\r\n\tif (rtl) {\r\n\t\tvar length = to > from \r\n\t\t\t? from/*the begining backward*/ + arr.length - to/*the other half*/\r\n\t\t\t: from - to;\r\n\t\treturn _preceding(arr, reference, length, rotate, lastReference);\r\n\t};\r\n\tvar length = to < from \r\n\t\t? arr.length - from - 1/*the remainder forward*/ + to + 1/*the other half*/\r\n\t\t: to - from;\r\n\treturn _following(arr, reference, length, rotate, lastReference);\r\n};\r\n\r\n/**\r\n * Returns the intersection of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nconst _intersect = function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) !== -1\r\n\t);\r\n};\r\n\r\n/**\r\n * Returns the difference of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nconst _difference = function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) === -1\r\n\t);\r\n};\r\n\r\n/**\r\n * Returns a list of items that pass a callback test.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n * @param function\t\t\t\tcallback\r\n *\t *\r\n * @return array\r\n */\r\nconst _filter = function(arr, callback) {\r\n\treturn _divide(arr, callback)[0];\r\n};\r\n\r\n/**\r\n * Makes a separation between items that pass a callback test and those that fail.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n * @param function\t\t\t\tcallback\r\n *\t *\r\n * @return array\r\n */\r\nconst _divide = function(arr, callback) {\r\n\tvar passes = [];\r\n\tvar failures = [];\r\n\tvar length = arr.length;\r\n\tfor (i = 0; i < length; i++) {\r\n\t\tif (callback(arr[i])) {\r\n\t\t\tpasses.push(arr[i]);\r\n\t\t} else {\r\n\t\t\tfailures.push(arr[i]);\r\n\t\t};\r\n\t};\r\n\treturn [passes, failures];\r\n};\r\n\r\n/**\r\n * Flattens a nested array to the given depth.\r\n *\r\n * @param array \tarr\r\n * @param int \t \tdepth\r\n * @param bool \t \twithObjects\r\n *\r\n * @return array\r\n */\r\nconst _flatten = function(arr, depth = 1, withObjects = true) {\r\n\tif (!_isNumeric(depth) || depth <= 0) {\r\n\t\treturn arr;\r\n\t};\r\n\tif (!_isArray(arr) && _isObject(arr) && withObjects) {\r\n\t\tarr = Object.values(arr);\r\n\t};\r\n\tif (!_isArray(arr)) {\r\n\t\treturn arr;\r\n\t};\r\n\treturn arr.reduce((acc, val) => _isArray(val) || (_isObject(val) && withObjects) \r\n\t\t? acc.concat(_flatten(!_isArray(val) ? Object.values(val) : val, depth - 1, withObjects)) \r\n\t\t: acc.concat(val), []);\r\n};\r\n\r\n/**\r\n * Sorts a list performantly.\r\n *\r\n * @param array\t \t\t\t\t\tarr\r\n * @param string\t \t\t\t\torder\t\t\tASC|DESC \r\n * @param function\t\t\t\t\tcallback\r\n *\r\n * @return array\r\n */\r\nconst _sort = function(arr, order, callback = null) {\r\n\tvar _arr = [];\r\n\t// Make a shallow copy\r\n\tvar length = arr.length;\r\n\tfor (var i = 0; i < length; i ++) {\r\n\t\t_arr.push({index: i, value: callback ? callback(arr[i]) : arr[i]});\r\n\t};\r\n\t_arr.sort(function(a, b) {\r\n\t\t// Using localeCompare if possible\r\n\t\tif (_isString(a.value) && \"\".localeCompare) {\r\n\t\t\treturn a.value.localeCompare(b.value);\r\n\t\t};\r\n\t\treturn a.value === b.value ? 0 : a.value > b.value ? 1 : -1;\r\n\t});\r\n\tif ((order || '').trim().toLowerCase() === 'desc') {\r\n\t\t_arr = _arr.reverse();\r\n\t};\r\n\t// Fill the order with actual values\r\n\treturn _arr.map(itm => arr[itm.index]);\r\n};\r\n\r\n/**\r\n * Returns a list of unique items.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n *\t *\r\n * @return array\r\n */\r\nconst _unique = function(arr) {\r\n\tconst distinct = (value, index, self) => {\r\n\t\treturn self.indexOf(value) === index;\r\n\t};\r\n\treturn arr.filter(distinct);\r\n};\r\n\r\n/**\r\n * Adds an item if not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...itms\r\n *\r\n * @return array\r\n */\r\nconst _pushUnique = function(arr, ...items) {\r\n\titems.forEach(itm => {\r\n\t\tif (arr.indexOf(itm) < 0) {\r\n\t\t\tarr.push(itm);\r\n\t\t}\r\n\t});\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Adds items that do not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...arrs\r\n *\r\n * @return array\r\n */\r\nconst _concatUnique = function(arr, ...arrs) {\r\n\tarrs.forEach(_arr => {\r\n\t\t_arr.forEach(itm => _pushUnique(arr, ..._from(_arr)));\r\n\t});\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Removes instances of reference up to <limit> times.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \titm\r\n * @param int|bool \tlimit\r\n *\r\n * @return array\r\n */\r\nconst _remove = function(arr, itm, limit = false) {\r\n\tvar i = arr.indexOf(itm);\r\n\twhile (i > -1 && (limit || limit === false)) {\r\n\t\tarr.splice(i, 1);\r\n\t\tif (limit > 0) {\r\n\t\t\tlimit --;\r\n\t\t};\r\n\t\ti = arr.indexOf(itm);\r\n\t};\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Removes all instances of each item.\r\n *\r\n * @param array \tarr\r\n * @param array\t \titms\r\n *\r\n * @return array\r\n */\r\nconst _exclude = function(arr, ...itms) {\r\n\titms.forEach(itm => _remove(arr, itm));\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Removes an item.\r\n *\r\n * @param array \tarr\r\n * @param array\t \titms\r\n * @param array\t \treplacements\r\n *\r\n * @return array\r\n */\r\nconst _replace = function(arr, itms, replacements = []) {\r\n\tif (arguments.length === 2) {\r\n\t\titms.forEach((itm, i) => {arr[i] = itm;});\r\n\t\treturn arr;\r\n\t};\r\n\t_each(itms, (k, reference) => {\r\n\t\tvar i = arr.indexOf(reference);\r\n\t\tif (i !== -1) {\r\n\t\t\tarr[i] = replacements[k];\r\n\t\t};\r\n\t});\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Adds A LIST OF ITEMS before the FIRST instance of the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param array\t \titms\r\n * @param bool\t \tlastReference\r\n *\r\n * @return array\r\n */\r\nconst _concatBefore = function(arr, reference, itms, lastReference = false) {\r\n\tvar secondHalf = arr.splice(lastReference ? arr.lastIndexOf(reference) : arr.indexOf(reference));\r\n\titms.concat(secondHalf).forEach(function(itm) {\r\n\t\tarr.push(itm);\r\n\t});\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Adds A LIST OF ITEMS after the FIRST instance of the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param array\t \titms\r\n * @param bool\t \tlastReference\r\n *\r\n * @return array\r\n */\r\nconst _concatAfter = function(arr, reference, itms, lastReference = false) {\r\n\tvar secondHalf = arr.splice(lastReference ? arr.lastIndexOf(reference) + 1 : arr.indexOf(reference) + 1);\r\n\titms.concat(secondHalf).forEach(function(itm) {\r\n\t\tarr.push(itm);\r\n\t});\r\n\treturn arr;\r\n};\r\n\r\n/**\r\n * Adds A LIST OF ITEMS before the LAST instance of the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param array\t \titms\r\n *\r\n * @return array\r\n */\r\nconst _concatBeforeLast = function(arr, reference, itms) {\r\n\treturn _concatBefore(arr, reference, itms, true/*lastReference*/);\r\n};\r\n\r\n/**\r\n * Adds A LIST OF ITEMS after the LAST instance of the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param array\t \titms\r\n *\r\n * @return array\r\n */\r\nconst _concatAfterLast = function(arr, reference, itms) {\r\n\treturn _concatAfter(arr, itms, reference, true/*lastReference*/);\r\n};\r\n\r\n/**\r\n * Tells if ALL items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nconst _all = function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest && callback(itm), true);\r\n};\r\n\r\n/**\r\n * Tells if ANY items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nconst _any = function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest || callback(itm), false);\r\n};\r\n\r\n/**\r\n * Calls callback with each item in the list and waits inbetween for each callback's promise to resolve.\r\n * The delay parameter may be used solely as the wait or as an addition to the promise-based wait.\r\n *\r\n * @param int|string|object \tinterval\r\n *\r\n * @return new Promise\r\n */\r\nconst _inSequence = function(arr, callback, timing) {\r\n\tif (!_isArray(arr)) {\r\n\t\treturn;\r\n\t};\r\n\tif (_isObject(timing)) {\r\n\t\tvar sync = timing.sync || false;\r\n\t\tvar delay = timing.delay || 0;\r\n\t\tvar delayAlways = timing.delayAlways || false;\r\n\t} else {\r\n\t\tvar sync = _isBoolean(timing) || timing === 'last' ? timing : false;\r\n\t\tvar delay = _isNumber(timing) ? timing : 0;\r\n\t\tvar delayAlways = false;\r\n\t};\r\n\tvar items = arr;\r\n\tvar promise = new Promise(function(resolve, reject) {\r\n\t\tif (items.length) {\r\n\t\t\tvar call = function(i) {\r\n\t\t\t\tvar advance = () => {\r\n\t\t\t\t\t// Delay first before asking items.length\r\n\t\t\t\t\t// Good for progressivly adding new items\r\n\t\t\t\t\t// -----------------------\r\n\t\t\t\t\tif (delayAlways) {\r\n\t\t\t\t\t\tif (delay) {\r\n\t\t\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\t\t\tif (items.length > i + 1) {\r\n\t\t\t\t\t\t\t\t\tcall(i + 1);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\t}, delay);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tif (items.length > i + 1) {\r\n\t\t\t\t\t\t\t\tcall(i + 1);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t// Ask items.length first before delay\r\n\t\t\t\t\t// Good for when delay should only be BETWEEN items\r\n\t\t\t\t\t// -----------------------\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tif (items.length > i + 1) {\r\n\t\t\t\t\t\t\tif (delay) {\r\n\t\t\t\t\t\t\t\tsetTimeout(() => {call(i + 1);}, delay);\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tcall(i + 1);\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tresolve()\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t};\r\n\t\t\t\t};\r\n\t\t\t\tvar ret = callback(items[i]);\r\n\t\t\t\tif (ret instanceof Promise && (sync === true || (sync === 'last' && i === items.length - 1))) {\r\n\t\t\t\t\t// On any of the outcomes...\r\n\t\t\t\t\tret.then(advance);\r\n\t\t\t\t\tret.catch(advance);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tadvance();\r\n\t\t\t\t};\r\n\t\t\t};\r\n\t\t\tcall(0);\r\n\t\t} else {\r\n\t\t\tresolve();\r\n\t\t};\r\n\t});\r\n\treturn promise;\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport {\r\n\t_from,\r\n\t_first,\r\n\t_last,\r\n\t_avg,\r\n\t_max,\r\n\t_min,\r\n\t_rand,\r\n\t_sum,\r\n\t_slice, \r\n\t_preceding,\r\n\t_following,\r\n\t_precedingLast,\r\n\t_followingLast,\r\n\t_between,\r\n\t_intersect,\r\n\t_difference,\r\n\t_filter,\r\n\t_divide,\r\n\t_flatten,\r\n\t_sort,\r\n\t_unique,\r\n\t_pushUnique,\r\n\t_concatUnique,\r\n\t_remove,\r\n\t_exclude,\r\n\t_replace,\r\n\t_concatBefore,\r\n\t_concatAfter,\r\n\t_concatBeforeLast,\r\n\t_concatAfterLast, \r\n\t_all,\r\n\t_any,\r\n\t_inSequence\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isObject\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_pushUnique,\r\n\t_intersect\r\n} from '@onephrase/commons/src/Arr.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The HTML Context Model Schema.\r\n\t// @see https://html.spec.whatwg.org/multipage\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\n/**\r\n * @object\r\n */\r\nconst Schema = {\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\tstd: {\r\n\t\t/**\r\n\t\t * @uncategorized\r\n\t\t */\r\n\t\thtml: {\r\n\t\t\ttype: ['#sectioning-root'],\r\n\t\t\tmodel: ['head', 'body'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcaption: {\r\n\t\t\tmodel: ['#flow', '!table'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcol: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tcolgroup: {\r\n\t\t\tmodel: [{'colgroup[span]': ['#nothing']}, {':not(colgroup[span])': ['col', 'template']}],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tdd: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'definition',\r\n\t\t},\r\n\t\tdt: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tfigcaption: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thead: {\r\n\t\t\tmodel: ['#metadata'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlegend: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tli: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'listitem',\r\n\t\t},\r\n\t\toptgroup: {\r\n\t\t\tmodel: ['option', '#script-supporting'],\r\n\t\t\timplicitRole: 'group',\r\n\t\t},\r\n\t\toption: {\r\n\t\t\tmodel: [{'option[label][value]': ['#nothing']}, {'option[label]:not(option[value])': ['#text']}, {':not(option[label])': ['#text']}],\r\n\t\t},\r\n\t\tparam: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\trp: {\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\trt: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsource: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tsummary: {\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#phrasing', '#heading'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttrack: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttbody: {\r\n\t\t\tmodel: ['#script-supporting', 'tr'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t},\r\n\t\ttfoot: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tthead: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttr: {\r\n\t\t\tmodel: ['#script-supporting', 'td', 'th'],\r\n\t\t},\r\n\t\t/**\r\n\t\t * @categorized\r\n\t\t */\r\n\t\ta: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'a[href]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#interactive', '!a'],\r\n\t\t},\r\n\t\tabbr: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing',],\r\n\t\t},\r\n\t\taddress: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer', '!address',],\r\n\t\t},\r\n\t\t// If a child of <map>\r\n\t\tarea: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tarticle: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'article',\r\n\t\t\tacceptableRoles: ['application', 'article', 'document', 'main',],\r\n\t\t},\r\n\t\taside: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'complementary',\r\n\t\t\tacceptableRoles: ['complementary', 'note', 'search',],\r\n\t\t},\r\n\t\taudio: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'audio[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(audio[src])': ['source']}],\r\n\t\t},\r\n\t\tb: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbase: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbdi: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbdo: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tblockquote: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\tbody: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow', '@banner', '@contentinfo', '@complementary', '@main'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tbutton: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#phrasing', '!#interactive'],\r\n\t\t},\r\n\t\tcanvas: {\r\n\t\t\ttype: ['#embedded', '#flow', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#transparent', '!#interactive', 'a', 'img[usemap]', 'button', 'input[type=\"button\"]', 'input[type=\"radio\"]', 'input[type=\"checkbox\"]', 'select[multiple]', 'select[size>=1]', /*has tabindex but not #interactive*/'[tabindex]!#interactive'],\r\n\t\t},\r\n\t\tcite: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tcode: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdata: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdatalist: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '#script-supporting', 'option'],\r\n\t\t},\r\n\t\tdel: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tdetails: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow', 'summary'],\r\n\t\t},\r\n\t\tdfn: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '!dfn'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tdialog: {\r\n\t\t\ttype: ['#flow', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'dialog',\r\n\t\t},\r\n\t\tdiv: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [{'dl > div': ['dt', 'dd']}, {':not(dl > div)': ['#flow']}],\r\n\t\t},\r\n\t\tdl: {\r\n\t\t\t/*complicated*/\r\n\t\t\ttype: ['#flow', /*{:contains(> * name-value group): ['#palpable']}*/],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#script-supporting', 'dl', 'dt', 'div'],\r\n\t\t},\r\n\t\tem: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tembed: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tfieldset: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['legend', '#flow'],\r\n\t\t},\r\n\t\tfigure: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['#flow', 'figcaption'],\r\n\t\t\timplicitRole: 'figure',\r\n\t\t},\r\n\t\tfooter: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['contentinfo',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tform: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!form'],\r\n\t\t},\r\n\t\th1: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th2: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th3: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th4: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th5: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th6: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\theader: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['banner',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thgroup: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', '#script-supporting'],\r\n\t\t},\r\n\t\thr: {\r\n\t\t\ttype: ['#flow'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\timplicitRole: 'separator',\r\n\t\t},\r\n\t\ti: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tiframe: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\timg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'img[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tinput: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'input:not([type!=\"hidden\"])': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tins: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tkbd: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tlabel: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!label'],\r\n\t\t},\r\n\t\tlink: {\r\n\t\t\ttype: ['#metadata', {'body link': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tmain: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'main',\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tmap: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmark: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmath: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\tmenu: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tmeta: {\r\n\t\t\ttype: ['#metadata', {'meta[itemprop]': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tnames: ['application-name', 'author', 'description', 'generator', 'keywords', 'referrer', 'theme-color'],\r\n\t\t},\r\n\t\tmeter: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tnav: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'navigation',\r\n\t\t\tacceptableRoles: ['navigation',],\r\n\t\t},\r\n\t\tnoscript: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing'], \r\n\t\t\tmodel: [{'head link': ['style', 'meta', 'link']}, {':not(head link)': ['#transparent', '!noscript']}],\r\n\t\t},\r\n\t\tobject: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'object[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', 'param'],\r\n\t\t},\r\n\t\tol: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\toutput: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tp: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tpicture: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing'], \r\n\t\t\tmodel: ['source', 'img', '#acript-supporting'],\r\n\t\t},\r\n\t\tpre: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tprogress: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!progress'],\r\n\t\t},\r\n\t\tq: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\truby: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'],\r\n\t\t\t/*complicated*/ \r\n\t\t\tmodel: ['rp', 'rt'],\r\n\t\t},\r\n\t\ts: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsamp: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tscript: {\r\n\t\t\ttype: ['#flow', '#metadata', '#phrasing', '#acript-supporting'], \r\n\t\t\tmodel: [{'script[src]': []}],\r\n\t\t},\r\n\t\tsection: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'region',\r\n\t\t\tacceptableRoles: ['alert', 'alertdialog', 'application', 'contentinfo', 'dialog', 'document', 'log', 'main', 'marquee', 'region', 'search', 'status',],\r\n\t\t},\r\n\t\tselect: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['option', 'optgroup', '#acript-supporting'],\r\n\t\t},\r\n\t\tslot: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tsmall: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tspan: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstrong: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstyle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\tsub: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsup: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsvg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\ttable: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['caption', 'colgroup', 'thead', 'tbody', 'tr', 'tfoot', '#script-supporting'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\ttemplate: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing', '#script-supporting'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttextarea: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\ttime: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: [{'time[datetime]': ['#phrasing']}, {':not(time[datetime])': ['#text']}],\r\n\t\t},\r\n\t\ttitle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tu: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tul: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tvar: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tvideo: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'video[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(video[src])': ['source']}],\r\n\t\t},\r\n\t\twbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\taria: {\r\n\t\tbanner: {\r\n\t\t\ttype: ['@banner'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcontentinfo: {\r\n\t\t\ttype: ['@contentinfo'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcomplementary: {\r\n\t\t\ttype: ['@complementary'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tnavigation: {\r\n\t\t\ttype: ['@navigation'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlist: {\r\n\t\t\ttype: ['@list'], \r\n\t\t},\r\n\t\tlistitem: {\r\n\t\t\ttype: ['@listitem'], \r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic content model for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetContentModelFor(el) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\treturn Schema.std[elTagName] ? Schema.expandRules(el, Schema.std[elTagName].model || []) : [];\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic categories for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param bool\t\t\t\t\t\troleInclusive\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetCategoriesFor(el, roleInclusive = true) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\tvar elSchema = Schema.std[elTagName] || Schema.aria[elTagName] || {};\r\n\t\tvar currentElCategories = [];\r\n\t\tif (roleInclusive && !el.nodeName.startsWith('#') \r\n\t\t&& (el.hasAttribute('role') || elSchema.implicitRole)) {\r\n\t\t\t// Current el's impliable/acceptable roles\r\n\t\t\t// (These take precedence over native semantics)\r\n\t\t\tif (el.hasAttribute('role')) {\r\n\t\t\t\tvar definedRoles = el.getAttribute('role').split(' ');\r\n\t\t\t\tel.getAttribute('role').split(' ').forEach(role => {\r\n\t\t\t\t\tif (elSchema && elSchema.acceptableRoles && !elSchema.acceptableRoles.includes(role)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\trole = role.trim();\r\n\t\t\t\t\tcurrentElCategories.push('@' + role);\r\n\t\t\t\t\tif (Schema.aria[role] && Schema.aria[role].type) {\r\n\t\t\t\t\t\tcurrentElCategories = currentElCategories.concat(Schema.expandRules(el, Schema.aria[role].type || []));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (elSchema.implicitRole) {\r\n\t\t\t\t_pushUnique(currentElCategories, '@' + elSchema.implicitRole, elTagName);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Current node's categories/tagname\r\n\t\t\tvar currentElCategories = _pushUnique(Schema.expandRules(el, elSchema.type || []), elTagName);\r\n\t\t}\r\n\t\treturn currentElCategories;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node belongs in the context's content model\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tcontext\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInContentModel(context, node) {\r\n\t\tvar contextModel = context instanceof HTMLElement \r\n\t\t\t? Schema.getContentModelFor(context)\r\n\t\t\t: context;\r\n\t\tvar nodeCategories = node instanceof HTMLElement \r\n\t\t\t? Schema.getCategoriesFor(node)\r\n\t\t\t: node;\r\n\t\tif (_intersect(contextModel, ['#nothing', '#text']).length) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar valid;\r\n\t\t// So current content model has to list either this node's categories,\r\n\t\t// tagname, or impliable/acceptable roles\r\n\t\tcontextModel.forEach(allowedNode => {\r\n\t\t\tif (allowedNode.startsWith('!')) {\r\n\t\t\t\tvar disallowedNode = allowedNode.substr(1);\r\n\t\t\t\tif (nodeCategories.includes(disallowedNode)) {\r\n\t\t\t\t\tvalid = false;\r\n\t\t\t\t}\r\n\t\t\t} else if (valid !== false) {\r\n\t\t\t\tif (nodeCategories.includes(allowedNode)) {\r\n\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn valid && true;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node is associated to the context directly\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tscope\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t * @param object\t\t\t\t\tnodeSchema\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInScopeAs(scope, node, nodeSchema = null) {\r\n\t\tvar contextCategories = Schema.getCategoriesFor(scope);\r\n\t\tvar closest, current = node, nodeModel;\r\n\t\twhile (!closest && (current = current.parentNode)) {\r\n\t\t\tif (_intersect(contextCategories, Schema.getCategoriesFor(current)).length\r\n\t\t\t\t&& Schema.assertNodeBelongsInContentModel(current, nodeSchema ? (nodeSchema.type || node) : node)\r\n\t\t\t) {\r\n\t\t\t\tclosest = current;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn closest === scope;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Flattens the schema rules for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param array\t\t\t\t\t\trules\r\n\t *\r\n\t * @return array\r\n\t */\r\n\texpandRules(el, rules) {\r\n\t\tvar rles = rules.reduce((categories, rule) => {\r\n\t\t\tif (_isObject(rule)) {\r\n\t\t\t\tif (el.matches(Object.keys(rule)[0])) {\r\n\t\t\t\t\tcategories = categories.concat(Object.values(rule)[0]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcategories.push(rule);\r\n\t\t\t}\r\n\t\t\treturn categories;\r\n\t\t}, []);\r\n\t\tif (rles.includes('#sectioning-root')) {\r\n\t\t\trles.push('#sectioning-content');\r\n\t\t}\r\n\t\treturn rles;\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Schema;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_from\r\n} from '@onephrase/commons/src/Arr.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Matrix loader\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Matrix = class {\r\n\t\r\n\t/**\r\n\t * Creates a new Matrix instance.\r\n\t *\r\n\t * @param array \t\t\tsources\r\n\t * @param string|array \t\tnamespace\r\n\t * @param function \t\t\tgetter\r\n\t * @param MatrixInterface\tcarry\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(sources, namespace, getter, carry = null) {\r\n\t\tthis.sources = _from(sources);\r\n\t\tthis.namespace = _from(namespace);\r\n\t\tthis.getter = getter;\r\n\t\tthis.carry = carry;\r\n\t\tthis.collections = {};\r\n\t\tthis.value;\r\n\t}\r\n\r\n\t/**\r\n\t * Enters into a sub collection if exists.\r\n\t *\r\n\t * @param string \t\t\tname\r\n\t *\r\n\t * @return MatrixInterface\r\n\t */\r\n\tenter(name) {\r\n\t\tif (!(name in this.collections)) {\r\n\t\t\tthis.collections[name] = new Matrix(\r\n\t\t\t\tthis.sources, \r\n\t\t\t\tthis.namespace.concat(name),\r\n\t\t\t\tthis.getter,\r\n\t\t\t\tthis \r\n\t\t\t);\r\n\t\t}\r\n\t\treturn this.collections[name];\r\n\t}\r\n\r\n\t/**\r\n\t * Leaves the current current collection into the super collection if exists.\r\n\t *\r\n\t * @return MatrixInterface\r\n\t */\r\n\tleave() {\r\n\t\treturn this.carry;\r\n\t}\r\n\r\n\t/**\r\n\t * Lazy-loads a property from sources.\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget() {\r\n\t\tif (!this.value) {\r\n\t\t\tvar namespace = this.namespace.slice();\r\n\t\t\tvar value = this.carry ? this.carry.get() : null;\r\n\t\t\tthis.sources.forEach((source, i) => {\r\n\t\t\t\tif (value = this.getter.call(null, source, namespace, value, i)) {\r\n\t\t\t\t\tthis.value = value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this.value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds the most-specific module for the given namespace from sources.\r\n\t *\r\n\t * @param sting\t\t\t\t\tnamespace\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tfind(namespace) {\r\n\t\tvar nsArray = namespace.split('/');\r\n\t\tvar subMatrix, nsKey, nsDrill = this;\r\n\t\twhile((nsKey = nsArray.shift()) && (nsDrill = nsDrill.enter(nsKey))) {\r\n\t\t\tsubMatrix = nsDrill; \r\n\t\t}\r\n\t\t// Clone now...\r\n\t\tvar el = subMatrix.get();\r\n\t\tif (el) {\r\n\t\t\treturn el.cloneNode(true);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Matrix;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {_isObject} from '@onephrase/commons/src/Js.js';\r\nimport {_even} from '@onephrase/commons/src/Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ExprInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Compares the current instance with another object.\r\n\t *\r\n\t * @param object Expr\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\teven(Expr) {\r\n\t\tif (_isObject(Expr) && Expr.jsenType === this.jsenType) {\r\n\t\t\treturn _even(Expr, this);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Inherits properties from a super Expr.\r\n\t *\r\n\t * @param ExprInterface Super\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tinherit(Super) {\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds comments to the instance.\r\n\t *\r\n\t * @param string\t comments\r\n\t *\r\n\t * @return this\r\n\t */\r\n\twithComments(comments) {\r\n\t\tif (!this.meta) {\r\n\t\t\tthis.meta = {};\r\n\t\t}\r\n\t\tthis.meta.comments = comments;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds variables to the instance.\r\n\t *\r\n\t * @param array\t\t vars\r\n\t *\r\n\t * @return this\r\n\t */\r\n\twithVars(vars) {\r\n\t\tif (!this.meta) {\r\n\t\t\tthis.meta = {};\r\n\t\t}\r\n\t\tthis.meta.vars = vars;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Evaluates the expression instance for a result,\r\n\t * optionally in the context of an object.\r\n\t *\r\n\t * @param object context\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t//eval(context = null, callback = null)\r\n\t\r\n\t/**\r\n\t * Serializes the expression instance back to a string,\r\n\t * optionally in the context of an object.\r\n\t *\r\n\t * @param object context\r\n\t *\r\n\t * @return string\r\n\t */\r\n\t//toString(context = null)\r\n\t\r\n\t/**\r\n\t * SAttempts to parse a string into the class instance.\r\n\t *\r\n\t * @param string expr\r\n\t * @param object params\r\n\t *\r\n\t * @return ExprInterface\r\n\t */\r\n\t//static parse(expr, params = {})\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AssignmentInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'AssignmentExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ReferenceInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Reference'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * DeletionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'DeleteExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * CallInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'CallExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_remove\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isArray,\r\n\t_instanceof\r\n} from '@onephrase/commons/src/Js.js';\r\nimport AssignmentInterface from './Expr/AssignmentInterface.js';\r\nimport ReferenceInterface from './Expr/ReferenceInterface.js';\r\nimport DeletionInterface from './Expr/DeletionInterface.js';\r\nimport CallInterface from './Expr/CallInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Jsen (base) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Jsen = class {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, Parsers, params = {}, Static = Jsen) {\r\n\t\tif (!params.meta) {\r\n\t\t\tparams.meta = {vars: []};\r\n\t\t}\r\n\t\tif (expr.length) {\r\n\t\t\tvar parsers = Object.values(Parsers || Static.grammars);\r\n\t\t\tfor (var i = 0; i < parsers.length; i ++) {\r\n\t\t\t\t// From this point forward, all vars is within current scope\r\n\t\t\t\tvar varsScope = params.meta && _isArray(params.meta.vars) ? params.meta.vars.length : 0;\r\n\t\t\t\tvar parsed = parsers[i].parse(expr, (_expr, _Parsers) => Jsen.parse(_expr, _Parsers, params, Static));\r\n\t\t\t\t// Add/remove vars to scope\r\n\t\t\t\tif (parsed && params.meta) {\r\n\t\t\t\t\tif (!parsed.meta) {\r\n\t\t\t\t\t\tparsed.meta = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Reap vars into scope expr\r\n\t\t\t\t\tparsed.meta.vars = params.meta.vars.slice(varsScope);\r\n\t\t\t\t\t// Add vars to scope\r\n\t\t\t\t\tif (_instanceof(parsed, ReferenceInterface) || _instanceof(parsed, CallInterface)) {\r\n\t\t\t\t\t\t_remove(parsed.meta.vars, parsed.context);\r\n\t\t\t\t\t\t_remove(params.meta.vars, parsed.context);\r\n\t\t\t\t\t\tparams.meta.vars.push(parsed);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (parsed && params.explain) {\r\n\t\t\t\t\tconsole.log(expr, ' >>------------->> ', parsed.jsenType);\r\n\t\t\t\t}\r\n\t\t\t\tif ((parsed instanceof AssignmentInterface || parsed instanceof DeletionInterface) \r\n\t\t\t\t&& (!params || !params.mutates)) {\r\n\t\t\t\t\tthrow new Error('[Permission error:] ' + expr);\r\n\t\t\t\t}\r\n\t\t\t\tif (parsed) {\r\n\t\t\t\t\treturn parsed;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (params.assert === false) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthrow new Error('[Syntax error:] ' + expr);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Jsen;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isString,\r\n\t_isUndefined\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_from,\r\n\t_flatten,\r\n\t_first,\r\n\t_last\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_merge,\r\n\t_even,\r\n\t_copyPlain\r\n} from '@onephrase/commons/src/Obj.js';\r\n\r\n/**\r\n * --------------------------\r\n * TOKENIZER\r\n * --------------------------\r\n */\r\n\r\nconst Lexer = class {\r\n\r\n\t/**\r\n\t * Factory method.\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic lex(str, delims, options) {\r\n\t\tif (!_isString(str)) {\r\n\t\t\tthrow new Error('Argument1 must be a string!');\r\n\t\t}\r\n\t\t// CREATE NEW -----------------------------\r\n\t\tvar instance = new Lexer(str, options);\r\n\t\t// GIVE CACHE -----------------------------\r\n\t\tLexer.$cache[str] = Lexer.$cache[str] || [];\r\n\t\tLexer.$cache[str].push(instance);\r\n\t\t// RETURN NEW -----------------------------\r\n\t\treturn instance.lex(delims);\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method for .split().\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic split(str, delims, options) {\r\n\t\treturn Lexer.lex(str, delims, options).tokens;\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method for .match().\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic match(str, delims, options) {\r\n\t\treturn Lexer.lex(str, delims, options).matches;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a lexer instance on a string with the given options.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions:\r\n\t * @param string \t\tblocks\t\t\t\tThe strings that begin and end a nested structure\r\n\t * @param number \t\tlimit\t\t\t\tMax results to return\r\n\t * @param string \t\tbackreference\t\tA character like (\\) that prefixes non-delim characters\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tconstructor(str, options) {\r\n\t\tif (!_isString(str)) {\r\n\t\t\tthrow new Error('Lexer requires the first argument to be a string.');\r\n\t\t}\r\n\t\tthis.$str = str;\r\n\t\tthis.$options = options || {};\r\n\t\tif (!this.$options.blocks) {\r\n\t\t\tthis.$options.blocks = Lexer.$blocks;\r\n\t\t}\r\n\t\tif (!this.$options.quotes) {\r\n\t\t\tthis.$options.quotes = Lexer.$quotes;\r\n\t\t}\r\n\t\tif (!this.$options.comments) {\r\n\t\t\tthis.$options.comments = Lexer.$comments;\r\n\t\t}\r\n\t\tthis.$cache = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the instance string on the given delimeters.\r\n\t *\r\n\t * This method supports static calling,\r\n\t * in which case a string is required as the first argument.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tlex(delims, options) {\r\n\t\tvar runtime = {\r\n\t\t\tdelims: _from(delims),\r\n\t\t\toptions: _merge(true, {}, this.$options, options || {}),\r\n\t\t\tnesting: [],\r\n\t\t\tmaxDepth: 0,\r\n\t\t\tcomments: [],\r\n\t\t\ttokens: [],\r\n\t\t\tmatches: [],\r\n\t\t\tmatchesi: {},\r\n\t\t};\r\n\t\t// ASK INSTANCE CACHE ---------------------------\r\n\t\tif (runtime.options.cache !== false) {\r\n\t\t\tfor (var i = 0; i < this.$cache.length; i ++) {\r\n\t\t\t\tif (_even(this.$cache[i].delims, runtime.delims) && _even(this.$cache[i].options, runtime.options)) {\r\n\t\t\t\t\treturn _copyPlain(this.$cache[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// EVALUATE NEW --------------------------------\r\n\t\t// Iterate over each character, keep track of current row and column (of the returned array)\r\n\t\tthis._evalCharsAt(runtime, 0);\r\n\t\tif (runtime.nesting.length) {\r\n\t\t\tthrow new Error('Error parsing the string: ' + this.$str + '. Unterminated blocks: ' + _flatten(runtime.nesting).join(', ') + '');\r\n\t\t}\r\n\t\t// GIVE CACHE ----------------------------------\r\n\t\tif (runtime.options.cache !== false) {\r\n\t\t\tthis.$cache.push(runtime);\r\n\t\t}\r\n\t\t// RETURN NEW ----------------------------------\r\n\t\treturn runtime;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: evaluates and handles the character on the current cursor.\r\n\t * Advances the cursor.\r\n\t *\r\n\t * @param object \truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_evalCharsAt(runtime, i) {\r\n\t\tif (i >= this.$str.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar charWidth = 1;\r\n\t\tvar commentTest = {}, quoteTest = {}, nestingTest = {};\r\n\t\t// Quotes inside comments must be ignored\r\n\t\tif (!runtime.openComment) {\r\n\t\t\tquoteTest = this._testQuotes(runtime, i);\r\n\t\t}\r\n\t\t// Comments inside quotes must be ignored\r\n\t\tif (!runtime.openQuote) {\r\n\t\t\tcommentTest = this._testComments(runtime, i);\r\n\t\t}\r\n\t\t// Save comments\r\n\t\tif (runtime.openComment || commentTest.ending) {\r\n\t\t\t// Save only outer comments\r\n\t\t\tif (!runtime.nesting.length && !nestingTest.ending) {\r\n\t\t\t\tvar chars = commentTest.starting || commentTest.ending || this.$str[i];\r\n\t\t\t\tcharWidth = chars.length;\r\n\t\t\t\tthis._push(runtime, chars, 'comments');\r\n\t\t\t\tif (runtime.options.preserveComments) {\r\n\t\t\t\t\tthis._push(runtime, chars);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\t}\r\n\t\t} else if (runtime.openQuote || quoteTest.ending) {\r\n\t\t\t// Yes add quotes\r\n\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t} else if (runtime.options.limit && runtime.matches.length === runtime.options.limit) {\r\n\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\treturn this._evalCharsAt(runtime, i + 1);\r\n\t\t} else {\r\n\t\t\t// Nesting tags inside comments and quotes have been ignored\r\n\t\t\tnestingTest = this._testNesting(runtime, i);\r\n\t\t\t// ---------------------\r\n\t\t\t// STOP ON THIS CHARACTER...?\r\n\t\t\t// ---------------------\r\n\t\t\tvar nestingTest = this._testNesting(runtime, i);\r\n\t\t\t// STOP CHAR(S)? at top level?\r\n\t\t\tvar stopChar = this._testChars(runtime.options.stopChars || [], runtime, i);\r\n\t\t\tif (!runtime.nesting.length && stopChar !== false) {\r\n\t\t\t\truntime.options.stopChar = stopChar;\r\n\t\t\t\truntime.options.stopCharForward = this.$str.substr(i);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// ---------------------\r\n\t\t\t// Match and split now...\r\n\t\t\t// ---------------------\r\n\t\t\tif (!runtime.delims.length) {\r\n\t\t\t\t// BLOCK-BASED SPLITTING...\r\n\t\t\t\tif (runtime.nesting.length === 2 && nestingTest.starting) {\r\n\t\t\t\t\truntime.matches.push(null);\r\n\t\t\t\t\tthis._push(runtime, nestingTest.starting);\r\n\t\t\t\t\tcharWidth = nestingTest.starting.length;\r\n\t\t\t\t} else if (!runtime.nesting.length && nestingTest.ending) {\r\n\t\t\t\t\tthis._push(runtime, nestingTest.ending);\r\n\t\t\t\t\tcharWidth = nestingTest.ending.length;\r\n\t\t\t\t\truntime.matches.push(null);\r\n\t\t\t\t} else/*no-nesting flag*/ {\r\n\t\t\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// ---------------------\r\n\t\t\t\t// DELIMS-BASED SPLITTING\r\n\t\t\t\t// ---------------------\r\n\t\t\t\tif (!runtime.nesting.length && !nestingTest.ending) {\r\n\t\t\t\t\t// In case the chars at index 0 is a delim,\r\n\t\t\t\t\t// the resulting split should first have an empty string, instead of undefined\r\n\t\t\t\t\tthis._push(runtime, '');\r\n\t\t\t\t\tvar matchedDelim = this._testChars(runtime.delims, runtime, i);\r\n\t\t\t\t\tif (matchedDelim !== false) {\r\n\t\t\t\t\t\truntime.matches.push(matchedDelim);\r\n\t\t\t\t\t\truntime.matchesi[i] = matchedDelim;\r\n\t\t\t\t\t\tcharWidth = matchedDelim.length || 1;\r\n\t\t\t\t\t\tif (!runtime.options.preserveDelims) {\r\n\t\t\t\t\t\t\t// The current character is a delimiter...\r\n\t\t\t\t\t\t\t// and should not get to appending to the split series down the line\r\n\t\t\t\t\t\t\treturn this._evalCharsAt(runtime, i + (matchedDelim.length || 1));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._push(runtime, matchedDelim || this.$str[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar chars = nestingTest.starting || nestingTest.ending || this.$str[i];\r\n\t\t\t\t\tcharWidth = chars.length;\r\n\t\t\t\t\tthis._push(runtime, chars);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._evalCharsAt(runtime, i + charWidth);\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a quote start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testQuotes(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.quotes || []).forEach(quote => {\r\n\t\t\tif (this.$str.substr(i, 1) === quote) {\r\n\t\t\t\tif (!runtime.openQuote) {\r\n\t\t\t\t\truntime.openQuote = quote;\r\n\t\t\t\t\tresult.starting = quote;\r\n\t\t\t\t} else if (quote === runtime.openQuote) {\r\n\t\t\t\t\truntime.openQuote = false;\r\n\t\t\t\t\tresult.ending = quote;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a comment start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testComments(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.comments || []).forEach(block => {\r\n\t\t\tif (!runtime.openComment) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + _first(block)));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\truntime.openComment = block;\r\n\t\t\t\t\tresult.starting = m[0];\r\n\t\t\t\t}\r\n\t\t\t} else if (_last(block) === _last(runtime.openComment)) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + _last(block)));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\truntime.openComment = false;\r\n\t\t\t\t\tresult.ending = m[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a nesting start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testNesting(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.blocks || []).forEach(block => {\r\n\t\t\tvar starting = this.$str.substr(i).match(new RegExp('^' + _first(block)));\r\n\t\t\tif (starting) {\r\n\t\t\t\truntime.nesting = runtime.nesting.concat([block]);\r\n\t\t\t\tresult.starting = starting[0];\r\n\t\t\t} else if (runtime.nesting.length && _last(block) === _last(_last(runtime.nesting))) {\r\n\t\t\t\tvar ending = this.$str.substr(i).match(new RegExp('^' + _last(block)));\r\n\t\t\t\tif (ending) {\r\n\t\t\t\t\truntime.nesting = runtime.nesting.slice(0, -1);\r\n\t\t\t\t\tresult.ending = ending[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\truntime.maxDepth = Math.max(runtime.maxDepth, runtime.nesting.length);\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a delimiter or stop character on the current cursor.\r\n\t *\r\n\t * @param array\t\ttestList\r\n\t * @param object \truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t_testChars(testList, runtime, i) {\r\n\t\tfor (var k = 0; k < testList.length; k ++) {\r\n\t\t\tvar test = testList[k];\r\n\t\t\tif (runtime.options.useRegex) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + test, runtime.options.useRegex !== true ? runtime.options.useRegex : ''));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\treturn m[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ((!runtime.options.ci && this.$str.substr(i, test.length) === test)\r\n\t\t\t|| (runtime.options.ci && this.$str.substr(i, test.length).toLowerCase() === test.toLowerCase())) {\r\n\t\t\t\treturn test;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Expr helper: pushes a character or set of characters into the current split series.\r\n\t *\r\n\t * @param object \truntime\r\n\t * @param string\tchars\r\n\t * @param string\ttarget\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_push(runtime, chars, target = 'tokens') {\r\n\t\tvar splitSeries = runtime.matches.length;\r\n\t\tif (_isUndefined(runtime[target][splitSeries])) {\r\n\t\t\truntime[target][splitSeries] = '';\r\n\t\t}\r\n\t\truntime[target][splitSeries] += chars;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters and returns the tokens.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tsplit(str, delims, options) {\r\n\t\treturn this.lex(delims, options).tokens;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters and returns the matches.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions:\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tmatch(str, delims, options) {\r\n\t\treturn this.lex(delims, options).matches;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses the instance string on the given delimeters using regex.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tregParse(delims, options) {\r\n\t\treturn this.lex(delims, _merge({useRegex: true}, options || {}));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters using regex; returns the tokens.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tregSplit(delims, options) {\r\n\t\treturn this.regParse(delims, options).tokens;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Matches the instance string on the given delimeters using regex; returns the matches.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tregMatch(delims, options) {\r\n\t\treturn this.regParse(delims, options).matches;\r\n\t}\r\n};\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$blocks = [['\\\\(', '\\\\)'], ['\\\\[', '\\\\]'], ['\\\\{', '\\\\}'],];\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$quotes = ['\"', \"'\", '`',];\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$comments = [['\\\\/\\\\*', '\\\\*\\\\/'], ['\\\\/\\\\/', '(\\\\r)?\\\\n'],];\r\n\r\n/**\r\n * @var object\r\n */\r\nLexer.$cache = {};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Lexer;\r\n\r\n","\r\n/**\r\n * @exports\r\n */\r\nexport default class extends Array {};","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AbstractionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Abstraction'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport AbstractionInterface from './AbstractionInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Abstraction class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Abstraction = class extends AbstractionInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.expr.eval(context, callback);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '(' + this.expr.toString(context) + ')';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Abstraction) {\r\n\t\tif (_wrapped(expr, '(', ')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(_unwrap(expr, '(', ')'))\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Abstraction;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ArrInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ArrayType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport ArrInterface from './ArrInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Array utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Arr = class extends ArrInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(exprs) {\r\n\t\tsuper();\r\n\t\tthis.exprs = exprs || [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof ArrInterface) {\r\n\t\t\tvar newExprs = Super.exprs.filter(exprA => {\r\n\t\t\t\treturn this.exprs.reduce((uniqueSoFar, exprB) => uniqueSoFar && !exprA.even(exprB), true);\r\n\t\t\t});\r\n\t\t\tthis.exprs = newExprs.concat(this.exprs);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.exprs.map(expr => expr.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '[' + this.exprs.map(expr => expr.toString(context)).join(', ') + ']';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Arr) {\r\n\t\tif (_wrapped(expr, '[', ']') && !Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar splits = Lexer.split(_unwrap(expr, '[', ']'), [','])\r\n\t\t\t\t.map(n => n.trim()).filter(n => n).map(expr => parseCallback(expr));\r\n\t\t\treturn new Static(splits);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Arr;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ArgumentsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Arguments'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport ArgumentsInterface from './ArgumentsInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Arguments class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Arguments = class extends ArgumentsInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(list = []) {\r\n\t\tsuper();\r\n\t\tthis.list = list;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.list.map(arg => arg.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '(' + this.list.map(arg => arg.toString(context)).join(', ') + ')';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Arguments) {\r\n\t\tvar args; expr = expr.trim();\r\n\t\tif (_wrapped(expr, '(', ')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tLexer.split(_unwrap(expr, '(', ')'), [',']).map(arg => parseCallback(arg.trim()))\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Arguments;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AssertionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'AssertionExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_first,\r\n\t_flatten,\r\n\t_unique\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport AssertionInterface from './AssertionInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Assertion class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Assertion = class extends AssertionInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(exprs, logic) {\r\n\t\tsuper();\r\n\t\tthis.exprs = exprs;\r\n\t\tthis.logic = logic;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\t eval(context = null, callback = null) {\r\n\t\tif (this.logic === '!') {\r\n\t\t\treturn !_first(this.exprs).eval(context, callback);\r\n\t\t}\r\n\t\tvar operators = _flatten(Assertion.operators);\r\n\t\tvar logic = (this.logic || '').trim().toUpperCase();\r\n\t\tvar isOr = logic === (Assertion.operators.or || '').trim().toUpperCase();\r\n\t\tvar isNor = logic === (Assertion.operators.nor || '').trim().toUpperCase();\r\n\t\tvar isAnd = logic === (Assertion.operators.and || '').trim().toUpperCase();\r\n\t\tvar isNand = logic === (Assertion.operators.nand || '').trim().toUpperCase();\r\n\t\tvar lastResult = true, trues = 0;\r\n\t\tfor(var i = 0; i < this.exprs.length; i ++) {\r\n\t\t\tif (isAnd && !lastResult) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (isNand && !lastResult) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tlastResult = this.exprs[i].eval(context, callback);\r\n\t\t\tif (isOr && lastResult) {\r\n\t\t\t\treturn lastResult;\r\n\t\t\t}\r\n\t\t\ttrues += lastResult ? 1 : 0;\r\n\t\t}\r\n\t\tif (isOr) {\r\n\t\t\t// Which is falsey,\r\n\t\t\t// by virtue of getting here\r\n\t\t\treturn lastResult;\r\n\t\t}\r\n\t\tif (isAnd || isNand) {\r\n\t\t\t// For AND and NAND, all entries must be true,\r\n\t\t\t// by virtue of getting here.\r\n\t\t\t// For AND, this means true; for NAND, false\r\n\t\t\treturn isAnd;\r\n\t\t}\r\n\t\t// For NOR, all entries need to be false\r\n\t\treturn isNor && trues === 0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\t toString(context = null) {\r\n\t\tif (this.logic === '!') {\r\n\t\t\treturn '!' + _first(this.exprs).toString(context);\r\n\t\t}\r\n\t\treturn this.exprs.map(expr => expr.toString(context)).join(' ' + this.logic + ' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Assertion) {\r\n\t\tif (expr.startsWith('!')) {\r\n\t\t\treturn new Static(\r\n\t\t\t\t[parseCallback(expr.substr(1))],\r\n\t\t\t\t'!'\r\n\t\t\t);\r\n\t\t}\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\tvar logic = _unique(parse.matches);\r\n\t\t\tif (logic.length > 1) {\r\n\t\t\t\tthrow new Error('\"AND\" and \"OR\" logic cannot be asserted in the same expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparse.tokens.map(expr => parseCallback(expr.trim())),\r\n\t\t\t\t_first(logic)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nAssertion.operators = {\r\n\tand: '&&',\r\n\tor: '||',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Assertion;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_last\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isUndefined,\r\n\t_isFunction\r\n} from '@onephrase/commons/src/Js.js';\r\nimport AssignmentInterface from './AssignmentInterface.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Assignment class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Assignment = class extends AssignmentInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, val, operator = '=') {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.val = val;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tvar val = this.val.eval(context, callback);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name, val);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar cntxt = reference.context instanceof Contexts \r\n\t\t\t\t? _last(reference.context) \r\n\t\t\t\t: reference.context;\r\n\t\t\t// -----------------------------\r\n\t\t\tcntxt[reference.name] = val;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.reference.toString(context), this.operator, this.val.toString(context)].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Assignment) {\r\n\t\tvar parse = Lexer.lex(expr, Static.operators);\r\n\t\tif (parse.tokens.length === 2) {\r\n\t\t\tvar reference, val;\r\n\t\t\tif (!((reference = parseCallback(parse.tokens.shift().trim())) instanceof ReferenceInterface) \r\n\t\t\t|| !(val = parseCallback(parse.tokens.shift().trim()))) {\r\n\t\t\t\tthrow new Error('Invalid assignment directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, val, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nAssignment.operators = [' = '];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Assignment;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * BoolInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'BooleanType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport BoolInterface from './BoolInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Bool (boolean) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Bool = class extends BoolInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(state) {\r\n\t\tsuper();\r\n\t\tthis.state = state;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn this.state.toLowerCase().trim() === 'true';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString() {\r\n\t\treturn this.state;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Bool) {\r\n\t\tvar expr = expr.toLowerCase().trim();\r\n\t\tif (expr === 'true' || expr === 'false') {\r\n\t\t\treturn new Static(expr);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Bool;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isArray,\r\n\t_isFunction,\r\n\t_isNumeric,\r\n\t_isObject,\r\n\t_isString,\r\n\t_isUndefined\r\n} from '@onephrase/commons/src/Js.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport CallInterface from './CallInterface.js';\r\nimport Arguments from './Arguments.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Call = class extends CallInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, args) {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.args = args;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tvar args = this.args.eval(context, callback);\r\n\t\tif (!_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name, args);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar _contexts = reference.context instanceof Contexts \r\n\t\t\t\t? reference.context.slice() \r\n\t\t\t\t: [reference.context];\r\n\t\t\tvar __contexts = _contexts.slice();\r\n\t\t\twhile(_contexts.length) {\r\n\t\t\t\tvar cntxt = _contexts.pop();\r\n\t\t\t\tif (cntxt && _isFunction(cntxt[reference.name])) {\r\n\t\t\t\t\treturn cntxt[reference.name](...args);\r\n\t\t\t\t}\r\n\t\t\t\t// -----------------------------\r\n\t\t\t\tvar utils = Call.utils || {};\r\n\t\t\t\tvar handler = _isNumeric(cntxt) && utils.Num ? utils.Num\r\n\t\t\t\t\t: (_isString(cntxt) && utils.Str ? utils.Str\r\n\t\t\t\t\t\t: (_isArray(cntxt) && utils.Arr ? utils.Arr\r\n\t\t\t\t\t\t\t: (_isObject(cntxt) && utils.Obj ? utils.Obj : null)));\r\n\t\t\t\tif (handler && _isFunction(handler[reference.name])) {\r\n\t\t\t\t\targs.unshift(cntxt);\r\n\t\t\t\t\treturn handler[reference.name](...args);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthrow new Error('\"' + this + '\" is not a function. (Called on ' + __contexts.map(c => typeof c).join(', ') + ')');\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.reference.toString(context) + this.args.toString(context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Call) {\r\n\t\tif (!expr.startsWith('(') && expr.endsWith(')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\tvar tokens = Lexer.split(expr, []);\r\n\t\t\tvar reference, args = tokens.pop();\r\n\t\t\tif (!((reference = parseCallback(tokens.join(''))) instanceof ReferenceInterface) \r\n\t\t\t|| !(args = parseCallback(args, [Arguments]))) {\r\n\t\t\t\tthrow new Error('Invalid call directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, args);\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Call;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * CommentsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Comments'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_after,\r\n\t_before\r\n} from '@onephrase/commons/src/Str.js';\r\nimport CommentsInterface from './CommentsInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Comments class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Comments = class extends CommentsInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(comments, type) {\r\n\t\tsuper();\r\n\t\tthis.comments = comments;\r\n\t\tthis.type = type;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Comments) {\r\n\t\tvar _comments = null;\r\n\t\tvar _expr = null;\r\n\t\tvar type = 0;\r\n\t\tvar commentPlacement = 'before';\r\n\t\t// Oneliner comments\r\n\t\tif (expr.startsWith('//')) {\r\n\t\t\tvar splits = Lexer.split(_after(expr, '//'), [\"\\r\\n\"]);\r\n\t\t\t_comments = splits.shift().trim();\r\n\t\t\t_expr = splits.shift().trim();\r\n\t\t\ttype = 1;\r\n\t\t} else if (expr.startsWith('/*')) {\r\n\t\t\tvar splits = Lexer.split(_after(expr, '/*'), [\"*/\"]);\r\n\t\t\t_comments = splits.shift().trim();\r\n\t\t\t_expr = splits.shift().trim();\r\n\t\t\ttype = 2;\r\n\t\t} else if (expr.endsWith('*/')) {\r\n\t\t\tvar splits = Lexer.split(_beforeLast(expr, '*/'), [\"/*\"]);\r\n\t\t\t_comments = splits.pop().trim();\r\n\t\t\t_expr = splits.pop().trim();\r\n\t\t\ttype = 2;\r\n\t\t\tvar commentPlacement = 'after';\r\n\t\t}\r\n\t\tif (type) {\r\n\t\t\tif (type === 2) {\r\n\t\t\t\t_comments = Lexer.split(_comments.trim(), [\"\\r\\n\"])\r\n\t\t\t\t\t.map(line => line.replace(/^[\\*]+/, ''))\r\n\t\t\t\t\t.filter(line => line.trim());\r\n\t\t\t}\r\n\t\t\tconsole.log(_comments, commentPlacement, expr);\r\n\t\t\t_comments = new Static(_comments, type);\r\n\t\t}\r\n\t\tif (_expr) {\r\n\t\t\t_expr = parseCallback(_expr);\r\n\t\t\t_expr.meta.commenta = _comments;\r\n\t\t\treturn _expr;\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Comments;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ComparisonInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ComparisonExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_matches\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {\r\n\t_flatten,\r\n\t_first,\r\n\t_last,\r\n\t_difference\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isArray,\r\n\t_isObject,\r\n\t_isString\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport ComparisonInterface from './ComparisonInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Comparison class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Comparison = class extends ComparisonInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(operand1, operand2, operator) {\r\n\t\tsuper();\r\n\t\tthis.operand1 = operand1;\r\n\t\tthis.operand2 = operand2;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn Comparison.compare(\r\n\t\t\tthis.operand1.eval(context, callback), \r\n\t\t\tthis.operand2.eval(context, callback), \r\n\t\t\tthis.operator\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [\r\n\t\t\tthis.operand1.toString(context), \r\n\t\t\tthis.operator, \r\n\t\t\tthis.operand2.toString(context)\r\n\t\t].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Comparison) {\r\n\t\tvar operators = _flatten(Static.operators).map(oper => ' ' + oper + ' ');\r\n\t\tvar parse = Lexer.lex(expr, operators);\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\tif (parse.tokens.length > 2) {\r\n\t\t\t\tthrow new Error('Malformed \"Comparison\" expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(_first(parse.tokens).trim()),\r\n\t\t\t\tparseCallback(_last(parse.tokens).trim()),\r\n\t\t\t\tparse.matches[0].trim()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------------------------------------------\r\n\t */\r\n\t \r\n\t/**\r\n\t * Use the operator type to compare the two operands\r\n\t *\r\n\t * @param mixed\t\toperand1\t\t\r\n\t * @param mixed\t\toperand2\t\t\r\n\t * @param string \toperator\t\t\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstatic compare(operand1, operand2, operator = '==') {\r\n\t\tif (_flatten(Comparison.operators).indexOf(operator) === -1) {\r\n\t\t\tthrow new Error('The operator \"' + operator + '\" is not recognized.');\r\n\t\t}\r\n\t\tif (_isArray(operand1) && _isArray(operand2) && operator !== '===') {\r\n\t\t\tif (operand1.length !== operand2.length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar allItemsMatch = true;\r\n\t\t\toperand1.sort();\r\n\t\t\toperand2.sort();\r\n\t\t\tfor (var i = 0; i < operand1.length; i ++) {\r\n\t\t\t\tallItemsMatch = allItemsMatch && Comparison.compare(operand1[i], operand2[i], operator);\r\n\t\t\t}\r\n\t\t\treturn allItemsMatch;\r\n\t\t} else if (_isObject(operand1) && _isObject(operand2) && operator !== '===') {\r\n\t\t\tvar entry1Keys = Object.keys(operand1);\r\n\t\t\tvar entry2Keys = Object.keys(operand2);\r\n\t\t\tif (entry1Keys.length !== entry2Keys.length || _difference(entry1Keys, entry2Keys).length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar allEntriesMatch = true;\r\n\t\t\t_each(entry1Keys, (i, key) => {\r\n\t\t\t\tallEntriesMatch = allEntriesMatch && Comparison.compare(operand1[key], operand2[key], operator);\r\n\t\t\t});\r\n\t\t\treturn allEntriesMatch;\r\n\t\t}\r\n\t\tswitch(operator) {\r\n\t\t\tcase '===':\r\n\t\t\t\treturn operand1 === operand2;\r\n\t\t\tcase '==':\r\n\t\t\tcase '=':\r\n\t\t\t\treturn operand1 == operand2;\r\n\t\t\tcase '>':\r\n\t\t\t\treturn operand1 > operand2;\r\n\t\t\tcase '<':\r\n\t\t\t\treturn operand1 < operand2;\r\n\t\t\tcase '>=':\r\n\t\t\t\treturn operand1 >= operand2;\r\n\t\t\tcase '<=':\r\n\t\t\t\treturn operand1 <= operand2;\r\n\t\t\tcase '!=':\r\n\t\t\t\treturn operand1 != operand2;\r\n\t\t\tcase '!==':\r\n\t\t\t\treturn operand1 !== operand2;\r\n\t\t\tcase '^=':\r\n\t\t\t\treturn _isString(operand1) && operand1.startsWith(operand2);\r\n\t\t\tcase '$=':\r\n\t\t\t\treturn _isString(operand1) && operand1.endsWith(operand2);\r\n\t\t\tcase '*=':\r\n\t\t\t\t// Contains\r\n\t\t\t\treturn _isArray(operand2) || _isString(operand2) ? operand1.indexOf(operand2) > -1 : false;\r\n\t\t\tcase '~=':\r\n\t\t\t\t// Contains word\r\n\t\t\t\treturn _isString(operand1) && _isString(operand2) && (' ' + operand1 + ' ').indexOf(' ' + operand2 + ' ') > -1;\r\n\t\t\tcase '>=<': // Between\r\n\t\t\t\t if (!(_isArray(operand2) && operand2.length === 2)) {\r\n\t\t\t\t\t throw new Error('A \\'Between\\' comparison requires argument 2 to be an array of exactly 2 values.');\r\n\t\t\t\t }\r\n\t\t\t\t return operand1 >= operand2[0] && operand1 <= operand2[1];\r\n\t\r\n\t\t\tcase '/**/': // Regex\r\n\t\t\t\treturn _matches(operand2, operand1);\r\n\t\t\tdefault:\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * Compares two operands for differences\r\n\t *\r\n\t * @param mixed\t\toperand1\t\t\r\n\t * @param mixed\t\toperand2\t\t\r\n\t * @param bool\t \tstrict\t\t\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstatic diff(operand1, operand2, strict) {\r\n\t\treturn !Comparison.compare(operand1, operand2, strict ? '===' : '==');\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nComparison.operators = {\r\n\texact: {\r\n\t\tis: '===',\r\n\t\tisNull: '===',\r\n\t\tequalsTo: '==',\r\n\t\tnotEqualsTo: '!=',\r\n\t},\r\n\trelative: {\r\n\t\tlesserThan: '<',\r\n\t\tgreaterThan: '>',\r\n\t\tlesserThanOrEqualsTo: '<=',\r\n\t\tgreaterThanOrEqualsTo: '>=',\r\n\t\tbetween: '>=<',\r\n\t},\r\n\tpartial: {\r\n\t\tstartsWith: '^=',\r\n\t\tendsWith: '$=',\r\n\t\tcontains: '*=',\r\n\t\tany: '~=',\r\n\t\tin: '~=',\r\n\t\tmatches: '/**/',\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Comparison;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ConditionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ConditionExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport ConditionInterface from './ConditionInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Condition class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Condition = class extends ConditionInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(assertion, onTrue, onFalse) {\r\n\t\tsuper();\r\n\t\tthis.assertion = assertion;\r\n\t\tthis.onTrue = onTrue;\r\n\t\tthis.onFalse = onFalse;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.assertion.eval(context, callback) \r\n\t\t\t? this.onTrue.eval(context, callback) \r\n\t\t\t: this.onFalse.eval(context, callback);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [\r\n\t\t\tthis.assertion.toString(context), \r\n\t\t\tCondition.operators[0], \r\n\t\t\tthis.onTrue.toString(context),\r\n\t\t\tCondition.operators[1], \r\n\t\t\tthis.onFalse.toString(context)\r\n\t\t].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Condition) {\r\n\t\tvar splits = Lexer.split(expr, Static.operators);\r\n\t\tif (splits.length > 1) {\r\n\t\t\tif (splits.length === 2) {\r\n\t\t\t\tthrow new Error('Malformed ternary expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(splits[0].trim()),\r\n\t\t\t\tparseCallback(splits[1].trim()),\r\n\t\t\t\tparseCallback(splits[2].trim())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nCondition.operators = ['?', ':'];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Condition;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_last\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isUndefined,\r\n\t_isFunction\r\n} from '@onephrase/commons/src/Js.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport DeletionInterface from './DeletionInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Deletion class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Deletion = class extends DeletionInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, operator = 'delete') {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar cntxt = reference.context instanceof Contexts \r\n\t\t\t\t? _last(reference.context) \r\n\t\t\t\t: reference.context;\r\n\t\t\t// -----------------------------\r\n\t\t\tdelete cntxt[reference.name];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.operator + ' ' + this.reference.toString(context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Deletion) {\r\n\t\tvar parse = Lexer.lex(expr, Object.values(Static.operators));\r\n\t\tif (parse.matches.length === 1 && expr.startsWith(parse.matches[0] + ' ')) {\r\n\t\t\tvar reference;\r\n\t\t\tif (!((reference = parseCallback(parse.tokens.pop().trim())) instanceof ReferenceInterface)) {\r\n\t\t\t\tthrow new Error('Invalid delete directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nDeletion.operators = {\r\n\tred: 'reduce', \r\n\tdel: 'delete',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Deletion;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * FuncInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'FunctionType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_copy,\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_flatten\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport FuncInterface from './FuncInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Func class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Func = class extends FuncInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(paramters, statements, wrappings = {}) {\r\n\t\tsuper();\r\n\t\tthis.paramters = paramters || {};\r\n\t\tthis.statements = statements;\r\n\t\tthis.wrappings = wrappings;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof FuncInterface) {\r\n\t\t\tvar parentParams = Object.keys(Super.paramters);\r\n\t\t\tvar ownParams = Object.keys(this.paramters);\r\n\t\t\tfor (var i = 0; i < Math.max(ownParams.length, parentParams.length); i ++) {\r\n\t\t\t\tvar nameInParent = parentParams[i];\r\n\t\t\t\tvar nameInSelf = ownParams[i];\r\n\t\t\t\tif (!nameInSelf && nameInParent) {\r\n\t\t\t\t\tthrow new Error('Parameter #' + i + ' (' + nameInParent + ') in parent function must be implemented.');\r\n\t\t\t\t}\r\n\t\t\t\tif (nameInSelf && nameInParent) {\r\n\t\t\t\t\tvar defaultValInParent = Super.paramters[nameInParent];\r\n\t\t\t\t\tvar defaultValInSelf = this.paramters[nameInSelf];\r\n\t\t\t\t\tif (defaultValInSelf && !defaultValInParent) {\r\n\t\t\t\t\t\tthrow new Error('Parameter #' + i + ' (' + nameInSelf + ') must not have a default value as established in parent function.');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (defaultValInSelf && defaultValInParent && defaultValInSelf.jsenType !== defaultValInParent.jsenType) {\r\n\t\t\t\t\t\tthrow new Error('Default value for parameter #' + i + ' (' + nameInSelf + ') must be of type ' + defaultValInParent.jsenType + ' as established in parent function.');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.sup = Super;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn (...args) => {\r\n\t\t\tvar localContext = {};\r\n\t\t\t_each(Object.keys(this.paramters), (i, name) => {\r\n\t\t\t\tvar defaultVal = this.paramters[name];\r\n\t\t\t\tif (args.length - 1 < i && !defaultVal) {\r\n\t\t\t\t\tthrow new Error('The parameter \"' + name + '\" is required.');\r\n\t\t\t\t}\r\n\t\t\t\tlocalContext[name] = args.length > i \r\n\t\t\t\t\t? args[i] \r\n\t\t\t\t\t: (this.paramters[name] \r\n\t\t\t\t\t\t? this.paramters[name].eval(context, callback) \r\n\t\t\t\t\t\t: null);\r\n\t\t\t});\r\n\t\t\tvar multipleContexts = new Contexts(localContext);\r\n\t\t\t// But this newer context should come last\r\n\t\t\tif (context instanceof Contexts) {\r\n\t\t\t\tmultipleContexts = context.concat(multipleContexts);\r\n\t\t\t} else if (context) {\r\n\t\t\t\tmultipleContexts.unshift(context);\r\n\t\t\t}\r\n\t\t\treturn this.statements.eval(multipleContexts, callback);\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar paramters = [];\r\n\t\t_each(this.paramters, (name, value) => {\r\n\t\t\tparamters.push(name + (value ? '=' + value.toString(context) : ''));\r\n\t\t});\r\n\t\tvar headNoWrap = this.wrappings.head === false || (paramters.length === 1 && paramters[0].indexOf('=') === -1);\r\n\t\tvar bodyNoWrap = this.wrappings.body === false\r\n\t\treturn (headNoWrap ? paramters[0] : '(' + paramters.join(', ') + ')')\r\n\t\t+ ' => ' + (bodyNoWrap ? this.statements.toString(context) : '{' + this.statements.toString(context) + '}');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Func) {\r\n\t\tvar splits = Lexer.split(expr, _flatten(Static.operators));\r\n\t\tif (splits.length === 2) {\r\n\t\t\tvar funcHead = splits.shift().trim();\r\n\t\t\tvar funcBody = splits.shift().trim();\r\n\t\t\tvar wrappings = {};\r\n\t\t\tif (_wrapped(funcHead, '(', ')')) {\r\n\t\t\t\tfuncHead = _unwrap(funcHead, '(', ')');\r\n\t\t\t} else {\r\n\t\t\t\twrappings.head = false;\r\n\t\t\t}\r\n\t\t\tif (_wrapped(funcBody, '{', '}')) {\r\n\t\t\t\tfuncBody = _unwrap(funcBody, '{', '}');\r\n\t\t\t} else {\r\n\t\t\t\twrappings.body = false;\r\n\t\t\t}\r\n\t\t\tvar paramters = {};\r\n\t\t\tLexer.split(funcHead, [',']).forEach(param => {\r\n\t\t\t\tvar paramSplit = param.split('=');\r\n\t\t\t\tif (paramSplit[1]) {\r\n\t\t\t\t\tparamters[paramSplit[0].trim()] = parseCallback(paramSplit[1].trim());\r\n\t\t\t\t} else {\r\n\t\t\t\t\tparamters[param.trim()] = null;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tvar statements = parseCallback(funcBody);\r\n\t\t\treturn new Static(paramters, statements, wrappings);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nFunc.operators = ['=>',];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Func;","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * MathInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'MathExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_flatten,\r\n\t_intersect,\r\n\t_unique\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isNumeric\r\n} from '@onephrase/commons/src/Js.js';\r\nimport MathInterface from './MathInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Math class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Math = class extends MathInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(val, exprs) {\r\n\t\tsuper();\r\n\t\tthis.val = val;\r\n\t\tthis.exprs = exprs;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.exprs.reduce((currentTotal, expr) => {\r\n\t\t\tvar val = expr.val.eval(context, callback);\r\n\t\t\tvar operator = expr.operator.trim();\r\n\t\t\tif ((!_isNumeric(currentTotal) || !_isNumeric(val)) && operator !== '+') {\r\n\t\t\t\tthrow new Error('Invalid Math expression: ' + this.toString() + '!');\r\n\t\t\t}\r\n\t\t\tswitch(operator) {\r\n\t\t\t\tcase '+':\r\n\t\t\t\t\treturn currentTotal + val;\r\n\t\t\t\tcase '-':\r\n\t\t\t\t\treturn currentTotal - val;\r\n\t\t\t\tcase '*':\r\n\t\t\t\t\treturn currentTotal * val;\r\n\t\t\t\tcase '/':\r\n\t\t\t\t\treturn currentTotal / val;\r\n\t\t\t}\r\n\t\t}, this.val.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.val.toString(context)].concat(\r\n\t\t\tthis.exprs.map(expr => expr.operator + ' ' + expr.val.toString(context))\r\n\t\t).join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Math) {\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1 && parse.matches.length === parse.tokens.length - 1) {\r\n\t\t\tvar operators = _unique(parse.matches);\r\n\t\t\tif (_intersect(operators, Math.operators.sup).length && _intersect(operators, Math.operators.sub).length) {\r\n\t\t\t\tthrow new Error('\"Addition/subtraction\" and \"multiplication/division\" operators cannot be used in the same expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(parse.tokens.shift().trim()),\r\n\t\t\t\tparse.tokens.map((expr, i) => {return {\r\n\t\t\t\t\toperator: parse.matches[i],\r\n\t\t\t\t\tval: parseCallback(expr.trim())\r\n\t\t\t\t};})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nMath.operators = {\r\n\tsup: ['*', '/'],\r\n\tsub: [' + ', ' - '],\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Math;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * NumInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'NumberType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isNumeric\r\n} from '@onephrase/commons/src/Js.js';\r\nimport NumInterface from './NumInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Num (number) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Num = class extends NumInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(int, dec = 0) {\r\n\t\tsuper();\r\n\t\tthis.int = int;\r\n\t\tthis.dec = dec;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn parseFloat(this.int + (this.dec ? '.' + this.dec : null));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.int + (this.dec ? '.' + this.dec : null);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Num) {\r\n\t\tif (_isNumeric(expr)) {\r\n\t\t\tvar expr = expr.split('.');\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseInt(expr.shift()),\r\n\t\t\t\tparseInt(expr.shift())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Num;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ObjInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ObjectType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_first,\r\n\t_last\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport ObjInterface from './ObjInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Object utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Obj = class extends ObjInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(entries) {\r\n\t\tsuper();\r\n\t\tthis.entries = entries || {};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof ObjInterface) {\r\n\t\t\t_each(Super.entries, (name, val) => {\r\n\t\t\t\tif (!(name in this.entries)) {\r\n\t\t\t\t\tthis.entries[name] = val;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar items = {};\r\n\t\t_each(this.entries, (key, expr) => {\r\n\t\t\titems[key] = expr.eval(context, callback);\r\n\t\t});\r\n\t\treturn items;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar str = [];\r\n\t\t_each(this.entries, (key, expr) => {\r\n\t\t\tstr.push(key + Obj.operators.sub + expr.toString(context));\r\n\t\t});\r\n\t\treturn '{' + str.join(Obj.operators.sup) + '}';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Obj) {\r\n\t\tif (_wrapped(expr, '{', '}') && !Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar entries = {};\r\n\t\t\tvar _entriesSplit = Lexer.split(_unwrap(expr, '{', '}'), [Obj.operators.sup])\r\n\t\t\t\t.map(n => n.trim()).filter(n => n);\r\n\t\t\t_each(_entriesSplit, (key, expr) => {\r\n\t\t\t\tvar entry = Lexer.split(expr, [Obj.operators.sub], {limit:1}/*IMPORTANT*/);\r\n\t\t\t\tentries[_first(entry).trim()] = parseCallback(_last(entry).trim());\r\n\t\t\t});\r\n\t\t\treturn new Static(entries);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nObj.operators = {\r\n\tsup: ',',\r\n\tsub: ':',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Obj;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {\r\n\t_isUndefined,\r\n\t_isFunction\r\n} from '@onephrase/commons/src/Js.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport ExprInterface from '../ExprInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Reference class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Reference = class extends ReferenceInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(context, name, backticks = false) {\r\n\t\tsuper();\r\n\t\tthis.context = context;\r\n\t\tthis.name = name;\r\n\t\tthis.backticks = backticks;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tgetEval(context = null, callback = null) {\r\n\t\tvar sourceContext = context, name = this.name;\r\n\t\tif (this.context) {\r\n\t\t\tif (name instanceof ExprInterface) {\r\n\t\t\t\tname = name.eval(context, callback);\r\n\t\t\t}\r\n\t\t\tsourceContext = this.context.eval(context, callback);\r\n\t\t}\r\n\t\treturn {context:sourceContext, name:name,};\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar parts = this.getEval(context, callback);\r\n\t\tif (!_isUndefined(parts.context) && !_isUndefined(parts.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, parts.context, parts.name);\r\n\t\t\t}\r\n\t\t\tvar _contexts = parts.context instanceof Contexts \r\n\t\t\t\t? parts.context.slice() \r\n\t\t\t\t: [parts.context];\r\n\t\t\twhile(_contexts.length) {\r\n\t\t\t\tvar cntxt = _contexts.pop(), val = cntxt[parts.name];\r\n\t\t\t\tif (!_isUndefined(val)) {\r\n\t\t\t\t\treturn val;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar name = this.name;\r\n\t\tif (this.context) {\r\n\t\t\tvar subjectContext = this.context.toString(context);\r\n\t\t\tif (name instanceof ExprInterface) {\r\n\t\t\t\tname = '[' + name.toString(context) + ']';\r\n\t\t\t} else if (this.backticks) {\r\n\t\t\t\tname = '`' + name + '`';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar subjectContext = context;\r\n\t\t\tif (this.backticks) {\r\n\t\t\t\tname = '`' + name + '`';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn (subjectContext || '') + (subjectContext && !name.startsWith('[') ? Reference.separator : '') + name;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Reference) {\r\n\t\tif (!Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar splits = Lexer.split(expr, []);\r\n\t\t\t// ------------------------\r\n\t\t\t// name, first\r\n\t\t\t// ------------------------\r\n\t\t\tvar context, name = splits.pop(), backticks;\r\n\t\t\tvar nameSplit = Lexer.split(name.trim(), [Static.separator], {preserveDelims:true});\r\n\t\t\tif (nameSplit.length > 1) {\r\n\t\t\t\tname = nameSplit.pop().substr(1);\r\n\t\t\t\tsplits = splits.concat(nameSplit);\r\n\t\t\t}\r\n\t\t\tif (_wrapped(name, '`', '`')) {\r\n\t\t\t\tname = _unwrap(name, '`', '`');\r\n\t\t\t\tbackticks = true;\r\n\t\t\t}\r\n\t\t\t// ------------------------\r\n\t\t\t// context, second\r\n\t\t\t// ------------------------\r\n\t\t\tif (splits.length) {\r\n\t\t\t\tcontext = parseCallback(splits.join(''));\r\n\t\t\t\tcontext.isContext = true;\r\n\t\t\t}\r\n\t\t\tif (_wrapped(name, '[', ']')) {\r\n\t\t\t\tif (!context) {\r\n\t\t\t\t\tthrow new Error('Invalid reference: ' + expr + '!');\r\n\t\t\t\t}\r\n\t\t\t\tname = parseCallback(_unwrap(name, '[', ']'));\r\n\t\t\t}\r\n\t\t\treturn new Static(context, name, backticks);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop string\r\n */\r\nReference.separator = '.';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Reference;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ReturnInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ReturnDirective'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport ReturnInterface from './ReturnInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Ret (return) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Return = class extends ReturnInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.expr ? this.expr.eval(context, callback) : undefined;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.expr ? 'return ' + this.expr.toString(context) : 'return';\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------------------------------------------\r\n\t */\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Return) {\r\n\t\tvar exprLc = expr.toLowerCase();\r\n\t\tif (exprLc.startsWith('return ') || exprLc === 'return') {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(expr.substr(6).trim())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Return;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * StatementsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Statements'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_flatten\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport StatementsInterface from './StatementsInterface.js';\r\nimport ReturnInterface from './ReturnInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Statements class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Statements = class extends StatementsInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(stmts, delim) {\r\n\t\tsuper();\r\n\t\tthis.stmts = exprs;\r\n\t\tthis.delim = delim;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar exprs = [];\r\n\t\tfor (var i = 0; i < this.stmts.length; i ++) {\r\n\t\t\tif (this.stmts[i] instanceof ReturnInterface) {\r\n\t\t\t\treturn this.stmts[i].eval(context, callback);\r\n\t\t\t} else {\r\n\t\t\t\texprs[i] = this.stmts[i].eval(context, callback);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn exprs;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.stmts.map(expr => expr.toString(context)).join(this.delim);\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Statements) {\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparse.tokens.map(expr => parseCallback(expr)),\r\n\t\t\t\tparse.matches[0].trim()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop array\r\n */\r\nStatements.operators = [\r\n\t';',\r\n\t\"\\r\\n\",\r\n];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Statements;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * StrInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'StringType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport StrInterface from './StrInterface.js';\r\nimport Lexer from '../Lexer.js';\r\nimport Bool from './Bool.js';\r\n\r\n/**\r\n * ---------------------------\r\n * String utils\r\n * ---------------------------\r\n */\r\n\r\nconst Str = class extends StrInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr, quote) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t\tthis.quote = quote;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn this.expr;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString() {\r\n\t\treturn this.quote + this.expr + this.quote;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Str) {\r\n\t\texpr = expr.trim();\r\n\t\tif ((_wrapped(expr, '\"', '\"') || _wrapped(expr, \"'\", \"'\")) \r\n\t\t&& !Lexer.match(expr, [' ']).length) {\r\n\t\t\tvar quote = _wrapped(expr, '\"', '\"') ? '\"' : \"'\";\r\n\t\t\treturn new Static(\r\n\t\t\t\t_unwrap(expr, quote, quote),\r\n\t\t\t\tquote\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Str;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {_isObject} from './Js.js';\r\nimport {_each} from './Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Num (number) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\n\r\n/**\r\n * In an array of numbers, returns the item closest to the given value.\r\n *\r\n * @param array|object \tarr\r\n * @param int \t \t\tnum\r\n * @param bool \t \t\tbyKey\r\n *\r\n * @return number\r\n */\r\nconst _closest = function(arr, num, byKey = false) {\r\n\tvar keys = null;\r\n\tvar entries = arr;\r\n\tif (byKey || _isObject(entries)) {\r\n\t\tkeys = Object.keys(entries);\r\n\t\tentries = keys.map(key => entries[key]);\r\n\t}\r\n\tvar closest = entries.reduce((prev, curr) => {\r\n\t  return (Math.abs(curr - num) < Math.abs(prev - num) ? curr : prev);\r\n\t}, undefined);\r\n\treturn keys ? keys[entries.indexOf(closest)] : closest;\r\n};\r\n\r\n/**\r\n * Converts words to numbers\r\n * Adapted from Crunz\\Utils | 22-07-17;\r\n *\r\n * @param  text\r\n *\r\n * @return string\r\n */\r\nconst _fromWords = function(text) {\r\n\tvar data = strtr(text, {\r\n\t\tzero:       '0',\r\n\t\ta:          '1',\r\n\t\tone:        '1',\r\n\t\ttwo:        '2',\r\n\t\tthree:      '3',\r\n\t\tfour:       '4',\r\n\t\tfive:       '5',\r\n\t\tsix:        '6',\r\n\t\tseven:      '7',\r\n\t\teight:      '8',\r\n\t\tnine:       '9',\r\n\t\tten:        '10',\r\n\t\televen:     '11',\r\n\t\ttwelve:     '12',\r\n\t\tthirteen:   '13',\r\n\t\tfourteen:   '14',\r\n\t\tfifteen:    '15',\r\n\t\tsixteen:    '16',\r\n\t\tseventeen: \t'17',\r\n\t\teighteen:   '18',\r\n\t\tnineteen:   '19',\r\n\t\ttwenty:     '20',\r\n\t\tthirty:     '30',\r\n\t\tforty:      '40',\r\n\t\tfourty:     '40',\r\n\t\tfifty:      '50',\r\n\t\tsixty:      '60',\r\n\t\tseventy:    '70',\r\n\t\teighty:     '80',\r\n\t\tninety:     '90',\r\n\t\thundred:    '100',\r\n\t\tthousand:   '1000',\r\n\t\tmillion:    '1000000',\r\n\t\tbillion:    '1000000000',\r\n\t\tand:        '',\r\n\t});\r\n\r\n\t// Coerce all tokens to numbers\r\n\tvar parts = data.split('/[\\s-]+/').map(val => parseFloat(val));\r\n\r\n\tvar tmp   = null;\r\n\tvar sum   = 0;\r\n\tvar last  = null;\r\n\r\n\t_each(parts, (i, part) => {           \r\n\t\tif (tmp !== '') {                \r\n\t\t\tif (tmp > part) {\r\n\t\t\t\tif (last >= 1000) {                                       \r\n\t\t\t\t\tsum += tmp;\r\n\t\t\t\t\ttmp = part;\r\n\t\t\t\t} else {          \r\n\t\t\t\t\ttmp = tmp + part;\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttmp = tmp * part;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\ttmp = part;\r\n\t\t}\r\n\t\t\r\n\t\tlast = part;\r\n\t});\r\n\r\n\treturn sum + tmp;    \r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\t_closest,\r\n\t_fromWords\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport * as _Arr from './Arr.js';\r\nimport * as _Js from './Js.js';\r\nimport * as _Num from './Num.js';\r\nimport * as _Obj from './Obj.js';\r\nimport * as _Str from './Str.js';\r\n\r\n/**\r\n * Standardize functions as\r\n * prototype methods.\r\n */\r\nconst standardize = (a, prototype, prefix = '') => Object.keys(a).reduce((prototype, funcName) => _Obj._with(prototype, prefix + funcName, function() {\r\n\treturn a[funcName](this, ...arguments);\r\n}), prototype);\r\n\r\n/**\r\n * Deliver functions without\r\n * their initial underscore.\r\n */\r\nconst rename = (a, b = {}) => Object.keys(a).reduce((b, funcName) => _Obj._with(b, funcName.substr(1), a[funcName]), b);\r\nconst Arr = rename(_Arr);\r\nconst Js = rename(_Js);\r\nconst Num = rename(_Num);\r\nconst Obj = rename(_Obj);\r\nconst Str = rename(_Str);\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {Arr, Js, Num, Obj, Str, standardize};","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen from './Jsen.js';\r\nimport ExprInterface from './ExprInterface.js';\r\nimport Lexer from './Lexer.js';\r\nimport Contexts from './Contexts.js';\r\nimport Abstraction from './Expr/Abstraction.js';\r\nimport AbstractionInterface from './Expr/AbstractionInterface.js';\r\nimport Arr from './Expr/Arr.js';\r\nimport ArrInterface from './Expr/ArrInterface.js';\r\nimport Arguments from './Expr/Arguments.js';\r\nimport ArgumentsInterface from './Expr/ArgumentsInterface.js';\r\nimport Assertion from './Expr/Assertion.js';\r\nimport AssertionInterface from './Expr/AssertionInterface.js';\r\nimport Assignment from './Expr/Assignment.js';\r\nimport AssignmentInterface from './Expr/AssignmentInterface.js';\r\nimport Bool from './Expr/Bool.js';\r\nimport BoolInterface from './Expr/BoolInterface.js';\r\nimport Call from './Expr/Call.js';\r\nimport CallInterface from './Expr/CallInterface.js';\r\nimport Comments from './Expr/Comments.js';\r\nimport CommentsInterface from './Expr/CommentsInterface.js';\r\nimport Comparison from './Expr/Comparison.js';\r\nimport ComparisonInterface from './Expr/ComparisonInterface.js';\r\nimport Condition from './Expr/Condition.js';\r\nimport ConditionInterface from './Expr/ConditionInterface.js';\r\nimport Deletion from './Expr/Deletion.js';\r\nimport DeletionInterface from './Expr/DeletionInterface.js';\r\nimport Func from './Expr/Func.js';\r\nimport FuncInterface from './Expr/FuncInterface.js';\r\nimport Math from './Expr/Math.js';\r\nimport MathInterface from './Expr/MathInterface.js';\r\nimport Num from './Expr/Num.js';\r\nimport NumInterface from './Expr/NumInterface.js';\r\nimport Obj from './Expr/Obj.js';\r\nimport ObjInterface from './Expr/ObjInterface.js';\r\nimport Reference from './Expr/Reference.js';\r\nimport ReferenceInterface from './Expr/ReferenceInterface.js';\r\nimport Return from './Expr/Return.js';\r\nimport ReturnInterface from './Expr/ReturnInterface.js';\r\nimport Statements from './Expr/Statements.js';\r\nimport StatementsInterface from './Expr/StatementsInterface.js';\r\nimport Str from './Expr/Str.js';\r\nimport StrInterface from './Expr/StrInterface.js';\r\nimport * as Commons from '@onephrase/commons';\r\n\r\n/**\r\n * @var object\r\n */\r\nJsen.grammars = {\r\n\tComments: Comments,\t\t\t// // single-line | /* double-line */\r\n\tReturn: Return,\t\t\t\t// return field1\r\n\tStatements: Statements,\t\t// field1 = 3; field2 = val2\r\n\tDeletion: Deletion,\t\t\t// delete field1\r\n\tAssignment: Assignment,\t\t// field1[key1].key2 = k\r\n\tFunc: Func,\t\t\t\t\t// (field1, field2) => {}\r\n\tAbstraction: Abstraction,\t// (field1)\r\n\tCondition: Condition,\t\t// field1 > field2 ? val1 : val2\r\n\tAssertion: Assertion,\t\t// !field1 && field2\r\n\tComparison: Comparison,\t\t// field1 > field2\r\n\tMath: Math,\t\t\t\t\t// field1 + field2\r\n\tArr: Arr,\t\t\t\t\t// [field1, field2]\r\n\tObj: Obj,\t\t\t\t\t// {field1:val1, field2:val2}\r\n\tNum: Num,\t\t\t\t\t// [0-9]\r\n\tStr: Str,\t\t\t\t\t// \"\"\r\n\tBool: Bool,\t\t\t\t\t// true\r\n\tCall: Call,\t\t\t\t\t// field1()\r\n\tReference: Reference,\t\t\t\t// field1\r\n};\r\n\r\nCall.utils = Commons;\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tExprInterface,\r\n\tLexer,\r\n\tContexts\r\n};\r\nexport {\r\n\tAbstraction,\r\n\tArr,\r\n\tArguments,\r\n\tAssertion,\r\n\tAssignment,\r\n\tBool,\r\n\tCall,\r\n\tComments,\r\n\tComparison,\r\n\tCondition,\r\n\tDeletion,\r\n\tFunc,\r\n\tMath,\r\n\tNum,\r\n\tObj,\r\n\tReference,\r\n\tReturn,\r\n\tStr,\r\n\tStatements\r\n};\r\nexport {\r\n\tAbstractionInterface,\r\n\tArrInterface,\r\n\tArgumentsInterface,\r\n\tAssertionInterface,\r\n\tAssignmentInterface,\r\n\tBoolInterface,\r\n\tCallInterface,\r\n\tCommentsInterface,\r\n\tComparisonInterface,\r\n\tConditionInterface,\r\n\tDeletionInterface,\r\n\tFuncInterface,\r\n\tMathInterface,\r\n\tNumInterface,\r\n\tObjInterface,\r\n\tReferenceInterface,\r\n\tReturnInterface,\r\n\tStrInterface,\r\n\tStatementsInterface\r\n};\r\nexport default Jsen;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Event class\r\n * ---------------------------\r\n */\r\n\r\nconst Event = class {\r\n\r\n\t/**\r\n\t * Initializes an Event instance.\r\n\t *\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(params) {\r\n\t\tthis.$ = {\r\n\t\t\tisPropagationStopped: false,\r\n\t\t\tisDefaultPrevented: false,\r\n\t\t\tpromises: [],\r\n\t\t};\r\n\t\t_each(params, (name, value) => {\r\n\t\t\tthis[name] = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Stops the evnt from reaching other listeners.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstopPropagation() {\r\n\t\tthis.$.isPropagationStopped = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if stopPropagation() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget isPropagationStopped() {\r\n\t\treturn this.$.isPropagationStopped;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a disposition that asks event initiator not to\r\n\t * proceed with default action.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpreventDefault() {\r\n\t\tthis.$.isDefaultPrevented = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if preventDefault() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget isDefaultPrevented() {\r\n\t\treturn this.$.isDefaultPrevented;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a Promise disposition.\r\n\t *\r\n\t * @param Promise\tpromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpromise(promise) {\r\n\t\tif (!(promise instanceof Promise)) {\r\n\t\t\tthrow new Error('Event.promise() must be called with a Promise.');\r\n\t\t}\r\n\t\tthis.$.promises.push(promise);\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) returns all promises.\r\n\t *\r\n\t * @return Promise|null\r\n\t */\r\n\tget promises() {\r\n\t\treturn this.$.promises.length ? Promise.all(this.$.promises) : null;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Event;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_even,\r\n\t_get\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_remove,\r\n\t_concatUnique,\r\n\t_from,\r\n\t_difference,\r\n\t_intersect,\r\n\t_exclude,\r\n\t_from as _arr_from\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_isNull,\r\n\t_isFunction,\r\n\t_getType,\r\n\t_isString,\r\n\t_isArray\r\n} from '@onephrase/commons/src/Js.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nconst EventController = class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor() {\r\n\t\tthis.$ = {\r\n\t\t\tlisteners: [],\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * Creates a listener object.\r\n\t *\r\n\t * @param string|array\t\teventNames\r\n\t * @param function\t\t\tcallback\r\n\t * @param object\t\t\tparams\r\n\t * @param string\t\t\ttag\r\n\t *\r\n\t * @return void\r\n\t */\r\n\taddListener(eventNames, callback, params = {}, tag = null) {\r\n\t\tif (_isFunction(eventNames)) {\r\n\t\t\ttag = arguments.length > 2 ? params : '';\r\n\t\t\tparams = callback;\r\n\t\t\tcallback = eventNames;\r\n\t\t\teventNames = null;\r\n\t\t}\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t\t}\r\n\t\tvar listener = {\r\n\t\t\teventNames: eventNames, \r\n\t\t\tcallback: callback, \r\n\t\t\tparams: params,\r\n\t\t\ttag: tag,\r\n\t\t\tremove: () => {\r\n\t\t\t\t_remove(this.$.listeners, listener);\r\n\t\t\t},\r\n\t\t};\r\n\t\tthis.$.listeners.push(listener);\r\n\t\treturn listener;\r\n\t}\r\n\r\n\t/**\r\n\t * Unregisters an listener.\r\n\t *\r\n\t * @param string|array\t\teventNames\r\n\t * @param function\t\t\tcallback\r\n\t * @param object\t\t\tparams\r\n\t * @param string\t\t\ttag\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tremoveListener(eventNames, callback = null, params = {}, tag = null) {\r\n\t\tif (_isFunction(eventNames)) {\r\n\t\t\ttag = arguments.length > 2 ? params : '';\r\n\t\t\tparams = callback || {};\r\n\t\t\tcallback = eventNames;\r\n\t\t\teventNames = null;\r\n\t\t}\r\n\t\tvar success = false;\r\n\t\tfor (var i = 0; i < this.$.listeners.length; i ++) {\r\n\t\t\tif ((_isNull(eventNames) || _even(_arr_from(this.$.listeners[i].eventNames), _arr_from(eventNames))) \r\n\t\t\t&& (_isNull(callback) || this.$.listeners[i].callback === callback)\r\n\t\t\t&& (_isNull(params) || _even(this.$.listeners[i].params, params))\r\n\t\t\t&& (_isNull(tag) || this.$.listeners[i].tag === tag)) {\r\n\t\t\t\tif (this.$.listeners[i].removeCallback) {\r\n\t\t\t\t\tthis.$.listeners[i].removeCallback();\r\n\t\t\t\t}\r\n\t\t\t\tthis.$.listeners[i].remove();\r\n\t\t\t\tsuccess = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn success;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Returns the list of params being listend.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\teventsAll() {\r\n\t\tvar eventsAll = [];\r\n\t\t(this.$.listeners || []).forEach(listener => {\r\n\t\t\tif (!_isNull(listener.eventNames)) {\r\n\t\t\t\teventsAll = _concatUnique(eventsAll, _from(listener.eventNames));\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn eventsAll;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fires listeners that are bound to the given events.\r\n\t *\r\n\t * @param string|array\t \teventNames\r\n\t * @param object \t\t\tdetails\r\n\t *\r\n\t * @return bool|Promise\r\n\t */\r\n\tfire(eventNames, details) {\r\n\t\tvar e = details instanceof Event ? details : new Event(details);\r\n\t\t// We handle multiple events actually...\r\n\t\teventNames = _from(eventNames);\r\n\t\t// And fields already firing should trigger a refire\r\n\t\tthis.$.currentlyFiring = this.$.currentlyFiring || [];\r\n\t\tvar eventNamesAntiRecursion = _difference(eventNames, this.$.currentlyFiring);\r\n\t\tif (!eventNamesAntiRecursion.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_concatUnique(this.$.currentlyFiring, eventNamesAntiRecursion)\r\n\t\t// Initialize evteters for \"return\"\r\n\t\tfor (var i = 0; i < (this.$.listeners || []).length; i ++) {\r\n\t\t\tif (e.isPropagationStopped) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar listener = this.$.listeners[i];\r\n\t\t\tvar listenerParams = listener.params || {};\r\n\t\t\tvar listenerEventNames = _from(listener.eventNames).map(str => str.replace(/\\`/g, ''));\r\n\t\t\t// --------------------------\r\n\t\t\t// Level-1 filtering...\r\n\t\t\t// Match listenerEventNames to firingEventNames\r\n\t\t\t// --------------------------\r\n\t\t\tvar matches;\r\n\t\t\tif (listenerEventNames.length) {\r\n\t\t\t\tmatches = listenerEventNames.filter(listenerEventName => {\r\n\t\t\t\t\tvar firingEventNames = e.bubbling && listenerEventName.indexOf('.') > -1 ? e.bubbling\r\n\t\t\t\t\t\t: (!e.bubbling || listenerParams.allowBubbling ? eventNamesAntiRecursion : []);\r\n\t\t\t\t\treturn firingEventNames.filter(firingEventName => (listenerEventName + '.').startsWith(firingEventName + '.')).length;\r\n\t\t\t\t}).length;\r\n\t\t\t} else {\r\n\t\t\t\tmatches = !e.bubbling || listenerParams.allowBubbling;\r\n\t\t\t}\r\n\t\t\t// --------------------------\r\n\t\t\t// Level-2 filtering...\r\n\t\t\t// --------------------------\r\n\t\t\tif (matches && this._shouldFire(listener, eventNames, e)) {\r\n\t\t\t\t// Call listener...\r\n\t\t\t\tvar dispostn = this._doFire(listener, eventNames, e), proms;\r\n\t\t\t\tif ((dispostn === false) || (dispostn instanceof Event && dispostn.isPropagationStopped)) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t} else if ((dispostn === false) || (dispostn instanceof Event && dispostn.isDefaultPrevented)) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t} else if ((dispostn instanceof Promise && (proms = dispostn))\r\n\t\t\t\t|| (dispostn instanceof Event && (proms = dispostn.promises))) {\r\n\t\t\t\t\te.promise(proms);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t_exclude(this.$.currentlyFiring, ...eventNamesAntiRecursion)\r\n\t\t// -----------------------------\r\n\t\t// The overall return value\r\n\t\t// -----------------------------\r\n\t\treturn e;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determins if to fire the listener at entry \"i\".\r\n\t * Returns a data object if so.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\t_shouldFire(listener, eventNames, e) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Fires the listener at entry \"i\".\r\n\t * Returns listener's disposition.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\t_doFire(listener, eventNames, e) {\r\n\t\tvar context = e.context || {};\r\n\t\tvar _context = e._context || {};\r\n\t\tif (!_isNull(listener.eventNames)) {\r\n\t\t\t// Call listener...\r\n\t\t\tvar data = [];\r\n\t\t\tvar _data = [];\r\n\t\t\tvar result = _from(listener.eventNames).forEach(eventName => {\r\n\t\t\t\teventName = _isString(eventName) ? eventName.split('.') : eventName;\r\n\t\t\t\tdata.push(_get(context, eventName));\r\n\t\t\t\t_data.push(_get(_context, eventName));\r\n\t\t\t});\r\n\t\t\treturn _isArray(listener.eventNames) \r\n\t\t\t\t? listener.callback(data, _data, e)\r\n\t\t\t\t: listener.callback(data[0], _data[0], e);\r\n\t\t}\r\n\t\tvar data = {};\r\n\t\tvar _data = {};\r\n\t\teventNames.forEach(eventName => {\r\n\t\t\tvar path = _isString(eventName) ? eventName.split('.') : eventName;\r\n\t\t\tdata[eventName] = _get(context, path);\r\n\t\t\t_data[eventName] = _get(_context, path);\r\n\t\t});\r\n\t\t// Call listener...\r\n\t\treturn listener.callback(data, _data, e);\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default EventController;","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen, {\r\n\tArgumentsInterface,\r\n\tCallInterface,\r\n\tReferenceInterface,\r\n\tContexts\r\n} from '@onephrase/jsen';\r\nimport {\r\n\t_isArray,\r\n\t_isString,\r\n\t_isObject,\r\n\t_isFunction,\r\n\t_isNumber,\r\n\t_isNumeric,\r\n\t_isObservable,\r\n\t_proxy,\r\n\t_isProxy,\r\n\t_getProxyTarget,\r\n\t_isUndefined,\r\n\t_isNull\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_from,\r\n\t_unique\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_inherit,\r\n\t_copy,\r\n\t_each,\r\n\t_even,\r\n\t_get\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport EventController from './EventController.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Observable\r\n * ---------------------------\r\n */\r\n \r\nconst Observable = class extends EventController {\r\n\r\n\t/**\r\n\t * Handles initializations.\r\n\t *\r\n\t * @param object\t\t\tstate\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tsuper();\r\n\t\t// @see ObservableCore.init()\r\n\t\tthis.$.params = _inherit({}, params, Observable.params);\r\n\t\tthis.$.bubblers = {};\r\n\t\tthis.$.state = state;\r\n\t\tthis.$._state = _isArray(state) ? state.slice() : _copy(1, state);\r\n\t\t_each(this.$.state, (prop, value) => {\r\n\t\t\tthis._incoming(prop, value);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a reference to the parent instance.\r\n\t *\r\n\t * @param object|null\t\toffsetParent\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tsetOffsetParent(offsetParent) {\r\n\t\tthis.$.offsetParent = offsetParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a reference to the parent instance.\r\n\t *\r\n\t * @return object|null\r\n\t */\r\n\tgetOffsetParent() {\r\n\t\treturn this.$.offsetParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Alias of addListener.\r\n\t *\r\n\t * @see addListener()\r\n\t */\r\n\tobserve(...args) {\r\n\t\treturn this.addListener(...args);\r\n\t}\r\n\r\n\t/**\r\n\t * Alias of removeListener.\r\n\t *\r\n\t * @see removeListener()\r\n\t */\r\n\tunobserve(...args) {\r\n\t\treturn this.removeListener(...args);\r\n\t}\r\n\r\n\t/**\r\n\t * Pushes data into a given property, or list of properties.\r\n\t *\r\n\t * @param string\t\tprops\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\tset(prop, value) {\r\n\t\tvar data = {};\r\n\t\tif (_isString(prop) || _isNumber(prop)) {\r\n\t\t\tdata[prop] = value;\r\n\t\t} else if (_isArray(prop)) {\r\n\t\t\tprop.forEach(p => {\r\n\t\t\t\tdata[p] = value;\r\n\t\t\t})\r\n\t\t} else if (_isObject(prop)) {\r\n\t\t\tdata = prop;\r\n\t\t}\r\n\t\tvar changedProps = Object.keys(data);\r\n\t\tif (_isArray(this.$.state)) {\r\n\t\t\tchangedProps = changedProps.map(key => parseInt(key));\r\n\t\t}\r\n\t\t// ------------------\r\n\t\tvar entries = [];\r\n\t\tchangedProps.forEach(prop => {\r\n\t\t\tif (prop in this.$.state) {\r\n\t\t\t\tthis._outgoing(prop, this.$.state[prop]);\r\n\t\t\t} else {\r\n\t\t\t\tentries.push(prop);\r\n\t\t\t}\r\n\t\t\t// Incoming...\r\n\t\t\t// ------------------\r\n\t\t\tvar value = data[prop];\r\n\t\t\t// When observables come as proxies,\r\n\t\t\t// we'll save them real\r\n\t\t\tif (_isProxy(value)) {\r\n\t\t\t\tvar _value = _getProxyTarget(value);\r\n\t\t\t\tif (_isObservable(_value)) {\r\n\t\t\t\t\tvalue = _value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._incoming(prop, value);\r\n\t\t\t// Set now...\r\n\t\t\t// ------------------\r\n\t\t\tthis.$.state[prop] = value;\r\n\t\t});\r\n\t\tvar observersDisposition = this.fire(changedProps, {context: this.$.state, _context: this.$._state, entries: entries, exits: []});\r\n\t\tchangedProps.forEach(prop => {\r\n\t\t\tthis.$._state[prop] = this.$.state[prop];\r\n\t\t});\r\n\t\treturn observersDisposition;\r\n\t}\r\n\r\n\t/**\r\n\t * Unsets the property or list of properties from the object.\r\n\t *\r\n\t * @param string|array\t\tprop\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\tdel(prop) {\r\n\t\tvar props = _from(prop);\r\n\t\tvar exits = [];\r\n\t\tprops.forEach(prop => {\r\n\t\t\tif (prop in this.$.state) {\r\n\t\t\t\texits.push(prop);\r\n\t\t\t\tthis._outgoing(prop, this.$.state[prop]);\r\n\t\t\t}\r\n\t\t\tdelete this.$.state[prop];\r\n\t\t});\r\n\t\tvar observersDisposition = this.fire(props, {context: this.$.state, _context: this.$._state, entries: [], exits: exits});\r\n\t\tprops.forEach(prop => {\r\n\t\t\tdelete this.$._state[prop];\r\n\t\t});\r\n\t\treturn observersDisposition;\r\n\t}\r\n\r\n\t/**\r\n\t * Evaluates a property name to see if it's a request for instance method\r\n\t * as against state property.\r\n\t *\r\n\t * This is especially useful for _jsenGetters.\r\n\t *\r\n\t * @param string\t\t\tprop\r\n\t *\r\n\t * @return function|undefined\r\n\t */\r\n\tasOwnMethod(prop) {\r\n\t\tif (_isString(prop) && this.$.params.methodPrefix && prop.startsWith(this.$.params.methodPrefix)) {\r\n\t\t\tvar ownMethod = prop.substr(this.$.params.methodPrefix.length);\r\n\t\t\tif (ownMethod && _isFunction(ownMethod = this[ownMethod])) {\r\n\t\t\t\treturn ownMethod.bind(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns a field's value.\r\n\t *\r\n\t * @param string|int \t\tprop\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(prop) {\r\n\t\t// ----------------------\r\n\t\tvar asOwnMethod = this.asOwnMethod(prop);\r\n\t\tif (asOwnMethod) {\r\n\t\t\treturn asOwnMethod;\r\n\t\t}\r\n\t\t// ----------------------\r\n\t\tif (prop === '_') {\r\n\t\t\treturn this.getOffsetParent();\r\n\t\t}\r\n\t\tif (prop === '__') {\r\n\t\t\tvar parent = this.getOffsetParent();\r\n\t\t\treturn (parent ? parent.get('__') : parent) || parent;\r\n\t\t}\r\n\t\tvar value = this.$.state[prop];\r\n\t\tif (_isArray(this.$.state) && !_isNumeric(prop) && _isFunction(value)) {\r\n\t\t\treturn (...args) => {\r\n\t\t\t\tvar copy = this.$.state.slice();\r\n\t\t\t\tvar ret = value.apply(this.$.state, args);\r\n\t\t\t\tvar changedKeys = _unique(Object.keys(copy).concat(Object.keys(this.$.state))).filter(k => {\r\n\t\t\t\t\tk = parseInt(k);\r\n\t\t\t\t\tif (this.$.state[k] !== copy[k]) {\r\n\t\t\t\t\t\tif (!(k in this.$.state)) {\r\n\t\t\t\t\t\t\t// Outgoing...\r\n\t\t\t\t\t\t\t// ------------------\r\n\t\t\t\t\t\t\tthis._outgoing(k, copy[k]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Incoming...\r\n\t\t\t\t\t\t\t// ------------------\r\n\t\t\t\t\t\t\tthis._incoming(k, this.$.state[k]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (changedKeys.length) {\r\n\t\t\t\t\tthis.fire(changedKeys, {context: this.$.state, _context: this.$._state});\r\n\t\t\t\t\tthis.$._state = this.$.state.slice();\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Tells if a a field exists.\r\n\t *\r\n\t * @param string|int \t\tprop\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\thas(prop) {\r\n\t\treturn (prop in this.$.state);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Keys of current entries.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tkeys() {\r\n\t\treturn Object.keys(this.$.state);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Utility for deeply running JSEN expressions on the instance.\r\n\t *\r\n\t * @param string\t\t\texpr\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tjsenEval(expr, params = {}) {\r\n\t\tvar exprObj = Jsen.parse(expr, null, params);\r\n\t\tif (exprObj) {\r\n\t\t\treturn exprObj.eval(this, this.jsenGetter());;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * A getter callback for JSEN evaluators.\r\n\t *\r\n\t * @param array \t\tvars\r\n\t *\r\n\t * @return function\r\n\t */\r\n\tjsenGetter(vars = []) {\r\n\t\treturn ((caller, context, name, args = []) => {\r\n\t\t\tif (caller instanceof CallInterface || caller instanceof ReferenceInterface) {\r\n\t\t\t\tif (!caller.isContext) {\r\n\t\t\t\t\tvars.push(caller);\r\n\t\t\t\t}\r\n\t\t\t\tvar value, advance = true;\r\n\t\t\t\tvar _contexts = context instanceof Contexts ? context.slice() : [context];\r\n\t\t\t\tvar __contexts = _contexts.slice();\r\n\t\t\t\twhile(_isUndefined(value) && advance && _contexts.length) {\r\n\t\t\t\t\tvar cntxt = _contexts.pop();\r\n\t\t\t\t\tif (_isObservable(cntxt)) {\r\n\t\t\t\t\t\tvalue = cntxt.get(name);\r\n\t\t\t\t\t} else if (cntxt) {\r\n\t\t\t\t\t\tvalue = cntxt[name];\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ((caller instanceof CallInterface) && !_isUndefined(value)) {\r\n\t\t\t\t\t\tif (!_isFunction(value)) {\r\n\t\t\t\t\t\t\tthis.error(name + '() is not callable in the expression ' + caller.toString() + '!');\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvalue = value.apply(cntxt, args);\r\n\t\t\t\t\t\tadvance = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (advance && caller instanceof CallInterface) {\r\n\t\t\t\t\tthis.error('\"' + caller + '\" is not a function. (Called on ' + __contexts.map(c => typeof c).join(', ') + ')');\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t}\r\n\t\t\tthis.error('Operation \"' + caller + '\" is not supported!');\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determins if to fire the listener at entry \"i\".\r\n\t * Returns a data object if so.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\t_shouldFire(listener, eventNames, e) {\r\n\t\tvar passes = 0, failures = 0;\r\n\t\t// One CACHE across listeners\r\n\t\t// IMPORTANT: This cache must\r\n\t\t// be destroyed before bubbling the (e) object\r\n\t\tif (!('CACHE' in e.$)) {\r\n\t\t\te.$.CACHE = {};\r\n\t\t\te.$._CACHE = {};\r\n\t\t}\r\n\t\tvar listenerParams = listener.params || {};\r\n\t\t(!_isNull(listener.eventNames) ? _from(listener.eventNames) : eventNames).forEach(prop => {\r\n\t\t\tif (!(prop in e.$.CACHE)) {\r\n\t\t\t\te.$.CACHE[prop] = {};\r\n\t\t\t\te.$._CACHE[prop] = {};\r\n\t\t\t\t// > ACCESS\r\n\t\t\t\tvar existsReciever = {};\r\n\t\t\t\tvar _existsReciever = {};\r\n\t\t\t\tvar path = _isString(prop) ? prop.split('.') : prop;\r\n\t\t\t\te.$.CACHE[prop].val = _get(e.context, path, existsReciever);\r\n\t\t\t\te.$._CACHE[prop].val = _get(e._context, path, _existsReciever);\r\n\t\t\t\te.$.CACHE[prop].existence = existsReciever.exists;\r\n\t\t\t\te.$._CACHE[prop].existence = _existsReciever.exists;\r\n\t\t\t\t// > DIFFING\r\n\t\t\t\tif (listenerParams.diff !== false && !('diffing' in e.$.CACHE[prop])) {\r\n\t\t\t\t\te.$.CACHE[prop].diffing = e.bubbling\r\n\t\t\t\t\t|| e.$.CACHE[prop].existence !== e.$._CACHE[prop].existence \r\n\t\t\t\t\t|| (_isObject(e.$.CACHE[prop].val) && _isObject(e.$._CACHE[prop].val) \r\n\t\t\t\t\t\t? !_even(e.$.CACHE[prop].val, e.$._CACHE[prop].val) \r\n\t\t\t\t\t\t: e.$.CACHE[prop].val !== e.$._CACHE[prop].val);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// > Delta...\r\n\t\t\tif (_isNumeric(listenerParams.pulse) && e.context && e._context) {\r\n\t\t\t\tif (listenerParams.pulse === 0 && e.$.CACHE[prop].val && !e.$._CACHE[prop].val) {\r\n\t\t\t\t\tfailures ++;\r\n\t\t\t\t} else if (listenerParams.pulse === 1 && !e.$.CACHE[prop].val && e.$._CACHE[prop].val) {\r\n\t\t\t\t\tfailures ++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// > Diff...\r\n\t\t\tif (listenerParams.diff === false || e.$.CACHE[prop].diffing) {\r\n\t\t\t\tpasses ++;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn !failures && passes && super._shouldFire(listener, eventNames, e);\r\n\t}\r\n\r\n\t/**\r\n\t * A function that captures outgoing objects/values.\r\n\t *\r\n\t * @param string\t\tprop\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_outgoing(prop, value) {\r\n\t\tif (_isObservable(value)) {\r\n\t\t\tif (prop in this.$.bubblers) {\r\n\t\t\t\tvalue.unobserve(this.$.bubblers[prop], {allowBubbling:true});\r\n\t\t\t}\r\n\t\t\tif (_isFunction(value.getOffsetParent) && value.getOffsetParent() === this) {\r\n\t\t\t\tvalue.setOffsetParent(null);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A function that captures incoming objects/values.\r\n\t *\r\n\t * @param string\t\tprop\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_incoming(prop, value) {\r\n\t\tif (_isObservable(value)) {\r\n\t\t\tvalue.observe(this._getBubbler(prop), {allowBubbling:true});\r\n\t\t\tif (_isFunction(value.getOffsetParent) && !value.getOffsetParent()) {\r\n\t\t\t\tvalue.setOffsetParent(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a function that observes changes in child observables and bubble them up here.\r\n\t *\r\n\t * @param string\t\tname\r\n\t *\r\n\t * @return function\r\n\t */\r\n\t_getBubbler(prop) {\r\n\t\tthis.$.bubblers = this.$.bubblers || {};\r\n\t\tthis.$.bubblers[prop] = (changes, _changes, e) => {\r\n\t\t\tvar _e = {};\r\n\t\t\t_e.context = this.$.state;\r\n\t\t\t_e._context = this.$._state;\r\n\t\t\t_e.entries = (e.entries || []).slice();\r\n\t\t\t_e.exits = (e.exits || []).slice();\r\n\t\t\t_e.bubbling = (e.bubbling ? _from(e.bubbling) : Object.keys(changes))\r\n\t\t\t\t.map(subFieldName => prop + '.' + subFieldName);\r\n\t\t\treturn this.fire(prop, _e);\r\n\t\t};\r\n\t\treturn this.$.bubblers[prop];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Warning handler.\r\n\t *\r\n\t * @param string\t\tmsg\r\n\t *\r\n\t * @return void\r\n\t */\r\n\twarn(msg) {\r\n\t\tconsole.error(msg);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Error handler.\r\n\t *\r\n\t * @param string\t\tmsg\r\n\t *\r\n\t * @return void\r\n\t */\r\n\terror(msg) {\r\n\t\tif (this.$.params.strictDebug) {\r\n\t\t\tthrow new Error(msg);\r\n\t\t} else {\r\n\t\t\tconsole.error(msg);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Constructs a proxy wrapper for the target.\r\n\t *\r\n\t * @return new Proxy\r\n\t */\r\n\tproxy() {\r\n\t\treturn _proxy(this, {\r\n\t\t\t// -----------------------\r\n\t\t\t// The 4 cardinal points...\r\n\t\t\t// -----------------------\r\n\t\t\tget: function(target, prop) {\r\n\t\t\t\tvar value = target.get(prop);\r\n\t\t\t\tif (_isObject(value) && _isFunction(value.proxy)) {\r\n\t\t\t\t\tvalue = value.proxy();\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\t\t\tset: function(target, prop, val) {\r\n\t\t\t\ttarget.set(prop, val);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\thas: function(target, prop) {\r\n\t\t\t\treturn target.has(prop);\r\n\t\t\t},\r\n\t\t\tdeleteProperty: function(target, prop) {\r\n\t\t\t\treturn target.del(prop);\r\n\t\t\t},\r\n\t\t\t// -----------------------\r\n\t\t\t// Unimportant additions...\r\n\t\t\t// -----------------------\r\n\t\t\townKeys: function(target) {\r\n\t\t\t\t//TODO:return Reflect.ownKeys(target.$.state);\r\n\t\t\t\treturn Object.keys(target.$.state);\r\n\t\t\t},\r\n\t\t\tdefineProperty: function(target, prop, descriptor) {\r\n\t\t\t\tObject.defineProperty(target.$.state, prop, descriptor);\r\n\t\t\t\ttarget.set(prop, target.$.state[prop]);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tgetOwnPropertyDescriptor: function(target, prop) {\r\n\t\t\t\treturn Object.getOwnPropertyDescriptor(target.$.state, prop);\r\n\t\t\t},\r\n\t\t\tgetOwnPropertySymbols: function(target) {\r\n\t\t\t\treturn Object.getOwnPropertySymbols(target.$.state);\r\n\t\t\t},\r\n\t\t\tgetOwnPropertyNames: function(target) {\r\n\t\t\t\treturn Object.getOwnPropertyNames(target.$.state);\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nObservable.params = {\r\n\tmethodPrefix: '$',\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Observable;","\r\n/**\r\n * @imports\r\n */\r\nimport Observable from './Observable.js';\r\nimport EventController from './EventController.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tEventController,\r\n\tEvent\r\n};\r\nexport default Observable;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_last\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_copy\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Def = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(key, value, flag = null) {\r\n\t\tthis.key = key;\r\n\t\tthis.value = value;\r\n\t\tthis.flag = flag;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.key + ': ' + this.value + (this.flag ? ' ' + this.flag : '');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return Def\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\tif (expr) {\r\n\t\t\tvar _opts = _copy(opts);\r\n\t\t\t_opts.limit = 1;\r\n\t\t\tvar defSplit = Lexer.split(expr, [':'], _opts);\r\n\t\t\tif (defSplit.length < 2) {\r\n\t\t\t\tthrow new Error('Malformed def: ' + expr);\r\n\t\t\t}\r\n\t\t\tvar key = defSplit.shift().trim();\r\n\t\t\tvar value, flag, vf = Lexer.split(defSplit.shift().trim(), [' '], opts);\r\n\t\t\tif (vf.length > 1) {\r\n\t\t\t\tif (Def.flags.includes(_last(vf).trim().toLowerCase())) {\r\n\t\t\t\t\tflag = vf.pop().trim().toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvalue = vf.join(' ');\r\n\t\t\treturn new Def(key, value, flag);\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nDef.flags = ['!replace', '!incase',];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Def;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_wrapped,\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport Def from './Def.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst DefBlock = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(entries = []) {\r\n\t\t// We must add them through the door\r\n\t\tthis.entries = [];\r\n\t\tentries.forEach(entry => this.add(entry));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns valid entries.\r\n\t *\r\n\t * @param bool\t\twithDuplicates\r\n\t * @param bool\t\twithOverRidden\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfilter(withDuplicate = false, withOverRidden = false) {\r\n\t\treturn this.entries.filter(entry => (!entry.isDuplicate || withDuplicate) && (!entry.overridden || withOverRidden));\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null, withDuplicate = false, withOverRidden = true) {\r\n\t\treturn this.filter(withDuplicate, withOverRidden).map(def => def.toString(context)).join('; ') + ';';\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds an entry to the list with overRiding resolved.\r\n\t *\r\n\t * @param object\t\tentry\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tadd(newDef) {\r\n\t\tif (!newDef.key || !newDef.value) {\r\n\t\t\tthrow new Error('Def must contain a valid key and value!');\r\n\t\t}\r\n\t\tif (!(newDef instanceof Def)) {\r\n\t\t\tnewDef = new Def(newDef.key, newDef.value, newDef.flag);\r\n\t\t}\r\n\t\tthis.entries.forEach(existingDef => {\r\n\t\t\tif (existingDef.isDuplicate || existingDef.overridden) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar key_a = existingDef.key.toString();\r\n\t\t\tvar value_a = existingDef.value.toString();\r\n\t\t\tvar value_aUnwrapped = _wrapped(value_a, '(', ')') ? _unwrap(value_a, '(', ')') : value_a;\r\n\t\t\tvar key_b = newDef.key.toString();\r\n\t\t\tvar value_b = newDef.value.toString();\r\n\t\t\tvar value_bUnwrapped = _wrapped(value_b, '(', ')') ? _unwrap(value_b, '(', ')') : value_b;\r\n\t\t\tvar incase_a = (existingDef.flag || '').toLowerCase() === '!incase';\r\n\t\t\tvar important_a = (existingDef.flag || '').toLowerCase() === '!replace';\r\n\t\t\tvar incase_b = (newDef.flag || '').toLowerCase() === '!incase';\r\n\t\t\tvar important_b = (newDef.flag || '').toLowerCase() === '!replace';\r\n\t\t\tif (key_a === key_b) {\r\n\t\t\t\tif ((value_a === value_b || value_aUnwrapped === value_bUnwrapped) \r\n\t\t\t\t&& (important_a === important_b || incase_a === incase_b)) {\r\n\t\t\t\t\tnewDef.isDuplicate = true;\r\n\t\t\t\t} else if (important_b || incase_a) {\r\n\t\t\t\t\texistingDef.overridden = true;\r\n\t\t\t\t} else if ((important_a || incase_b)) {\r\n\t\t\t\t\tnewDef.overridden = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.entries.push(newDef);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return DefBlock\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\treturn new DefBlock(\r\n\t\t\tLexer.split(expr, [';'], opts).filter(def => def.trim()).map(def => Def.parse(def.trim()))\r\n\t\t);\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default DefBlock;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport {\r\n\t_copy,\r\n\t_each\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_isArray,\r\n\t_isObject\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_unwrap\r\n} from '@onephrase/commons/src/Str.js';\r\nimport DefBlock from './DefBlock.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst DefSheet = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(block = {}) {\r\n\t\tthis.block = {};\r\n\t\tthis.apply(block);\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null, withDuplicate = false, withOverRidden = true) {\r\n\t\tvar str = [];\r\n\t\t_each(this.block, (type, defBlock) => {\r\n\t\t\tstr.push('@' + type);\r\n\t\t\tstr.push('{' + defBlock.toString(context, withDuplicate, withOverRidden) + '}');\r\n\t\t});\r\n\t\treturn str.join(' ');\r\n\t}\r\n\t \r\n\t/**\r\n\t * Merges a DefSheet instance or a block of entries into the current instance.\r\n\t *\r\n\t * @param array|DefSheet\tdefSheet\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tapply(defSheet) {\r\n\t\tvar block = defSheet;\r\n\t\tif (defSheet instanceof DefSheet) {\r\n\t\t\tblock = defSheet.block;\r\n\t\t} else if (!_isObject(defSheet)) {\r\n\t\t\tthrow new Error('Argument #1 must only be an object or an instance of ./DefSheet!');\r\n\t\t}\r\n\t\t_each(block, (section, defBlock) => {\r\n\t\t\tthis.applyTo(section, defBlock);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * Adds entries to the list of entries for the given type.\r\n\t *\r\n\t * @param string\t\t\tsection\r\n\t * @param array|DefBlock\tdefBlock\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tapplyTo(section, defBlock) {\r\n\t\tvar entries = defBlock;\r\n\t\tif (defBlock instanceof DefBlock) {\r\n\t\t\tentries = defBlock.entries;\r\n\t\t} else if (!_isArray(defBlock)) {\r\n\t\t\tthrow new Error('Argument #1 must only be an array or an instance of ./DefBlock!');\r\n\t\t}\r\n\t\tif (!this.block[section]) {\r\n\t\t\tthis.block[section] = new DefBlock;\r\n\t\t}\r\n\t\tentries.forEach(entry => this.block[section].add(_copy(entry)));\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\tvar splits = Lexer.split(expr, [], opts);\r\n\t\tvar type, expr, defBlock, block = {};\r\n\t\twhile ((type = splits.shift()) && (defBlock = splits.shift())) {\r\n\t\t\tblock[type.trim().toLowerCase().substr(1)] = DefBlock.parse(_unwrap(defBlock.trim(), '{', '}'), opts);\r\n\t\t}\r\n\t\treturn new DefSheet(block);\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default DefSheet;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_isArray,\r\n\t_isString,\r\n\t_isFunction,\r\n\t_isProxy,\r\n\t_getProxyTarget\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_from as _arr_from,\r\n\t_unique\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_even,\r\n\t_each,\r\n\t_copy\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport {\r\n\t_before,\r\n\t_after\r\n} from '@onephrase/commons/src/Str.js';\r\nimport Jsen, {\r\n\tArgumentsInterface,\r\n\tCallInterface,\r\n\tReferenceInterface,\r\n\tArguments,\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport Observable from '@onephrase/observable';\r\nimport Matrix from './Def/Matrix.js';\r\nimport DefSheet from './Def/DefSheet.js';\r\nimport DefBlock from './Def/DefBlock.js';\r\nimport Schema from './Schema.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n push, observe bare class, return proxy if, \r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst ChtmlCore = class extends Observable {\r\n\r\n\t/**\r\n\t * Initializes the new Chtml instance.\r\n\t *\r\n\t * @param document|HTMLElement\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper({}, params);\r\n\t\t// -----------------------------\r\n\t\t// ROOT RESOLUTION:\r\n\t\t// -----------------------------\r\n\t\tthis.root = this.el = el;\r\n\t\tif (el.nodeName === '#document') {\r\n\t\t\tthis.el = el.querySelector('html');\r\n\t\t} else if (!(el instanceof HTMLElement)) {\r\n\t\t\tthrow new Error('Argument #1 must be instanceof of HTMLElement or the document object!');\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// BINDINGS/DIRECTIVES\r\n\t\t// -----------------------------\r\n\t\t// The parsed namespace ($ns)\r\n\t\tthis.$.ns = ChtmlCore.parseNamespace(this.el);\r\n\t\t// The parsed Cascaded Definition Sheet ($defs)\r\n\t\tthis.$.defs = ChtmlCore.parseCascadedDefSheet(this.el);\r\n\t\t// Initialize...\r\n\t\tthis.init();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Executes one-off initialization directives.\r\n\t *\r\n\t * Then executes reactive bindings and keeps them bound.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tinit() {\r\n\t\t// -----------------------\r\n\t\t// Free the instance first...\r\n\t\tthis.free(false);\r\n\t\t// -----------------------\r\n\t\t// One-off init\r\n\t\tthis.getCpsBlock('init', true/*asDirectives*/).forEach(directive => directive.eval(this));\r\n\t\t// -----------------------\r\n\t\t// Reactive bindings\r\n\t\tthis.$.bindingsListeners = [];\r\n\t\t// Apply bindings...\r\n\t\tvar stringifyEach = list => _unique(list.map(expr => _before(_before(expr.toString(), '['), '(')));\r\n\t\tthis.getCpsBlock('bindings', true/*asDirectives*/).forEach(binding => {\r\n\t\t\tif (!this.$.params.observeOnly) {\r\n\t\t\t\tbinding.eval(this, this.jsenGetter());\r\n\t\t\t}\r\n\t\t\t// We'll execute binding on the appriopriate changes\r\n\t\t\tvar listenerObj = this.observe(stringifyEach(binding.meta.vars), (newState, oldState, params) => {\r\n\t\t\t\t// Next eval() should be triggered by only the changes in the vars that participated in this eval()\r\n\t\t\t\tvar evalReturn = binding.eval(this, this.jsenGetter());\r\n\t\t\t\t// If the result of this evaluation is false,\r\n\t\t\t\t// e.stopPropagation will be called and subsequent expressions\r\n\t\t\t\t// will not be evaluated. So we must not allow false to be returned.\r\n\t\t\t\t// All expressions are meant to be evaluated in parallel, independent of each other.\r\n\t\t\t\tif (evalReturn !== false) {\r\n\t\t\t\t\treturn evalReturn;\r\n\t\t\t\t}\r\n\t\t\t}, {diff: this.$.params.diff});\r\n\t\t\tthis.$.bindingsListeners.push(listenerObj);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Frees the instance of either observed bindings\r\n\t * or entire available listeners.\r\n\t *\r\n\t * @param bool\t\t\t\t\tall\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tfree(all = true) {\r\n\t\tif (all) {\r\n\t\t\t// Remove all available listeners\r\n\t\t\tsuper.removeListener();\r\n\t\t} else if (this.$.bindingsListeners) {\r\n\t\t\t// Remove all observed bindings\r\n\t\t\tthis.$.bindingsListeners.forEach(listener => listener.remove());\r\n\t\t\tthis.$.bindingsListeners.splice();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Clones the instance using a serialize/deserialize strategy.\r\n\t *\r\n\t * @param bool\t \t\tcleanCopy\r\n\t *\r\n\t * @return ChtmlInterface\r\n\t */\r\n\tclone(cleanCopy = true) {\r\n\t\tif (!_isFunction(this.$.params.componentCallback)) {\r\n\t\t\tthrow new Error('The params.componentCallback function is required!');\r\n\t\t}\r\n\t\tvar el = this.el.cloneNode(true);\r\n\t\t// -------------------------------\r\n\t\t// We'll remove all aprsable components of the element\r\n\t\t// as we already have the most accurate available\r\n\t\t// -------------------------------\r\n\t\tvar attrCache = {};\r\n\t\t[ChtmlCore.attributeMap.related, ChtmlCore.attributeMap.bindings].forEach(type => {\r\n\t\t\tvar attrValue;\r\n\t\t\tif (attrValue = el.getAttribute(type)) {\r\n\t\t\t\tattrCache.type = attrValue;\r\n\t\t\t\tel.removeAttribute(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar dataBlockScript;\r\n\t\tif (dataBlockScript = _arr_from(el.children).filter(node => node.matches(ChtmlCore.elementMap.defsheet))[0]) {\r\n\t\t\tdataBlockScript.remove();\r\n\t\t}\r\n\t\t// -------------------------------\r\n\t\t// Instantiate now...\r\n\t\t// -------------------------------\r\n\t\tvar instance = this.$.params.componentCallback(el, this.$.params, false/*resolveInheritance*/);\r\n\t\tvar _instance = _isProxy(instance) ? _getProxyTarget(instance) : instance;\r\n\t\t// Serialize/deserialize definitions\r\n\t\t_instance.$defs = DefSheet.parse(this.$.defs.toString(null/*context*/, !cleanCopy/*withDuplicate*/, true/*withOverRidden*/));\r\n\t\t// -------------------------------\r\n\t\t// Restore parsable components of the element just for the records\r\n\t\t// -------------------------------\r\n\t\t_each(attrCache, (type, attrValue) => {\r\n\t\t\tel.setAttribute(type, attrValue);\r\n\t\t});\r\n\t\tif (dataBlockScript) {\r\n\t\t\tel.prepend(dataBlockScript);\r\n\t\t}\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Evalutes the bindings for the component;\r\n\t * caches the result for subsequent calls.\r\n\t *\r\n\t * @param string\t\tkey\r\n\t * @param bool\t\t\tasDirectives\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetCpsBlock(key, asDirectives = false) {\r\n\t\tvar cpsBlockDefs = this.$.defs.block[key] ? this.$.defs.block[key].filter() : [];\r\n\t\tif (asDirectives) {\r\n\t\t\tvar directives = [];\r\n\t\t\tcpsBlockDefs.forEach(def => {\r\n\t\t\t\tvar argsExpr = (this.$.params.chainableDirectives === false || !def.value.trim().startsWith('(') ? [def.value] : Lexer.split(def.value, ['.']))\r\n\t\t\t\t\t.map(expr => Jsen.parse(expr, [Arguments], {assert:false}) || Jsen.parse(expr));\r\n\t\t\t\tif (argsExpr.length !== argsExpr.filter(a => a).length) {\r\n\t\t\t\t\tthis.error('Malformed argument in the CPS expression: ' + def.toString());\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar directive, _directive = def.key + (argsExpr.length > 1 || argsExpr[0] instanceof ArgumentsInterface ? argsExpr.join('.') : '(' + argsExpr[0].toString() + ')');\r\n\t\t\t\tif (!(directive = Jsen.parse(_directive, null, {explain: this.$.params.explainJsen}))) {\r\n\t\t\t\t\tthis.error('Malformed CPS expression: ' + def.toString());\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdirectives.push(directive);\r\n\t\t\t});\r\n\t\t\treturn directives;\r\n\t\t}\r\n\t\treturn cpsBlockDefs;\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to resolve a node as related node.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|ChtmlInterface\r\n\t */\r\n\tgetRelatedNode(requestNodeName) {\r\n\t\tvar computeQuery, node, vars = [];\r\n\t\tif (!this.computedRelated) {\r\n\t\t\tthis.computedRelated = {};\r\n\t\t\tthis.getCpsBlock('related', false/*asDirectives*/).forEach(entry => {\r\n\t\t\t\tthis.computedRelated[entry.key] = Jsen.parse(entry.value);\r\n\t\t\t});\r\n\t\t}\r\n\t\tif ((computeQuery = this.computedRelated[requestNodeName]) \r\n\t\t&& (node = computeQuery.eval(this, this.jsenGetter(vars)))) {\r\n\t\t\tif (_isFunction(node)) {\r\n\t\t\t\tnode = node(this.el, requestNodeName);\r\n\t\t\t\tif (!_isString(node) && !(node instanceof HTMLElement)) {\r\n\t\t\t\t\tthrow new Error('The callback for node \"' + requestNodeName + '\" returned an invalid type.');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (_isString(node)) {\r\n\t\t\t\t// Markup or plain selector string....\r\n\t\t\t\tnode = ChtmlCore.toElement(node);\r\n\t\t\t}\r\n\t\t\tif (!(node instanceof HTMLElement)) {\r\n\t\t\t\tthrow new Error('\"' + requestNodeName + '\" could not be resolved to a valid node instance.');\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from explicit model.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tgetExplicitNode(requestNodeName) {\r\n\t\t// If given a rolecase, we can perform a query if we understand the semantics.\r\n\t\tif ((this.$.roles && this.$.roles.length)\r\n\t\t|| (this.$.roles = (this.el.getAttribute(ChtmlCore.attributeMap.superrole) || '').replace('  ', ' ').split(' ')).length) {\r\n\t\t\tvar roles = this.$.params.rolecase ? [this.$.params.rolecase] : this.$.roles;\r\n\t\t\t// Find matches...\r\n\t\t\treturn roles.reduce((matchedNode, role) => {\r\n\t\t\t\tif (!matchedNode) {\r\n\t\t\t\t\tvar closestSuperSelector = '[' + ChtmlCore.attributeMap.superrole + '~=\"' + role + '\"]';\r\n\t\t\t\t\tvar nodeSelector = '[' + ChtmlCore.attributeMap.subrole + '~=\"' + role + '-' + requestNodeName + '\"]';\r\n\t\t\t\t\tvar closestSuper, _matchedNode;\r\n\t\t\t\t\tif ((_matchedNode = (this.el.shadowRoot || this.el).querySelector(nodeSelector))\r\n\t\t\t\t\t// If this.el has a shadowRoot, we don't expect _matchedNode to be able to find is superRole element.\r\n\t\t\t\t\t// If it finds one, then its not for the curren superRole element.\r\n\t\t\t\t\t&& ((this.el.shadowRoot && !(_matchedNode.parentNode.closest && _matchedNode.parentNode.closest(closestSuperSelector)))\r\n\t\t\t\t\t// _matchedNode must find this.el as its superRole element to qualify.\r\n\t\t\t\t\t\t|| (!this.el.shadowRoot && _matchedNode.parentNode && (closestSuper = _matchedNode.parentNode.closest(closestSuperSelector)) && closestSuper.isSameNode(this.el))\r\n\t\t\t\t\t)) {\r\n\t\t\t\t\t\tmatchedNode = _matchedNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn matchedNode;\r\n\t\t\t}, null);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from implicit model.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|array\r\n\t */\r\n\tgetImplicitNode(requestNodeName) {\r\n\t\tif (requestNodeName.match(/[^a-zA-Z0-9\\-]/)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Use schema...\r\n\t\tvar nodeSchema, nodeSelector = [];\r\n\t\tvar tries = [];\r\n\t\tif (ChtmlCore.schema.aria[requestNodeName]) {\r\n\t\t\ttries.push({\r\n\t\t\t\tschema: ChtmlCore.schema.aria[requestNodeName],\r\n\t\t\t\tselector: ['[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\ttries.push({\r\n\t\t\t\tschema: ChtmlCore.schema.std[requestNodeName] || ChtmlCore.schema.aria[requestNodeName],\r\n\t\t\t\tselector: [requestNodeName, '[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t}\r\n\t\t_each(ChtmlCore.schema.std, (tagname, schema) => {\r\n\t\t\tif (schema.implicitRole === requestNodeName) {\r\n\t\t\t\ttries.push({\r\n\t\t\t\t\tschema: schema,\r\n\t\t\t\t\tselector: [tagname],\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar matches = null;\r\n\t\ttries.forEach(trie => {\r\n\t\t\t(this.el.shadowRoot || this.el).querySelectorAll(trie.selector.join(',')).forEach(node => {\r\n\t\t\t\tif (ChtmlCore.schema.assertNodeBelongsInScopeAs(this.el, node, trie.schema)) {\r\n\t\t\t\t\tif (trie.schema && trie.schema.singleton) {\r\n\t\t\t\t\t\tmatches = node;\r\n\t\t\t\t\t} else if (!matches || _isArray(matches)) {\r\n\t\t\t\t\t\tmatches = matches || [];\r\n\t\t\t\t\t\tmatches.push(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn matches;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Makes a node object following the nodeCallback rules\r\n\t * for the instance.\r\n\t *\r\n\t * @param string|int\t nodeName\r\n\t * @param mixed\t\t\t node\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tcreateNode(nodeName, node) {\r\n\t\tvar _node = node;\r\n\t\tif (this.$.params.drilldown) {\r\n\t\t\tif (node === this.root || node === this.el) {\r\n\t\t\t\tnode = this;\r\n\t\t\t} else if (node) {\r\n\t\t\t\tif (!_isFunction(this.$.params.componentCallback)) {\r\n\t\t\t\t\tthrow new Error('The params.componentCallback function is required!');\r\n\t\t\t\t}\r\n\t\t\t\tvar params = _copy(this.$.params);\r\n\t\t\t\tparams.alias = nodeName;\r\n\t\t\t\tnode = _isArray(node) \r\n\t\t\t\t\t? node.map(node => this.$.params.componentCallback(node, params, true/*resolveInheritance*/)) \r\n\t\t\t\t\t: this.$.params.componentCallback(node, params, true/*resolveInheritance*/);\r\n\t\t\t}\r\n\t\t} else if (_isFunction(this.$.params.nodeCallback)) {\r\n\t\t\tnode = _isArray(node) \r\n\t\t\t\t? node.map(node => this.$.params.nodeCallback(node)) \r\n\t\t\t\t: this.$.params.nodeCallback(node);\r\n\t\t}\r\n\t\tthis.set(nodeName, node);\r\n\t\tif (_node && _node !== this.root && _node !== this.el && !_isArray(_node)) {\r\n\t\t\tChtmlCore.disconnectedCallback(_node, () => {\r\n\t\t\t\tthis.del(nodeName);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn node;\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds a node by name; caches result.\r\n\t *\r\n\t * @param string \t\tnodeName\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(nodeName) {\r\n\t\t// ----------------------\r\n\t\tvar asOwnMethod = this.asOwnMethod(nodeName);\r\n\t\tif (asOwnMethod) {\r\n\t\t\treturn asOwnMethod;\r\n\t\t}\r\n\t\t// ----------------------\r\n\t\tvar node;\r\n\t\tif (nodeName === '_' || nodeName === '__') {\r\n\t\t\treturn super.get(nodeName);\r\n\t\t}\r\n\t\tif ((nodeName === 'root' && (node = this.root)) \r\n\t\t|| (nodeName === 'el' && (node = this.el))) {\r\n\t\t\treturn _isFunction(this.$.params.nodeCallback) \r\n\t\t\t\t? this.$.params.nodeCallback(node) \r\n\t\t\t\t: node;\r\n\t\t}\r\n\t\tif (!(nodeName in this.$.state)) {\r\n\t\t\tif ((node = this.getRelatedNode(nodeName))\r\n\t\t\t|| (!this.$.params.implicitOnly && (node = this.getExplicitNode(nodeName)))\r\n\t\t\t|| (!this.$.params.explicitOnly && (node = this.getImplicitNode(nodeName)))) {\r\n\t\t\t\tthis.createNode(nodeName, node);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.$.state[nodeName];\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------\r\n\t * UTILITY METHODS\r\n\t * -------------------\r\n\t */\r\n\t\r\n\t/**\r\n\t * Parses an element's CHTML namespace.\r\n\t * This explains how an element's namespace is used in CHTML.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\t\tel\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parseNamespace(el) {\r\n\t\tvar namespaceParse = {roadmap: el.getAttribute(ChtmlCore.attributeMap.ns)};\r\n\t\tif (namespaceParse.roadmap) {\r\n\t\t\tnamespaceParse.namespace = _before(namespaceParse.roadmap, '//');\r\n\t\t\tnamespaceParse.subnamespace = _after(namespaceParse.roadmap, '//');\r\n\t\t\t// In case this is the /// spot...\r\n\t\t\tif (namespaceParse.subnamespace.startsWith('/')) {\r\n\t\t\t\tnamespaceParse.subnamespace = _after(namespaceParse.subnamespace, '/');\r\n\t\t\t}\r\n\t\t\tif (namespaceParse.subnamespace.endsWith('//') && namespaceParse.subnamespace.indexOf('///') === -1) {\r\n\t\t\t\tnamespaceParse.subnamespace = namespaceParse.subnamespace + namespaceParse.namespace + '//';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn namespaceParse;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an element's CHTML definitions (related, bindings)\r\n\t * both from attributes and from an embedded script data block.\r\n\t *\r\n\t * Where both attributes and data block are set, definitions in attributes inherit from those in data block.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\t\tel\r\n\t *\r\n\t * @return DefSheet\r\n\t */\r\n\tstatic parseCascadedDefSheet(el) {\r\n\t\tvar dataBlockScript, defsheet;\r\n\t\tif (!(dataBlockScript = _arr_from(el.children).filter(node => node.matches(ChtmlCore.elementMap.defsheet))[0])\r\n\t\t|| !(defsheet = DefSheet.parse((dataBlockScript.textContent || '').trim()))) {\r\n\t\t\tdefsheet = new DefSheet;\r\n\t\t}\r\n\t\tvar attr, defBlock;\r\n\t\t['related', 'bindings',].forEach(type => {\r\n\t\t\tif ((attr = el.getAttribute(ChtmlCore.attributeMap[type])) && (defBlock = DefBlock.parse(attr))) {\r\n\t\t\t\tdefsheet.applyTo(type, defBlock);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn defsheet;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Composes a component from a super component.\r\n\t *\r\n\t * All definitions (related, bindings) will be inherited.\r\n\t * If the idea is to import, the super component's element will be returned,\r\n\t * (On import, nodes in component (as defined, if) will be uploaded into slots in the super component.)\r\n\t *\r\n\t * @param HTMLElement\t\t\t\telTo\r\n\t * @param HTMLElement\t\t\t\telFrom\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic recompose(elTo, elFrom) {\r\n\t\tif (elTo.matches(ChtmlCore.elementMap.import)) {\r\n\t\t\telFrom = elFrom.cloneNode(true);\r\n\t\t\tvar elToNs = elTo.getAttribute(ChtmlCore.attributeMap.ns);\r\n\t\t\tvar elFromNs = elFrom.getAttribute(ChtmlCore.attributeMap.ns);\r\n\t\t\tvar elFromRoles = (elFrom.getAttribute(ChtmlCore.attributeMap.superrole) || '').split(' ').map(r => r.trim());\r\n\t\t\t// -------------------------\r\n\t\t\t// So we concat() the role attribute\r\n\t\t\t// -------------------------\r\n\t\t\telFrom.setAttribute(ChtmlCore.attributeMap.ns, elToNs);\r\n\t\t\t// We will prepend defs from the elTo into elFrom\r\n\t\t\tChtmlCore.recomposeDefs(elFrom, elTo, 'append');\r\n\t\t\t// -------------------------\r\n\t\t\t// Upload nodes into elFrom just the way slots work in Web Compoonents\r\n\t\t\t// -------------------------\r\n\t\t\t_arr_from((elTo.shadowRoot || elTo).children).forEach((replacementNode, i) => {\r\n\t\t\t\tif (replacementNode.matches(ChtmlCore.elementMap.defsheet)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\treplacementNode = replacementNode.cloneNode(true);\r\n\t\t\t\tvar applicableContextRoles = [], applicableReplacementNodeRoles = [];\r\n\t\t\t\tvar replacementNodeRoles = (replacementNode.getAttribute(ChtmlCore.attributeMap.subrole) || '').split(' ').map(r => r.trim());\r\n\t\t\t\treplacementNodeRoles.forEach(replacementNodeRole => {\r\n\t\t\t\t\tvar _applicableContextRoles = elFromRoles.filter(contextRole => replacementNodeRole.startsWith(contextRole + '-'));\r\n\t\t\t\t\tif (_applicableContextRoles.length) {\r\n\t\t\t\t\t\tapplicableContextRoles.push(_applicableContextRoles[0]);\r\n\t\t\t\t\t\tapplicableReplacementNodeRoles.push(replacementNodeRole);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (applicableContextRoles.length) {\r\n\t\t\t\t\tvar slotNodes;\r\n\t\t\t\t\tvar contextSelector = applicableContextRoles.map(contextRole => '[' + ChtmlCore.attributeMap.superrole + '~=\"' + contextRole + '\"]');\r\n\t\t\t\t\tvar slotNodeSelector = applicableReplacementNodeRoles.map(replacementNodeRole => '[' + ChtmlCore.attributeMap.subrole + '~=\"' + replacementNodeRole + '\"]');\r\n\t\t\t\t\tif ((elFrom.shadowRoot && (slotNodes = elFrom.shadowRoot.querySelectorAll(slotNodeSelector)))\r\n\t\t\t\t\t|| ((slotNodes = elFrom.querySelectorAll(slotNodeSelector)).length === 1 && slotNodes[0].closest(contextSelector) === elFrom)) {\r\n\t\t\t\t\t\t// We will prepend defs from the slot node into replacement node\r\n\t\t\t\t\t\tChtmlCore.recomposeDefs(replacementNode, slotNodes[0], 'prepend');\r\n\t\t\t\t\t\t// Port to target...\r\n\t\t\t\t\t\tslotNodes[0].replaceWith(replacementNode);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.error('Composition Error: Node #' + i + ' (at ' + elToNs + ') must match exactly one targetNode in ' + elFromNs + '! (' + slotNodes.length + ' matched)');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\telFrom.append(replacementNode);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn elFrom;\r\n\t\t}\r\n\t\t// We will append defs from the elFrom into elTo\r\n\t\tChtmlCore.recomposeDefs(elTo, elFrom, 'prepend');\r\n\t\treturn elTo;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Composes definitions (related, bindings) from elFrom into elTo.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\telTo\r\n\t * @param HTMLElement\t\t\t\telFrom\r\n\t * @param string\t\t\t\t\tappendOrPrepend\r\n\t * @param array\t\t\t\t\t\tnorecompose\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic recomposeDefs(elTo, elFrom, appendOrPrepend, norecompose = []) {\r\n\t\tnorecompose = norecompose.concat([ChtmlCore.attributeMap.ns, ...ChtmlCore.attributeMap.nocompose]);\r\n\t\tif (elTo.hasAttribute('norecompose')) {\r\n\t\t\tnorecompose = norecompose.concat((elTo.getAttribute('norecompose') || '*').split(' ').map(val => val.trim()));\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// Custom Composition...\r\n\t\t// ----------------------------\r\n\t\tif (_isFunction(ChtmlCore.recomposeCallback)) {\r\n\t\t\tvar disposition = ChtmlCore.recomposeCallback(elTo, elFrom, appendOrPrepend, norecompose);\r\n\t\t\tif (disposition === false) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (_isString(disposition) || _isArray(disposition)) {\r\n\t\t\t\tnorecompose = norecompose.concat(disposition);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// Merge list attributes...\r\n\t\t// ----------------------------\r\n\t\t_unique([ChtmlCore.attributeMap.superrole, ChtmlCore.attributeMap.subrole, 'role', 'class']).forEach(type => {\r\n\t\t\tvar b_attr, a_attr;\r\n\t\t\tif (!norecompose.includes(type) && !norecompose.includes('*') && (b_attr = elFrom.getAttribute(type))) {\r\n\t\t\t\tif (a_attr = elTo.getAttribute(type)) {\r\n\t\t\t\t\tvar jointList = appendOrPrepend === 'prepend' ? [b_attr, a_attr] : [a_attr, b_attr];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar jointList = [b_attr];\r\n\t\t\t\t}\r\n\t\t\t\telTo.setAttribute(type, _unique(jointList.join(' ').split(' ').map(r => r.trim())).join(' '));\r\n\t\t\t\tnorecompose.push(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\t// ----------------------------\r\n\t\t// Merge definition attributes...\r\n\t\t// ----------------------------\r\n\t\t[ChtmlCore.attributeMap.related, ChtmlCore.attributeMap.bindings, 'style'].forEach(type => {\r\n\t\t\tvar b_attr, a_attr;\r\n\t\t\tif (!norecompose.includes(type) && !norecompose.includes('*') && (b_attr = elFrom.getAttribute(type))) {\r\n\t\t\t\tif (a_attr = elTo.getAttribute(type)) {\r\n\t\t\t\t\tvar jointDefs = appendOrPrepend === 'prepend' ? [b_attr, a_attr] : [a_attr, b_attr];\r\n\t\t\t\t\tif (!jointDefs[0].trim().endsWith(';')) {\r\n\t\t\t\t\t\tjointDefs[0] = jointDefs[0] + ';';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar jointDefs = [b_attr];\r\n\t\t\t\t}\r\n\t\t\t\telTo.setAttribute(type, jointDefs.join(' '));\r\n\t\t\t\tnorecompose.push(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\t// ----------------------------\r\n\t\t// Port all other attributes...\r\n\t\t// ----------------------------\r\n\t\tfor (var i = 0; i < elFrom.attributes.length; i ++) {\r\n\t\t\tvar attr = elFrom.attributes[i];\r\n\t\t\tif (!norecompose.includes(attr.name) && !norecompose.includes('*') && !elTo.hasAttribute(attr.name)) {\r\n\t\t\t\telTo.setAttribute(attr.name, attr.value);\r\n\t\t\t\tnorecompose.push(attr.name);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// For data blocks...\r\n\t\t// ----------------------------\r\n\t\tif (!norecompose.includes('@cps') && !norecompose.includes('*')) {\r\n\t\t\tvar elToDefs = _arr_from((elTo.shadowRoot || elTo).children)\r\n\t\t\t\t.filter(node => node.matches(ChtmlCore.elementMap.defsheet));\r\n\t\t\tvar elFromDefs = _arr_from((elFrom.shadowRoot || elFrom).children)\r\n\t\t\t\t.filter(node => node.matches(ChtmlCore.elementMap.defsheet));\r\n\t\t\tif (elFromDefs.length) {\r\n\t\t\t\tif (elToDefs.length) {\r\n\t\t\t\t\telToDefs[0][appendOrPrepend](elFromDefs[0].textContent);\r\n\t\t\t\t} else {\r\n\t\t\t\t\telTo.prepend(elFromDefs[0].cloneNode(true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves markup or selector string to a DOM element.\r\n\t *\r\n\t * @param sting\t\t\t\t\t\tinput\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic toElement(input) {\r\n\t\tif (ChtmlCore.ctxt.document) {\r\n\t\t\tvar el;\r\n\t\t\tif (input.trim().startsWith('<')) {\r\n\t\t\t\t// Create a node from markup\r\n\t\t\t\tvar temp = ChtmlCore.ctxt.document.createElement('div');\r\n\t\t\t\ttemp.innerHtml = input;\r\n\t\t\t\tel = temp.firstChild;\r\n\t\t\t} else {\r\n\t\t\t\tel = ChtmlCore.ctxt.document.querySelector(input);\r\n\t\t\t}\r\n\t\t\treturn el;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves markup or selector string to a DOM element.\r\n\t *\r\n\t * @param sting\t\t\t\t\t\tinput\r\n\t * @param function\t\t\t\t\tcallback\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic disconnectedCallback(el, callback) {\r\n\t\tif (el.parentNode) {\r\n\t\t\tvar called = false;\r\n\t\t\tvar observer = new MutationObserver(mutations => {\r\n\t\t\t\tmutations.forEach(m => {\r\n\t\t\t\t\tif (!called && _arr_from(m.removedNodes).includes(el)) {\r\n\t\t\t\t\t\tcalled = true;\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tobserver.observe(el.parentNode, {childList:true});\r\n\t\t\tChtmlCore.disconnectedCallback(el.parentNode, () => {\r\n\t\t\t\tif (!called) {\r\n\t\t\t\t\tcalled = true;\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.ctxt = {};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.schema = Schema;\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.elementMap = {\r\n\tdefsheet: 'script[type=\"application/chtml-cps\"]',\r\n\tbundle: 'chtml-bundle',\r\n\timport: 'chtml-import',\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.attributeMap = {\r\n\tns: 'chtml-ns',\r\n\trelated: 'chtml-related',\r\n\tbindings: 'chtml-bindings',\r\n\tsuperrole: 'chtml-role',\r\n\tsubrole: 'chtml-role',\r\n\tnocompose: ['nocompose', 'shadow',],\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default ChtmlCore;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_mixin,\r\n\t_isString,\r\n\t_isNumeric,\r\n\t_isEmpty,\r\n\t_isNumber,\r\n\t_isFunction,\r\n\t_isObservable,\r\n\t_isProxy,\r\n\t_isUndefined,\r\n\t_getProxyTarget\r\n} from '@onephrase/commons/src/Js.js';\r\nimport {\r\n\t_all,\r\n\t_following\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport {\r\n\t_before,\r\n\t_beforeLast\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {\r\n\t_closest\r\n} from '@onephrase/commons/src/Num.js';\r\nimport {\r\n\t_inherit\r\n} from '@onephrase/commons/src/Obj.js';\r\nimport ChtmlCore from './ChtmlCore.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n push, observe bare class, return proxy if, \r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Chtml = class extends ChtmlCore {\r\n\r\n\t/**\r\n\t * Constructs a new Chtml and optionally returns a proxy wrapper.\r\n\t *\r\n\t * @param document|HTMLElement\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return new Proxy\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper(el, _inherit({}, params, Chtml.params));\r\n\t\t// -----------------------------\r\n\t\t// OBSERVABILITY\r\n\t\t// -----------------------------\r\n\t\t// Bind populable context\r\n\t\tthis.observe(this.$.params.dataKey, (context, _context) => {\r\n\t\t\tif (this.$.ns.subnamespace && !_isString(context) && !_isNumber(context) && !_isUndefined(context)) {\r\n\t\t\t\t// Initial Sync...\r\n\t\t\t\tthis.populate(context, this.$.ns.subnamespace, this.$.params.itemCallback);\r\n\t\t\t\t// Reactive Sync?\r\n\t\t\t\tif (_isObservable(context)) {\r\n\t\t\t\t\tcontext.observe(changes => {\r\n\t\t\t\t\t\tthis.populate(context, this.$.ns.subnamespace, this.$.params.itemCallback, Object.keys(changes));\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a (reactive) context object or logical object to the instance.\r\n\t *\r\n\t * @param object \t\tcontext\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tbind(context) {\r\n\t\tthis.set(this.$.params.dataKey, context);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a (reactive) list context to the instance.\r\n\t * Childnodes will be automatically created/removed per key.\r\n\t *\r\n\t * @param array \t\tlistContext\r\n\t * @param string \t\tsubnamespace\r\n\t * @param function \t\titemCallback\r\n\t * @param array \t\tonlyKeys\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tpopulate(listContext, subnamespace, itemCallback = null, onlyKeys = []) {\r\n\t\tif (_isObservable(listContext) && !_isProxy(listContext)) {\r\n\t\t\tlistContext = listContext.proxy();\r\n\t\t}\r\n\t\t(arguments.length > 3 ? onlyKeys : Object.keys(listContext)).forEach(k => {\r\n\t\t\tk = _isNumeric(k) ? parseInt(k) : k;\r\n\t\t\tvar item = this.has(k) ? this.get(k) : null;\r\n\t\t\tif (!_isUndefined(listContext[k])) {\r\n\t\t\t\tvar isNewItem = false;\r\n\t\t\t\tif (!item) {\r\n\t\t\t\t\tvar itemNamespaceArray = subnamespace.split('//');\r\n\t\t\t\t\t// Create a namespace hash...\r\n\t\t\t\t\titemNamespaceArray[0] += '/' + k;\r\n\t\t\t\t\tvar itemEl = Chtml.import(itemNamespaceArray.join('//'));\r\n\t\t\t\t\tif (itemEl) {\r\n\t\t\t\t\t\tvar following = _following(Object.keys(listContext), k + ''/*numeric k needs this*/, true/*length*/)\r\n\t\t\t\t\t\t\t.reduce((closest, _k) => closest || (this.has(_k) ? this.get(_k) : null), null);\r\n\t\t\t\t\t\tif (following) {\r\n\t\t\t\t\t\t\tfollowing.el.before(itemEl);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.el.append(itemEl);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titem = this.createNode(k, itemEl);\r\n\t\t\t\t\t\tisNewItem = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (item) {\r\n\t\t\t\t\tif (_isFunction(itemCallback)) {\r\n\t\t\t\t\t\titemCallback(item, listContext[k], k, isNewItem);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.bind(listContext[k]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (item) {\r\n\t\t\t\tif (_isFunction(itemCallback)) {\r\n\t\t\t\t\tvar unbindReturn = itemCallback(item, false, k);\r\n\t\t\t\t\tif (('Promise' in ChtmlCore.ctxt) && unbindReturn instanceof ChtmlCore.ctxt.Promise) {\r\n\t\t\t\t\t\tunbindReturn.then(() => {\r\n\t\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t\t}).catch(() => {\r\n\t\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.free();\r\n\t\t\t\t\titem.el.remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------\r\n\t * INSTANCE-RELATED METHODS\r\n\t * -------------------\r\n\t */\r\n\r\n\t/**\r\n\t * Creates a Chtml over a root resolved from definition or markup string.\r\n\t *\r\n\t * @param string|document|HTMLElement\tinput\r\n\t * @param object\t\t\t\t\t\tparams\r\n\t * @param bool\t\t\t\t\t\t\tresolveInheritance\r\n\t * @param object\t\t\t\t\t\tStatic\r\n\t *\r\n\t * @return Chtml\r\n\t */\r\n\tstatic from(input, params = {}, resolveInheritance = true, Static = Chtml) {\r\n\t\t// -----------------------------\r\n\t\t// Resolve element from input\r\n\t\t// -----------------------------\r\n\t\tvar el = input;\r\n\t\tif (_isString(input) && !input.trim().startsWith('<') && input.indexOf('/') !== -1) {\r\n\t\t\tif (!ChtmlCore.bundles || !(el = Chtml.import(_before(input, '//')))) {\r\n\t\t\t\tthrow new Error('No element found on the namespace \"' + input + '\"!');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (_isString(input)) {\r\n\t\t\t\tif (!(el = ChtmlCore.toElement(input))) {\r\n\t\t\t\t\tthrow new Error('Could not resolve the string \"' +input + '\" to an element!');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (resolveInheritance && ChtmlCore.bundles) {\r\n\t\t\t\tvar ns, superNs, superEl, isImport = el.matches(ChtmlCore.elementMap.import);\r\n\t\t\t\tif ((ns = _before(el.getAttribute(ChtmlCore.attributeMap.ns) || '', '//'))\r\n\t\t\t\t// The entire namespace is used for elements of type import.\r\n\t\t\t\t// The supernamespace is used for normal elements\r\n\t\t\t\t&& ((isImport && (superNs = ns)) || (superNs = _beforeLast(ns, '/')) && superNs.indexOf('/') > -1)\r\n\t\t\t\t&& (superEl = Chtml.import(superNs))) {\r\n\t\t\t\t\tvar _el = el;\r\n\t\t\t\t\tel = ChtmlCore.recompose(el, superEl);\r\n\t\t\t\t\tif (isImport) {\r\n\t\t\t\t\t\t_el.replaceWith(el);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (ns) {\r\n\t\t\t\t\tconsole.warn('Namespace resolution failed: ' + ns);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn new Static(el, params);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Imports a module from bundles.\r\n\t *\r\n\t * @param string\t\t\t\t\t\tnamespace\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic import(namespace) {\r\n\t\treturn ChtmlCore.bundles.find(namespace);\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtml.params = {\r\n\tdiff: true,\r\n\tdataKey: '$',\r\n\tdrilldown: false,\r\n\tnodeCallback: null,\r\n\tcomponentCallback: Chtml.from,\r\n\tobserveOnly: false,\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Chtml;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\t_before\r\n} from '@onephrase/commons/src/Str.js';\r\nimport {  \r\n\t_from as _arr_from\r\n} from '@onephrase/commons/src/Arr.js';\r\nimport Schema from './Schema.js';\r\nimport Matrix from './Def/Matrix.js';\r\nimport ChtmlCore from './ChtmlCore.js';\r\nimport Chtml from './Chtml.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The client-build entry\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Configure CHTM with\r\n * a global document.\r\n */\r\nChtmlCore.ctxt = window;\r\n\r\n/**\r\n * Create a \"ready\" construct that\r\n * init-related functionality can leverage.\r\n */\r\nvar contentLoadedPromise = new Promise(resolve => {\r\n\tif (document.readyState === 'complete') {\r\n\t\tresolve(); return;\r\n\t}\r\n\tdocument.addEventListener('DOMContentLoaded', resolve, false);\r\n\twindow.addEventListener('load', resolve, false);\r\n});\r\n// ------------------------------------\r\nChtmlCore.ready = (callback, waitForBundles = true) => {\r\n\tcontentLoadedPromise.then(() => {\r\n\t\tif (!waitForBundles) {\r\n\t\t\tcallback(); return;\r\n\t\t}\r\n\t\tChtmlCore.initObj.loadingBundlesPromise.then(callback);\r\n\t});\r\n};\r\n\r\n/**\r\n * Create an initialization object that all\r\n * init-related functionality can build on.\r\n */\r\ncontentLoadedPromise.then(() => {\r\n\t// ------------------------------------\r\n\tChtmlCore.initObj = (() => {\r\n\t\tvar bundles = _arr_from(document.querySelectorAll('template[is=\"' + ChtmlCore.elementMap.bundle + '\"]')).reverse();\r\n\t\tvar remoteBundles = bundles.filter(b => b.hasAttribute('src') && !b.content.children.length);\r\n\t\tvar loadingBundles = remoteBundles.map(b => new Promise(resolve => {\r\n\t\t\tb.addEventListener('bundleloadsuccess', resolve);\r\n\t\t\tb.addEventListener('bundleloaderror', resolve);\r\n\t\t}));\r\n\t\tvar loadingBundlesPromise = Promise.all(loadingBundles).then(() => {\r\n\t\t\tloadingBundles.splice(0);\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tcontentLoadedPromise,\r\n\t\t\tloadingBundlesPromise,\r\n\t\t\tbundles,\r\n\t\t\tremoteBundles,\r\n\t\t\tloadingBundles\r\n\t\t};\r\n\t})();\r\n\t// ------------------------------------\r\n\t// Configure CHTM with bundle sources.\r\n\t// ------------------------------------\r\n\tvar warnedEarlyBundleAccess;\r\n\tvar anticyclicBundlesQuery = [];\r\n\tChtmlCore.bundles = new Matrix(ChtmlCore.initObj.bundles/*sources*/, []/*namespace*/, (bundle, namespace, superEl, bundleIndex) => {\r\n\t\tif (ChtmlCore.initObj.loadingBundles.length && !warnedEarlyBundleAccess) {\r\n\t\t\twarnedEarlyBundleAccess = true;\r\n\t\t\tconsole.warn('Remote bundles are still loading at this time! You should probabbly wrap bundle-dependent code within Chtml.ready(callback[, true/*waitForBundles*/]).');\r\n\t\t}\r\n\t\tvar _namespace = namespace.join('/');\r\n\t\tif (anticyclicBundlesQuery.includes(_namespace)) {\r\n\t\t\treturn ChtmlCore.bundles.find(namespace.slice(0, -1).join('/'));\r\n\t\t}\r\n\t\tanticyclicBundlesQuery.push(_namespace);\r\n\t\tvar el = bundle.content.querySelector('[' + ChtmlCore.attributeMap.ns + '=\"' + _namespace + '\"]');\r\n\t\tif (el && superEl) {\r\n\t\t\ttry {\r\n\t\t\t\tvar norecompose = [];\r\n\t\t\t\tif (bundle.hasAttribute('norecompose')) {\r\n\t\t\t\t\tnorecompose = (bundle.getAttribute('norecompose') || '*').split(' ').map(val => val.trim());\r\n\t\t\t\t}\r\n\t\t\t\tel = ChtmlCore.recompose(el, superEl, 'prepend', norecompose);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error('[Inheritance error at source #' + bundleIndex + ']: ' + e.message);\r\n\t\t\t}\r\n\t\t\tanticyclicBundlesQuery.pop();\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\tanticyclicBundlesQuery.pop();\r\n\t\treturn el ? el.cloneNode(true) \r\n\t\t\t: (superEl ? superEl.cloneNode(true) : null);\r\n\t}/*getter*/);\r\n});\r\n\t\t\t\r\n/**\r\n * Define the customized built-in template element\r\n * that supports remote content.\r\n */\r\ncustomElements.define(ChtmlCore.elementMap.bundle, class extends HTMLTemplateElement {\r\n\r\n\t/**\r\n\t * This handles both triggers remote loading\r\n\t * when so defined.\r\n\t *\r\n\t * @param string\tname\r\n\t * @param string\toldValue\r\n\t * @param string\tnewValue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tattributeChangedCallback(name, oldValue, newValue) {\r\n\t\tif (newValue) {\r\n\t\t\tthis.load();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempt to load remote content if so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tload() {\r\n\t\tvar src = this.getAttribute('src');\r\n\t\tif (src && this.content.children.length) {\r\n\t\t\tconsole.warn('A CHTML bundle must define only either a remote content or local content! Bundle ignored.');\r\n\t\t} else if (src) {\r\n\t\t\tfetch(src).then(response => {\r\n\t\t\t\treturn response.ok ? response.text() : Promise.reject(response.statusText);\r\n\t\t\t}).then(content => {\r\n\t\t\t\tthis.innerHTML = content;\r\n\t\t\t\t// Dispatch the event.\r\n\t\t\t\tthis.dispatchEvent(new Event('bundleloadsuccess'));\r\n\t\t\t}).catch(error => {\r\n\t\t\t\t// Dispatch the event.\r\n\t\t\t\tconsole.warn('Error fetching the bundle at ' + src + '. (' + error + ')');\r\n\t\t\t\tthis.dispatchEvent(new Event('bundleloaderror'));\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The attributes we want to observe.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tstatic get observedAttributes() {\r\n\t\treturn ['src'];\r\n\t}\r\n}, {extends: 'template'});\r\n\t\t\t\r\n/**\r\n * Define the custom import element\r\n */\r\ncustomElements.define(ChtmlCore.elementMap.import, class extends HTMLElement {\r\n\r\n\t/**\r\n\t * Tests if conditions are right to resolve the import.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tshouldResolve() {\r\n\t\treturn !this.hasAttribute('ondemand')\r\n\t\t\t&& !this.closest('template')\r\n\t\t\t&& !this.closest(ChtmlCore.elementMap.import + '[ondemand]');\r\n\t}\r\n\r\n\t/**\r\n\t * This triggers self-replacement\r\n\t * when so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconnectedCallback() {\r\n\t\tthis.processed = false;\r\n\t\tif (this.shouldResolve()) {\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * This triggers self-replacement\r\n\t * when so defined.\r\n\t *\r\n\t * @param string\tname\r\n\t * @param string\toldValue\r\n\t * @param string\tnewValue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tattributeChangedCallback(name, oldValue, newValue) {\r\n\t\tif (this.shouldResolve()) {\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempt self-replacement if so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tresolve() {\r\n\t\tChtml.ready(() => {\r\n\t\t\tif (!this.parentNode) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar replacement, namespace, namespaceAttr = ChtmlCore.attributeMap.ns;\r\n\t\t\tif ((namespace = _before(this.getAttribute(namespaceAttr) || '', '//'))\r\n\t\t\t&& (namespace !== this.__namespace)) {\r\n\t\t\t\tthis.__namespace = namespace;\r\n\t\t\t\tif (!(replacement = Chtml.import(namespace))) {\r\n\t\t\t\t\tthis.innnerText = 'No element found on the namespace \"' + namespace + '\"!';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar resolved = ChtmlCore.recompose(this, replacement);\r\n\t\t\t\t\tif (this.hasAttribute('shadow')) {\r\n\t\t\t\t\t\tif (!this.parentNode.shadowRoot) {\r\n\t\t\t\t\t\t\tthis.parentNode.attachShadow({mode: 'open'});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.parentNode.shadowRoot.append(resolved);\r\n\t\t\t\t\t\tthis.remove();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.replaceWith(resolved);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * The attributes we want to observe.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tstatic get observedAttributes() {\r\n\t\treturn ['ondemand', ChtmlCore.attributeMap.ns];\r\n\t}\r\n});\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tChtmlCore,\r\n\tSchema,\r\n\tMatrix,\r\n};\r\nexport default Chtml;","\r\n/**\r\n * @imports\r\n */\r\nimport Chtml from './index.js';\r\n\r\n// As globals\r\nif (!window.OnePhrase) {\r\n\twindow.OnePhrase = {};\r\n}\r\nwindow.OnePhrase.Chtml = Chtml;\r\n"],"sourceRoot":""}