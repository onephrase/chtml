{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///../commons/str/before.js","webpack:///../commons/js/isArray.js","webpack:///../commons/js/isString.js","webpack:///../commons/js/isUndefined.js","webpack:///../commons/js/isNull.js","webpack:///../commons/js/isTypeObject.js","webpack:///../commons/js/isObject.js","webpack:///../commons/arr/from.js","webpack:///../commons/js/isEmpty.js","webpack:///../commons/js/isTypeArray.js","webpack:///../commons/arr/pushUnique.js","webpack:///../commons/arr/intersect.js","webpack:///./src/Schema.js","webpack:///./src/Def/Matrix.js","webpack:///../commons/arr/remove.js","webpack:///../commons/js/instanceof.js","webpack:///../commons/js/isFunction.js","webpack:///../commons/js/isTypeFunction.js","webpack:///../commons/js/isBoolean.js","webpack:///../commons/js/isNumeric.js","webpack:///../commons/obj/each.js","webpack:///../commons/obj/even.js","webpack:///../commons/obj/compareCallback.js","webpack:///../jsen/src/ExprInterface.js","webpack:///../jsen/src/Expr/AssignmentInterface.js","webpack:///../jsen/src/Expr/ReferenceInterface.js","webpack:///../jsen/src/Expr/DeletionInterface.js","webpack:///../jsen/src/Expr/CallInterface.js","webpack:///../jsen/src/Jsen.js","webpack:///../commons/arr/flatten.js","webpack:///../commons/arr/first.js","webpack:///../commons/arr/last.js","webpack:///../commons/obj/getAllPropertyNames.js","webpack:///../commons/obj/getPrototypeChain.js","webpack:///../commons/obj/mergeCallback.js","webpack:///../commons/obj/merge.js","webpack:///../commons/obj/copyPlain.js","webpack:///../jsen/src/Lexer.js","webpack:///../commons/js/isObservable.js","webpack:///../commons/arr/all.js","webpack:///../commons/obj/get.js","webpack:///../jsen/src/Contexts.js","webpack:///../commons/str/wrapped.js","webpack:///../commons/str/after.js","webpack:///../commons/str/beforeLast.js","webpack:///../commons/str/unwrap.js","webpack:///../jsen/src/Expr/AbstractionInterface.js","webpack:///../jsen/src/Expr/Abstraction.js","webpack:///../jsen/src/Expr/ArrInterface.js","webpack:///../jsen/src/Expr/Arr.js","webpack:///../jsen/src/Expr/ArgumentsInterface.js","webpack:///../jsen/src/Expr/Arguments.js","webpack:///../commons/arr/unique.js","webpack:///../jsen/src/Expr/AssertionInterface.js","webpack:///../jsen/src/Expr/Assertion.js","webpack:///../jsen/src/Expr/Assignment.js","webpack:///../jsen/src/Expr/BoolInterface.js","webpack:///../jsen/src/Expr/Bool.js","webpack:///../jsen/src/Expr/Call.js","webpack:///../jsen/src/Expr/CommentsInterface.js","webpack:///../jsen/src/Expr/Comments.js","webpack:///../commons/arr/difference.js","webpack:///../jsen/src/Expr/ComparisonInterface.js","webpack:///../jsen/src/Expr/Comparison.js","webpack:///../jsen/src/Expr/ConditionInterface.js","webpack:///../jsen/src/Expr/Condition.js","webpack:///../jsen/src/Expr/Deletion.js","webpack:///../commons/obj/copy.js","webpack:///../jsen/src/Expr/FuncInterface.js","webpack:///../jsen/src/Expr/Func.js","webpack:///../jsen/src/Expr/MathInterface.js","webpack:///../jsen/src/Expr/Math.js","webpack:///../jsen/src/Expr/NumInterface.js","webpack:///../jsen/src/Expr/Num.js","webpack:///../jsen/src/Expr/ObjInterface.js","webpack:///../jsen/src/Expr/Obj.js","webpack:///../jsen/src/Expr/Reference.js","webpack:///../jsen/src/Expr/ReturnInterface.js","webpack:///../jsen/src/Expr/Return.js","webpack:///../jsen/src/Expr/StatementsInterface.js","webpack:///../jsen/src/Expr/Statements.js","webpack:///../jsen/src/Expr/StrInterface.js","webpack:///../jsen/src/Expr/Str.js","webpack:///../jsen/src/index.js","webpack:///../commons/js/isProxy.js","webpack:///../commons/js/getProxyTarget.js","webpack:///../commons/js/isNumber.js","webpack:///../commons/obj/inherit.js","webpack:///../commons/arr/concatUnique.js","webpack:///../observable/src/Event.js","webpack:///../observable/src/EventController.js","webpack:///../commons/js/getType.js","webpack:///../commons/arr/exclude.js","webpack:///../observable/src/Observable.js","webpack:///../commons/js/proxy.js","webpack:///../observable/src/index.js","webpack:///./src/Def/Def.js","webpack:///./src/Def/DefBlock.js","webpack:///./src/Def/DefSheet.js","webpack:///./src/ChtmlCore.js","webpack:///./src/Chtml.js","webpack:///../commons/arr/following.js","webpack:///./src/index.js","webpack:///./src/browser-entry.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","search","subject","pos","beforeLast","lastIndexOf","indexOf","substr","Array","isArray","val","arguments","length","undefined","keys","slice","values","items","forEach","itm","arr","push","arr2","filter","val1","callback","val2","Schema","std","html","type","model","singleton","caption","col","colgroup","dd","implicitRole","dt","figcaption","head","legend","li","optgroup","option","param","rp","rt","source","summary","track","tbody","td","tfoot","thead","tr","a","abbr","address","area","article","acceptableRoles","aside","audio","b","base","bdi","bdo","blockquote","body","br","button","canvas","cite","code","data","datalist","del","details","dfn","dialog","div","dl","em","embed","fieldset","figure","footer","form","h1","h2","h3","h4","h5","h6","header","hgroup","hr","iframe","img","input","ins","kbd","label","link","main","map","mark","math","menu","meta","names","meter","nav","noscript","ol","output","picture","pre","progress","q","ruby","samp","script","section","select","slot","small","span","strong","style","sub","sup","svg","table","template","textarea","time","title","u","ul","var","video","wbr","aria","banner","contentinfo","complementary","navigation","list","listitem","el","elTagName","nodeName","toLowerCase","expandRules","roleInclusive","elSchema","currentElCategories","startsWith","hasAttribute","getAttribute","split","role","includes","trim","concat","context","node","valid","contextModel","HTMLElement","getContentModelFor","nodeCategories","getCategoriesFor","allowedNode","disallowedNode","scope","nodeSchema","closest","contextCategories","current","parentNode","assertNodeBelongsInContentModel","rules","rles","reduce","categories","rule","matches","Matrix","sources","namespace","carry","this","collections","subMatrix","nsKey","nsArray","nsDrill","shift","enter","cloneNode","limit","splice","obj","classB","mixinTest","classA","Function","prototypes","prevAns","getPrototypeOf","constructor","toString","isNaN","returnValue","k","parseFloat","_even","obj1","obj2","assertion","depth","result","contn","v1","testPass","v2","netComparison","contrast","returnOnFirstFalse","Expr","jsenType","Super","comments","vars","Interface","ExprInterface","Jsen","expr","Parsers","params","Static","parsers","grammars","varsScope","parsed","parse","_expr","_Parsers","ReferenceInterface","CallInterface","explain","console","log","AssignmentInterface","DeletionInterface","mutates","Error","assert","_flatten","withObjects","acc","count","firsts","amount","reverse","keysAll","until","prototypalChain","getOwnPropertyNames","objs","deepProps","valAtObj1","valAtObj2","isReplace","withSymbols","getOwnPropertyDescriptor","e","Lexer","str","delims","options","instance","$cache","lex","tokens","$str","$options","blocks","$blocks","quotes","$quotes","$comments","runtime","nesting","maxDepth","matchesi","cache","_evalCharsAt","join","charWidth","commentTest","quoteTest","nestingTest","openComment","_testQuotes","openQuote","_testComments","ending","_push","chars","starting","preserveComments","_testNesting","stopChar","_testChars","stopChars","stopCharForward","matchedDelim","preserveDelims","quote","block","match","RegExp","Math","max","testList","test","useRegex","ci","target","splitSeries","regParse","method","prevTest","detectObservables","path","_ctxt","ctxt","_key","isObsvble","reciever","exists","varName","bindThis","cntxt","openingTag","endsWith","closingTag","afterLast","Abstraction","AbstractionInterface","super","eval","parseCallback","Arr","ArrInterface","exprs","newExprs","exprA","uniqueSoFar","exprB","even","Arguments","ArgumentsInterface","arg","index","self","Assertion","AssertionInterface","logic","operators","toUpperCase","isOr","or","isNor","nor","isAnd","and","isNand","nand","lastResult","trues","Assignment","reference","operator","getEval","Bool","BoolInterface","state","Call","args","_contexts","func","_cntxts","handler","utils","Num","Str","Obj","unshift","pop","Comments","CommentsInterface","_comments","commentPlacement","splits","_beforeLast","line","replace","commenta","Comparison","ComparisonInterface","operand1","operand2","compare","oper","allItemsMatch","sort","entry1Keys","entry2Keys","allEntriesMatch","strict","exact","is","isNull","equalsTo","notEqualsTo","relative","lesserThan","greaterThan","lesserThanOrEqualsTo","greaterThanOrEqualsTo","between","partial","contains","any","in","Condition","ConditionInterface","onTrue","onFalse","Deletion","red","Func","FuncInterface","paramters","statements","arrowFunctionFormatting","parentParams","ownParams","nameInParent","nameInSelf","defaultValInParent","defaultValInSelf","localContext","defaultVal","multipleContexts","headNoWrap","bodyNoWrap","funcHead","funcBody","paramSplit","MathInterface","currentTotal","NumInterface","int","dec","parseInt","ObjInterface","entries","_entriesSplit","entry","Reference","backticks","sourceContext","parts","subjectContext","separator","nameSplit","isContext","Return","ReturnInterface","exprLc","Statements","StatementsInterface","stmts","delim","StrInterface","__proxyTargetByCommons","arrs","_arr","$","propagationStopped","defaultPrevented","promisesInstance","promises","promise","Promise","all","listeners","eventNames","tag","listener","remove","success","removeCallback","eventsAll","currentlyFiring","eventNamesAntiRecursion","listenerParams","listenerEventNames","listenerEventName","bubbling","allowBubbling","firingEventName","_shouldFire","proms","dispostn","_doFire","stopPropagation","preventDefault","itms","_context","_data","eventName","Observable","bubblers","_state","prop","_incoming","addListener","removeListener","changedProps","_outgoing","_value","observersDisposition","fire","exits","props","methodPrefix","ownMethod","asOwnMethod","copy","ret","apply","changedKeys","passes","failures","CACHE","_CACHE","existsReciever","_existsReciever","existence","diff","diffing","pulse","unobserve","getOffsetParent","setOffsetParent","observe","_getBubbler","offsetParent","changes","_changes","_e","subFieldName","msg","error","strictDebug","trapByCommons","trap","Proxy","proxy","set","has","deleteProperty","ownKeys","descriptor","getOwnPropertySymbols","Def","flag","opts","_opts","defSplit","vf","flags","DefBlock","add","withDuplicate","withOverRidden","isDuplicate","overridden","def","newDef","existingDef","key_a","value_a","value_aUnwrapped","key_b","value_b","value_bUnwrapped","incase_a","important_a","incase_b","important_b","DefSheet","defBlock","defSheet","applyTo","ChtmlCore","root","querySelector","parseNamespace","defs","parseCascadedDefSheet","init","free","getCpsBlock","directive","bindingsListeners","binding","observeOnly","listenerObj","newState","oldState","evalReturn","cleanCopy","componentCallback","dataBlockScript","attrCache","paramsAttrs","attr","attributeMap","attrValue","removeAttribute","children","elementMap","defsheet","$defs","setAttribute","prepend","asDirectives","cpsBlockDefs","directives","argsExpr","chainableDirectives","_directive","explainJsen","requestNodeName","computeQuery","computedRelated","toElement","roles","superrole","rolecase","matchedNode","closestSuper","_matchedNode","closestSuperSelector","CSS","escape","nodeSelector","subrole","shadowRoot","isSameNode","tries","schema","selector","tagname","trie","querySelectorAll","assertNodeBelongsInScopeAs","_node","drilldown","alias","nodeCallback","disconnectedCallback","getRelatedNode","implicitOnly","getExplicitNode","explicitOnly","getImplicitNode","createNode","namespaceParse","roadmap","subnamespace","textContent","elTo","elFrom","import","elToNs","elFromNs","elFromRoles","recomposeDefs","replacementNode","applicableContextRoles","applicableReplacementNodeRoles","replacementNodeRole","_applicableContextRoles","contextRole","slotNodes","contextSelector","slotNodeSelector","replaceWith","append","appendOrPrepend","norecompose","nocompose","recomposeCallback","disposition","b_attr","a_attr","jointList","jointDefs","attributes","elToDefs","elFromDefs","document","temp","createElement","innerHtml","firstChild","called","MutationObserver","mutations","removedNodes","childList","bundle","related","Chtml","dataKey","populate","itemCallback","listContext","onlyKeys","item","unbindReturn","then","catch","isNewItem","itemNamespaceArray","itemEl","following","from","lastReference","after","rotate","_k","before","resolveInheritance","bundles","superNs","superEl","isImport","_el","recompose","warn","find","window","contentLoadedPromise","resolve","readyState","addEventListener","ready","waitForBundles","initObj","loadingBundlesPromise","remoteBundles","loadingBundles","warnedEarlyBundleAccess","content","anticyclicBundlesQuery","bundleIndex","_namespace","message","customElements","define","HTMLTemplateElement","oldValue","newValue","load","src","fetch","response","ok","text","reject","statusText","innerHTML","dispatchEvent","Event","extends","processed","shouldResolve","replacement","namespaceAttr","__namespace","resolved","attachShadow","innnerText","OnePhrase"],"mappings":"aACE,IAAIA,EAAmB,GAGvB,SAASC,EAAoBC,GAG5B,GAAGF,EAAiBE,GACnB,OAAOF,EAAiBE,GAAUC,QAGnC,IAAIC,EAASJ,EAAiBE,GAAY,CACzCG,EAAGH,EACHI,GAAG,EACHH,QAAS,IAUV,OANAI,EAAQL,GAAUM,KAAKJ,EAAOD,QAASC,EAAQA,EAAOD,QAASF,GAG/DG,EAAOE,GAAI,EAGJF,EAAOD,QAKfF,EAAoBQ,EAAIF,EAGxBN,EAAoBS,EAAIV,EAGxBC,EAAoBU,EAAI,SAASR,EAASS,EAAMC,GAC3CZ,EAAoBa,EAAEX,EAASS,IAClCG,OAAOC,eAAeb,EAASS,EAAM,CAAEK,YAAY,EAAMC,IAAKL,KAKhEZ,EAAoBkB,EAAI,SAAShB,GACX,oBAAXiB,QAA0BA,OAAOC,aAC1CN,OAAOC,eAAeb,EAASiB,OAAOC,YAAa,CAAEC,MAAO,WAE7DP,OAAOC,eAAeb,EAAS,aAAc,CAAEmB,OAAO,KAQvDrB,EAAoBsB,EAAI,SAASD,EAAOE,GAEvC,GADU,EAAPA,IAAUF,EAAQrB,EAAoBqB,IAC/B,EAAPE,EAAU,OAAOF,EACpB,GAAW,EAAPE,GAA8B,iBAAVF,GAAsBA,GAASA,EAAMG,WAAY,OAAOH,EAChF,IAAII,EAAKX,OAAOY,OAAO,MAGvB,GAFA1B,EAAoBkB,EAAEO,GACtBX,OAAOC,eAAeU,EAAI,UAAW,CAAET,YAAY,EAAMK,MAAOA,IACtD,EAAPE,GAA4B,iBAATF,EAAmB,IAAI,IAAIM,KAAON,EAAOrB,EAAoBU,EAAEe,EAAIE,EAAK,SAASA,GAAO,OAAON,EAAMM,IAAQC,KAAK,KAAMD,IAC9I,OAAOF,GAIRzB,EAAoB6B,EAAI,SAAS1B,GAChC,IAAIS,EAAST,GAAUA,EAAOqB,WAC7B,WAAwB,OAAOrB,EAAgB,SAC/C,WAA8B,OAAOA,GAEtC,OADAH,EAAoBU,EAAEE,EAAQ,IAAKA,GAC5BA,GAIRZ,EAAoBa,EAAI,SAASiB,EAAQC,GAAY,OAAOjB,OAAOkB,UAAUC,eAAe1B,KAAKuB,EAAQC,IAGzG/B,EAAoBkC,EAAI,GAIjBlC,EAAoBA,EAAoBmC,EAAI,G,sCCxEtC,yBACd,GAAc,IAAVC,EACH,OAAOC,EAER,IAAIC,EAAMC,EAAaF,EAAQG,YAAYJ,GAAUC,EAAQI,QAAQL,GACrE,OAAa,IAATE,EACID,EAEDA,EAAQK,OAAO,EAAGJ,ICVX,cACd,OAAOK,MAAMC,QAAQC,ICDP,cACd,MAAsB,iBAARA,GCDA,cACd,OAAOC,UAAUC,cAAmBC,IAARH,QAAoC,IAARA,ICD1C,cACd,OAAe,OAARA,GAAwB,KAARA,GCAT,cACd,OAAOF,MAAMC,QAAQC,IAAuB,iBAARA,GCFtB,cACd,OAAQF,MAAMC,QAAQC,IAAuB,iBAARA,GAAoBA,GCO3C,cACd,OAAI,EAASA,GACLA,GAEI,IAARA,GAAyB,IAARA,GCHP,YACd,OAAO,EAAQA,IAAQ,EAAaA,KAAgB,IAARA,GAAyB,IAARA,GACxD,EAAcA,KAAS/B,OAAOmC,KAAKJ,GAAKE,ODCX,CAASF,GACnC,GENM,YACd,OAAQ,EAAUA,KAAS,EAAaA,EAAIE,QFOxC,CAAaF,GACTF,MAAMX,UAAUkB,MAAM3C,KAAKsC,GAE/B,EAAUA,GACN/B,OAAOqC,OAAON,GAEf,CAACA,IGpBM,mBAMd,OALAO,EAAMC,QAAQC,IACTC,EAAId,QAAQa,GAAO,GACtBC,EAAIC,KAAKF,KAGJC,GCCO,uBACd,OAAQ,EAASE,GAAaF,EAAIG,OAAOC,GAAQC,EAC9CH,EAAKC,OAAOG,GAAQD,EAASD,EAAME,IAAOd,QAClB,IAAxBU,EAAKhB,QAAQkB,IAFS,ICC1B,MAAMG,EAAS,CAKdC,IAAK,CAIJC,KAAM,CACLC,KAAM,CAAC,oBACPC,MAAO,CAAC,OAAQ,QAChBC,WAAW,GAEZC,QAAS,CACRF,MAAO,CAAC,QAAS,UACjBC,WAAW,GAEZE,IAAK,CACJH,MAAO,CAAC,aAETI,SAAU,CACTJ,MAAO,CAAC,CAAC,iBAAkB,CAAC,aAAc,CAAC,uBAAwB,CAAC,MAAO,cAC3EC,WAAW,GAEZI,GAAI,CACHL,MAAO,CAAC,SACRM,aAAc,cAEfC,GAAI,CACHP,MAAO,CAAC,QAAS,YAAa,eAAgB,UAAW,WACzDM,aAAc,QAEfE,WAAY,CACXR,MAAO,CAAC,SACRC,WAAW,GAEZQ,KAAM,CACLT,MAAO,CAAC,aACRC,WAAW,GAEZS,OAAQ,CACPV,MAAO,CAAC,aACRC,WAAW,GAEZU,GAAI,CACHX,MAAO,CAAC,SACRM,aAAc,YAEfM,SAAU,CACTZ,MAAO,CAAC,SAAU,sBAClBM,aAAc,SAEfO,OAAQ,CACPb,MAAO,CAAC,CAAC,uBAAwB,CAAC,aAAc,CAAC,mCAAoC,CAAC,UAAW,CAAC,sBAAuB,CAAC,YAE3Hc,MAAO,CACNd,MAAO,CAAC,aAETe,GAAI,CACHf,MAAO,CAAC,UAETgB,GAAI,CACHhB,MAAO,CAAC,cAETiB,OAAQ,CACPjB,MAAO,CAAC,aAETkB,QAAS,CAERlB,MAAO,CAAC,YAAa,YACrBC,WAAW,GAEZkB,MAAO,CACNnB,MAAO,CAAC,aAEToB,MAAO,CACNpB,MAAO,CAAC,qBAAsB,OAE/BqB,GAAI,CACHrB,MAAO,CAAC,QAAS,YAAa,eAAgB,UAAW,YAE1DsB,MAAO,CACNtB,MAAO,CAAC,KAAM,sBACdC,WAAW,GAEZsB,MAAO,CACNvB,MAAO,CAAC,KAAM,sBACdC,WAAW,GAEZuB,GAAI,CACHxB,MAAO,CAAC,qBAAsB,KAAM,OAKrCyB,EAAG,CACF1B,KAAM,CAAC,QAAS,YAAa,CAAC,UAAW,CAAC,eAAgB,eAC1DC,MAAO,CAAC,eAAgB,gBAAiB,OAE1C0B,KAAM,CACL3B,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAET2B,QAAS,CACR5B,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,QAAS,YAAa,eAAgB,UAAW,UAAW,aAGrE4B,KAAM,CACL7B,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,aAET6B,QAAS,CACR9B,KAAM,CAAC,QAAS,YAAa,uBAC7BC,MAAO,CAAC,SACRM,aAAc,UACdwB,gBAAiB,CAAC,cAAe,UAAW,WAAY,SAEzDC,MAAO,CACNhC,KAAM,CAAC,QAAS,YAAa,uBAC7BC,MAAO,CAAC,SACRM,aAAc,gBACdwB,gBAAiB,CAAC,gBAAiB,OAAQ,WAE5CE,MAAO,CACNjC,KAAM,CAAC,YAAa,QAAS,YAAa,CAAC,kBAAmB,CAAC,eAAgB,eAC/EC,MAAO,CAAC,eAAgB,UAAW,QAAS,CAAC,mBAAoB,CAAC,aAEnEiC,EAAG,CACFlC,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAETkC,KAAM,CACLnC,KAAM,CAAC,aACPC,MAAO,CAAC,YACRC,WAAW,GAEZkC,IAAK,CACJpC,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAEToC,IAAK,CACJrC,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAETqC,WAAY,CACXtC,KAAM,CAAC,QAAS,YAAa,oBAC7BC,MAAO,CAAC,UAETsC,KAAM,CACLvC,KAAM,CAAC,oBACPC,MAAO,CAAC,QAAS,UAAW,eAAgB,iBAAkB,SAC9DC,WAAW,GAEZsC,GAAI,CACHxC,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,aAETwC,OAAQ,CACPzC,KAAM,CAAC,QAAS,eAAgB,YAAa,aAC7CC,MAAO,CAAC,YAAa,kBAEtByC,OAAQ,CACP1C,KAAM,CAAC,YAAa,QAAS,YAAa,aAC1CC,MAAO,CAAC,eAAgB,gBAAiB,IAAK,cAAe,SAAU,uBAAwB,sBAAuB,yBAA0B,mBAAoB,kBAAwD,4BAE7N0C,KAAM,CACL3C,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAET2C,KAAM,CACL5C,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAET4C,KAAM,CACL7C,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAET6C,SAAU,CACT9C,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,YAAa,qBAAsB,WAE5C8C,IAAK,CACJ/C,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,iBAET+C,QAAS,CACRhD,KAAM,CAAC,QAAS,eAAgB,YAAa,oBAC7CC,MAAO,CAAC,QAAS,YAElBgD,IAAK,CACJjD,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,YAAa,QACrBM,aAAc,QAEf2C,OAAQ,CACPlD,KAAM,CAAC,QAAS,oBAChBC,MAAO,CAAC,SACRM,aAAc,UAEf4C,IAAK,CACJnD,KAAM,CAAC,QAAS,aAEhBC,MAAO,CAAC,CAAC,WAAY,CAAC,KAAM,OAAQ,CAAC,iBAAkB,CAAC,YAEzDmD,GAAI,CAEHpD,KAAM,CAAC,SAEPC,MAAO,CAAC,qBAAsB,KAAM,KAAM,QAE3CoD,GAAI,CACHrD,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAETqD,MAAO,CACNtD,KAAM,CAAC,YAAa,QAAS,YAAa,eAAgB,aAC1DC,MAAO,CAAC,aAETsD,SAAU,CACTvD,KAAM,CAAC,QAAS,mBAAoB,aACpCC,MAAO,CAAC,SAAU,UAEnBuD,OAAQ,CACPxD,KAAM,CAAC,QAAS,mBAAoB,aACpCC,MAAO,CAAC,QAAS,cACjBM,aAAc,UAEfkD,OAAQ,CACPzD,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,QAAS,UAAW,WAC5B8B,gBAAiB,CAAC,eAClB7B,WAAW,GAEZwD,KAAM,CACL1D,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,QAAS,UAElB0D,GAAI,CACH3D,KAAM,CAAC,QAAS,WAAY,aAC5BC,MAAO,CAAC,aACRM,aAAc,WAEfqD,GAAI,CACH5D,KAAM,CAAC,QAAS,WAAY,aAC5BC,MAAO,CAAC,aACRM,aAAc,WAEfsD,GAAI,CACH7D,KAAM,CAAC,QAAS,WAAY,aAC5BC,MAAO,CAAC,aACRM,aAAc,WAEfuD,GAAI,CACH9D,KAAM,CAAC,QAAS,WAAY,aAC5BC,MAAO,CAAC,aACRM,aAAc,WAEfwD,GAAI,CACH/D,KAAM,CAAC,QAAS,WAAY,aAC5BC,MAAO,CAAC,aACRM,aAAc,WAEfyD,GAAI,CACHhE,KAAM,CAAC,QAAS,WAAY,aAC5BC,MAAO,CAAC,aACRM,aAAc,WAEf0D,OAAQ,CACPjE,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,QAAS,UAAW,WAC5B8B,gBAAiB,CAAC,UAClB7B,WAAW,GAEZgE,OAAQ,CACPlE,KAAM,CAAC,QAAS,WAAY,aAC5BC,MAAO,CAAC,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,uBAE7CkE,GAAI,CACHnE,KAAM,CAAC,SACPC,MAAO,CAAC,YACRM,aAAc,aAEfpE,EAAG,CACF6D,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAETmE,OAAQ,CACPpE,KAAM,CAAC,YAAa,QAAS,YAAa,eAAgB,aAC1DC,MAAO,CAAC,aAEToE,IAAK,CACJrE,KAAM,CAAC,YAAa,QAAS,YAAa,CAAC,cAAe,CAAC,eAAgB,eAC3EC,MAAO,CAAC,aAETqE,MAAO,CACNtE,KAAM,CAAC,QAAS,YAAa,CAAC,8BAA+B,CAAC,eAAgB,eAC9EC,MAAO,CAAC,aAETsE,IAAK,CACJvE,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,iBAETuE,IAAK,CACJxE,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAETwE,MAAO,CACNzE,KAAM,CAAC,QAAS,YAAa,eAAgB,aAC7CC,MAAO,CAAC,YAAa,WAEtByE,KAAM,CACL1E,KAAM,CAAC,YAAa,CAAC,YAAa,CAAC,QAAS,eAC5CC,MAAO,CAAC,aAET0E,KAAM,CACL3E,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,SACRM,aAAc,OACdL,WAAW,GAEZ0E,IAAK,CACJ5E,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,iBAET4E,KAAM,CACL7E,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,iBAET6E,KAAM,CACL9E,KAAM,CAAC,YAAa,QAAS,YAAa,aAE1CC,MAAO,IAER8E,KAAM,CACL/E,KAAM,CAAC,QAAS,CAAC,kBAAmB,CAAC,eACrCC,MAAO,CAAC,qBAAsB,MAC9BM,aAAc,QAEfyE,KAAM,CACLhF,KAAM,CAAC,YAAa,CAAC,iBAAkB,CAAC,QAAS,eACjDC,MAAO,CAAC,YACRgF,MAAO,CAAC,mBAAoB,SAAU,cAAe,YAAa,WAAY,WAAY,gBAE3FC,MAAO,CACNlF,KAAM,CAAC,QAAS,aAAc,YAAa,aAC3CC,MAAO,CAAC,YAAa,WAEtBkF,IAAK,CACJnF,KAAM,CAAC,QAAS,sBAAuB,aACvCC,MAAO,CAAC,SACRM,aAAc,aACdwB,gBAAiB,CAAC,eAEnBqD,SAAU,CACTpF,KAAM,CAAC,YAAa,QAAS,aAC7BC,MAAO,CAAC,CAAC,YAAa,CAAC,QAAS,OAAQ,SAAU,CAAC,kBAAmB,CAAC,eAAgB,gBAExFpC,OAAQ,CACPmC,KAAM,CAAC,YAAa,QAAS,YAAa,CAAC,iBAAkB,CAAC,eAAgB,eAC9EC,MAAO,CAAC,eAAgB,UAEzBoF,GAAI,CACHrF,KAAM,CAAC,QAAS,CAAC,kBAAmB,CAAC,eACrCC,MAAO,CAAC,qBAAsB,MAC9BM,aAAc,QAEf+E,OAAQ,CACPtF,KAAM,CAAC,QAAS,aAAc,YAAa,aAC3CC,MAAO,CAAC,YAAa,WAEtBhC,EAAG,CACF+B,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,cAETsF,QAAS,CACRvF,KAAM,CAAC,YAAa,QAAS,aAC7BC,MAAO,CAAC,SAAU,MAAO,uBAE1BuF,IAAK,CACJxF,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,cAETwF,SAAU,CACTzF,KAAM,CAAC,QAAS,aAAc,YAAa,aAC3CC,MAAO,CAAC,YAAa,cAEtByF,EAAG,CACF1F,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAET0F,KAAM,CACL3F,KAAM,CAAC,QAAS,YAAa,aAE7BC,MAAO,CAAC,KAAM,OAEf/B,EAAG,CACF8B,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAET2F,KAAM,CACL5F,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAET4F,OAAQ,CACP7F,KAAM,CAAC,QAAS,YAAa,YAAa,sBAC1CC,MAAO,CAAC,CAAC,cAAe,MAEzB6F,QAAS,CACR9F,KAAM,CAAC,QAAS,sBAAuB,aACvCC,MAAO,CAAC,SACRM,aAAc,SACdwB,gBAAiB,CAAC,QAAS,cAAe,cAAe,cAAe,SAAU,WAAY,MAAO,OAAQ,UAAW,SAAU,SAAU,WAE7IgE,OAAQ,CACP/F,KAAM,CAAC,QAAS,eAAgB,aAAc,YAAa,aAC3DC,MAAO,CAAC,SAAU,WAAY,uBAE/B+F,KAAM,CACLhG,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,iBAETgG,MAAO,CACNjG,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAETiG,KAAM,CACLlG,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAETkG,OAAQ,CACPnG,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAETmG,MAAO,CACNpG,KAAM,CAAC,aACPC,MAAO,CAAC,UAEToG,IAAK,CACJrG,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAETqG,IAAK,CACJtG,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAETsG,IAAK,CACJvG,KAAM,CAAC,YAAa,QAAS,YAAa,aAE1CC,MAAO,IAERuG,MAAO,CACNxG,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,UAAW,WAAY,QAAS,QAAS,KAAM,QAAS,uBAEjEqB,GAAI,CACHtB,KAAM,CAAC,oBACPC,MAAO,CAAC,UAETwG,SAAU,CACTzG,KAAM,CAAC,YAAa,QAAS,YAAa,sBAC1CC,MAAO,CAAC,aAETyG,SAAU,CACT1G,KAAM,CAAC,QAAS,eAAgB,aAAc,YAAa,aAC3DC,MAAO,CAAC,UAET0G,KAAM,CACL3G,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,CAAC,iBAAkB,CAAC,cAAe,CAAC,uBAAwB,CAAC,YAEtE2G,MAAO,CACN5G,KAAM,CAAC,aACPC,MAAO,CAAC,SACRC,WAAW,GAEZ2G,EAAG,CACF7G,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAET6G,GAAI,CACH9G,KAAM,CAAC,QAAS,CAAC,kBAAmB,CAAC,eACrCC,MAAO,CAAC,qBAAsB,MAC9BM,aAAc,QAEfwG,IAAK,CACJ/G,KAAM,CAAC,QAAS,YAAa,aAC7BC,MAAO,CAAC,cAET+G,MAAO,CACNhH,KAAM,CAAC,YAAa,QAAS,YAAa,CAAC,kBAAmB,CAAC,eAAgB,eAC/EC,MAAO,CAAC,eAAgB,UAAW,QAAS,CAAC,mBAAoB,CAAC,aAEnEgH,IAAK,CACJjH,KAAM,CAAC,QAAS,aAChBC,MAAO,CAAC,cAOViH,KAAM,CACLC,OAAQ,CACPnH,KAAM,CAAC,WACPE,WAAW,GAEZkH,YAAa,CACZpH,KAAM,CAAC,gBACPE,WAAW,GAEZmH,cAAe,CACdrH,KAAM,CAAC,kBACPE,WAAW,GAEZoH,WAAY,CACXtH,KAAM,CAAC,eACPE,WAAW,GAEZqH,KAAM,CACLvH,KAAM,CAAC,UAERwH,SAAU,CACTxH,KAAM,CAAC,eAWT,mBAAmByH,GAClB,IAAIC,EAAYD,EAAGE,SAASC,cAC5B,OAAO/H,EAAOC,IAAI4H,GAAa7H,EAAOgI,YAAYJ,EAAI5H,EAAOC,IAAI4H,GAAWzH,OAAS,IAAM,IAW5F,iBAAiBwH,EAAIK,GAAgB,GACpC,IAAIJ,EAAYD,EAAGE,SAASC,cACxBG,EAAWlI,EAAOC,IAAI4H,IAAc7H,EAAOqH,KAAKQ,IAAc,GAC9DM,EAAsB,GAC1B,GAAIF,IAAkBL,EAAGE,SAASM,WAAW,OACzCR,EAAGS,aAAa,SAAWH,EAASxH,cAGvC,GAAIkH,EAAGS,aAAa,QAAS,CACTT,EAAGU,aAAa,QAAQC,MAAM,KACjDX,EAAGU,aAAa,QAAQC,MAAM,KAAKhJ,QAAQiJ,IACtCN,GAAYA,EAAShG,kBAAoBgG,EAAShG,gBAAgBuG,SAASD,KAG/EA,EAAOA,EAAKE,OACZP,EAAoBzI,KAAK,IAAM8I,GAC3BxI,EAAOqH,KAAKmB,IAASxI,EAAOqH,KAAKmB,GAAMrI,OAC1CgI,EAAsBA,EAAoBQ,OAAO3I,EAAOgI,YAAYJ,EAAI5H,EAAOqH,KAAKmB,GAAMrI,MAAQ,cAG1F+H,EAASxH,cACnB,EAAYyH,EAAqB,IAAMD,EAASxH,aAAcmH,QAI3DM,EAAsB,EAAYnI,EAAOgI,YAAYJ,EAAIM,EAAS/H,MAAQ,IAAK0H,GAEpF,OAAOM,GAYR,gCAAgCS,EAASC,GACxC,IASIC,EATAC,EAAeH,aAAmBI,YACnChJ,EAAOiJ,mBAAmBL,GAC1BA,EACCM,EAAiBL,aAAgBG,YAClChJ,EAAOmJ,iBAAiBN,GACxBA,EACH,OAAI,EAAWE,EAAc,CAAC,WAAY,UAAU9J,SAMpD8J,EAAaxJ,QAAQ6J,IACpB,GAAIA,EAAYhB,WAAW,KAAM,CAChC,IAAIiB,EAAiBD,EAAYxK,OAAO,GACpCsK,EAAeT,SAASY,KAC3BP,GAAQ,QAEW,IAAVA,GACNI,EAAeT,SAASW,KAC3BN,GAAQ,KAIJA,IAAS,IAajB,2BAA2BQ,EAAOT,EAAMU,EAAa,MAGpD,IAFA,IACIC,EADAC,EAAoBzJ,EAAOmJ,iBAAiBG,GACnCI,EAAUb,GACfW,IAAYE,EAAUA,EAAQC,aACjC,EAAWF,EAAmBzJ,EAAOmJ,iBAAiBO,IAAUzK,QAChEe,EAAO4J,gCAAgCF,EAASH,GAAcA,EAAWpJ,MAAgB0I,KAE5FW,EAAUE,GAGZ,OAAOF,IAAYF,GAWpB,YAAY1B,EAAIiC,GACf,IAAIC,EAAOD,EAAME,OAAO,CAACC,EAAYC,KAChC,EAAUA,GACTrC,EAAGsC,QAAQlN,OAAOmC,KAAK8K,GAAM,MAChCD,EAAaA,EAAWrB,OAAO3L,OAAOqC,OAAO4K,GAAM,KAGpDD,EAAWtK,KAAKuK,GAEVD,GACL,IAIH,OAHIF,EAAKrB,SAAS,qBACjBqB,EAAKpK,KAAK,uBAEJoK,IAOM,QCjqBf,MAAMK,EAAS,MAYd,YAAYC,EAASC,EAAWvN,EAAQwN,EAAQ,MAC/CC,KAAKH,QAAU,EAASA,GACxBG,KAAKF,UAAY,EAASA,GAC1BE,KAAKzN,OAASA,EACdyN,KAAKD,MAAQA,EACbC,KAAKC,YAAc,GACnBD,KAAKhN,MAUN,MAAMV,GASL,OARMA,KAAQ0N,KAAKC,cAClBD,KAAKC,YAAY3N,GAAQ,IAAIsN,EAC5BI,KAAKH,QACLG,KAAKF,UAAU1B,OAAO9L,GACtB0N,KAAKzN,OACLyN,OAGKA,KAAKC,YAAY3N,GAQzB,QACC,OAAO0N,KAAKD,MAQb,MACC,IAAKC,KAAKhN,MAAO,CAChB,IAAI8M,EAAYE,KAAKF,UAAUjL,QAC3B7B,EAAQgN,KAAKD,MAAQC,KAAKD,MAAMnN,MAAQ,KAC5CoN,KAAKH,QAAQ7K,QAAQ,CAAC8B,EAAQ/E,MACzBiB,EAAQgN,KAAKzN,OAAOL,KAAK,KAAM4E,EAAQgJ,EAAW9M,EAAOjB,MAC5DiO,KAAKhN,MAAQA,KAIhB,OAAOgN,KAAKhN,MAUb,KAAK8M,GAGJ,IAFA,IACII,EAAWC,EADXC,EAAUN,EAAU9B,MAAM,KACRqC,EAAUL,MACzBG,EAAQC,EAAQE,WAAaD,EAAUA,EAAQE,MAAMJ,KAC3DD,EAAYG,EAGb,IAAIhD,EAAK6C,EAAUtN,MACnB,GAAIyK,EACH,OAAOA,EAAGmD,WAAU,KAQR,QC7FA,qBAEd,IADA,IAAIzO,EAAImD,EAAId,QAAQa,GACblD,GAAK,IAAM0O,IAAmB,IAAVA,IAC1BvL,EAAIwL,OAAO3O,EAAG,GACV0O,EAAQ,GACXA,IAED1O,EAAImD,EAAId,QAAQa,GAEjB,OAAOC,GCVO,gBACd,IAAKyL,EACJ,OAAO,EAER,GAAIA,aAAeC,EAClB,OAAO,EAER,IAAIC,EAAYC,IACf,KAAOA,GAAUA,IAAWC,SAASpN,WAAW,CAC/C,GAAImN,IAAWF,GAAWE,EAAOE,YAAcF,EAAOE,WAAWxB,OAAO,CAACyB,EAAStN,IAAcsN,GAAYtN,IAAciN,GAAWC,EAAUlN,IAAY,GAC1J,OAAO,EAERmN,EAASrO,OAAOyO,eAAeJ,GAEhC,OAAO,GAER,OAAOD,EAAUF,EAAIQ,cCZP,cACd,OCLc,YACd,MAAsB,mBAAR3M,EDIP,CAAgBA,IAASA,GAAiC,sBAA1B,GAAG4M,SAASlP,KAAKsC,IEN1C,cACd,OAAe,IAARA,IAAwB,IAARA,GCAT,cACd,OAAe,IAARA,IAAwB,IAARA,GAAyB,OAARA,GAAwB,KAARA,IAAe6M,MAAY,EAAN7M,ICM/D,gBACd,IAAI8M,OAAc3M,EAQlB,OAPI,EAAcgM,IACjBlO,OAAOmC,KAAK+L,GAAK3L,QAAQuM,KACJ,IAAhBD,IACHA,EAAc/L,EAAS,EAAWgM,GAAKC,WAAWD,GAAKA,EAAGZ,EAAIY,OAI1DD,GCLR,MAAMG,EAAQ,SAASC,EAAMC,EAAMC,GAAY,EAAMC,EAAQ,GAC5D,GAAK,EAASH,IAAS,EAASC,IAASD,EAAKhN,SAAWiN,EAAKjN,QAC1D,EAAUgN,IAAS,EAAUC,IAASlP,OAAOmC,KAAK8M,GAAMhN,SAAWjC,OAAOmC,KAAK+M,GAAMjN,OACxF,OAAO,EAER,IAAIoN,ECFU,kCACd,GAAI,EAASJ,IAAS,EAASC,GAAO,CACrC,IAAIG,EAAS,GACTC,GAAQ,EA4BZ,OA3BAL,EAAK1M,QAAQgN,IACZ,GAAKD,EAAL,CAGA,IAAIE,GAAW,EACf,EAAMN,EAAM,CAACJ,EAAGW,OACVD,GAAaE,GAAiB,EAAcH,MAChDC,EAAWL,EAAUI,EAAIE,IACpB,EAASD,KAAcA,EAASvN,QAAY,EAAUuN,KAAcxP,OAAOmC,KAAKqN,GAAUvN,UAC9FuN,GAAW,GAER,EAAcA,IAAaE,IAE9BH,EAAKC,MAIJ,EAAcA,GACjBH,EAAO3M,KAAKgN,EAAgBF,EAAWD,GAC5B,EAAWC,GAEXG,IAAaH,IAAeG,GAAYH,EACnDH,EAAO3M,KAAK6M,GACFK,IACVN,GAAQ,GAJRD,EAAO3M,KAAK8M,MAOPH,EAGR,GAAI,EAAUJ,IAAS,EAAUC,GAAO,CACnCG,EAAS,GACTC,GAAQ,EAmBZ,OAlBAtP,OAAOmC,KAAK8M,GAAM1M,QAAQuM,IACzB,GAAKQ,EAAL,CAGA,IAAIE,EAAWL,EAAUF,EAAKH,GAAII,EAAKJ,KAClC,EAASU,KAAcA,EAASvN,QAAY,EAAUuN,KAAcxP,OAAOmC,KAAKqN,GAAUvN,UAC9FuN,GAAW,GAER,EAAcA,GACjBH,EAAOP,GAAKY,EAAgBF,EAAWP,EAAKH,GACjC,EAAWU,GAEXG,IAAaH,IAAeG,GAAYH,EACnDH,EAAOP,GAAKG,EAAKH,GACPc,IACVN,GAAQ,GAJRD,EAAOP,GAAKU,KAOPH,GDrDK,CAAiBJ,EAAMC,EAAM,CAACK,EAAIE,IAC1CL,EAAQ,IAAO,EAASG,IAAO,EAASE,IAAS,EAAUF,IAAO,EAAUE,IACxET,EAAMO,EAAIE,EAAIN,EAAWC,EAAQ,GAElC,EAAYD,GAAaA,EAAUI,EAAIE,GAAOF,IAAOE,IAAQN,GAClE,GAAwB,GAAmB,GAC9C,OAAO,EAASE,GAAUA,EAAOpN,SAAWgN,EAAKhN,OAC7C,EAAUoN,GAAUrP,OAAOmC,KAAKkN,GAAQpN,SAAWjC,OAAOmC,KAAK8M,GAAMhN,OAASoN,GAMpE,QEzBA,QASd,KAAKQ,GACJ,SAAI,EAAUA,IAASA,EAAKC,WAAavC,KAAKuC,WACtC,EAAMD,EAAMtC,MAYrB,QAAQwC,GACP,OAAOxC,KAUR,aAAayC,GAKZ,OAJKzC,KAAKpF,OACToF,KAAKpF,KAAO,IAEboF,KAAKpF,KAAK6H,SAAWA,EACdzC,KAUR,SAAS0C,GAKR,OAJK1C,KAAKpF,OACToF,KAAKpF,KAAO,IAEboF,KAAKpF,KAAK8H,KAAOA,EACV1C,OCvDT,MAAM2C,EAAY,cAAcC,IAChCnQ,OAAOC,eAAeiQ,EAAUhP,UAAW,WAAY,CACtDf,IAAG,IAAY,yBAED,QCJf,MAAM,EAAY,cAAcgQ,IAChCnQ,OAAOC,eAAe,EAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,cAED,QCJf,MAAM,EAAY,cAAcgQ,IAChCnQ,OAAOC,eAAe,EAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,qBAED,QCJf,MAAM,EAAY,cAAcgQ,IAChCnQ,OAAOC,eAAe,EAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,mBAED,QCEf,MAAMiQ,EAAO,MAKZ,aAAaC,EAAMC,EAASC,EAAS,GAAIC,EAASJ,GAIjD,GAHKG,EAAOpI,OACXoI,EAAOpI,KAAO,CAAC8H,KAAM,KAElBI,EAAKpO,OAAQ,CAEhB,IADA,IAAIwO,EAAUzQ,OAAOqC,OAAOiO,GAAWE,EAAOE,UACrCpR,EAAI,EAAGA,EAAImR,EAAQxO,OAAQ3C,IAAM,CAEzC,IAAIqR,EAAYJ,EAAOpI,MAAQ,EAASoI,EAAOpI,KAAK8H,MAAQM,EAAOpI,KAAK8H,KAAKhO,OAAS,EAClF2O,EAASH,EAAQnR,GAAGuR,MAAMR,EAAM,CAACS,EAAOC,IAAaX,EAAKS,MAAMC,EAAOC,EAAUR,EAAQC,IAkB7F,GAhBII,GAAUL,EAAOpI,OACfyI,EAAOzI,OACXyI,EAAOzI,KAAO,IAGfyI,EAAOzI,KAAK8H,KAAOM,EAAOpI,KAAK8H,KAAK7N,MAAMuO,IAEtC,EAAYC,EAAQI,IAAuB,EAAYJ,EAAQK,MAClE,EAAQL,EAAOzI,KAAK8H,KAAMW,EAAOhF,SACjC,EAAQ2E,EAAOpI,KAAK8H,KAAMW,EAAOhF,SACjC2E,EAAOpI,KAAK8H,KAAKvN,KAAKkO,KAGpBA,GAAUL,EAAOW,SACpBC,QAAQC,IAAIf,EAAM,yBAAuBO,EAAOd,WAE5Cc,aAAkBS,GAAuBT,aAAkBU,MAC3Df,IAAWA,EAAOgB,SACtB,MAAM,IAAIC,MAAM,uBAAyBnB,GAE1C,GAAIO,EACH,OAAOA,EAGT,IAAsB,IAAlBL,EAAOkB,OACV,OAED,MAAM,IAAID,MAAM,mBAAqBnB,MAQzB,QCpDf,MAAMqB,EAAW,SAASjP,EAAK2M,EAAQ,EAAGuC,GAAc,GACvD,OAAK,EAAWvC,IAAUA,GAAS,EAC3B3M,IAEH,EAASA,IAAQ,EAAUA,IAAQkP,IACvClP,EAAMzC,OAAOqC,OAAOI,IAEhB,EAASA,GAGPA,EAAIsK,OAAO,CAAC6E,EAAK7P,IAAQ,EAASA,IAAS,EAAUA,IAAQ4P,EACjEC,EAAIjG,OAAO+F,EAAU,EAAS3P,GAA4BA,EAArB/B,OAAOqC,OAAON,GAAYqN,EAAQ,EAAGuC,IAC1EC,EAAIjG,OAAO5J,GAAM,IAJZU,IAUM,QC1BA,kBACd,IAAIoP,EAAQ,EACZpP,EAAIF,QAAQC,IACXqP,MAED,IAAIC,EAASrP,EAAIL,MAAMK,EAAIR,OAAS4P,EAAOE,GAC3C,OAAO/P,UAAUC,OAAS,EAAI6P,EAASA,EAAO,ICDhC,kBACd,OAAO9P,UAAUC,OAAS,EACvB,EAAOQ,EAAIL,QAAQ4P,UAAWD,GAAQC,UACtC,EAAOvP,EAAIL,QAAQ4P,YCFR,gBACd,IAAIC,EAAU,GAId,OCNc,cAEdC,GADAA,EAAQA,GAASlS,OAAOkB,aACN,EAASgR,GAAS,CAACA,GAASA,EAE9C,IAAIC,EAAkB,GAEtB,IADIjE,EAAMA,EACHA,KAASgE,GAASA,EAAMvQ,QAAQuM,GAAO,IAAmB,YAAbA,EAAIrO,MACvDsS,EAAgBzP,KAAKwL,GACrBA,EAAMA,EAAMlO,OAAOyO,eAAeP,GAAO,KAE1C,OAAOiE,EDPP,CAAmBjE,EAAKgE,GAAO3P,QAAQ2L,IACtC,EAAY+D,KAAYjS,OAAOoS,oBAAoBlE,MAE7C+D,GEAO,+BACd,IAAI7C,EAAQ,EACRH,EAAOoD,EAAKxE,QAKhB,IAJI,EAAWoB,KAAkB,IAATA,IAA0B,IAATA,KACxCG,EAAQH,EACRA,EAAOoD,EAAKxE,UAERwE,EAAKpQ,OACT,MAAM,IAAIuP,MAAM,gDAgCjB,OA9BAa,EAAK9P,QAAQ,CAAC2M,EAAM5P,MACd,EAAc4P,IAAU,EAAYA,MAGxCoD,EAAY,EAAqBpD,GAAQlP,OAAOoS,oBAAoBlD,IAAO3M,QAAQ1B,IACnF,IAAI0R,EAAYtD,EAAKpO,GACjB2R,EAAYtD,EAAKrO,GACrB,IAAM,EAAS0R,IAAc,EAASC,IAAgB,EAAUD,IAAc,EAAUC,OAC1E,IAAVpD,GAAkBA,EAAQ,GAE7BH,EAAKpO,GAAO,EAAS0R,IAAc,EAASC,GAAa,GAAK,GAC9D,EAAe,CAAC,EAAWpD,GAASA,EAAQ,EAAIA,EAAOH,EAAKpO,GAAM0R,EAAWC,GAAY1P,EAAUwP,EAAWG,QACxG,GAAI3P,EAASjC,EAAKoO,EAAMC,EAAM5P,GACpC,GAAI,EAAS2P,IAAS,EAASC,GAC1BuD,EACHxD,EAAKpO,GAAO2R,EAEZvD,EAAKvM,KAAK8P,QAEL,GAAIE,EACV1S,OAAOC,eAAegP,EAAMpO,EAAKb,OAAO2S,yBAAyBzD,EAAMrO,SAEvE,IAECoO,EAAKpO,GAAOqO,EAAKrO,GAChB,MAAM+R,SAKL3D,GC9CO,iBACd,OAAO,EAAeoD,EAAM,CAACvD,EAAGG,EAAMC,KAC9B,ICCM,mBACd,OAAO,EAAe,CAAC,GAAIhB,GAAM,CAACrN,EAAKoO,EAAMC,KAC5C,IAAK,EAAYA,EAAKrO,IACrB,OAAO,EAAY+B,GAAUA,EAAO/B,IAChC,EAAS+B,KAAWA,EAAOX,QAASW,EAAOjB,QAAQd,IAAQ,IAE9D,GAAoB,GAAoB,ICH5C,MAAMgS,EAAQ,MASb,WAAWC,EAAKC,EAAQC,GACvB,IAAK,EAAUF,GACd,MAAM,IAAItB,MAAM,+BAGjB,IAAIyB,EAAW,IAAIJ,EAAMC,EAAKE,GAK9B,OAHAH,EAAMK,OAAOJ,GAAOD,EAAMK,OAAOJ,IAAQ,GACzCD,EAAMK,OAAOJ,GAAKpQ,KAAKuQ,GAEhBA,EAASE,IAAIJ,GAUrB,aAAaD,EAAKC,EAAQC,GACzB,OAAOH,EAAMM,IAAIL,EAAKC,EAAQC,GAASI,OAUxC,aAAaN,EAAKC,EAAQC,GACzB,OAAOH,EAAMM,IAAIL,EAAKC,EAAQC,GAAS9F,QAcxC,YAAY4F,EAAKE,GAChB,IAAK,EAAUF,GACd,MAAM,IAAItB,MAAM,qDAEjBjE,KAAK8F,KAAOP,EACZvF,KAAK+F,SAAWN,GAAW,GACtBzF,KAAK+F,SAASC,SAClBhG,KAAK+F,SAASC,OAASV,EAAMW,SAEzBjG,KAAK+F,SAASG,SAClBlG,KAAK+F,SAASG,OAASZ,EAAMa,SAEzBnG,KAAK+F,SAAStD,WAClBzC,KAAK+F,SAAStD,SAAW6C,EAAMc,WAEhCpG,KAAK2F,OAAS,GAcf,IAAIH,EAAQC,GACX,IAAIY,EAAU,CACbb,OAAQ,EAASA,GACjBC,QAAS,GAAO,EAAM,GAAIzF,KAAK+F,SAAUN,GAAW,IACpDa,QAAS,GACTC,SAAU,EACV9D,SAAU,GACVoD,OAAQ,GACRlG,QAAS,GACT6G,SAAU,IAGX,IAA8B,IAA1BH,EAAQZ,QAAQgB,MACnB,IAAK,IAAI1U,EAAI,EAAGA,EAAIiO,KAAK2F,OAAOjR,OAAQ3C,IACvC,GAAI,EAAMiO,KAAK2F,OAAO5T,GAAGyT,OAAQa,EAAQb,SAAW,EAAMxF,KAAK2F,OAAO5T,GAAG0T,QAASY,EAAQZ,SACzF,OAAO,EAAWzF,KAAK2F,OAAO5T,IAOjC,GADAiO,KAAK0G,aAAaL,EAAS,GACvBA,EAAQC,QAAQ5R,OACnB,MAAM,IAAIuP,MAAM,6BAA+BjE,KAAK8F,KAAO,0BAA4B,EAASO,EAAQC,SAASK,KAAK,OAOvH,OAJ8B,IAA1BN,EAAQZ,QAAQgB,OACnBzG,KAAK2F,OAAOxQ,KAAKkR,GAGXA,EAYR,aAAaA,EAAStU,GACrB,KAAIA,GAAKiO,KAAK8F,KAAKpR,QAAnB,CAGA,IAAIkS,EAAY,EACZC,EAAc,GAAIC,EAAY,GAAIC,EAAc,GAUpD,GARKV,EAAQW,cACZF,EAAY9G,KAAKiH,YAAYZ,EAAStU,IAGlCsU,EAAQa,YACZL,EAAc7G,KAAKmH,cAAcd,EAAStU,IAGvCsU,EAAQW,aAAeH,EAAYO,OAEtC,GAAKf,EAAQC,QAAQ5R,QAAWqS,EAAYK,OAQ3CpH,KAAKqH,MAAMhB,EAASrG,KAAK8F,KAAK/T,SAN9B6U,GADIU,EAAQT,EAAYU,UAAYV,EAAYO,QAAUpH,KAAK8F,KAAK/T,IAClD2C,OAClBsL,KAAKqH,MAAMhB,EAASiB,EAAO,YACvBjB,EAAQZ,QAAQ+B,kBACnBxH,KAAKqH,MAAMhB,EAASiB,QAKhB,GAAIjB,EAAQa,WAAaJ,EAAUM,OAEzCpH,KAAKqH,MAAMhB,EAASrG,KAAK8F,KAAK/T,QACxB,IAAIsU,EAAQZ,QAAQhF,OAAS4F,EAAQ1G,QAAQjL,SAAW2R,EAAQZ,QAAQhF,MAE9E,OADAT,KAAKqH,MAAMhB,EAASrG,KAAK8F,KAAK/T,IACvBiO,KAAK0G,aAAaL,EAAStU,EAAI,GAGtCgV,EAAc/G,KAAKyH,aAAapB,EAAStU,GAIrCgV,EAAc/G,KAAKyH,aAAapB,EAAStU,GAA7C,IAEI2V,EAAW1H,KAAK2H,WAAWtB,EAAQZ,QAAQmC,WAAa,GAAIvB,EAAStU,GACzE,IAAKsU,EAAQC,QAAQ5R,SAAuB,IAAbgT,EAG9B,OAFArB,EAAQZ,QAAQiC,SAAWA,OAC3BrB,EAAQZ,QAAQoC,gBAAkB7H,KAAK8F,KAAKzR,OAAOtC,IAMpD,GAAKsU,EAAQb,OAAO9Q,OAiBnB,GAAK2R,EAAQC,QAAQ5R,QAAWqS,EAAYK,OAgBrC,CACN,IAAIE,EACJV,GADIU,EAAQP,EAAYQ,UAAYR,EAAYK,QAAUpH,KAAK8F,KAAK/T,IAClD2C,OAClBsL,KAAKqH,MAAMhB,EAASiB,OAnB+B,CAGnDtH,KAAKqH,MAAMhB,EAAS,IACpB,IAAIyB,EAAe9H,KAAK2H,WAAWtB,EAAQb,OAAQa,EAAStU,GAC5D,IAAqB,IAAjB+V,IACHzB,EAAQ1G,QAAQxK,KAAK2S,GACrBzB,EAAQG,SAASzU,GAAK+V,EACtBlB,EAAYkB,EAAapT,QAAU,GAC9B2R,EAAQZ,QAAQsC,gBAGpB,OAAO/H,KAAK0G,aAAaL,EAAStU,GAAK+V,EAAapT,QAAU,IAGhEsL,KAAKqH,MAAMhB,EAASyB,GAAgB9H,KAAK8F,KAAK/T,SA9BhB,IAA3BsU,EAAQC,QAAQ5R,QAAgBqS,EAAYQ,UAC/ClB,EAAQ1G,QAAQxK,KAAK,MACrB6K,KAAKqH,MAAMhB,EAASU,EAAYQ,UAChCX,EAAYG,EAAYQ,SAAS7S,SACtB2R,EAAQC,QAAQ5R,QAAUqS,EAAYK,QACjDpH,KAAKqH,MAAMhB,EAASU,EAAYK,QAChCR,EAAYG,EAAYK,OAAO1S,OAC/B2R,EAAQ1G,QAAQxK,KAAK,OAErB6K,KAAKqH,MAAMhB,EAASrG,KAAK8F,KAAK/T,IA6BjC,OAAOiO,KAAK0G,aAAaL,EAAStU,EAAI6U,IAWvC,YAAYP,EAAStU,GACpB,IAAI+P,EAAS,GAYb,OAXCuE,EAAQZ,QAAQS,QAAU,IAAIlR,QAAQgT,IAClChI,KAAK8F,KAAKzR,OAAOtC,EAAG,KAAOiW,IACzB3B,EAAQa,UAGFc,IAAU3B,EAAQa,YAC5Bb,EAAQa,WAAY,EACpBpF,EAAOsF,OAASY,IAJhB3B,EAAQa,UAAYc,EACpBlG,EAAOyF,SAAWS,MAOdlG,EAWR,cAAcuE,EAAStU,GACtB,IAAI+P,EAAS,GAgBb,OAfCuE,EAAQZ,QAAQhD,UAAY,IAAIzN,QAAQiT,IACxC,GAAK5B,EAAQW,aAMN,GAAI,EAAMiB,KAAW,EAAM5B,EAAQW,aAAc,CACvD,IAAI7U,KAAI6N,KAAK8F,KAAKzR,OAAOtC,GAAGmW,MAAM,IAAIC,OAAO,IAAM,EAAMF,QAExD5B,EAAQW,aAAc,EACtBlF,EAAOsF,OAASjV,EAAE,UATfA,EAAI6N,KAAK8F,KAAKzR,OAAOtC,GAAGmW,MAAM,IAAIC,OAAO,IAAM,EAAOF,QAEzD5B,EAAQW,YAAciB,EACtBnG,EAAOyF,SAAWpV,EAAE,MAUhB2P,EAWR,aAAauE,EAAStU,GACrB,IAAI+P,EAAS,GAeb,OAdCuE,EAAQZ,QAAQO,QAAU,IAAIhR,QAAQiT,IACtC,IAAIV,EAAWvH,KAAK8F,KAAKzR,OAAOtC,GAAGmW,MAAM,IAAIC,OAAO,IAAM,EAAOF,KACjE,GAAIV,EACHlB,EAAQC,QAAUD,EAAQC,QAAQlI,OAAO,CAAC6J,IAC1CnG,EAAOyF,SAAWA,EAAS,QACrB,GAAIlB,EAAQC,QAAQ5R,QAAU,EAAMuT,KAAW,EAAM,EAAM5B,EAAQC,UAAW,CACpF,IAAIc,EAASpH,KAAK8F,KAAKzR,OAAOtC,GAAGmW,MAAM,IAAIC,OAAO,IAAM,EAAMF,KAC1Db,IACHf,EAAQC,QAAUD,EAAQC,QAAQzR,MAAM,GAAI,GAC5CiN,EAAOsF,OAASA,EAAO,OAI1Bf,EAAQE,SAAW6B,KAAKC,IAAIhC,EAAQE,SAAUF,EAAQC,QAAQ5R,QACvDoN,EAYR,WAAWwG,EAAUjC,EAAStU,GAC7B,IAAK,IAAIwP,EAAI,EAAGA,EAAI+G,EAAS5T,OAAQ6M,IAAM,CAC1C,IAAIgH,EAAOD,EAAS/G,GACpB,GAAI8E,EAAQZ,QAAQ+C,SAAU,CAC7B,IAAIrW,EAAI6N,KAAK8F,KAAKzR,OAAOtC,GAAGmW,MAAM,IAAIC,OAAO,IAAMI,GAAmC,IAA7BlC,EAAQZ,QAAQ+C,SAAoBnC,EAAQZ,QAAQ+C,SAAW,KACxH,GAAIrW,EACH,OAAOA,EAAE,GAGX,IAAMkU,EAAQZ,QAAQgD,IAAMzI,KAAK8F,KAAKzR,OAAOtC,EAAGwW,EAAK7T,UAAY6T,GAC7DlC,EAAQZ,QAAQgD,IAAMzI,KAAK8F,KAAKzR,OAAOtC,EAAGwW,EAAK7T,QAAQ8I,gBAAkB+K,EAAK/K,cACjF,OAAO+K,EAGT,OAAO,EAYR,MAAMlC,EAASiB,EAAOoB,EAAS,UAC9B,IAAIC,EAActC,EAAQ1G,QAAQjL,OAC9B,EAAa2R,EAAQqC,GAAQC,MAChCtC,EAAQqC,GAAQC,GAAe,IAEhCtC,EAAQqC,GAAQC,IAAgBrB,EAWjC,MAAM/B,EAAKC,EAAQC,GAClB,OAAOzF,KAAK4F,IAAIJ,EAAQC,GAASI,OAWlC,MAAMN,EAAKC,EAAQC,GAClB,OAAOzF,KAAK4F,IAAIJ,EAAQC,GAAS9F,QAWlC,SAAS6F,EAAQC,GAChB,OAAOzF,KAAK4F,IAAIJ,EAAQ,EAAO,CAACgD,UAAU,GAAO/C,GAAW,KAW7D,SAASD,EAAQC,GAChB,OAAOzF,KAAK4I,SAASpD,EAAQC,GAASI,OAWvC,SAASL,EAAQC,GAChB,OAAOzF,KAAK4I,SAASpD,EAAQC,GAAS9F,UAOxC2F,EAAMW,QAAU,CAAC,CAAC,MAAO,OAAQ,CAAC,MAAO,OAAQ,CAAC,MAAO,QAKzDX,EAAMa,QAAU,CAAC,IAAK,IAAK,KAK3Bb,EAAMc,UAAY,CAAC,CAAC,SAAU,UAAW,CAAC,SAAU,cAKpDd,EAAMK,OAAS,GAKA,QC9aA,cACd,OAAO,EAAUzL,KCPH,EDcX2O,GAAU,EAAY3O,EAAM2O,IAPC,CAC/B,UACA,YACA,MACA,MACA,MACA,OCZUrJ,OAAO,CAACsJ,EAAU7T,IAAQ6T,GAAYvT,EAASN,IAAM,IADlD,OCgBA,oBAAoC8T,GAAoB,GACtEC,EAAO,EAASA,GAAMnU,QAEtB,IADA,IAAIoU,EAAQC,GACL,EAAaD,KAAW,EAAQA,IAAUD,EAAKtU,QAAQ,CAC7D,IAAIyU,EAAOH,EAAK1I,QACZ8I,EAAYL,GAAqB,EAAcE,GACnD,KAAMG,EAAYH,EAAMrW,IAAIuW,GAAS,EAAcF,GAASE,KAAQF,EAAQA,EAAME,IAEjF,YADAE,EAASC,QAAS,GAGnBL,EAAQG,EAAYH,EAAMrW,IAAIuW,GAAQF,EAAME,GAG7C,OADAE,EAASC,QAAS,EACXL,GC3BR,MAAM,UAAiB3U,MAWtB,IAAIiV,EAASC,GAAW,GACvB,IAAI,IAAIzX,EAAI,EAAGA,EAAIiO,KAAKtL,OAAQ3C,IAAM,CACrC,IAAIyC,EAAM,EAAKwL,KAAKjO,GAAIwX,GACxB,GAAI,EAAY/U,IAAQgV,EACvB,OAAOhV,EAAIjB,KAAKyM,KAAKjO,IAEtB,IAAK,EAAayC,GACjB,OAAOA,GAYV,cAAciV,GACb,OAAOA,aAAiB,EAAWA,EAC/BA,EAAQ,IAAI,EAASA,GAAS,IAAI,GAOzB,QCxCA,kBACd,OAAOzV,EAAQ6J,WAAW6L,IAAe1V,EAAQ2V,SAASC,ICD5C,qBACd,GAAc,IAAV7V,EACH,OAAOC,EAER,IAAIC,EAAM4V,EAAY7V,EAAQG,YAAYJ,GAAUC,EAAQI,QAAQL,GACpE,OAAa,IAATE,EACI,GAEDD,EAAQK,OAAOJ,EAAMF,EAAOW,SCJrB,gBACd,OAAO,EAAQV,EAASD,GAAQ,ICClB,kBACd,OAAO,EAAY,EAAOC,EAAS0V,GAAaE,ICLjD,MAAM,GAAY,cAAchH,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,gBAED,UCDf,MAAMkX,GAAc,cAAcC,GAKjC,YAAYjH,GACXkH,QACAhK,KAAK8C,KAAOA,EAMb,KAAKzE,EAAU,KAAM9I,EAAW,MAC/B,OAAOyK,KAAK8C,KAAKmH,KAAK5L,EAAS9I,GAMhC,SAAS8I,EAAU,MAClB,MAAO,IAAM2B,KAAK8C,KAAK1B,SAAS/C,GAAW,IAM5C,aAAayE,EAAMoH,EAAejH,EAAS6G,IAC1C,GAAI,EAAShH,EAAM,IAAK,OAAS,EAAMoF,MAAMpF,EAAM,CAAC,MAAMpO,OACzD,OAAO,IAAIuO,EACViH,EAAc,EAAQpH,EAAM,IAAK,SAStB,UC1Cf,MAAM,GAAY,cAAcF,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,cAED,UCDf,MAAMuX,GAAM,cAAcC,GAKzB,YAAYC,GACXL,QACAhK,KAAKqK,MAAQA,GAAS,GAMvB,QAAQ7H,GACP,GAAIA,aAAiB4H,GAAc,CAClC,IAAIE,EAAW9H,EAAM6H,MAAMhV,OAAOkV,GAC1BvK,KAAKqK,MAAM7K,OAAO,CAACgL,EAAaC,IAAUD,IAAgBD,EAAMG,KAAKD,IAAQ,IAErFzK,KAAKqK,MAAQC,EAASlM,OAAO4B,KAAKqK,OAEnC,OAAOrK,KAMR,KAAK3B,EAAU,KAAM9I,EAAW,MAC/B,OAAOyK,KAAKqK,MAAM7P,IAAIsI,GAAQA,EAAKmH,KAAK5L,EAAS9I,IAMlD,SAAS8I,EAAU,MAClB,MAAO,IAAM2B,KAAKqK,MAAM7P,IAAIsI,GAAQA,EAAK1B,SAAS/C,IAAUsI,KAAK,MAAQ,IAM1E,aAAa7D,EAAMoH,EAAejH,EAASkH,IAC1C,GAAI,EAASrH,EAAM,IAAK,OAAS,EAAMoF,MAAMpF,EAAK3E,OAAQ,CAAC,MAAMzJ,OAGhE,OAAO,IAAIuO,EAFE,EAAMjF,MAAM,EAAQ8E,EAAM,IAAK,KAAM,CAAC,MACjDtI,IAAIhH,GAAKA,EAAE2K,QAAQ9I,OAAO7B,GAAKA,GAAGgH,IAAIsI,GAAQoH,EAAcpH,OASlD,UCvDf,MAAM,GAAY,cAAcF,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,cAED,UCDf,MAAM+X,GAAY,cAAcC,GAK/B,YAAYzN,EAAO,IAClB6M,QACAhK,KAAK7C,KAAOA,EAMb,KAAKkB,EAAU,KAAM9I,EAAW,MAC/B,OAAOyK,KAAK7C,KAAK3C,IAAIqQ,GAAOA,EAAIZ,KAAK5L,EAAS9I,IAM/C,SAAS8I,EAAU,MAClB,MAAO,IAAM2B,KAAK7C,KAAK3C,IAAIqQ,GAAOA,EAAIzJ,SAAS/C,IAAUsI,KAAK,MAAQ,IAMvE,aAAa7D,EAAMoH,EAAejH,EAAS0H,IAE1C,GADU7H,EAAOA,EAAK3E,OAClB,EAAS2E,EAAM,IAAK,OAAS,EAAMoF,MAAMpF,EAAM,CAAC,MAAMpO,OACzD,OAAO,IAAIuO,EACV,EAAMjF,MAAM,EAAQ8E,EAAM,IAAK,KAAM,CAAC,MAAMtI,IAAIqQ,GAAOX,EAAcW,EAAI1M,YAS9D,UC/CA,eAId,OAAOjJ,EAAIG,OAHM,CAACrC,EAAO8X,EAAOC,IACxBA,EAAK3W,QAAQpB,KAAW8X,ICEjC,MAAM,GAAY,cAAclI,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,wBAED,UCAf,MAAMoY,GAAY,cAAcC,GAK/B,YAAYZ,EAAOa,GAClBlB,QACAhK,KAAKqK,MAAQA,EACbrK,KAAKkL,MAAQA,EAMb,KAAK7M,EAAU,KAAM9I,EAAW,MAChC,GAAmB,MAAfyK,KAAKkL,MACR,OAAQ,EAAOlL,KAAKqK,OAAOJ,KAAK5L,EAAS9I,GAE1B,EAASyV,GAAUG,WAOnC,IAPA,IACID,GAASlL,KAAKkL,OAAS,IAAI/M,OAAOiN,cAClCC,EAAOH,KAAWF,GAAUG,UAAUG,IAAM,IAAInN,OAAOiN,cACvDG,EAAQL,KAAWF,GAAUG,UAAUK,KAAO,IAAIrN,OAAOiN,cACzDK,EAAQP,KAAWF,GAAUG,UAAUO,KAAO,IAAIvN,OAAOiN,cACzDO,EAAST,KAAWF,GAAUG,UAAUS,MAAQ,IAAIzN,OAAOiN,cAC3DS,GAAa,EAAMC,EAAQ,EACvB/Z,EAAI,EAAGA,EAAIiO,KAAKqK,MAAM3V,OAAQ3C,IAAM,CAC3C,GAAI0Z,IAAUI,EACb,OAAO,EAER,GAAIF,IAAWE,EACd,OAAO,EAGR,GADAA,EAAa7L,KAAKqK,MAAMtY,GAAGkY,KAAK5L,EAAS9I,GACrC8V,GAAQQ,EACX,OAAOA,EAERC,GAASD,EAAa,EAAI,EAE3B,OAAIR,EAGIQ,EAEJJ,GAASE,EAILF,EAGDF,GAAmB,IAAVO,EAMhB,SAASzN,EAAU,MACnB,MAAmB,MAAf2B,KAAKkL,MACD,IAAM,EAAOlL,KAAKqK,OAAOjJ,SAAS/C,GAEnC2B,KAAKqK,MAAM7P,IAAIsI,GAAQA,EAAK1B,SAAS/C,IAAUsI,KAAK,IAAM3G,KAAKkL,MAAQ,KAM/E,aAAapI,EAAMoH,EAAejH,EAAS+H,IAC1C,GAAIlI,EAAKjF,WAAW,KACnB,OAAO,IAAIoF,EACV,CAACiH,EAAcpH,EAAKzO,OAAO,KAC3B,KAGF,IAAIiP,EAAQ,EAAMsC,IAAI9C,EAAM,EAASG,EAAOkI,YAC5C,GAAI7H,EAAMuC,OAAOnR,OAAS,EAAG,CAC5B,IAAIwW,EAAQ,GAAQ5H,EAAM3D,SAC1B,GAAIuL,EAAMxW,OAAS,EAClB,MAAM,IAAIuP,MAAM,mEAAqEnB,EAAO,KAE7F,OAAO,IAAIG,EACVK,EAAMuC,OAAOrL,IAAIsI,GAAQoH,EAAcpH,EAAK3E,SAC5C,EAAO+M,OASXF,GAAUG,UAAY,CACrBO,IAAK,KACLJ,GAAI,MAMU,UChGf,MAAMS,GAAa,cAAcjI,EAKhC,YAAYkI,EAAWxX,EAAKyX,EAAW,KACtCjC,QACAhK,KAAKgM,UAAYA,EACjBhM,KAAKxL,IAAMA,EACXwL,KAAKiM,SAAWA,EAMjB,KAAK5N,EAAU,KAAM9I,EAAW,MAC/B,IAAIyW,EAAYhM,KAAKgM,UAAUE,QAAQ7N,EAAS9I,GAC5Cf,EAAMwL,KAAKxL,IAAIyV,KAAK5L,EAAS9I,GACjC,OAAK,EAAayW,EAAU3N,WAAa,EAAa2N,EAAU1Z,QAC3D,EAAYiD,GACRA,EAASyK,KAAMgM,EAAU3N,QAAS2N,EAAU1Z,KAAMkC,KAG9CwX,EAAU3N,mBAAmB,EACtC,EAAM2N,EAAU3N,SAChB2N,EAAU3N,SAEP2N,EAAU1Z,MAAQkC,GACjB,IAQT,SAAS6J,EAAU,MAClB,MAAO,CAAC2B,KAAKgM,UAAU5K,SAAS/C,GAAU2B,KAAKiM,SAAUjM,KAAKxL,IAAI4M,SAAS/C,IAAUsI,KAAK,KAM3F,aAAa7D,EAAMoH,EAAejH,EAAS8I,IAC1C,IAAIzI,EAAQ,EAAMsC,IAAI9C,EAAMG,EAAOkI,WACnC,GAA4B,IAAxB7H,EAAMuC,OAAOnR,OAAc,CAC9B,IAAIsX,EAAWxX,EACf,MAAOwX,EAAY9B,EAAc5G,EAAMuC,OAAOvF,QAAQnC,mBAAoBsF,IACrEjP,EAAM0V,EAAc5G,EAAMuC,OAAOvF,QAAQnC,UAC7C,MAAM,IAAI8F,MAAM,iCAAmCnB,GAEpD,OAAO,IAAIG,EAAO+I,EAAWxX,EAAK8O,EAAM3D,QAAQ,GAAGxB,WAQtD4N,GAAWZ,UAAY,CAAC,OAKT,UCtEf,MAAM,GAAY,cAAcvI,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,gBAED,UCHf,MAAMuZ,GAAO,cAAcC,GAK1B,YAAYC,GACXrC,QACAhK,KAAKqM,MAAQA,EAMd,OACC,MAA2C,SAApCrM,KAAKqM,MAAM7O,cAAcW,OAMjC,WACC,OAAO6B,KAAKqM,MAMb,aAAavJ,EAAMoH,EAAejH,EAASkJ,IAE1C,GAAa,UADTrJ,EAAOA,EAAKtF,cAAcW,SACE,UAAT2E,EACtB,OAAO,IAAIG,EAAOH,KAQN,UC7Bf,MAAMwJ,GAAO,cAAc5I,EAK1B,YAAYsI,EAAWO,GACtBvC,QACAhK,KAAKgM,UAAYA,EACjBhM,KAAKuM,KAAOA,EAMb,KAAKlO,EAAU,KAAM9I,EAAW,MAC/B,IAAIyW,EAAYhM,KAAKgM,UAAUE,QAAQ7N,EAAS9I,GAC5CgX,EAAOvM,KAAKuM,KAAKtC,KAAK5L,EAAS9I,GACnC,IAAK,EAAayW,EAAU1Z,MAAO,CAClC,GAAI,EAAYiD,GACf,OAAOA,EAASyK,KAAMgM,EAAU3N,QAAS2N,EAAU1Z,KAAMia,GAG1D,IAAIC,EAAY,EAASnZ,OAAO2Y,EAAU3N,SAASxJ,QAC/C4X,EAAOD,EAAU5Z,IAAIoZ,EAAU1Z,MAAM,GACzC,GAAI,EAAYma,GACf,OAAOA,KAAQF,GAIhB,IADA,IAAaG,EAAUF,EAAU3X,QAC3B6X,EAAQhY,SAAWiY,GAAS,CACjC,IAEIA,EAFAlD,EAAQiD,EAAQpM,QAChBsM,EAAQN,GAAKM,OAAS,GAK1B,IAJID,EAAU,EAAWlD,IAAUmD,EAAMC,IAAMD,EAAMC,IACjD,EAAUpD,IAAUmD,EAAME,IAAMF,EAAME,IACrC,EAASrD,IAAUmD,EAAMzC,IAAMyC,EAAMzC,IACpC,EAAUV,IAAUmD,EAAMG,IAAMH,EAAMG,IAAM,OACnC,EAAYJ,EAAQX,EAAU1Z,OAE5C,OADAia,EAAKS,QAAQvD,GACNkD,EAAQX,EAAU1Z,SAASia,GAEnC,MAAM,IAAItI,MAAM,IAAMjE,KAAO,mCAAqCwM,EAAUhS,IAAIpI,UAAYA,GAAGuU,KAAK,MAAQ,OAQ/G,SAAStI,EAAU,MAClB,OAAO2B,KAAKgM,UAAU5K,SAAS/C,GAAW2B,KAAKuM,KAAKnL,SAAS/C,GAM9D,aAAayE,EAAMoH,EAAejH,EAASqJ,IAC1C,IAAKxJ,EAAKjF,WAAW,MAAQiF,EAAK6G,SAAS,OAAS,EAAMzB,MAAMpF,EAAM,CAAC,MAAMpO,OAAQ,CACpF,IACIsX,EADAnG,EAAS,EAAM7H,MAAM8E,EAAM,IAChByJ,EAAO1G,EAAOoH,MAC7B,MAAOjB,EAAY9B,EAAcrE,EAAOc,KAAK,gBAAiBlD,IACzD8I,EAAOrC,EAAcqC,EAAM,CAAC,OAChC,MAAM,IAAItI,MAAM,2BAA6BnB,GAE9C,OAAO,IAAIG,EAAO+I,EAAWO,MAQjB,UCjFf,MAAM,GAAY,cAAc3J,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,aAED,UCDf,MAAMsa,GAAW,cAAcC,GAK9B,YAAY1K,EAAU7M,GACrBoU,QACAhK,KAAKyC,SAAWA,EAChBzC,KAAKpK,KAAOA,EAMb,KAAKyI,EAAU,KAAM9I,EAAW,OAMhC,SAAS8I,EAAU,MAClB,MAAO,GAMR,aAAayE,EAAMoH,EAAejH,EAASiK,IAC1C,IAAIE,EAAY,KACZ7J,EAAQ,KACR3N,EAAO,EACPyX,EAAmB,SAEvB,GAAIvK,EAAKjF,WAAW,MAEnBuP,GADIE,EAAS,EAAMtP,MAAM,EAAO8E,EAAM,MAAO,CAAC,UAC3BxC,QAAQnC,OAC3BoF,EAAQ+J,EAAOhN,QAAQnC,OACvBvI,EAAO,OACD,GAAIkN,EAAKjF,WAAW,MAAO,CAEjCuP,GADIE,EAAS,EAAMtP,MAAM,EAAO8E,EAAM,MAAO,CAAC,QAC3BxC,QAAQnC,OAC3BoF,EAAQ+J,EAAOhN,QAAQnC,OACvBvI,EAAO,OACD,GAAIkN,EAAK6G,SAAS,MAAO,CAC/B,IAAI2D,EACJF,GADIE,EAAS,EAAMtP,MAAMuP,YAAYzK,EAAM,MAAO,CAAC,QAChCmK,MAAM9O,OACzBoF,EAAQ+J,EAAOL,MAAM9O,OACrBvI,EAAO,EACHyX,EAAmB,QAWxB,GATIzX,IACU,IAATA,IACHwX,EAAY,EAAMpP,MAAMoP,EAAUjP,OAAQ,CAAC,SACzC3D,IAAIgT,GAAQA,EAAKC,QAAQ,SAAU,KACnCpY,OAAOmY,GAAQA,EAAKrP,SAEvByF,QAAQC,IAAIuJ,EAAWC,EAAkBvK,GACzCsK,EAAY,IAAInK,EAAOmK,EAAWxX,IAE/B2N,EAGH,OAFAA,EAAQ2G,EAAc3G,IAChB3I,KAAK8S,SAAWN,EACf7J,IAQK,UCrEA,wBACd,OAAQ,EAASnO,GAAaF,EAAIG,OAAOC,GAAQC,EAC9CH,EAAKC,OAAOG,GAAQD,EAASD,EAAME,IAAOd,QAClB,IAAxBU,EAAKhB,QAAQkB,IAFS,ICL1B,MAAM,GAAY,cAAcsN,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,yBAED,UCKf,MAAM+a,GAAa,cAAcC,GAKhC,YAAYC,EAAUC,EAAU7B,GAC/BjC,QACAhK,KAAK6N,SAAWA,EAChB7N,KAAK8N,SAAWA,EAChB9N,KAAKiM,SAAWA,EAMjB,KAAK5N,EAAU,KAAM9I,EAAW,MAC/B,OAAOoY,GAAWI,QACjB/N,KAAK6N,SAAS5D,KAAK5L,EAAS9I,GAC5ByK,KAAK8N,SAAS7D,KAAK5L,EAAS9I,GAC5ByK,KAAKiM,UAOP,SAAS5N,EAAU,MAClB,MAAO,CACN2B,KAAK6N,SAASzM,SAAS/C,GACvB2B,KAAKiM,SACLjM,KAAK8N,SAAS1M,SAAS/C,IACtBsI,KAAK,KAMR,aAAa7D,EAAMoH,EAAejH,EAAS0K,IAC1C,IAAIxC,EAAY,EAASlI,EAAOkI,WAAW3Q,IAAIwT,GAAQ,IAAMA,EAAO,KAChE1K,EAAQ,EAAMsC,IAAI9C,EAAMqI,GAC5B,GAAI7H,EAAMuC,OAAOnR,OAAS,EAAG,CAC5B,GAAI4O,EAAMuC,OAAOnR,OAAS,EACzB,MAAM,IAAIuP,MAAM,sCAAwCnB,EAAO,KAEhE,OAAO,IAAIG,EACViH,EAAc,EAAO5G,EAAMuC,QAAQ1H,QACnC+L,EAAc,EAAM5G,EAAMuC,QAAQ1H,QAClCmF,EAAM3D,QAAQ,GAAGxB,SAkBpB,eAAe0P,EAAUC,EAAU7B,EAAW,MAC7C,IAA0D,IAAtD,EAAS0B,GAAWxC,WAAW/W,QAAQ6X,GAC1C,MAAM,IAAIhI,MAAM,iBAAmBgI,EAAW,wBAE/C,GAAI,EAAS4B,IAAa,EAASC,IAA0B,QAAb7B,EAAoB,CACnE,GAAI4B,EAASnZ,SAAWoZ,EAASpZ,OAChC,OAAO,EAER,IAAIuZ,GAAgB,EACpBJ,EAASK,OACTJ,EAASI,OACT,IAAK,IAAInc,EAAI,EAAGA,EAAI8b,EAASnZ,OAAQ3C,IACpCkc,EAAgBA,GAAiBN,GAAWI,QAAQF,EAAS9b,GAAI+b,EAAS/b,GAAIka,GAE/E,OAAOgC,EACD,GAAI,EAAUJ,IAAa,EAAUC,IAA0B,QAAb7B,EAAoB,CAC5E,IAAIkC,EAAa1b,OAAOmC,KAAKiZ,GACzBO,EAAa3b,OAAOmC,KAAKkZ,GAC7B,GAAIK,EAAWzZ,SAAW0Z,EAAW1Z,QAAU,GAAYyZ,EAAYC,GAAY1Z,OAClF,OAAO,EAER,IAAI2Z,GAAkB,EAItB,OAHA,EAAMF,EAAY,CAACpc,EAAGuB,KACrB+a,EAAkBA,GAAmBV,GAAWI,QAAQF,EAASva,GAAMwa,EAASxa,GAAM2Y,KAEhFoC,EAER,OAAOpC,GACN,IAAK,MACJ,OAAO4B,IAAaC,EACrB,IAAK,KACL,IAAK,IACJ,OAAOD,GAAYC,EACpB,IAAK,IACJ,OAAOD,EAAWC,EACnB,IAAK,IACJ,OAAOD,EAAWC,EACnB,IAAK,KACJ,OAAOD,GAAYC,EACpB,IAAK,KACJ,OAAOD,GAAYC,EACpB,IAAK,KACJ,OAAOD,GAAYC,EACpB,IAAK,MACJ,OAAOD,IAAaC,EACrB,IAAK,KACJ,OAAO,EAAUD,IAAaA,EAAShQ,WAAWiQ,GACnD,IAAK,KACJ,OAAO,EAAUD,IAAaA,EAASlE,SAASmE,GACjD,IAAK,KAEJ,SAAO,EAASA,KAAa,EAAUA,KAAYD,EAASzZ,QAAQ0Z,IAAa,EAClF,IAAK,KAEJ,OAAO,EAAUD,IAAa,EAAUC,KAAc,IAAMD,EAAW,KAAKzZ,QAAQ,IAAM0Z,EAAW,MAAQ,EAC9G,IAAK,MACH,IAAM,EAASA,IAAiC,IAApBA,EAASpZ,OACpC,MAAM,IAAIuP,MAAM,kFAEjB,OAAO4J,GAAYC,EAAS,IAAMD,GAAYC,EAAS,GAEzD,IAAK,OACJ,OAAOA,EAAS5F,MAAM,IAAIC,OAAO0F,IAClC,QACC,OAAO,GAaV,YAAYA,EAAUC,EAAUQ,GAC/B,OAAQX,GAAWI,QAAQF,EAAUC,EAAUQ,EAAS,MAAQ,QAOlEX,GAAWxC,UAAY,CACtBoD,MAAO,CACNC,GAAI,MACJC,OAAQ,MACRC,SAAU,KACVC,YAAa,MAEdC,SAAU,CACTC,WAAY,IACZC,YAAa,IACbC,qBAAsB,KACtBC,sBAAuB,KACvBC,QAAS,OAEVC,QAAS,CACRrR,WAAY,KACZ8L,SAAU,KACVwF,SAAU,KACVC,IAAK,KACLC,GAAI,KACJ1P,QAAS,SAOI,UC1Lf,MAAM,GAAY,cAAciD,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,wBAED,UCHf,MAAM0c,GAAY,cAAcC,GAK/B,YAAY3N,EAAW4N,EAAQC,GAC9BzF,QACAhK,KAAK4B,UAAYA,EACjB5B,KAAKwP,OAASA,EACdxP,KAAKyP,QAAUA,EAMhB,KAAKpR,EAAU,KAAM9I,EAAW,MAC/B,OAAOyK,KAAK4B,UAAUqI,KAAK5L,EAAS9I,GACjCyK,KAAKwP,OAAOvF,KAAK5L,EAAS9I,GAC1ByK,KAAKyP,QAAQxF,KAAK5L,EAAS9I,GAM/B,SAAS8I,EAAU,MAClB,MAAO,CACN2B,KAAK4B,UAAUR,SAAS/C,GACxBiR,GAAUnE,UAAU,GACpBnL,KAAKwP,OAAOpO,SAAS/C,GACrBiR,GAAUnE,UAAU,GACpBnL,KAAKyP,QAAQrO,SAAS/C,IACrBsI,KAAK,KAMR,aAAa7D,EAAMoH,EAAejH,EAASqM,IAC1C,IAAIhC,EAAS,EAAMtP,MAAM8E,EAAMG,EAAOkI,WACtC,GAAImC,EAAO5Y,OAAS,EAAG,CACtB,GAAsB,IAAlB4Y,EAAO5Y,OACV,MAAM,IAAIuP,MAAM,iCAAmCnB,EAAO,KAE3D,OAAO,IAAIG,EACViH,EAAcoD,EAAO,GAAGnP,QACxB+L,EAAcoD,EAAO,GAAGnP,QACxB+L,EAAcoD,EAAO,GAAGnP,YAS5BmR,GAAUnE,UAAY,CAAC,IAAK,KAKb,UCvDf,MAAMuE,GAAW,cAAc3L,EAK9B,YAAYiI,EAAWC,EAAW,UACjCjC,QACAhK,KAAKgM,UAAYA,EACjBhM,KAAKiM,SAAWA,EAMjB,KAAK5N,EAAU,KAAM9I,EAAW,MAC/B,IAAIyW,EAAYhM,KAAKgM,UAAUE,QAAQ7N,EAAS9I,GAChD,OAAK,EAAayW,EAAU3N,WAAa,EAAa2N,EAAU1Z,QAC3D,EAAYiD,GACRA,EAASyK,KAAMgM,EAAU3N,QAAS2N,EAAU1Z,cAGxC0Z,EAAU3N,mBAAmB,EACtC,EAAM2N,EAAU3N,SAChB2N,EAAU3N,SAEA2N,EAAU1Z,OAChB,IAQT,SAAS+L,EAAU,MAClB,OAAO2B,KAAKiM,SAAW,IAAMjM,KAAKgM,UAAU5K,SAAS/C,GAMtD,aAAayE,EAAMoH,EAAejH,EAASyM,IAC1C,IAAIpM,EAAQ,EAAMsC,IAAI9C,EAAMrQ,OAAOqC,OAAOmO,EAAOkI,YACjD,GAA6B,IAAzB7H,EAAM3D,QAAQjL,QAAgBoO,EAAKjF,WAAWyF,EAAM3D,QAAQ,GAAK,KAAM,CAC1E,IAAIqM,EACJ,MAAOA,EAAY9B,EAAc5G,EAAMuC,OAAOoH,MAAM9O,mBAAoBsF,GACvE,MAAM,IAAIQ,MAAM,6BAA+BnB,GAEhD,OAAO,IAAIG,EAAO+I,EAAW1I,EAAM3D,QAAQ,GAAGxB,WAQjDuR,GAASvE,UAAY,CACpBwE,IAAK,SACLhX,IAAK,UAMS,UChEA,oBACd,IAAIkJ,EAAQ,EAMZ,OALI,EAAWpN,UAAU,KAAO,EAAcA,UAAU,MACvDoN,EAAQpN,UAAU,GAClBkM,EAAMlM,UAAU,GAChBY,EAASZ,UAAU,IAAM,IAEnB,EAAe,CAACoN,EAAO,GAAIlB,GAAM,CAACrN,EAAKoO,EAAMC,IAC5C,EAAYtM,GAAUA,EAAO/B,IAChC,EAAS+B,KAAWA,EAAOX,QAASW,EAAOjB,QAAQd,IAAQ,GAC7D,GAAoB,GAAoB,IChB5C,MAAM,GAAY,cAAcsP,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,iBAED,UCGf,MAAMgd,GAAO,cAAcC,GAK1B,YAAYC,EAAWC,EAAYC,EAA0B,IAC5DhG,QACAhK,KAAK8P,UAAYA,GAAa,GAC9B9P,KAAK+P,WAAaA,EAClB/P,KAAKgQ,wBAA0BA,EAMhC,QAAQxN,GACP,GAAIA,aAAiBqN,GAAe,CAGnC,IAFA,IAAII,EAAexd,OAAOmC,KAAK4N,EAAMsN,WACjCI,EAAYzd,OAAOmC,KAAKoL,KAAK8P,WACxB/d,EAAI,EAAGA,EAAIqW,KAAKC,IAAI6H,EAAUxb,OAAQub,EAAavb,QAAS3C,IAAM,CAC1E,IAAIoe,EAAeF,EAAale,GAC5Bqe,EAAaF,EAAUne,GAC3B,IAAKqe,GAAcD,EAClB,MAAM,IAAIlM,MAAM,cAAgBlS,EAAI,KAAOoe,EAAe,6CAE3D,GAAIC,GAAcD,EAAc,CAC/B,IAAIE,EAAqB7N,EAAMsN,UAAUK,GACrCG,EAAmBtQ,KAAK8P,UAAUM,GACtC,GAAIE,IAAqBD,EACxB,MAAM,IAAIpM,MAAM,cAAgBlS,EAAI,KAAOqe,EAAa,sEAEzD,GAAIE,GAAoBD,GAAsBC,EAAiB/N,WAAa8N,EAAmB9N,SAC9F,MAAM,IAAI0B,MAAM,gCAAkClS,EAAI,KAAOqe,EAAa,qBAAuBC,EAAmB9N,SAAW,wCAIlIvC,KAAK9D,IAAMsG,EAEZ,OAAOxC,KAMR,KAAK3B,EAAU,KAAM9I,EAAW,MAC/B,MAAO,IAAIgX,KACV,IAAIgE,EAAe,GACnB,EAAM9d,OAAOmC,KAAKoL,KAAK8P,WAAY,CAAC/d,EAAGO,KACtC,IAAIke,EAAaxQ,KAAK8P,UAAUxd,GAChC,GAAIia,EAAK7X,OAAS,EAAI3C,IAAMye,EAC3B,MAAM,IAAIvM,MAAM,kBAAoB3R,EAAO,kBAE5Cie,EAAaje,GAAQia,EAAK7X,OAAS3C,EAChCwa,EAAKxa,GACJiO,KAAK8P,UAAUxd,GACf0N,KAAK8P,UAAUxd,GAAM2X,KAAK5L,EAAS9I,GACnC,OAGL,IAAIkb,EAAmB,EAASpd,OAAOkd,GAAcnS,OAAO,EAAS/K,OAAOgL,IAC5E,OAAO2B,KAAK+P,WAAW9F,KAAKwG,EAAkBlb,IAOhD,SAAS8I,EAAU,MAClB,IAAIyR,EAAY,GAIhB,GAHA,EAAM9P,KAAK8P,UAAW,CAACxd,EAAMU,KAC5B8c,EAAU3a,KAAK7C,GAAQU,EAAQ,IAAMA,EAAMoO,SAAS/C,GAAW,OAE5D2B,KAAKgQ,wBAAyB,CACjC,IAAIU,GAAmD,IAAtC1Q,KAAKgQ,wBAAwB1Z,MAAwC,IAArBwZ,EAAUpb,SAA+C,IAA/Bob,EAAU,GAAG1b,QAAQ,KAC5Guc,GAAmD,IAAtC3Q,KAAKgQ,wBAAwB7X,KAC9C,OAAQuY,EAAaZ,EAAU,GAAK,IAAMA,EAAUnJ,KAAK,MAAQ,KAC/D,QAAUgK,EAAa3Q,KAAK+P,WAAW3O,SAAS/C,GAAW,IAAM2B,KAAK+P,WAAW3O,SAAS/C,GAAW,KAExG,MAAO,aAAeyR,EAAUnJ,KAAK,MAAQ,MAAQ3G,KAAK+P,WAAW3O,SAAS/C,GAAW,IAM1F,aAAayE,EAAMoH,EAAejH,EAAS2M,IAE1C,IAAItC,EACJ,IAFAxK,EAAOA,EAAK3E,QAEHN,WAAW,cAChByP,EAAS,EAAMtP,MAAM8E,EAAM,IAAIjO,MAAM,GAAGQ,OAAOyC,GAAKA,EAAEqG,UAA8B,IAAlBmP,EAAO5Y,OAC5E,IAAIsb,GAA0B,EAC1BY,EAAW,EAAQtD,EAAOhN,QAAQnC,OAAQ,IAAK,KAC/C0S,EAAW,EAAQvD,EAAOhN,QAAQnC,OAAQ,IAAK,SAC7C,IAAK2E,EAAKjF,WAAW,eACxByP,EAAS,EAAMtP,MAAM8E,EAAM,CAAC,SAA6B,IAAlBwK,EAAO5Y,OAejD,OAdIkc,EAAWtD,EAAOhN,QAAQnC,OAC1B0S,EAAWvD,EAAOhN,QAAQnC,OAC1B6R,EAA0B,GAC1B,EAASY,EAAU,IAAK,KAC3BA,EAAW,EAAQA,EAAU,IAAK,KAElCZ,EAAwB1Z,MAAO,EAE5B,EAASua,EAAU,IAAK,KAC3BA,EAAW,EAAQA,EAAU,IAAK,KAElCb,EAAwB7X,MAAO,EAKjC,IAAI2X,EAAY,GAChB,EAAM9R,MAAM4S,EAAU,CAAC,MAAM5b,QAAQ2B,IACpC,IAAIma,EAAana,EAAMqH,MAAM,KACzB8S,EAAW,GACdhB,EAAUgB,EAAW,GAAG3S,QAAU+L,EAAc4G,EAAW,GAAG3S,QAE9D2R,EAAUnZ,EAAMwH,QAAU,OAG5B,IAAI4R,EAAa7F,EAAc2G,GAC/B,OAAO,IAAI5N,EAAO6M,EAAWC,EAAYC,KAO3CJ,GAAKzE,UAAY,CAAC,MAKH,UC3If,MAAM,GAAY,cAAcvI,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,mBAED,UCCf,MAAM,GAAO,cAAcme,GAK1B,YAAYvc,EAAK6V,GAChBL,QACAhK,KAAKxL,IAAMA,EACXwL,KAAKqK,MAAQA,EAMd,KAAKhM,EAAU,KAAM9I,EAAW,MAC/B,OAAOyK,KAAKqK,MAAM7K,OAAO,CAACwR,EAAclO,KACvC,IAAItO,EAAMsO,EAAKtO,IAAIyV,KAAK5L,EAAS9I,GAC7B0W,EAAWnJ,EAAKmJ,SAAS9N,OAC7B,KAAM,EAAW6S,IAAkB,EAAWxc,IAAsB,MAAbyX,GACtD,MAAM,IAAIhI,MAAM,4BAA8BjE,KAAKoB,WAAa,KAEjE,OAAO6K,GACN,IAAK,IACJ,OAAO+E,EAAexc,EACvB,IAAK,IACJ,OAAOwc,EAAexc,EACvB,IAAK,IACJ,OAAOwc,EAAexc,EACvB,IAAK,IACJ,OAAOwc,EAAexc,IAEtBwL,KAAKxL,IAAIyV,KAAK5L,EAAS9I,IAM3B,SAAS8I,EAAU,MAClB,MAAO,CAAC2B,KAAKxL,IAAI4M,SAAS/C,IAAUD,OACnC4B,KAAKqK,MAAM7P,IAAIsI,GAAQA,EAAKmJ,SAAW,IAAMnJ,EAAKtO,IAAI4M,SAAS/C,KAC9DsI,KAAK,KAMR,aAAa7D,EAAMoH,EAAejH,EAAS,IAC1C,IAAIK,EAAQ,EAAMsC,IAAI9C,EAAM,EAASG,EAAOkI,YAC5C,GAAI7H,EAAMuC,OAAOnR,OAAS,GAAK4O,EAAM3D,QAAQjL,SAAW4O,EAAMuC,OAAOnR,OAAS,EAAG,CAChF,IAAIyW,EAAY,GAAQ7H,EAAM3D,SAC9B,GAAI,EAAWwL,EAAW,GAAKA,UAAUjP,KAAKxH,QAAU,EAAWyW,EAAW,GAAKA,UAAUlP,KAAKvH,OACjG,MAAM,IAAIuP,MAAM,yGAA2GnB,EAAO,KAEnI,OAAO,IAAIG,EACViH,EAAc5G,EAAMuC,OAAOvF,QAAQnC,QACnCmF,EAAMuC,OAAOrL,IAAI,CAACsI,EAAM/Q,KAAc,CACrCka,SAAU3I,EAAM3D,QAAQ5N,GACxByC,IAAK0V,EAAcpH,EAAK3E,eAU7B,GAAKgN,UAAY,CAChBjP,IAAK,CAAC,IAAK,KACXD,IAAK,CAAC,MAAO,QAMC,UChFf,MAAM,GAAY,cAAc2G,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,eAED,UCFf,MAAMia,GAAM,cAAcoE,GAKzB,YAAYC,EAAKC,EAAM,GACtBnH,QACAhK,KAAKkR,IAAMA,EACXlR,KAAKmR,IAAMA,EAMZ,OACC,OAAO3P,WAAWxB,KAAKkR,KAAOlR,KAAKmR,IAAM,IAAMnR,KAAKmR,IAAM,OAM3D,SAAS9S,EAAU,MAClB,OAAO2B,KAAKkR,KAAOlR,KAAKmR,IAAM,IAAMnR,KAAKmR,IAAM,MAMhD,aAAarO,EAAMoH,EAAejH,EAAS4J,IAC1C,GAAI,EAAW/J,GAAO,CACjBA,EAAOA,EAAK9E,MAAM,KACtB,OAAO,IAAIiF,EACVmO,SAAStO,EAAKxC,SACd8Q,SAAStO,EAAKxC,aASH,UC5Cf,MAAM,GAAY,cAAcsC,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,eAED,UCEf,MAAMma,GAAM,cAAcsE,GAKzB,YAAYC,GACXtH,QACAhK,KAAKsR,QAAUA,GAAW,GAM3B,QAAQ9O,GAQP,OAPIA,aAAiB6O,IACpB,EAAM7O,EAAM8O,QAAS,CAAChf,EAAMkC,KACrBlC,KAAQ0N,KAAKsR,UAClBtR,KAAKsR,QAAQhf,GAAQkC,KAIjBwL,KAMR,KAAK3B,EAAU,KAAM9I,EAAW,MAC/B,IAAIR,EAAQ,GAIZ,OAHA,EAAMiL,KAAKsR,QAAS,CAAChe,EAAKwP,KACzB/N,EAAMzB,GAAOwP,EAAKmH,KAAK5L,EAAS9I,KAE1BR,EAMR,SAASsJ,EAAU,MAClB,IAAIkH,EAAM,GAIV,OAHA,EAAMvF,KAAKsR,QAAS,CAAChe,EAAKwP,KACzByC,EAAIpQ,KAAK7B,EAAMyZ,GAAI5B,UAAUlP,IAAM6G,EAAK1B,SAAS/C,MAE3C,IAAMkH,EAAIoB,KAAKoG,GAAI5B,UAAUjP,KAAO,IAM5C,aAAa4G,EAAMoH,EAAejH,EAAS8J,IAC1C,GAAI,EAASjK,EAAM,IAAK,OAAS,EAAMoF,MAAMpF,EAAK3E,OAAQ,CAAC,MAAMzJ,OAAQ,CACxE,IAAI4c,EAAU,GACVC,EAAgB,EAAMvT,MAAM,EAAQ8E,EAAM,IAAK,KAAM,CAACiK,GAAI5B,UAAUjP,MACtE1B,IAAIhH,GAAKA,EAAE2K,QAAQ9I,OAAO7B,GAAKA,GAKjC,OAJA,EAAM+d,EAAe,CAACje,EAAKwP,KAC1B,IAAI0O,EAAQ,EAAMxT,MAAM8E,EAAM,CAACiK,GAAI5B,UAAUlP,KAAM,CAACwE,MAAM,IAC1D6Q,EAAQ,EAAOE,GAAOrT,QAAU+L,EAAc,EAAMsH,GAAOrT,UAErD,IAAI8E,EAAOqO,MAQrBvE,GAAI5B,UAAY,CACfjP,IAAK,IACLD,IAAK,KAMS,UCzEf,MAAMwV,GAAY,cAAchO,EAK/B,YAAYpF,EAAS/L,EAAMof,GAAY,GACtC1H,QACAhK,KAAK3B,QAAUA,EACf2B,KAAK1N,KAAOA,EACZ0N,KAAK0R,UAAYA,EAMlB,QAAQrT,EAAU,KAAM9I,EAAW,MAClC,IAAIoc,EAAgBtT,EAAS/L,EAAO0N,KAAK1N,KAOzC,OANI0N,KAAK3B,UACJ/L,aAAgBsQ,IACnBtQ,EAAOA,EAAK2X,KAAK5L,EAAS9I,IAE3Boc,EAAgB3R,KAAK3B,QAAQ4L,KAAK5L,EAAS9I,IAErC,CAAC8I,QAAQsT,EAAerf,KAAKA,GAMrC,KAAK+L,EAAU,KAAM9I,EAAW,MAC/B,IAAIqc,EAAQ5R,KAAKkM,QAAQ7N,EAAS9I,GAClC,IAAK,EAAaqc,EAAMvT,WAAa,EAAauT,EAAMtf,MACvD,OAAI,EAAYiD,GACRA,EAASyK,KAAM4R,EAAMvT,QAASuT,EAAMtf,MAErC,EAASe,OAAOue,EAAMvT,SAASzL,IAAIgf,EAAMtf,MAOlD,SAAS+L,EAAU,MAClB,IAAI/L,EAAO0N,KAAK1N,KAChB,GAAI0N,KAAK3B,QAAS,CACjB,IAAIwT,EAAiB7R,KAAK3B,QAAQ+C,SAAS/C,GACvC/L,aAAgBsQ,EACnBtQ,EAAO,IAAMA,EAAK8O,SAAS/C,GAAW,IAC5B2B,KAAK0R,YACfpf,EAAO,IAAMA,EAAO,SAEf,CACFuf,EAAiBxT,EACjB2B,KAAK0R,YACRpf,EAAO,IAAMA,EAAO,KAGtB,OAAQuf,GAAkB,KAAOA,IAAmBvf,EAAKuL,WAAW,KAAO4T,GAAUK,UAAY,IAAMxf,EAMxG,aAAawQ,EAAMoH,EAAejH,EAASwO,IAC1C,IAAK,EAAMvJ,MAAMpF,EAAK3E,OAAQ,CAAC,MAAMzJ,OAAQ,CAC5C,IAII2J,EAA8BqT,EAJ9BpE,EAAS,EAAMtP,MAAM8E,EAAM,IAIlBxQ,EAAOgb,EAAOL,MACvB8E,EAAY,EAAM/T,MAAM1L,EAAK6L,OAAQ,CAAC8E,EAAO6O,WAAY,CAAC/J,gBAAe,IAgB7E,GAfIgK,EAAUrd,OAAS,IACtBpC,EAAOyf,EAAU9E,MAAM5Y,OAAO,GAC9BiZ,EAASA,EAAOlP,OAAO2T,IAEpB,EAASzf,EAAM,IAAK,OACvBA,EAAO,EAAQA,EAAM,IAAK,KAC1Bof,GAAY,GAKTpE,EAAO5Y,UACV2J,EAAU6L,EAAcoD,EAAO3G,KAAK,MAC5BqL,WAAY,GAEjB,EAAS1f,EAAM,IAAK,KAAM,CAC7B,IAAK+L,EACJ,MAAM,IAAI4F,MAAM,sBAAwBnB,EAAO,KAEhDxQ,EAAO4X,EAAc,EAAQ5X,EAAM,IAAK,MAEzC,OAAO,IAAI2Q,EAAO5E,EAAS/L,EAAMof,MAQpCD,GAAUK,UAAY,IAKP,UChHf,MAAM,GAAY,cAAclP,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,oBAED,UCHf,MAAMqf,GAAS,cAAcC,GAK5B,YAAYpP,GACXkH,QACAhK,KAAK8C,KAAOA,EAMb,KAAKzE,EAAU,KAAM9I,EAAW,MAC/B,OAAOyK,KAAK8C,KAAO9C,KAAK8C,KAAKmH,KAAK5L,EAAS9I,QAAYZ,EAMxD,SAAS0J,EAAU,MAClB,OAAO2B,KAAK8C,KAAO,UAAY9C,KAAK8C,KAAK1B,SAAS/C,GAAW,SAU9D,aAAayE,EAAMoH,EAAejH,EAASgP,IAC1C,IAAIE,EAASrP,EAAKtF,cAClB,GAAI2U,EAAOtU,WAAW,YAAyB,WAAXsU,EACnC,OAAO,IAAIlP,EACViH,EAAcpH,EAAKzO,OAAO,GAAG8J,WASlB,UC7Cf,MAAM,GAAY,cAAcyE,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,eAED,UCDf,MAAMwf,GAAa,cAAcC,GAKhC,YAAYC,EAAOC,GAClBvI,QACAhK,KAAKsS,MAAQjI,MACbrK,KAAKuS,MAAQA,EAMd,KAAKlU,EAAU,KAAM9I,EAAW,MAE/B,IADA,IAAI8U,EAAQ,GACHtY,EAAI,EAAGA,EAAIiO,KAAKsS,MAAM5d,OAAQ3C,IAAM,CAC5C,GAAIiO,KAAKsS,MAAMvgB,aAAcmgB,GAC5B,OAAOlS,KAAKsS,MAAMvgB,GAAGkY,KAAK5L,EAAS9I,GAEnC8U,EAAMtY,GAAKiO,KAAKsS,MAAMvgB,GAAGkY,KAAK5L,EAAS9I,GAGzC,OAAO8U,EAMR,SAAShM,EAAU,MAClB,OAAO2B,KAAKsS,MAAM9X,IAAIsI,GAAQA,EAAK1B,SAAS/C,IAAUsI,KAAK3G,KAAKuS,OAMjE,aAAazP,EAAMoH,EAAejH,EAASmP,IAC1C,IAAI9O,EAAQ,EAAMsC,IAAI9C,EAAM,EAASG,EAAOkI,YAC5C,GAAI7H,EAAMuC,OAAOnR,OAAS,EACzB,OAAO,IAAIuO,EACVK,EAAMuC,OAAOrL,IAAIsI,GAAQoH,EAAcpH,IACvCQ,EAAM3D,QAAQ,GAAGxB,UASrBiU,GAAWjH,UAAY,CACtB,IACA,QAMc,UC7Df,MAAM,GAAY,cAAcvI,IAChCnQ,OAAOC,eAAe,GAAUiB,UAAW,WAAY,CACtDf,IAAG,IAAY,eAED,UCAf,MAAMka,GAAM,cAAc0F,GAKzB,YAAY1P,EAAMkF,GACjBgC,QACAhK,KAAK8C,KAAOA,EACZ9C,KAAKgI,MAAQA,EAMd,OACC,OAAOhI,KAAK8C,KAMb,WACC,OAAO9C,KAAKgI,MAAQhI,KAAK8C,KAAO9C,KAAKgI,MAMtC,aAAalF,EAAMoH,EAAejH,EAAS6J,IAE1C,GADAhK,EAAOA,EAAK3E,QACP,EAAS2E,EAAM,IAAK,MAAQ,EAASA,EAAM,IAAK,QACjD,EAAMoF,MAAMpF,EAAM,CAAC,MAAMpO,OAAQ,CACpC,IAAIsT,EAAQ,EAASlF,EAAM,IAAK,KAAO,IAAM,IAC7C,OAAO,IAAIG,EACV,EAAQH,EAAMkF,EAAOA,GACrBA,MASW,UCVf,EAAK7E,SAAW,CACf+J,SAAU,GACV+E,OAAQ,GACRG,WAAY,GACZ1C,SAAU,GACV3D,WAAY,GACZ6D,KAAM,GACN9F,YAAa,GACbwF,UAAW,GACXtE,UAAW,GACX2C,WAAY,GACZvF,KAAM,GACN+B,IAAK,GACL4C,IAAK,GACLF,IAAK,GACLC,IAAK,GACLX,KAAM,GACNG,KAAM,GACNmF,UAAW,IAqDG,SC5GA,eACd,OAAQ,EAAUvX,IAAUA,EAAMuY,yBAA2B,GCD/C,eACd,OAAO,GAAS/M,GAAYA,EAAS+M,4BAAyB9d,GCNhD,eACd,MAAsB,iBAARH,GCMA,kBACd,OAAO,EAAesQ,EAAM,CAACxR,EAAKoO,EAAMC,KACvC,GAAI,EAASD,IAAS,EAASC,IAC9B,IAAiC,IAA7BD,EAAKtN,QAAQuN,EAAKrO,IACrB,OAAO,OAEF,KAAMA,KAAOoO,GACnB,OAAO,KCPK,oBAId,OAHAgR,EAAK1d,QAAQ2d,IACZA,EAAK3d,QAAQC,GAAO,EAAYC,KAAQ,EAAMyd,OAExCzd,GCkFO,OAzFD,MASb,YAAY8N,GACXhD,KAAK4S,EAAI,CACRC,oBAAoB,EACpBC,kBAAkB,EAClBC,iBAAkB,KAClBC,SAAU,IAEX,EAAMhQ,EAAQ,CAAC1Q,EAAMU,KACpBgN,KAAK1N,GAAQU,IASf,kBACCgN,KAAK4S,EAAEC,oBAAqB,EAQ7B,yBACC,OAAO7S,KAAK4S,EAAEC,mBASf,iBACC7S,KAAK4S,EAAEE,kBAAmB,EAQ3B,uBACC,OAAO9S,KAAK4S,EAAEE,iBAUf,QAAQG,GACP,KAAMA,aAAmBC,SACxB,MAAM,IAAIjP,MAAM,kDAEjBjE,KAAK4S,EAAEI,SAAS7d,KAAK8d,GACrBjT,KAAK4S,EAAEG,iBAAmB,KAQ3B,eAIC,OAHK/S,KAAK4S,EAAEG,kBAAoB/S,KAAK4S,EAAEI,SAASte,SAC/CsL,KAAK4S,EAAEG,iBAAmBG,QAAQC,IAAInT,KAAK4S,EAAEI,WAEvChT,KAAK4S,EAAEG,mBCgJD,OArNS,MAOvB,cACC/S,KAAK4S,EAAI,CACRQ,UAAW,IAcb,YAAYC,EAAY9d,EAAUyN,EAAS,GAAIsQ,EAAM,MAOpD,GANI,EAAYD,KACfC,EAAM7e,UAAUC,OAAS,EAAIsO,EAAS,GACtCA,EAASzN,EACTA,EAAW8d,EACXA,EAAa,OAET,EAAY9d,GAChB,MAAM,IAAI0O,MAAM,wCAA4C1O,EAAY,YChD5D,IDkDTge,EAAW,CACdF,WAAYA,EACZ9d,SAAUA,EACVyN,OAAQA,EACRsQ,IAAKA,EACLE,OAAQ,KACP,EAAQxT,KAAK4S,EAAEQ,UAAWG,KAI5B,OADAvT,KAAK4S,EAAEQ,UAAUje,KAAKoe,GACfA,EAaR,eAAeF,EAAY9d,EAAW,KAAMyN,EAAS,GAAIsQ,EAAM,MAC1D,EAAYD,KACfC,EAAM7e,UAAUC,OAAS,EAAIsO,EAAS,GACtCA,EAASzN,GAAY,GACrBA,EAAW8d,EACXA,EAAa,MAGd,IADA,IAAII,GAAU,EACL1hB,EAAI,EAAGA,EAAIiO,KAAK4S,EAAEQ,UAAU1e,OAAQ3C,KACvC,EAAQshB,KAAe,EAAM,EAASrT,KAAK4S,EAAEQ,UAAUrhB,GAAGshB,YAAa,EAASA,MACjF,EAAQ9d,IAAayK,KAAK4S,EAAEQ,UAAUrhB,GAAGwD,WAAaA,IACtD,EAAQyN,KAAW,EAAMhD,KAAK4S,EAAEQ,UAAUrhB,GAAGiR,OAAQA,KACrD,EAAQsQ,IAAQtT,KAAK4S,EAAEQ,UAAUrhB,GAAGuhB,MAAQA,IAC3CtT,KAAK4S,EAAEQ,UAAUrhB,GAAG2hB,gBACvB1T,KAAK4S,EAAEQ,UAAUrhB,GAAG2hB,iBAErB1T,KAAK4S,EAAEQ,UAAUrhB,GAAGyhB,SACpBC,GAAU,GAGZ,OAAOA,EAQR,YACC,IAAIE,EAAY,GAMhB,OALC3T,KAAK4S,EAAEQ,WAAa,IAAIpe,QAAQue,IAC3B,EAAQA,EAASF,cACrBM,EAAY,GAAcA,EAAW,EAASJ,EAASF,gBAGlDM,EAWR,KAAKN,EAAYza,GAChB,IAAIyM,EAAIzM,aAAmB,GAAQA,EAAU,IAAI,GAAMA,GAEvDya,EAAa,EAASA,GAEtBrT,KAAK4S,EAAEgB,gBAAkB5T,KAAK4S,EAAEgB,iBAAmB,GACnD,IAAIC,EAA0B,GAAYR,EAAYrT,KAAK4S,EAAEgB,iBAC7D,GAAKC,EAAwBnf,OAA7B,CAGA,GAAcsL,KAAK4S,EAAEgB,gBAAiBC,GAEtC,IAAK,IAAI9hB,EAAI,EAAGA,GAAKiO,KAAK4S,EAAEQ,WAAa,IAAI1e,OAAQ3C,IACpD,IAAIsT,EAAEwN,mBAAN,CAGA,IAAIU,EAAWvT,KAAK4S,EAAEQ,UAAUrhB,GAC5B+hB,EAAiBP,EAASvQ,QAAU,GACpC+Q,EAAqB,EAASR,EAASF,YAAY7Y,IAAI+K,GAAOA,EAAIkI,QAAQ,MAAO,KAkBrF,IAZIsG,EAAmBrf,OACZqf,EAAmB1e,OAAO2e,IACZ3O,EAAE4O,UAAYD,EAAkB5f,QAAQ,MAAQ,EAAIiR,EAAE4O,UACxE5O,EAAE4O,UAAYH,EAAeI,cAAgBL,EAA0B,IACpDxe,OAAO8e,IAAoBH,EAAoB,KAAKnW,WAAWsW,EAAkB,MAAMzf,QAC7GA,QAEQ2Q,EAAE4O,UAAYH,EAAeI,gBAK1BlU,KAAKoU,YAAYb,EAAUF,EAAYhO,GAAI,CAEzD,IAAsDgP,EAAlDC,EAAWtU,KAAKuU,QAAQhB,EAAUF,EAAYhO,IAChC,IAAbiP,GAAwBA,aAAoB,IAASA,EAASzB,mBAClExN,EAAEmP,mBACsB,IAAbF,GAAwBA,aAAoB,IAASA,EAASxB,iBACzEzN,EAAEoP,kBACSH,aAAoBpB,UAAYmB,EAAQC,IAChDA,aAAoB,KAAUD,EAAQC,EAAStB,YAClD3N,EAAE4N,QAAQoB,IAQb,OEtKa,iBACdK,EAAK1f,QAAQC,GAAO,EAAQC,EAAKD,IFiKhC,CAAS+K,KAAK4S,EAAEgB,mBAAoBC,GAI7BxO,GAaR,YAAYkO,EAAUF,EAAYhO,GACjC,OAAO,EAaR,QAAQkO,EAAUF,EAAYhO,GAC7B,IAAIhH,EAAUgH,EAAEhH,SAAW,GACvBsW,EAAWtP,EAAEsP,UAAY,GAC7B,IAAK,EAAQpB,EAASF,YAAa,CAElC,IAAI5a,EAAO,GACPmc,EAAQ,GACC,EAASrB,EAASF,YAAYre,QAAQ6f,IAClDA,EAAY,EAAUA,GAAaA,EAAU7W,MAAM,KAAO6W,EAC1Dpc,EAAKtD,KAAK,EAAKkJ,EAASwW,IACxBD,EAAMzf,KAAK,EAAKwf,EAAUE,MAE3B,OAAO,EAAStB,EAASF,YACtBE,EAAShe,SAASkD,EAAMmc,EAAOvP,GAC/BkO,EAAShe,SAASkD,EAAK,GAAImc,EAAM,GAAIvP,GAErC5M,EAAO,GACPmc,EAAQ,GAOZ,OANAvB,EAAWre,QAAQ6f,IAClB,IAAI7L,EAAO,EAAU6L,GAAaA,EAAU7W,MAAM,KAAO6W,EACzDpc,EAAKoc,GAAa,EAAKxW,EAAS2K,GAChC4L,EAAMC,GAAa,EAAKF,EAAU3L,KAG5BuK,EAAShe,SAASkD,EAAMmc,EAAOvP,KGzMxC,MAAMyP,GAAa,cAAc,GAUhC,YAAYzI,EAAQ,GAAIrJ,EAAS,IAChCgH,QAEAhK,KAAK4S,EAAE5P,OAAS,GAAS,GAAIA,EAAQ8R,GAAW9R,QAChDhD,KAAK4S,EAAEmC,SAAW,GAClB/U,KAAK4S,EAAEvG,MAAQA,EACfrM,KAAK4S,EAAEoC,OAAS,EAAS3I,GAASA,EAAMxX,QAAU,GAAM,EAAGwX,GAC3D,EAAMrM,KAAK4S,EAAEvG,MAAO,CAAC4I,EAAMjiB,KAC1BgN,KAAKkV,UAAUD,EAAMjiB,KASvB,WAAWuZ,GACV,OAAOvM,KAAKmV,eAAe5I,GAQ5B,aAAaA,GACZ,OAAOvM,KAAKoV,kBAAkB7I,GAW/B,IAAI0I,EAAMjiB,GACT,IAAIyF,EAAO,GACP,EAAUwc,IAAS,GAAUA,GAChCxc,EAAKwc,GAAQjiB,EACH,EAASiiB,GACnBA,EAAKjgB,QAAQnB,IACZ4E,EAAK5E,GAAKb,IAED,EAAUiiB,KACpBxc,EAAOwc,GAER,IAAII,EAAe5iB,OAAOmC,KAAK6D,GAC3B,EAASuH,KAAK4S,EAAEvG,SACnBgJ,EAAeA,EAAa7a,IAAIlH,GAAO8d,SAAS9d,KAGjD,IAAIge,EAAU,GACd+D,EAAargB,QAAQigB,IAChBA,KAAQjV,KAAK4S,EAAEvG,MAClBrM,KAAKsV,UAAUL,EAAMjV,KAAK4S,EAAEvG,MAAM4I,IAElC3D,EAAQnc,KAAK8f,GAId,IAAIjiB,EAAQyF,EAAKwc,GAGjB,GAAI,GAASjiB,GAAQ,CACpB,IAAIuiB,EAAS,GAAgBviB,GACzB,EAAcuiB,KACjBviB,EAAQuiB,GAGVvV,KAAKkV,UAAUD,EAAMjiB,GAGrBgN,KAAK4S,EAAEvG,MAAM4I,GAAQjiB,IAEtB,IAAIwiB,EAAuBxV,KAAKyV,KAAKJ,EAAc,CAAChX,QAAS2B,KAAK4S,EAAEvG,MAAOsI,SAAU3U,KAAK4S,EAAEoC,OAAQ1D,QAASA,EAASoE,MAAO,KAI7H,OAHAL,EAAargB,QAAQigB,IACpBjV,KAAK4S,EAAEoC,OAAOC,GAAQjV,KAAK4S,EAAEvG,MAAM4I,KAE7BO,EAUR,IAAIP,GACH,IAAIU,EAAQ,EAASV,GACjBS,EAAQ,GACZC,EAAM3gB,QAAQigB,IACTA,KAAQjV,KAAK4S,EAAEvG,QAClBqJ,EAAMvgB,KAAK8f,GACXjV,KAAKsV,UAAUL,EAAMjV,KAAK4S,EAAEvG,MAAM4I,YAE5BjV,KAAK4S,EAAEvG,MAAM4I,KAErB,IAAIO,EAAuBxV,KAAKyV,KAAKE,EAAO,CAACtX,QAAS2B,KAAK4S,EAAEvG,MAAOsI,SAAU3U,KAAK4S,EAAEoC,OAAQ1D,QAAS,GAAIoE,MAAOA,IAIjH,OAHAC,EAAM3gB,QAAQigB,WACNjV,KAAK4S,EAAEoC,OAAOC,KAEfO,EAWR,YAAYP,GACX,GAAI,EAAUA,IAASjV,KAAK4S,EAAE5P,OAAO4S,cAAgBX,EAAKpX,WAAWmC,KAAK4S,EAAE5P,OAAO4S,cAAe,CACjG,IAAIC,EAAYZ,EAAK5gB,OAAO2L,KAAK4S,EAAE5P,OAAO4S,aAAalhB,QACvD,GAAImhB,GAAa,EAAYA,EAAY7V,KAAK6V,IAC7C,OAAOA,EAAUtiB,KAAKyM,OAYzB,IAAIiV,GAEH,IAAIa,EAAc9V,KAAK8V,YAAYb,GACnC,GAAIa,EACH,OAAOA,EAGR,IAAI9iB,EAAQgN,KAAK4S,EAAEvG,MAAM4I,GACzB,OAAI,EAASjV,KAAK4S,EAAEvG,SAAW,EAAW4I,IAAS,EAAYjiB,GACvD,IAAIuZ,KACV,IAAIwJ,EAAO/V,KAAK4S,EAAEvG,MAAMxX,QACpBmhB,EAAMhjB,EAAMijB,MAAMjW,KAAK4S,EAAEvG,MAAOE,GAChC2J,EAAc,GAAQzjB,OAAOmC,KAAKmhB,GAAM3X,OAAO3L,OAAOmC,KAAKoL,KAAK4S,EAAEvG,SAAShX,OAAOkM,IAErF,GADAA,EAAI6P,SAAS7P,GACTvB,KAAK4S,EAAEvG,MAAM9K,KAAOwU,EAAKxU,GAU5B,OATMA,KAAKvB,KAAK4S,EAAEvG,MAOjBrM,KAAKkV,UAAU3T,EAAGvB,KAAK4S,EAAEvG,MAAM9K,IAJ/BvB,KAAKsV,UAAU/T,EAAGwU,EAAKxU,KAMjB,IAOT,OAJI2U,EAAYxhB,SACfsL,KAAKyV,KAAKS,EAAa,CAAC7X,QAAS2B,KAAK4S,EAAEvG,MAAOsI,SAAU3U,KAAK4S,EAAEoC,SAChEhV,KAAK4S,EAAEoC,OAAShV,KAAK4S,EAAEvG,MAAMxX,SAEvBmhB,GAGFhjB,EAUR,IAAIiiB,GACH,OAAQA,KAAQjV,KAAK4S,EAAEvG,MAQxB,OACC,OAAO5Z,OAAOmC,KAAKoL,KAAK4S,EAAEvG,OAa3B,YAAYkH,EAAUF,EAAYhO,GACjC,IAAI8Q,EAAS,EAAGC,EAAW,EAIrB,UAAW/Q,EAAEuN,IAClBvN,EAAEuN,EAAEyD,MAAQ,GACZhR,EAAEuN,EAAE0D,OAAS,IAEd,IAAIxC,EAAiBP,EAASvQ,QAAU,GAmCxC,OAlCE,EAAQuQ,EAASF,YAA8CA,EAAhC,EAASE,EAASF,aAA0Bre,QAAQigB,IACpF,KAAMA,KAAQ5P,EAAEuN,EAAEyD,OAAQ,CACzBhR,EAAEuN,EAAEyD,MAAMpB,GAAQ,GAClB5P,EAAEuN,EAAE0D,OAAOrB,GAAQ,GAEnB,IAAIsB,EAAiB,GACjBC,EAAkB,GAClBxN,EAAO,EAAUiM,GAAQA,EAAKjX,MAAM,KAAOiX,EAC/C5P,EAAEuN,EAAEyD,MAAMpB,GAAMzgB,IAAM,EAAK6Q,EAAEhH,QAAS2K,EAAMuN,GAC5ClR,EAAEuN,EAAE0D,OAAOrB,GAAMzgB,IAAM,EAAK6Q,EAAEsP,SAAU3L,EAAMwN,GAC9CnR,EAAEuN,EAAEyD,MAAMpB,GAAMwB,UAAYF,EAAejN,OAC3CjE,EAAEuN,EAAE0D,OAAOrB,GAAMwB,UAAYD,EAAgBlN,QAEjB,IAAxBwK,EAAe4C,MAAoB,YAAarR,EAAEuN,EAAEyD,MAAMpB,KAC7D5P,EAAEuN,EAAEyD,MAAMpB,GAAM0B,QAAUtR,EAAE4O,UACzB5O,EAAEuN,EAAEyD,MAAMpB,GAAMwB,YAAcpR,EAAEuN,EAAE0D,OAAOrB,GAAMwB,YAC9C,EAAUpR,EAAEuN,EAAEyD,MAAMpB,GAAMzgB,MAAQ,EAAU6Q,EAAEuN,EAAE0D,OAAOrB,GAAMzgB,MAC7D,EAAM6Q,EAAEuN,EAAEyD,MAAMpB,GAAMzgB,IAAK6Q,EAAEuN,EAAE0D,OAAOrB,GAAMzgB,KAC7C6Q,EAAEuN,EAAEyD,MAAMpB,GAAMzgB,MAAQ6Q,EAAEuN,EAAE0D,OAAOrB,GAAMzgB,MAI1C,EAAWsf,EAAe8C,QAAUvR,EAAEhH,SAAWgH,EAAEsP,WACzB,IAAzBb,EAAe8C,OAAevR,EAAEuN,EAAEyD,MAAMpB,GAAMzgB,MAAQ6Q,EAAEuN,EAAE0D,OAAOrB,GAAMzgB,IAC1E4hB,IACmC,IAAzBtC,EAAe8C,QAAgBvR,EAAEuN,EAAEyD,MAAMpB,GAAMzgB,KAAO6Q,EAAEuN,EAAE0D,OAAOrB,GAAMzgB,KACjF4hB,OAI0B,IAAxBtC,EAAe4C,MAAkBrR,EAAEuN,EAAEyD,MAAMpB,GAAM0B,UACpDR,OAGMC,GAAYD,GAAUnM,MAAMoK,YAAYb,EAAUF,EAAYhO,GAWvE,UAAU4P,EAAMjiB,GACX,EAAcA,KACbiiB,KAAQjV,KAAK4S,EAAEmC,UAClB/hB,EAAM6jB,UAAU7W,KAAK4S,EAAEmC,SAASE,GAAO,CAACf,eAAc,IAEnD,EAAYlhB,EAAM8jB,kBAAoB9jB,EAAM8jB,oBAAsB9W,MACrEhN,EAAM+jB,gBAAgB,OAazB,UAAU9B,EAAMjiB,GACX,EAAcA,KACjBA,EAAMgkB,QAAQhX,KAAKiX,YAAYhC,GAAO,CAACf,eAAc,IACjD,EAAYlhB,EAAM8jB,mBAAqB9jB,EAAM8jB,mBAChD9jB,EAAM+jB,gBAAgB/W,OAYzB,gBAAgBkX,GACflX,KAAK4S,EAAEsE,aAAeA,EAQvB,kBACC,OAAOlX,KAAK4S,EAAEsE,aAUf,YAAYjC,GAYX,OAXAjV,KAAK4S,EAAEmC,SAAW/U,KAAK4S,EAAEmC,UAAY,GACrC/U,KAAK4S,EAAEmC,SAASE,GAAQ,CAACkC,EAASC,EAAU/R,KAC3C,IAAIgS,EAAK,GAOT,OANAA,EAAGhZ,QAAU2B,KAAK4S,EAAEvG,MACpBgL,EAAG1C,SAAW3U,KAAK4S,EAAEoC,OACrBqC,EAAG/F,SAAWjM,EAAEiM,SAAW,IAAIzc,QAC/BwiB,EAAG3B,OAASrQ,EAAEqQ,OAAS,IAAI7gB,QAC3BwiB,EAAGpD,UAAY5O,EAAE4O,SAAW,EAAS5O,EAAE4O,UAAYxhB,OAAOmC,KAAKuiB,IAC7D3c,IAAI8c,GAAgBrC,EAAO,IAAMqC,GAC5BtX,KAAKyV,KAAKR,EAAMoC,IAEjBrX,KAAK4S,EAAEmC,SAASE,GAUxB,KAAKsC,GACJ3T,QAAQ4T,MAAMD,GAUf,MAAMA,GACL,GAAIvX,KAAK4S,EAAE5P,OAAOyU,YACjB,MAAM,IAAIxT,MAAMsT,GAEhB3T,QAAQ4T,MAAMD,GAShB,QACC,OC9Xa,cACd,IAAIG,EAAgB,CACnB9kB,IAAK,CAAC8V,EAAQuM,IACA,2BAATA,EACIvM,EAEK,yBAATuM,EACI0C,EAEDA,EAAK/kB,IAAM+kB,EAAK/kB,IAAI8V,EAAQuM,GAAQvM,EAAOuM,IAGpD,OAAO,IAAI2C,MAAMlP,EAAQ,EAAO,GAAIiP,EAAMD,IDkXlC,CAAO1X,KAAM,CAInBpN,IAAK,SAAS8V,EAAQuM,GACrB,IAAIjiB,EAAQ0V,EAAO9V,IAAIqiB,GAIvB,OAHI,EAAUjiB,IAAU,EAAYA,EAAM6kB,SACzC7kB,EAAQA,EAAM6kB,SAER7kB,GAER8kB,IAAK,SAASpP,EAAQuM,EAAMzgB,GAE3B,OADAkU,EAAOoP,IAAI7C,EAAMzgB,IACV,GAERujB,IAAK,SAASrP,EAAQuM,GACrB,OAAOvM,EAAOqP,IAAI9C,IAEnB+C,eAAgB,SAAStP,EAAQuM,GAChC,OAAOvM,EAAO/P,IAAIsc,IAKnBgD,QAAS,SAASvP,GAEjB,OAAOjW,OAAOmC,KAAK8T,EAAOkK,EAAEvG,QAE7B3Z,eAAgB,SAASgW,EAAQuM,EAAMiD,GAGtC,OAFAzlB,OAAOC,eAAegW,EAAOkK,EAAEvG,MAAO4I,EAAMiD,GAC5CxP,EAAOoP,IAAI7C,EAAMvM,EAAOkK,EAAEvG,MAAM4I,KACzB,GAER7P,yBAA0B,SAASsD,EAAQuM,GAC1C,OAAOxiB,OAAO2S,yBAAyBsD,EAAOkK,EAAEvG,MAAO4I,IAExDkD,sBAAuB,SAASzP,GAC/B,OAAOjW,OAAO0lB,sBAAsBzP,EAAOkK,EAAEvG,QAE9CxH,oBAAqB,SAAS6D,GAC7B,OAAOjW,OAAOoS,oBAAoB6D,EAAOkK,EAAEvG,YAS/CyI,GAAW9R,OAAS,CACnB4S,aAAc,KAMA,IErbA,GFqbA,GGpbf,MAAMwC,GAAM,MAKX,YAAY9kB,EAAKN,EAAOqlB,EAAO,MAC9BrY,KAAK1M,IAAMA,EACX0M,KAAKhN,MAAQA,EACbgN,KAAKqY,KAAOA,EAMb,SAASha,EAAU,MAClB,OAAO2B,KAAK1M,IAAM,KAAO0M,KAAKhN,OAASgN,KAAKqY,KAAO,IAAMrY,KAAKqY,KAAO,IAWtE,aAAavV,EAAMwV,EAAO,IACzB,GAAIxV,EAAM,CACT,IAAIyV,EAAQ,GAAMD,GAClBC,EAAM9X,MAAQ,EACd,IAAI+X,EAAW,EAAMxa,MAAM8E,EAAM,CAAC,KAAMyV,GACxC,GAAIC,EAAS9jB,OAAS,EACrB,MAAM,IAAIuP,MAAM,kBAAoBnB,GAErC,IACI9P,EAAOqlB,EADP/kB,EAAMklB,EAASlY,QAAQnC,OACVsa,EAAK,EAAMza,MAAMwa,EAASlY,QAAQnC,OAAQ,CAAC,KAAMma,GAOlE,OANIG,EAAG/jB,OAAS,GACX0jB,GAAIM,MAAMxa,SAAS,EAAMua,GAAIta,OAAOX,iBACvC6a,EAAOI,EAAGxL,MAAM9O,OAAOX,eAGzBxK,EAAQylB,EAAG9R,KAAK,KACT,IAAIyR,GAAI9kB,EAAKN,EAAOqlB,MAQ9BD,GAAIM,MAAQ,CAAC,WAAY,WAKV,UCtDf,MAAMC,GAAW,MAKhB,YAAYrH,EAAU,IAErBtR,KAAKsR,QAAU,GACfA,EAAQtc,QAAQwc,GAASxR,KAAK4Y,IAAIpH,IAWnC,OAAOqH,GAAgB,EAAOC,GAAiB,GAC9C,OAAO9Y,KAAKsR,QAAQjc,OAAOmc,KAAWA,EAAMuH,aAAeF,MAAoBrH,EAAMwH,YAAcF,IAMpG,SAASza,EAAU,KAAMwa,GAAgB,EAAOC,GAAiB,GAChE,OAAO9Y,KAAK3K,OAAOwjB,EAAeC,GAAgBte,IAAIye,GAAOA,EAAI7X,SAAS/C,IAAUsI,KAAK,MAAQ,IAUlG,IAAIuS,GACH,IAAKA,EAAO5lB,MAAQ4lB,EAAOlmB,MAC1B,MAAM,IAAIiR,MAAM,2CA+BjB,OA7BMiV,aAAkB,KACvBA,EAAS,IAAI,GAAIA,EAAO5lB,IAAK4lB,EAAOlmB,MAAOkmB,EAAOb,OAEnDrY,KAAKsR,QAAQtc,QAAQmkB,IACpB,IAAIA,EAAYJ,cAAeI,EAAYH,WAA3C,CAGA,IAAII,EAAQD,EAAY7lB,IAAI8N,WACxBiY,EAAUF,EAAYnmB,MAAMoO,WAC5BkY,EAAmB,EAASD,EAAS,IAAK,KAAO,EAAQA,EAAS,IAAK,KAAOA,EAC9EE,EAAQL,EAAO5lB,IAAI8N,WACnBoY,EAAUN,EAAOlmB,MAAMoO,WACvBqY,EAAmB,EAASD,EAAS,IAAK,KAAO,EAAQA,EAAS,IAAK,KAAOA,EAC9EE,EAAsD,aAA1CP,EAAYd,MAAQ,IAAI7a,cACpCmc,EAAyD,cAA1CR,EAAYd,MAAQ,IAAI7a,cACvCoc,EAAiD,aAArCV,EAAOb,MAAQ,IAAI7a,cAC/Bqc,EAAoD,cAArCX,EAAOb,MAAQ,IAAI7a,cAClC4b,IAAUG,IACRF,IAAYG,GAAWF,IAAqBG,GAC7CE,IAAgBE,GAAeH,IAAaE,EAErCC,GAAeH,EACzBP,EAAYH,YAAa,GACdW,GAAeC,KAC1BV,EAAOF,YAAa,GAJpBE,EAAOH,aAAc,MAQxB/Y,KAAKsR,QAAQnc,KAAK+jB,GACXlZ,KAWR,aAAa8C,EAAMwV,EAAO,IACzB,OAAO,IAAIK,GACV,EAAM3a,MAAM8E,EAAM,CAAC,KAAMwV,GAAMjjB,OAAO4jB,GAAOA,EAAI9a,QAAQ3D,IAAIye,GAAO,GAAI3V,MAAM2V,EAAI9a,YAQtE,UCxFf,MAAM2b,GAAW,MAKhB,YAAY7R,EAAQ,IACnBjI,KAAKiI,MAAQ,GACbjI,KAAKiW,MAAMhO,GAMZ,SAAS5J,EAAU,KAAMwa,GAAgB,EAAOC,GAAiB,GAChE,IAAIvT,EAAM,GAKV,OAJA,EAAMvF,KAAKiI,MAAO,CAACrS,EAAMmkB,KACxBxU,EAAIpQ,KAAK,IAAMS,GACf2P,EAAIpQ,KAAK,IAAM4kB,EAAS3Y,SAAS/C,EAASwa,EAAeC,GAAkB,OAErEvT,EAAIoB,KAAK,KAUjB,MAAMqT,GACL,IAAI/R,EAAQ+R,EACZ,GAAIA,aAAoBF,GACvB7R,EAAQ+R,EAAS/R,WACX,IAAK,EAAU+R,GACrB,MAAM,IAAI/V,MAAM,oEAKjB,OAHA,EAAMgE,EAAO,CAACvM,EAASqe,KACtB/Z,KAAKia,QAAQve,EAASqe,KAEhB/Z,KAWR,QAAQtE,EAASqe,GAChB,IAAIzI,EAAUyI,EACd,GAAIA,aAAoB,GACvBzI,EAAUyI,EAASzI,aACb,IAAK,EAASyI,GACpB,MAAM,IAAI9V,MAAM,mEAMjB,OAJKjE,KAAKiI,MAAMvM,KACfsE,KAAKiI,MAAMvM,GAAW,IAAI,IAE3B4V,EAAQtc,QAAQwc,GAASxR,KAAKiI,MAAMvM,GAASkd,IAAI,GAAMpH,KAChDxR,KAWR,aAAa8C,EAAMwV,EAAO,IAGzB,IAFA,IACI1iB,EAAYmkB,EADZzM,EAAS,EAAMtP,MAAM8E,EAAM,GAAIwV,GACTrQ,EAAQ,IAC1BrS,EAAO0X,EAAOhN,WAAayZ,EAAWzM,EAAOhN,UACpD2H,EAAMrS,EAAKuI,OAAOX,cAAcnJ,OAAO,IAAM,GAASiP,MAAM,EAAQyW,EAAS5b,OAAQ,IAAK,KAAMma,GAEjG,OAAO,IAAIwB,GAAS7R,KAOP,UCrEf,MAAMiS,GAAY,cAAc,GAU/B,YAAY7c,EAAI2F,EAAS,IAMxB,GALAgH,MAAM,GAAIhH,GAIVhD,KAAKma,KAAOna,KAAK3C,GAAKA,EACF,cAAhBA,EAAGE,SACNyC,KAAK3C,GAAKA,EAAG+c,cAAc,aACrB,KAAM/c,aAAcoB,aAC1B,MAAM,IAAIwF,MAAM,yEAMjBjE,KAAK4S,EAAExf,GAAK8mB,GAAUG,eAAera,KAAK3C,IAE1C2C,KAAK4S,EAAE0H,KAAOJ,GAAUK,sBAAsBva,KAAK3C,IAEnD2C,KAAKwa,OAUN,OAGCxa,KAAKya,MAAK,GAGVza,KAAK0a,YAAY,QAAQ,GAAsB1lB,QAAQ2lB,GAAaA,EAAU1Q,KAAKjK,OAGnFA,KAAK4S,EAAEgI,kBAAoB,GAqB3B,OAlBA5a,KAAK0a,YAAY,cAAc,GAAsB1lB,QAAQ6lB,IACvD7a,KAAK4S,EAAE5P,OAAO8X,aAClBD,EAAQ5Q,KAAKjK,MAGd,IANmB7C,EAMf4d,EAAc/a,KAAKgX,SANJ7Z,EAM0B0d,EAAQjgB,KAAK8H,KAN/B,GAAQvF,EAAK3C,IAAIsI,GAAQ,EAAQ,EAAQA,EAAK1B,WAAY,KAAM,QAM1B,CAAC4Z,EAAUC,EAAUjY,KAErF,IAAIkY,EAAaL,EAAQ5Q,KAAKjK,MAK9B,IAAmB,IAAfkb,EACH,OAAOA,GAEN,CAACxE,KAAM1W,KAAK4S,EAAE5P,OAAO0T,OACxB1W,KAAK4S,EAAEgI,kBAAkBzlB,KAAK4lB,KAExB/a,KAWR,KAAKmT,GAAM,GASV,OARIA,EAEHnJ,MAAMoL,iBACIpV,KAAK4S,EAAEgI,oBAEjB5a,KAAK4S,EAAEgI,kBAAkB5lB,QAAQue,GAAYA,EAASC,UACtDxT,KAAK4S,EAAEgI,kBAAkBla,UAEnBV,KAUR,MAAMmb,GAAY,GACjB,IAAK,EAAYnb,KAAK4S,EAAE5P,OAAOoY,mBAC9B,MAAM,IAAInX,MAAM,sDAEjB,IAaIoX,EAbAhe,EAAK2C,KAAK3C,GAAGmD,WAAU,GAKvB8a,EAAY,GAChBpB,GAAUqB,YAAY/gB,IAAIghB,GAAQtB,GAAUuB,aAAaD,IAAOxmB,QAAQY,IACvE,IAAI8lB,GACAA,EAAYre,EAAGU,aAAanI,MAC/B0lB,EAAU1lB,KAAO8lB,EACjBre,EAAGse,gBAAgB/lB,OAIjBylB,EAAkB,EAAShe,EAAGue,UAAUvmB,OAAOiJ,GAAQA,EAAKqB,QAAQua,GAAU2B,WAAWC,WAAW,KACvGT,EAAgB7H,SAKjB,IAAI9N,EAAW1F,KAAK4S,EAAE5P,OAAOoY,kBAAkB/d,EAAI2C,KAAK4S,EAAE5P,QAAQ,GAalE,OAZgB,GAAS0C,GAAY,GAAgBA,GAAYA,GAEvDqW,MAAQ,GAASzY,MAAMtD,KAAK4S,EAAE0H,KAAKlZ,SAAS,MAAkB+Z,GAA4B,IAIpG,EAAMG,EAAW,CAAC1lB,EAAM8lB,KACvBre,EAAG2e,aAAapmB,EAAM8lB,KAEnBL,GACHhe,EAAG4e,QAAQZ,GAEL3V,EAYR,YAAYpS,EAAK4oB,GAAe,GAC/B,IAAIC,EAAenc,KAAK4S,EAAE0H,KAAKrS,MAAM3U,GAAO0M,KAAK4S,EAAE0H,KAAKrS,MAAM3U,GAAK+B,SAAW,GAC9E,GAAI6mB,EAAc,CACjB,IAAIE,EAAa,GAejB,OAdAD,EAAannB,QAAQikB,IACpB,IAAIoD,IAAkD,IAAtCrc,KAAK4S,EAAE5P,OAAOsZ,qBAAkCrD,EAAIjmB,MAAMmL,OAAON,WAAW,KAAqB,EAAMG,MAAMib,EAAIjmB,MAAO,CAAC,MAAtC,CAACimB,EAAIjmB,QACtGwH,IAAIsI,GAAQ,GAAKQ,MAAMR,EAAM,CAAC,IAAY,CAACoB,QAAO,KAAW,GAAKZ,MAAMR,IAC1E,GAAIuZ,EAAS3nB,SAAW2nB,EAAShnB,OAAOiC,GAAKA,GAAG5C,OAAhD,CAIA,IAAIimB,EAAW4B,EAAatD,EAAI3lB,KAAO+oB,EAAS3nB,OAAS,GAAK2nB,EAAS,aAAczR,GAAqByR,EAAS1V,KAAK,KAAO,IAAM0V,EAAS,GAAGjb,WAAa,MACxJuZ,EAAY,GAAKrX,MAAMiZ,EAAY,KAAM,CAAC5Y,QAAS3D,KAAK4S,EAAE5P,OAAOwZ,eAIvEJ,EAAWjnB,KAAKwlB,GAHf3a,KAAKwX,MAAM,6BAA+ByB,EAAI7X,iBAL9CpB,KAAKwX,MAAM,6CAA+CyB,EAAI7X,cAUzDgb,EAER,OAAOD,EAUR,eAAeM,GACd,IAAIC,EAAcpe,EAOlB,GANK0B,KAAK2c,kBACT3c,KAAK2c,gBAAkB,GACvB3c,KAAK0a,YAAY,WAAW,GAAuB1lB,QAAQwc,IAC1DxR,KAAK2c,gBAAgBnL,EAAMle,KAAO,GAAKgQ,MAAMkO,EAAMxe,WAGhD0pB,EAAe1c,KAAK2c,gBAAgBF,MACrCne,EAAOoe,EAAazS,KAAKjK,OAAQ,CACpC,GAAI,EAAY1B,KACfA,EAAOA,EAAK0B,KAAK3C,GAAIof,KAChB,EAAUne,IAAWA,aAAgBG,cACzC,MAAM,IAAIwF,MAAM,0BAA4BwY,EAAkB,+BAOhE,GAJI,EAAUne,KAEbA,EAAO4b,GAAU0C,UAAUte,MAEtBA,aAAgBG,aACrB,MAAM,IAAIwF,MAAM,IAAMwY,EAAkB,qDAEzC,OAAOne,GAWT,gBAAgBme,GAEf,GAAKzc,KAAK4S,EAAEiK,OAAS7c,KAAK4S,EAAEiK,MAAMnoB,SAC9BsL,KAAK4S,EAAEiK,OAAS7c,KAAK3C,GAAGU,aAAamc,GAAUuB,aAAaqB,YAAc,IAAIrP,QAAQ,KAAM,KAAKzP,MAAM,MAAMtJ,OAGhH,OAFYsL,KAAK4S,EAAE5P,OAAO+Z,SAAW,CAAC/c,KAAK4S,EAAE5P,OAAO+Z,UAAY/c,KAAK4S,EAAEiK,OAE1Drd,OAAO,CAACwd,EAAa/e,KACjC,IAAK+e,EAAa,CACjB,IAEIC,EAAcC,EAFdC,EAAuB,IAAMC,IAAIC,OAAOnD,GAAUuB,aAAaqB,WAAa,MAAQ7e,EAAO,KAC3Fqf,EAAe,IAAMF,IAAIC,OAAOnD,GAAUuB,aAAa8B,SAAW,MAAQtf,EAAO,IAAMwe,EAAkB,MAExGS,GAAgBld,KAAK3C,GAAGmgB,YAAcxd,KAAK3C,IAAI+c,cAAckD,MAG7Dtd,KAAK3C,GAAGmgB,cAAgBN,EAAa9d,WAAWH,UAAWie,EAAa9d,WAAWH,QAAQke,MAE1Fnd,KAAK3C,GAAGmgB,YAAcN,EAAa9d,aAAe6d,EAAeC,EAAa9d,WAAWH,QAAQke,KAA0BF,EAAaQ,WAAWzd,KAAK3C,OAE7J2f,EAAcE,GAGhB,OAAOF,GACL,MAWL,gBAAgBP,GACf,IAAIA,EAAgBvU,MAAM,kBAA1B,CAIA,IACIwV,EAAQ,GACRxD,GAAUyD,OAAO7gB,KAAK2f,GACzBiB,EAAMvoB,KAAK,CACVwoB,OAAQzD,GAAUyD,OAAO7gB,KAAK2f,GAC9BmB,SAAU,CAAC,UAAYnB,EAAkB,QAG1CiB,EAAMvoB,KAAK,CACVwoB,OAAQzD,GAAUyD,OAAOjoB,IAAI+mB,IAAoBvC,GAAUyD,OAAO7gB,KAAK2f,GACvEmB,SAAU,CAACnB,EAAiB,UAAYA,EAAkB,QAG5D,EAAMvC,GAAUyD,OAAOjoB,IAAK,CAACmoB,EAASF,KACjCA,EAAOxnB,eAAiBsmB,GAC3BiB,EAAMvoB,KAAK,CACVwoB,OAAQA,EACRC,SAAU,CAACC,OAId,IAAIle,EAAU,KAad,OAZA+d,EAAM1oB,QAAQ8oB,KACZ9d,KAAK3C,GAAGmgB,YAAcxd,KAAK3C,IAAI0gB,iBAAiBD,EAAKF,SAASjX,KAAK,MAAM3R,QAAQsJ,IAC7E4b,GAAUyD,OAAOK,2BAA2Bhe,KAAK3C,GAAIiB,EAAMwf,EAAKH,UAC/DG,EAAKH,QAAUG,EAAKH,OAAO7nB,UAC9B6J,EAAUrB,EACCqB,IAAW,EAASA,KAC/BA,EAAUA,GAAW,IACbxK,KAAKmJ,QAKVqB,GAYR,WAAWpC,EAAUe,GACpB,IAAI2f,EAAQ3f,EACZ,GAAI0B,KAAK4S,EAAE5P,OAAOkb,WACjB,GAAI5f,IAAS0B,KAAKma,MAAQ7b,IAAS0B,KAAK3C,GACvCiB,EAAO0B,UACD,GAAI1B,EAAM,CAChB,IAAK,EAAY0B,KAAK4S,EAAE5P,OAAOoY,mBAC9B,MAAM,IAAInX,MAAM,sDAEjB,IAAIjB,EAAS,GAAMhD,KAAK4S,EAAE5P,QAC1BA,EAAOmb,MAAQ5gB,EACfe,EAAO,EAASA,GACbA,EAAK9D,IAAI8D,GAAQ0B,KAAK4S,EAAE5P,OAAOoY,kBAAkB9c,EAAM0E,GAAQ,IAC/DhD,KAAK4S,EAAE5P,OAAOoY,kBAAkB9c,EAAM0E,GAAQ,SAExC,EAAYhD,KAAK4S,EAAE5P,OAAOob,gBACpC9f,EAAO,EAASA,GACbA,EAAK9D,IAAI8D,GAAQ0B,KAAK4S,EAAE5P,OAAOob,aAAa9f,IAC5C0B,KAAK4S,EAAE5P,OAAOob,aAAa9f,IAQ/B,OANA0B,KAAK8X,IAAIva,EAAUe,GACf2f,GAASA,IAAUje,KAAKma,MAAQ8D,IAAUje,KAAK3C,KAAO,EAAS4gB,IAClE/D,GAAUmE,qBAAqBJ,EAAO,KACrCje,KAAKrH,IAAI4E,KAGJe,EAWR,IAAIf,GAEH,IAKIe,EALAwX,EAAc9V,KAAK8V,YAAYvY,GACnC,OAAIuY,IAKa,MAAbvY,EACIyC,KAAK8W,kBAEK,SAAbvZ,IAAwBe,EAAO0B,KAAKma,OACxB,OAAb5c,IAAsBe,EAAO0B,KAAK3C,IAC9B,EAAY2C,KAAK4S,EAAE5P,OAAOob,cAC9Bpe,KAAK4S,EAAE5P,OAAOob,aAAa9f,GAC3BA,GAEEf,KAAYyC,KAAK4S,EAAEvG,SACnB/N,EAAO0B,KAAKse,eAAe/gB,MAC3ByC,KAAK4S,EAAE5P,OAAOub,eAAiBjgB,EAAO0B,KAAKwe,gBAAgBjhB,MAC3DyC,KAAK4S,EAAE5P,OAAOyb,eAAiBngB,EAAO0B,KAAK0e,gBAAgBnhB,MAC/DyC,KAAK2e,WAAWphB,EAAUe,GAGrB0B,KAAK4S,EAAEvG,MAAM9O,KAiBrB,sBAAsBF,GACrB,IAAIuhB,EAAiB,CAACC,QAASxhB,EAAGU,aAAamc,GAAUuB,aAAaroB,KAYtE,OAXIwrB,EAAeC,UAClBD,EAAe9e,UAAY,EAAQ8e,EAAeC,QAAS,MAC3DD,EAAeE,aAAe,EAAOF,EAAeC,QAAS,MAEzDD,EAAeE,aAAajhB,WAAW,OAC1C+gB,EAAeE,aAAe,EAAOF,EAAeE,aAAc,MAE/DF,EAAeE,aAAanV,SAAS,QAAyD,IAAhDiV,EAAeE,aAAa1qB,QAAQ,SACrFwqB,EAAeE,aAAeF,EAAeE,aAAeF,EAAe9e,UAAY,OAGlF8e,EAaR,6BAA6BvhB,GAC5B,IAAIge,EAAiBS,EAKjBN,EAAMzB,EAMV,OAVMsB,EAAkB,EAAShe,EAAGue,UAAUvmB,OAAOiJ,GAAQA,EAAKqB,QAAQua,GAAU2B,WAAWC,WAAW,MACrGA,EAAW,GAASxY,OAAO+X,EAAgB0D,aAAe,IAAI5gB,WAClE2d,EAAW,IAAI,IAGhB5B,GAAUqB,YAAYvmB,QAAQY,KACxB4lB,EAAOne,EAAGU,aAAamc,GAAUuB,aAAa7lB,OAAYmkB,EAAW,GAASzW,MAAMkY,KACxFM,EAAS7B,QAAQrkB,EAAMmkB,KAGlB+B,EAeR,iBAAiBkD,EAAMC,GACtB,GAAID,EAAKrf,QAAQua,GAAU2B,WAAWqD,QAAS,CAC9CD,EAASA,EAAOze,WAAU,GAC1B,IAAI2e,EAASH,EAAKjhB,aAAamc,GAAUuB,aAAaroB,IAClDgsB,EAAWH,EAAOlhB,aAAamc,GAAUuB,aAAaroB,IACtDisB,GAAeJ,EAAOlhB,aAAamc,GAAUuB,aAAaqB,YAAc,IAAI9e,MAAM,KAAKxD,IAAI3H,GAAKA,EAAEsL,QA0CtG,OAtCA8gB,EAAOjD,aAAa9B,GAAUuB,aAAaroB,GAAI+rB,GAE/CjF,GAAUoF,cAAcL,EAAQD,EAAM,UAItC,GAAUA,EAAKxB,YAAcwB,GAAMpD,UAAU5mB,QAAQ,CAACuqB,EAAiBxtB,KACtE,IAAIwtB,EAAgB5f,QAAQua,GAAU2B,WAAWC,UAAjD,CAGAyD,EAAkBA,EAAgB/e,WAAU,GAC5C,IAAIgf,EAAyB,GAAIC,EAAiC,GASlE,IAR4BF,EAAgBxhB,aAAamc,GAAUuB,aAAa8B,UAAY,IAAIvf,MAAM,KAAKxD,IAAI3H,GAAKA,EAAEsL,QACjGnJ,QAAQ0qB,IAC5B,IAAIC,EAA0BN,EAAYhqB,OAAOuqB,GAAeF,EAAoB7hB,WAAW+hB,EAAc,MACzGD,EAAwBjrB,SAC3B8qB,EAAuBrqB,KAAKwqB,EAAwB,IACpDF,EAA+BtqB,KAAKuqB,MAGlCF,EAAuB9qB,OAAQ,CAClC,IAAImrB,EACAC,EAAkBN,EAAuBhlB,IAAIolB,GAAe,IAAMxC,IAAIC,OAAOnD,GAAUuB,aAAaqB,WAAa,MAAQ8C,EAAc,MACvIG,EAAmBN,EAA+BjlB,IAAIklB,GAAuB,IAAMtC,IAAIC,OAAOnD,GAAUuB,aAAa8B,SAAW,MAAQmC,EAAsB,MAClK,KAAKT,EAAOzB,aAAeqC,EAAYZ,EAAOzB,WAAWO,iBAAiBgC,KACH,KAAlEF,EAAYZ,EAAOlB,iBAAiBgC,IAAmBrrB,QAAgBmrB,EAAU,GAAG5gB,QAAQ6gB,KAAqBb,GAMrH,MAAM,IAAIhb,MAAM,4BAA8BlS,EAAI,QAAUotB,EAAS,0CAA4CC,EAAW,MAAQS,EAAUnrB,OAAS,aAJvJwlB,GAAUoF,cAAcC,EAAiBM,EAAU,GAAI,WAEvDA,EAAU,GAAGG,YAAYT,QAM1BN,EAAOgB,OAAOV,MAGTN,EAIR,OADA/E,GAAUoF,cAAcN,EAAMC,EAAQ,WAC/BD,EAaR,qBAAqBA,EAAMC,EAAQiB,EAAiBC,EAAc,IAQjE,GAPAA,EAAcA,EAAY/hB,OAAO,CAAC8b,GAAUuB,aAAaroB,MAAO8mB,GAAUuB,aAAa2E,YACnFpB,EAAKlhB,aAAa,iBACrBqiB,EAAcA,EAAY/hB,QAAQ4gB,EAAKjhB,aAAa,gBAAkB,KAAKC,MAAM,KAAKxD,IAAIhG,GAAOA,EAAI2J,UAKlG,EAAY+b,GAAUmG,mBAAoB,CAC7C,IAAIC,EAAcpG,GAAUmG,kBAAkBrB,EAAMC,EAAQiB,EAAiBC,GAC7E,IAAoB,IAAhBG,EACH,OAAO,GACG,EAAUA,IAAgB,EAASA,MAC7CH,EAAcA,EAAY/hB,OAAOkiB,IAMnC,GAAQ,CAACpG,GAAUuB,aAAaqB,UAAW5C,GAAUuB,aAAa8B,QAAS,OAAQ,UAAUvoB,QAAQY,IACpG,IAAI2qB,EAAQC,EACZ,IAAKL,EAAYjiB,SAAStI,KAAUuqB,EAAYjiB,SAAS,OAASqiB,EAAStB,EAAOlhB,aAAanI,IAAQ,CACtG,GAAI4qB,EAASxB,EAAKjhB,aAAanI,GAC9B,IAAI6qB,EAAgC,YAApBP,EAAgC,CAACK,EAAQC,GAAU,CAACA,EAAQD,QAExEE,EAAY,CAACF,GAElBvB,EAAKhD,aAAapmB,EAAM,GAAQ6qB,EAAU9Z,KAAK,KAAK3I,MAAM,KAAKxD,IAAI3H,GAAKA,EAAEsL,SAASwI,KAAK,MACxFwZ,EAAYhrB,KAAKS,MAMnBskB,GAAUqB,YAAY/gB,IAAIghB,GAAQtB,GAAUuB,aAAaD,IAAOpd,OAAO,SAASpJ,QAAQY,IACvF,IAAI2qB,EAAQC,EACZ,IAAKL,EAAYjiB,SAAStI,KAAUuqB,EAAYjiB,SAAS,OAASqiB,EAAStB,EAAOlhB,aAAanI,IAAQ,CACtG,GAAI4qB,EAASxB,EAAKjhB,aAAanI,IAC1B8qB,EAAgC,YAApBR,EAAgC,CAACK,EAAQC,GAAU,CAACA,EAAQD,IAC7D,GAAGpiB,OAAOwL,SAAS,OACjC+W,EAAU,GAAKA,EAAU,GAAK,UAG/B,IAAIA,EAAY,CAACH,GAElBvB,EAAKhD,aAAapmB,EAAM8qB,EAAU/Z,KAAK,MACvCwZ,EAAYhrB,KAAKS,MAMnB,IAAK,IAAI7D,EAAI,EAAGA,EAAIktB,EAAO0B,WAAWjsB,OAAQ3C,IAAM,CACnD,IAAIypB,EAAOyD,EAAO0B,WAAW5uB,GACxBouB,EAAYjiB,SAASsd,EAAKlpB,OAAU6tB,EAAYjiB,SAAS,MAAS8gB,EAAKlhB,aAAa0d,EAAKlpB,QAC7F0sB,EAAKhD,aAAaR,EAAKlpB,KAAMkpB,EAAKxoB,OAClCmtB,EAAYhrB,KAAKqmB,EAAKlpB,OAMxB,IAAK6tB,EAAYjiB,SAAS,UAAYiiB,EAAYjiB,SAAS,KAAM,CAChE,IAAI0iB,EAAW,GAAU5B,EAAKxB,YAAcwB,GAAMpD,UAChDvmB,OAAOiJ,GAAQA,EAAKqB,QAAQua,GAAU2B,WAAWC,WAC/C+E,EAAa,GAAU5B,EAAOzB,YAAcyB,GAAQrD,UACtDvmB,OAAOiJ,GAAQA,EAAKqB,QAAQua,GAAU2B,WAAWC,WAC/C+E,EAAWnsB,SACVksB,EAASlsB,OACZksB,EAAS,GAAGV,GAAiBW,EAAW,GAAG9B,aAE3CC,EAAK/C,QAAQ4E,EAAW,GAAGrgB,WAAU,KAIxC,OAAO,EAUR,iBAAiBtG,GAChB,GAAIggB,GAAUhR,KAAK4X,SAAU,CAC5B,IAAIzjB,EACJ,GAAInD,EAAMiE,OAAON,WAAW,KAAM,CAEjC,IAAIkjB,EAAO7G,GAAUhR,KAAK4X,SAASE,cAAc,OACjDD,EAAKE,UAAY/mB,EACjBmD,EAAK0jB,EAAKG,gBAEV7jB,EAAK6c,GAAUhR,KAAK4X,SAAS1G,cAAclgB,GAE5C,OAAOmD,GAYT,4BAA4BA,EAAI9H,GAC/B,GAAI8H,EAAG+B,WAAY,CAClB,IAAI+hB,GAAS,EACE,IAAIC,iBAAiBC,IACnCA,EAAUrsB,QAAQ7C,KACZgvB,GAAU,EAAShvB,EAAEmvB,cAAcpjB,SAASb,KAChD8jB,GAAS,EACT5rB,SAIMyhB,QAAQ3Z,EAAG+B,WAAY,CAACmiB,WAAU,IAC3CrH,GAAUmE,qBAAqBhhB,EAAG+B,WAAY,KACxC+hB,IACJA,GAAS,EACT5rB,UAUL2kB,GAAUhR,KAAO,GAKjBgR,GAAUyD,OAAS,EAKnBzD,GAAU2B,WAAa,CACtBC,SAAU,6BACV0F,OAAQ,eACRtC,OAAQ,gBAMThF,GAAUuB,aAAe,CAExBgG,QAAS,gBACTrF,WAAY,mBAEZhpB,GAAI,WACJ0pB,UAAW,aACXS,QAAS,aAET6C,UAAW,CAAC,YAAa,WAM1BlG,GAAUqB,YAAc,CACvB,UACA,cAMc,UClqBf,MAAMmG,GAAQ,cAAc,GAU3B,YAAYrkB,EAAI2F,EAAS,IACxBgH,MAAM3M,EAAI,GAAS,GAAI2F,EAAQ0e,GAAM1e,SAKrChD,KAAKgX,QAAQhX,KAAK4S,EAAE5P,OAAO2e,QAAS,CAACtjB,EAASsW,MACzC3U,KAAK4S,EAAExf,GAAG0rB,cAAiB,EAAUzgB,IAAa,GAAUA,IAAa,EAAaA,KAEzF2B,KAAK4hB,SAASvjB,EAAS2B,KAAK4S,EAAExf,GAAG0rB,aAAc9e,KAAK4S,EAAE5P,OAAO6e,cAEzD,EAAcxjB,IACjBA,EAAQ2Y,QAAQG,IACfnX,KAAK4hB,SAASvjB,EAAS2B,KAAK4S,EAAExf,GAAG0rB,aAAc9e,KAAK4S,EAAE5P,OAAO6e,aAAcpvB,OAAOmC,KAAKuiB,SAc5F,KAAK9Y,GAEJ,OADA2B,KAAK8X,IAAI9X,KAAK4S,EAAE5P,OAAO2e,QAAStjB,GACzB2B,KAcR,SAAS8hB,EAAahD,EAAc+C,EAAe,KAAME,EAAW,IAC/D,EAAcD,KAAiB,GAASA,KAC3CA,EAAcA,EAAYjK,UAE1BpjB,UAAUC,OAAS,EAAIqtB,EAAWtvB,OAAOmC,KAAKktB,IAAc9sB,QAAQuM,IACpEA,EAAI,EAAWA,GAAK6P,SAAS7P,GAAKA,EAClC,IAAIygB,EAAOhiB,KAAK+X,IAAIxW,GAAKvB,KAAKpN,IAAI2O,GAAK,KACvC,GAAK,EAAaugB,EAAYvgB,KA0BvB,GAAIygB,EACV,GAAI,EAAYH,GAAe,CAC9B,IAAII,EAAeJ,EAAaG,GAAM,EAAOzgB,GACxC,YAAa,GAAU2H,MAAS+Y,aAAwB,GAAU/Y,KAAKgK,QAC3E+O,EAAaC,KAAK,KACjBF,EAAK3kB,GAAGmW,WACN2O,MAAM,KACRH,EAAK3kB,GAAGmW,WAGTwO,EAAK3kB,GAAGmW,cAGTwO,EAAKvH,OACLuH,EAAK3kB,GAAGmW,aAxCyB,CAClC,IAAI4O,GAAY,EAChB,IAAKJ,EAAM,CACV,IAAIK,EAAqBvD,EAAa9gB,MAAM,MAE5CqkB,EAAmB,IAAM,IAAM9gB,EAC/B,IAAI+gB,EAASZ,GAAMxC,OAAOmD,EAAmB1b,KAAK,OAClD,GAAI2b,EAAQ,CACX,IAAIC,EC9EK,6BACd,IAAgC,IAA5BrtB,EAAId,QAAQ4X,GACf,OAAOtX,EAAS,QAAKC,EAEtB,IAAI6P,GAAoB,IAAX9P,EAAkBQ,EAAIR,OAAS,GAAgB,IAAXA,EAAmB,EAAIA,EACpE8tB,EAAOC,EAAgBvtB,EAAIf,YAAY6X,GAAa,EAAI9W,EAAId,QAAQ4X,GAAa,EACjF0W,EAAS,EAAa1W,GAA8C,GAAjC9W,EAAIL,MAAM2tB,EAAMA,EAAOhe,GAI9D,OAHIme,GAAUD,EAAMhuB,OAAS8P,GAAUke,EAAMhuB,OAASQ,EAAIR,SACzDguB,EAAQA,EAAMtkB,OAAOlJ,EAAIL,MAAM,EAAG2P,EAASke,EAAMhuB,UAE3CA,EAASguB,EAAQA,EAAM,GDoET,CAAWjwB,OAAOmC,KAAKktB,GAAcvgB,EAAI,IAA4B,GACnF/B,OAAO,CAACP,EAAS2jB,IAAO3jB,IAAYe,KAAK+X,IAAI6K,GAAM5iB,KAAKpN,IAAIgwB,GAAM,MAAO,MACvEL,EACHA,EAAUllB,GAAGwlB,OAAOP,GAEpBtiB,KAAK3C,GAAG4iB,OAAOqC,GAEhBN,EAAOhiB,KAAK2e,WAAWpd,EAAG+gB,GAC1BF,GAAY,GAGVJ,IACC,EAAYH,GACfA,EAAaG,EAAMF,EAAYvgB,GAAIA,EAAG6gB,GAEtCJ,EAAKzuB,KAAKuuB,EAAYvgB,QAuC3B,YAAYrH,EAAO8I,EAAS,GAAI8f,GAAqB,EAAM7f,EAASye,IAInE,IAAIrkB,EAAKnD,EACT,GAAI,EAAUA,KAAWA,EAAMiE,OAAON,WAAW,OAAgC,IAAxB3D,EAAM9F,QAAQ,MACtE,IAAK,GAAU2uB,WAAa1lB,EAAKqkB,GAAMxC,OAAO,EAAQhlB,EAAO,QAC5D,MAAM,IAAI+J,MAAM,sCAAwC/J,EAAQ,UAE3D,CACN,GAAI,EAAUA,MACPmD,EAAK,GAAUuf,UAAU1iB,IAC9B,MAAM,IAAI+J,MAAM,iCAAkC/J,EAAQ,oBAG5D,GAAI4oB,GAAsB,GAAUC,QAAS,CAC5C,IAAI3vB,EAAI4vB,EAASC,EAASC,EAAW7lB,EAAGsC,QAAQ,GAAUkc,WAAWqD,QACrE,IAAK9rB,EAAK,EAAQiK,EAAGU,aAAa,GAAU0d,aAAaroB,KAAO,GAAI,SAG/D8vB,IAAaF,EAAU5vB,KAAS4vB,EAAU,EAAY5vB,EAAI,OAAS4vB,EAAQ5uB,QAAQ,MAAQ,KAC5F6uB,EAAUvB,GAAMxC,OAAO8D,IAAW,CACrC,IAAIG,EAAM9lB,EACVA,EAAK,GAAU+lB,UAAU/lB,EAAI4lB,GACzBC,GACHC,EAAInD,YAAY3iB,QAEPjK,GACVwQ,QAAQyf,KAAK,gCAAkCjwB,IAIlD,OAAO,IAAI6P,EAAO5F,EAAI2F,GAUvB,cAAclD,GACb,OAAO,GAAUijB,QAAQO,KAAKxjB,KAOhC4hB,GAAM1e,OAAS,CACd0T,MAAM,EACNiL,QAAS,IACTzD,WAAW,EACXE,aAAc,KACdhD,kBAAmBsG,GAAMc,KACzB1H,aAAa,GAMC,UE/Lf,GAAU5R,KAAOqa,OAMjB,IAAIC,GAAuB,IAAItQ,QAAQuQ,IACV,aAAxB3C,SAAS4C,YAGb5C,SAAS6C,iBAAiB,mBAAoBF,GAAS,GACvDF,OAAOI,iBAAiB,OAAQF,GAAS,IAHxCA,MAMF,GAAUG,MAAQ,CAACruB,EAAUsuB,GAAiB,KAC7CL,GAAqBtB,KAAK,KACpB2B,EAGL,GAAUC,QAAQC,sBAAsB7B,KAAK3sB,GAF5CA,OAUHiuB,GAAqBtB,KAAK,KAEL,IACfa,EACAiB,EACAC,EAIAF,EAcDG,EArBJ,GAAUJ,SACLf,EAAU,EAASjC,SAAS/C,iBAAiB,gBAAkB,GAAUlC,WAAW2F,OAAS,OAAO/c,UACpGuf,EAAgBjB,EAAQ1tB,OAAOyC,GAAKA,EAAEgG,aAAa,SAAWhG,EAAEqsB,QAAQvI,SAASlnB,QACjFuvB,EAAiBD,EAAcxpB,IAAI1C,GAAK,IAAIob,QAAQuQ,IACvD3rB,EAAE6rB,iBAAiB,oBAAqBF,GACxC3rB,EAAE6rB,iBAAiB,kBAAmBF,MAEnCM,EAAwB7Q,QAAQC,IAAI8Q,GAAgB/B,KAAK,KAC5D+B,EAAevjB,OAAO,KAEhB,CACN8iB,wBACAO,wBACAhB,UACAiB,gBACAC,mBAOF,IAAIG,EAAyB,GAC7B,GAAUrB,QAAU,IAAI,EAAO,GAAUe,QAAQf,QAAoB,GAAiB,CAACvB,EAAQ1hB,EAAWmjB,EAASoB,KAC9G,GAAUP,QAAQG,eAAevvB,SAAWwvB,IAC/CA,GAA0B,EAC1BtgB,QAAQyf,KAAK,2JAEd,IAAIiB,EAAaxkB,EAAU6G,KAAK,KAChC,GAAIyd,EAAuBlmB,SAASomB,GACnC,OAAO,GAAUvB,QAAQO,KAAKxjB,EAAUjL,MAAM,GAAI,GAAG8R,KAAK,MAE3Dyd,EAAuBjvB,KAAKmvB,GAC5B,IAAIjnB,EAAKmkB,EAAO2C,QAAQ/J,cAAc,IAAMgD,IAAIC,OAAO,GAAU5B,aAAaroB,IAAM,KAAOkxB,EAAa,MACxG,GAAIjnB,GAAM4lB,EAAS,CAClB,IACC,IAAI9C,EAAc,GACdqB,EAAO1jB,aAAa,iBACvBqiB,GAAeqB,EAAOzjB,aAAa,gBAAkB,KAAKC,MAAM,KAAKxD,IAAIhG,GAAOA,EAAI2J,SAErFd,EAAK,GAAU+lB,UAAU/lB,EAAI4lB,EAAS,UAAW9C,GAChD,MAAM9a,GACPzB,QAAQ4T,MAAM,iCAAmC6M,EAAc,MAAQhf,EAAEkf,SAG1E,OADAH,EAAuBnX,MAChB5P,EAGR,OADA+mB,EAAuBnX,MAChB5P,EAAKA,EAAGmD,WAAU,GACrByiB,EAAUA,EAAQziB,WAAU,GAAQ,SAQ1CgkB,eAAeC,OAAO,GAAU5I,WAAW2F,OAAQ,cAAckD,oBAYhE,yBAAyBpyB,EAAMqyB,EAAUC,GACpCA,GACH5kB,KAAK6kB,OASP,OACC,IAAIC,EAAM9kB,KAAKjC,aAAa,OACxB+mB,GAAO9kB,KAAKmkB,QAAQvI,SAASlnB,OAChCkP,QAAQyf,KAAK,6FACHyB,GACVC,MAAMD,GAAK5C,KAAK8C,GACRA,EAASC,GAAKD,EAASE,OAAShS,QAAQiS,OAAOH,EAASI,aAC7DlD,KAAKiC,IACPnkB,KAAKqlB,UAAYlB,EAEjBnkB,KAAKslB,cAAc,IAAIC,MAAM,wBAC3BpD,MAAM3K,IAER5T,QAAQyf,KAAK,gCAAkCyB,EAAM,MAAQtN,EAAQ,KACrExX,KAAKslB,cAAc,IAAIC,MAAM,sBAUhC,gCACC,MAAO,CAAC,SAEP,CAACC,QAAS,aAKbhB,eAAeC,OAAO,GAAU5I,WAAWqD,OAAQ,cAAczgB,YAOhE,gBACC,OAAQuB,KAAKlC,aAAa,cACrBkC,KAAKf,QAAQ,cACbe,KAAKf,QAAQ,GAAU4c,WAAWqD,OAAS,cASjD,oBACClf,KAAKylB,WAAY,EACbzlB,KAAK0lB,iBACR1lB,KAAKyjB,UAcP,yBAAyBnxB,EAAMqyB,EAAUC,GACpC5kB,KAAK0lB,iBACR1lB,KAAKyjB,UASP,UACC,GAAMG,MAAM,KACX,IAAK5jB,KAAKZ,WACT,OAAO,EAER,IAAIumB,EAAa7lB,EAAW8lB,EAAgB,GAAUnK,aAAaroB,GACnE,IAAK0M,EAAY,EAAQE,KAAKjC,aAAa6nB,IAAkB,GAAI,QAC7D9lB,IAAcE,KAAK6lB,YAEtB,GADA7lB,KAAK6lB,YAAc/lB,EACb6lB,EAAc,GAAMzG,OAAOpf,GAE1B,CACN,IAAIgmB,EAAW,GAAU1C,UAAUpjB,KAAM2lB,GACrC3lB,KAAKlC,aAAa,WAChBkC,KAAKZ,WAAWoe,YACpBxd,KAAKZ,WAAW2mB,aAAa,CAAC7yB,KAAM,SAErC8M,KAAKZ,WAAWoe,WAAWyC,OAAO6F,GAClC9lB,KAAKwT,UAELxT,KAAKggB,YAAY8F,QAVlB9lB,KAAKgmB,WAAa,sCAAwClmB,EAAY,OAsB1E,gCACC,MAAO,CAAC,WAAY,GAAU2b,aAAaroB,OAY9B,UCvPVmwB,OAAO0C,YACX1C,OAAO0C,UAAY,IAEpB1C,OAAO0C,UAAUvE,MAAQ","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n","\r\n/**\r\n * Return the part of a string before a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   beforeLast\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search, beforeLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = beforeLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn subject;\r\n\t}\r\n\treturn subject.substr(0, pos);\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"array\".\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val);\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'string';\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"undefined\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn arguments.length && (val === undefined || typeof val === 'undefined');\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is null.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === null || val === '';\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"object\".\r\n * This holds true for anything object, including built-ins.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn Array.isArray(val) || typeof val === 'object';\r\n};\r\n","\r\n/**\r\n * Tells if val is pure object.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !Array.isArray(val) && typeof val === 'object' && val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isTypeArray from '../js/isTypeArray.js';\r\nimport _isEmpty from '../js/isEmpty.js';\r\nimport _isObject from '../js/isObject.js';\r\n\r\n/**\r\n * Casts an array-like object to an array.\r\n *\r\n * @param mixed \tval\r\n *\r\n * @return array\r\n */\r\nexport default function(val) {\r\n\tif (_isArray(val)) {\r\n\t\treturn val;\r\n\t};\r\n\tif (val !== false && val !== 0 && _isEmpty(val)) {\r\n\t\treturn [];\r\n\t};\r\n\tif (_isTypeArray(val)) {\r\n\t\treturn Array.prototype.slice.call(val);\r\n\t};\r\n\tif (_isObject(val)) {\r\n\t\treturn Object.values(val);\r\n\t};\r\n\treturn [val];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from './isNull.js';\r\nimport _isUndefined from './isUndefined.js';\r\nimport _isTypeObject from './isTypeObject.js';\r\n\r\n/**\r\n * Tells if val is empty in its own type.\r\n * This holds true for NULLs, UNDEFINED, FALSE, 0,\r\n * objects without keys, empty arrays.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isNull(val) || _isUndefined(val) || val === false || val === 0 \r\n\t\t|| (_isTypeObject(val) && !Object.keys(val).length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from './isString.js';\r\nimport _isUndefined from './isUndefined.js';\r\n\r\n/**\r\n * Tells if val is \"array-like\".\r\n * This holds true for anything that has a length property.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn !_isString(val) && !_isUndefined(val.length);\r\n};\r\n","\r\n/**\r\n * Adds an item if not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...itms\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...items) {\r\n\titems.forEach(itm => {\r\n\t\tif (arr.indexOf(itm) < 0) {\r\n\t\t\tarr.push(itm);\r\n\t\t}\r\n\t});\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the intersection of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) !== -1\r\n\t);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _pushUnique from '@onephrase/commons/arr/pushUnique.js';\r\nimport _intersect from '@onephrase/commons/arr/intersect.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The HTML Context Model Schema.\r\n\t// @see https://html.spec.whatwg.org/multipage\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\n/**\r\n * @object\r\n */\r\nconst Schema = {\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\tstd: {\r\n\t\t/**\r\n\t\t * @uncategorized\r\n\t\t */\r\n\t\thtml: {\r\n\t\t\ttype: ['#sectioning-root'],\r\n\t\t\tmodel: ['head', 'body'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcaption: {\r\n\t\t\tmodel: ['#flow', '!table'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcol: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tcolgroup: {\r\n\t\t\tmodel: [{'colgroup[span]': ['#nothing']}, {':not(colgroup[span])': ['col', 'template']}],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tdd: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'definition',\r\n\t\t},\r\n\t\tdt: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tfigcaption: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thead: {\r\n\t\t\tmodel: ['#metadata'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlegend: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tli: {\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'listitem',\r\n\t\t},\r\n\t\toptgroup: {\r\n\t\t\tmodel: ['option', '#script-supporting'],\r\n\t\t\timplicitRole: 'group',\r\n\t\t},\r\n\t\toption: {\r\n\t\t\tmodel: [{'option[label][value]': ['#nothing']}, {'option[label]:not(option[value])': ['#text']}, {':not(option[label])': ['#text']}],\r\n\t\t},\r\n\t\tparam: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\trp: {\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\trt: {\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsource: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tsummary: {\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#phrasing', '#heading'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttrack: {\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttbody: {\r\n\t\t\tmodel: ['#script-supporting', 'tr'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer'],\r\n\t\t},\r\n\t\ttfoot: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tthead: {\r\n\t\t\tmodel: ['tr', '#script-supporting'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\ttr: {\r\n\t\t\tmodel: ['#script-supporting', 'td', 'th'],\r\n\t\t},\r\n\t\t/**\r\n\t\t * @categorized\r\n\t\t */\r\n\t\ta: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'a[href]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#interactive', '!a'],\r\n\t\t},\r\n\t\tabbr: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing',],\r\n\t\t},\r\n\t\taddress: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow', '!#heading', '!#sectioning', '!header', '!footer', '!address',],\r\n\t\t},\r\n\t\t// If a child of <map>\r\n\t\tarea: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tarticle: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'article',\r\n\t\t\tacceptableRoles: ['application', 'article', 'document', 'main',],\r\n\t\t},\r\n\t\taside: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-content'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'complementary',\r\n\t\t\tacceptableRoles: ['complementary', 'note', 'search',],\r\n\t\t},\r\n\t\taudio: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'audio[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(audio[src])': ['source']}],\r\n\t\t},\r\n\t\tb: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbase: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbdi: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tbdo: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tblockquote: {\r\n\t\t\ttype: ['#flow', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\tbody: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow', '@banner', '@contentinfo', '@complementary', '@main'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tbutton: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#phrasing', '!#interactive'],\r\n\t\t},\r\n\t\tcanvas: {\r\n\t\t\ttype: ['#embedded', '#flow', '#palpable', '#phrasing'], \r\n\t\t\tmodel: ['#transparent', '!#interactive', 'a', 'img[usemap]', 'button', 'input[type=\"button\"]', 'input[type=\"radio\"]', 'input[type=\"checkbox\"]', 'select[multiple]', 'select[size>=1]', /*has tabindex but not #interactive*/'[tabindex]!#interactive'],\r\n\t\t},\r\n\t\tcite: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tcode: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdata: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tdatalist: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '#script-supporting', 'option'],\r\n\t\t},\r\n\t\tdel: {\r\n\t\t\ttype: ['#flow', '#phrasing'],\r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tdetails: {\r\n\t\t\ttype: ['#flow', '#interactive', '#palpable', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow', 'summary'],\r\n\t\t},\r\n\t\tdfn: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing', '!dfn'],\r\n\t\t\timplicitRole: 'term',\r\n\t\t},\r\n\t\tdialog: {\r\n\t\t\ttype: ['#flow', '#sectioning-root'],\r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'dialog',\r\n\t\t},\r\n\t\tdiv: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [{'dl > div': ['dt', 'dd']}, {':not(dl > div)': ['#flow']}],\r\n\t\t},\r\n\t\tdl: {\r\n\t\t\t/*complicated*/\r\n\t\t\ttype: ['#flow', /*{:contains(> * name-value group): ['#palpable']}*/],\r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: ['#script-supporting', 'dl', 'dt', 'div'],\r\n\t\t},\r\n\t\tem: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tembed: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tfieldset: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['legend', '#flow'],\r\n\t\t},\r\n\t\tfigure: {\r\n\t\t\ttype: ['#flow', '#sectioning-root', '#palpable'],\r\n\t\t\tmodel: ['#flow', 'figcaption'],\r\n\t\t\timplicitRole: 'figure',\r\n\t\t},\r\n\t\tfooter: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['contentinfo',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tform: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!form'],\r\n\t\t},\r\n\t\th1: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th2: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th3: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th4: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th5: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\th6: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t\timplicitRole: 'heading',\r\n\t\t},\r\n\t\theader: {\r\n\t\t\ttype: ['#flow', '#palpable'],\r\n\t\t\tmodel: ['#flow', '!header', '!footer'],\r\n\t\t\tacceptableRoles: ['banner',],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\thgroup: {\r\n\t\t\ttype: ['#flow', '#heading', '#palpable'],\r\n\t\t\tmodel: ['h1', 'h2', 'h3', 'h4', 'h5', 'h6', '#script-supporting'],\r\n\t\t},\r\n\t\thr: {\r\n\t\t\ttype: ['#flow'],\r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\timplicitRole: 'separator',\r\n\t\t},\r\n\t\ti: {\r\n\t\t\ttype: ['#flow', '#palpable', '#phrasing'],\r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tiframe: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\timg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'img[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tinput: {\r\n\t\t\ttype: ['#flow', '#phrasing', {'input:not([type!=\"hidden\"])': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tins: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tkbd: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tlabel: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#interactive', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!label'],\r\n\t\t},\r\n\t\tlink: {\r\n\t\t\ttype: ['#metadata', {'body link': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\tmain: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'main',\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tmap: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmark: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tmath: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\tmenu: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tmeta: {\r\n\t\t\ttype: ['#metadata', {'meta[itemprop]': ['#flow', '#phrasing']}], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t\tnames: ['application-name', 'author', 'description', 'generator', 'keywords', 'referrer', 'theme-color'],\r\n\t\t},\r\n\t\tmeter: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tnav: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'navigation',\r\n\t\t\tacceptableRoles: ['navigation',],\r\n\t\t},\r\n\t\tnoscript: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing'], \r\n\t\t\tmodel: [{'head link': ['style', 'meta', 'link']}, {':not(head link)': ['#transparent', '!noscript']}],\r\n\t\t},\r\n\t\tobject: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'object[usemap]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', 'param'],\r\n\t\t},\r\n\t\tol: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\toutput: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!meter'],\r\n\t\t},\r\n\t\tp: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tpicture: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing'], \r\n\t\t\tmodel: ['source', 'img', '#acript-supporting'],\r\n\t\t},\r\n\t\tpre: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tprogress: {\r\n\t\t\ttype: ['#flow', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing', '!progress'],\r\n\t\t},\r\n\t\tq: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\truby: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'],\r\n\t\t\t/*complicated*/ \r\n\t\t\tmodel: ['rp', 'rt'],\r\n\t\t},\r\n\t\ts: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsamp: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tscript: {\r\n\t\t\ttype: ['#flow', '#metadata', '#phrasing', '#acript-supporting'], \r\n\t\t\tmodel: [{'script[src]': []}],\r\n\t\t},\r\n\t\tsection: {\r\n\t\t\ttype: ['#flow', '#sectioning-content', '#palpable'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t\timplicitRole: 'region',\r\n\t\t\tacceptableRoles: ['alert', 'alertdialog', 'application', 'contentinfo', 'dialog', 'document', 'log', 'main', 'marquee', 'region', 'search', 'status',],\r\n\t\t},\r\n\t\tselect: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['option', 'optgroup', '#acript-supporting'],\r\n\t\t},\r\n\t\tslot: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#transparent'],\r\n\t\t},\r\n\t\tsmall: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tspan: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstrong: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tstyle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\tsub: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsup: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tsvg: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', '#palpable'], \r\n\t\t\t/*complicated*/\r\n\t\t\tmodel: [],\r\n\t\t},\r\n\t\ttable: {\r\n\t\t\ttype: ['#flow', '#palpable'], \r\n\t\t\tmodel: ['caption', 'colgroup', 'thead', 'tbody', 'tr', 'tfoot', '#script-supporting'],\r\n\t\t},\r\n\t\ttd: {\r\n\t\t\ttype: ['#sectioning-root'], \r\n\t\t\tmodel: ['#flow'],\r\n\t\t},\r\n\t\ttemplate: {\r\n\t\t\ttype: ['#metadata', '#flow', '#phrasing', '#script-supporting'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t\ttextarea: {\r\n\t\t\ttype: ['#flow', '#interactive', '#labelable', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#text'],\r\n\t\t},\r\n\t\ttime: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: [{'time[datetime]': ['#phrasing']}, {':not(time[datetime])': ['#text']}],\r\n\t\t},\r\n\t\ttitle: {\r\n\t\t\ttype: ['#metadata'],\r\n\t\t\tmodel: ['#text'],\r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tu: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tul: {\r\n\t\t\ttype: ['#flow', {':contains(> li)': ['#palpable']}], \r\n\t\t\tmodel: ['#script-supporting', 'li'],\r\n\t\t\timplicitRole: 'list',\r\n\t\t},\r\n\t\tvar: {\r\n\t\t\ttype: ['#flow', '#phrasing', '#palpable'], \r\n\t\t\tmodel: ['#phrasing'],\r\n\t\t},\r\n\t\tvideo: {\r\n\t\t\ttype: ['#embedded', '#flow', '#phrasing', {'video[controls]': ['#interactive', '#palpable']}], \r\n\t\t\tmodel: ['#transparent', '!#media', 'track', {':not(video[src])': ['source']}],\r\n\t\t},\r\n\t\twbr: {\r\n\t\t\ttype: ['#flow', '#phrasing'], \r\n\t\t\tmodel: ['#nothing'],\r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * @object\r\n\t */\r\n\taria: {\r\n\t\tbanner: {\r\n\t\t\ttype: ['@banner'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcontentinfo: {\r\n\t\t\ttype: ['@contentinfo'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tcomplementary: {\r\n\t\t\ttype: ['@complementary'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tnavigation: {\r\n\t\t\ttype: ['@navigation'], \r\n\t\t\tsingleton: true,\r\n\t\t},\r\n\t\tlist: {\r\n\t\t\ttype: ['@list'], \r\n\t\t},\r\n\t\tlistitem: {\r\n\t\t\ttype: ['@listitem'], \r\n\t\t},\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic content model for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetContentModelFor(el) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\treturn Schema.std[elTagName] ? Schema.expandRules(el, Schema.std[elTagName].model || []) : [];\r\n\t},\r\n\t\r\n\t/**\r\n\t * Returns the semantic categories for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param bool\t\t\t\t\t\troleInclusive\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetCategoriesFor(el, roleInclusive = true) {\r\n\t\tvar elTagName = el.nodeName.toLowerCase();\r\n\t\tvar elSchema = Schema.std[elTagName] || Schema.aria[elTagName] || {};\r\n\t\tvar currentElCategories = [];\r\n\t\tif (roleInclusive && !el.nodeName.startsWith('#') \r\n\t\t&& (el.hasAttribute('role') || elSchema.implicitRole)) {\r\n\t\t\t// Current el's impliable/acceptable roles\r\n\t\t\t// (These take precedence over native semantics)\r\n\t\t\tif (el.hasAttribute('role')) {\r\n\t\t\t\tvar definedRoles = el.getAttribute('role').split(' ');\r\n\t\t\t\tel.getAttribute('role').split(' ').forEach(role => {\r\n\t\t\t\t\tif (elSchema && elSchema.acceptableRoles && !elSchema.acceptableRoles.includes(role)) {\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\trole = role.trim();\r\n\t\t\t\t\tcurrentElCategories.push('@' + role);\r\n\t\t\t\t\tif (Schema.aria[role] && Schema.aria[role].type) {\r\n\t\t\t\t\t\tcurrentElCategories = currentElCategories.concat(Schema.expandRules(el, Schema.aria[role].type || []));\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else if (elSchema.implicitRole) {\r\n\t\t\t\t_pushUnique(currentElCategories, '@' + elSchema.implicitRole, elTagName);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Current node's categories/tagname\r\n\t\t\tvar currentElCategories = _pushUnique(Schema.expandRules(el, elSchema.type || []), elTagName);\r\n\t\t}\r\n\t\treturn currentElCategories;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node belongs in the context's content model\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tcontext\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInContentModel(context, node) {\r\n\t\tvar contextModel = context instanceof HTMLElement \r\n\t\t\t? Schema.getContentModelFor(context)\r\n\t\t\t: context;\r\n\t\tvar nodeCategories = node instanceof HTMLElement \r\n\t\t\t? Schema.getCategoriesFor(node)\r\n\t\t\t: node;\r\n\t\tif (_intersect(contextModel, ['#nothing', '#text']).length) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar valid;\r\n\t\t// So current content model has to list either this node's categories,\r\n\t\t// tagname, or impliable/acceptable roles\r\n\t\tcontextModel.forEach(allowedNode => {\r\n\t\t\tif (allowedNode.startsWith('!')) {\r\n\t\t\t\tvar disallowedNode = allowedNode.substr(1);\r\n\t\t\t\tif (nodeCategories.includes(disallowedNode)) {\r\n\t\t\t\t\tvalid = false;\r\n\t\t\t\t}\r\n\t\t\t} else if (valid !== false) {\r\n\t\t\t\tif (nodeCategories.includes(allowedNode)) {\r\n\t\t\t\t\tvalid = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn valid && true;\r\n\t},\r\n\r\n\t/**\r\n\t * Validates that the given node is associated to the context directly\r\n\t * going by the semantics\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tscope\r\n\t * @param HTMLElement\t\t\t\tnode\r\n\t * @param object\t\t\t\t\tnodeSchema\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tassertNodeBelongsInScopeAs(scope, node, nodeSchema = null) {\r\n\t\tvar contextCategories = Schema.getCategoriesFor(scope);\r\n\t\tvar closest, current = node, nodeModel;\r\n\t\twhile (!closest && (current = current.parentNode)) {\r\n\t\t\tif (_intersect(contextCategories, Schema.getCategoriesFor(current)).length\r\n\t\t\t\t&& Schema.assertNodeBelongsInContentModel(current, nodeSchema ? (nodeSchema.type || node) : node)\r\n\t\t\t) {\r\n\t\t\t\tclosest = current;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn closest === scope;\r\n\t},\r\n\t\r\n\t/**\r\n\t * Flattens the schema rules for the given element.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\tel\r\n\t * @param array\t\t\t\t\t\trules\r\n\t *\r\n\t * @return array\r\n\t */\r\n\texpandRules(el, rules) {\r\n\t\tvar rles = rules.reduce((categories, rule) => {\r\n\t\t\tif (_isObject(rule)) {\r\n\t\t\t\tif (el.matches(Object.keys(rule)[0])) {\r\n\t\t\t\t\tcategories = categories.concat(Object.values(rule)[0]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tcategories.push(rule);\r\n\t\t\t}\r\n\t\t\treturn categories;\r\n\t\t}, []);\r\n\t\tif (rles.includes('#sectioning-root')) {\r\n\t\t\trles.push('#sectioning-content');\r\n\t\t}\r\n\t\treturn rles;\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Schema;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Matrix loader\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Matrix = class {\r\n\t\r\n\t/**\r\n\t * Creates a new Matrix instance.\r\n\t *\r\n\t * @param array \t\t\tsources\r\n\t * @param string|array \t\tnamespace\r\n\t * @param function \t\t\tgetter\r\n\t * @param MatrixInterface\tcarry\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tconstructor(sources, namespace, getter, carry = null) {\r\n\t\tthis.sources = _arrFrom(sources);\r\n\t\tthis.namespace = _arrFrom(namespace);\r\n\t\tthis.getter = getter;\r\n\t\tthis.carry = carry;\r\n\t\tthis.collections = {};\r\n\t\tthis.value;\r\n\t}\r\n\r\n\t/**\r\n\t * Enters into a sub collection if exists.\r\n\t *\r\n\t * @param string \t\t\tname\r\n\t *\r\n\t * @return MatrixInterface\r\n\t */\r\n\tenter(name) {\r\n\t\tif (!(name in this.collections)) {\r\n\t\t\tthis.collections[name] = new Matrix(\r\n\t\t\t\tthis.sources, \r\n\t\t\t\tthis.namespace.concat(name),\r\n\t\t\t\tthis.getter,\r\n\t\t\t\tthis \r\n\t\t\t);\r\n\t\t}\r\n\t\treturn this.collections[name];\r\n\t}\r\n\r\n\t/**\r\n\t * Leaves the current current collection into the super collection if exists.\r\n\t *\r\n\t * @return MatrixInterface\r\n\t */\r\n\tleave() {\r\n\t\treturn this.carry;\r\n\t}\r\n\r\n\t/**\r\n\t * Lazy-loads a property from sources.\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget() {\r\n\t\tif (!this.value) {\r\n\t\t\tvar namespace = this.namespace.slice();\r\n\t\t\tvar value = this.carry ? this.carry.get() : null;\r\n\t\t\tthis.sources.forEach((source, i) => {\r\n\t\t\t\tif (value = this.getter.call(null, source, namespace, value, i)) {\r\n\t\t\t\t\tthis.value = value;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this.value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds the most-specific module for the given namespace from sources.\r\n\t *\r\n\t * @param sting\t\t\t\t\tnamespace\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tfind(namespace) {\r\n\t\tvar nsArray = namespace.split('/');\r\n\t\tvar subMatrix, nsKey, nsDrill = this;\r\n\t\twhile((nsKey = nsArray.shift()) && (nsDrill = nsDrill.enter(nsKey))) {\r\n\t\t\tsubMatrix = nsDrill; \r\n\t\t}\r\n\t\t// Clone now...\r\n\t\tvar el = subMatrix.get();\r\n\t\tif (el) {\r\n\t\t\treturn el.cloneNode(true);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Matrix;\r\n","\r\n/**\r\n * Removes instances of reference up to <limit> times.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \titm\r\n * @param int|bool \tlimit\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, itm, limit = false) {\r\n\tvar i = arr.indexOf(itm);\r\n\twhile (i > -1 && (limit || limit === false)) {\r\n\t\tarr.splice(i, 1);\r\n\t\tif (limit > 0) {\r\n\t\t\tlimit --;\r\n\t\t};\r\n\t\ti = arr.indexOf(itm);\r\n\t};\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * Instanceof that supports our multi-inheritance implementstion.\r\n *\r\n * @param object\t \tobj1\r\n * @param object\t \tclassB\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj, classB) {\r\n\tif (!obj) {\r\n\t\treturn false;\r\n\t}\r\n\tif (obj instanceof classB) {\r\n\t\treturn true;\r\n\t}\r\n\tvar mixinTest = classA => {\r\n\t\twhile (classA && classA !== Function.prototype) {\r\n\t\t\tif (classA === classB || (classA.prototypes && classA.prototypes.reduce((prevAns, prototype) => prevAns || (prototype === classB) || mixinTest(prototype), false))) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tclassA = Object.getPrototypeOf(classA);\r\n\t\t}\r\n\t\treturn false;\r\n\t};\r\n\treturn mixinTest(obj.constructor);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeFunction from './isTypeFunction.js';\r\n\r\n/**\r\n * Tells if val is of type \"function\".\r\n *\r\n * @param object \t\tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn _isTypeFunction(val) || (val && {}.toString.call(val) === '[object function]');\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"function\".\r\n * This holds true for both regular functions and classes.\r\n *\r\n * @param object\t \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'function';\r\n};\r\n","\r\n/**\r\n * Tells if val is undefined or is of type \"boolean\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val === true || val === false;\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"string\" or a numeric string.\r\n * This holds true for both numbers and numeric strings.\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn val !== true && val !== false && val !== null && val !== '' && !isNaN(val * 1);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\n\r\n/**\r\n * Loops thru obj flatly with a callback function.\r\n * Stops when callback returns a non-undefined value.\r\n *\r\n * @param array|object \t\t\tobj \t\t\tThe array or object to iterate.\r\n * @param function \t\t\t\tcallback \t\tThe callback function.\r\n *\r\n * @return mixed|null\t\t\tAny non-null return from callback\r\n */\r\nexport default function(obj, callback) {\r\n\tvar returnValue = undefined;\r\n\tif (_isTypeObject(obj)) {\r\n\t\tObject.keys(obj).forEach(k => {\r\n\t\t\tif (returnValue !== false) {\r\n\t\t\t\treturnValue = callback(_isNumeric(k) ? parseFloat(k) : k, obj[k]);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\treturn returnValue;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _compareCallback from './compareCallback.js';\r\n\r\n/**\r\n * Asserts (members of) the first value against (members of) subsequent values.\r\n * Assertion could be TRUE, FALSE, or custom.\r\n *\r\n * @param mixed \t\t\tobj1\r\n * @param mixed \t\t\tobj2\r\n * @param bool|function\t\tassertion\r\n * @param int\t\t\t\tdepth\r\n *\r\n * @return bool\r\n */\r\nconst _even = function(obj1, obj2, assertion = true, depth = 1) {\r\n\tif ((_isArray(obj1) && _isArray(obj2) && obj1.length !== obj2.length)\r\n\t|| (_isObject(obj1) && _isObject(obj2) && Object.keys(obj1).length !== Object.keys(obj2).length)) {\r\n\t\treturn false;\r\n\t}\r\n\tvar result = _compareCallback(obj1, obj2, (v1, v2) => {\r\n\t\tif (depth > 0 && ((_isArray(v1) && _isArray(v2)) || (_isObject(v1) && _isObject(v2)))) {\r\n\t\t\treturn _even(v1, v2, assertion, depth - 1);\r\n\t\t}\r\n\t\treturn _isFunction(assertion) ? assertion(v1, v2) : (v1 === v2) === assertion;\r\n\t}, false/*netComparison*/, false/*contrast*/, true/*returnOnFirstFalse*/);\r\n\treturn _isArray(result) ? result.length === obj1.length\r\n\t\t: (_isObject(result) ? Object.keys(result).length === Object.keys(obj1).length : result);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _even;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isBoolean from '../js/isBoolean.js';\r\nimport _each from './each.js';\r\n\r\n/**\r\n * Gets the match(es) between (members of) two values;\r\n * assertion optionally custom.\r\n *\r\n * @param mixed \t\t\tob1\r\n * @param mixed \t\t\tobj2\r\n * @param string|function\tassertion\r\n * @param bool\t\t\t\tnetComparison\r\n * @param bool\t\t\t\tcontrast\r\n * @param bool\t\t\t\treturnOnFirstFalse\r\n *\r\n * @return bool|array|object\r\n */\r\nexport default function(obj1, obj2, assertion = true, netComparison = true, contrast = false, returnOnFirstFalse = false) {\r\n\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\tvar result = [];\r\n\t\tvar contn = true;\r\n\t\tobj1.forEach(v1 => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = false;\r\n\t\t\t_each(obj2, (k, v2) => {\r\n\t\t\t\tif (!testPass || (netComparison && _isTypeObject(v1))) {\r\n\t\t\t\t\ttestPass = assertion(v1, v2);\r\n\t\t\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\t\t\ttestPass = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (_isTypeObject(testPass) && netComparison) {\r\n\t\t\t\t\t\t// Further recursions should use this testPass as v1\r\n\t\t\t\t\t\tv1 = testPass;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult.push(netComparison ? testPass : v1);\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult.push(testPass);\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult.push(v1);\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tif (_isObject(obj1) && _isObject(obj2)) {\r\n\t\tvar result = {};\r\n\t\tvar contn = true;\r\n\t\tObject.keys(obj1).forEach(k => {\r\n\t\t\tif (!contn) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar testPass = assertion(obj1[k], obj2[k]);;\r\n\t\t\tif ((_isArray(testPass) && !testPass.length) || (_isObject(testPass) && !Object.keys(testPass).length)) {\r\n\t\t\t\ttestPass = false;\r\n\t\t\t}\r\n\t\t\tif (_isTypeObject(testPass)) {\r\n\t\t\t\tresult[k] = netComparison ? testPass : obj1[k];\r\n\t\t\t} else if (!_isBoolean(testPass)) {\r\n\t\t\t\tresult[k] = testPass;\r\n\t\t\t} else if ((contrast && !testPass) || (!contrast && testPass)) {\r\n\t\t\t\tresult[k] = obj1[k];\r\n\t\t\t} else if (returnOnFirstFalse) {\r\n\t\t\t\tcontn = false;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _even from '@onephrase/commons/obj/even.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ExprInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nexport default class {\r\n\t\r\n\t/**\r\n\t * Compares the current instance with another object.\r\n\t *\r\n\t * @param object Expr\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\teven(Expr) {\r\n\t\tif (_isObject(Expr) && Expr.jsenType === this.jsenType) {\r\n\t\t\treturn _even(Expr, this);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Inherits properties from a super Expr.\r\n\t *\r\n\t * @param ExprInterface Super\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tinherit(Super) {\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds comments to the instance.\r\n\t *\r\n\t * @param string\t comments\r\n\t *\r\n\t * @return this\r\n\t */\r\n\twithComments(comments) {\r\n\t\tif (!this.meta) {\r\n\t\t\tthis.meta = {};\r\n\t\t}\r\n\t\tthis.meta.comments = comments;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds variables to the instance.\r\n\t *\r\n\t * @param array\t\t vars\r\n\t *\r\n\t * @return this\r\n\t */\r\n\twithVars(vars) {\r\n\t\tif (!this.meta) {\r\n\t\t\tthis.meta = {};\r\n\t\t}\r\n\t\tthis.meta.vars = vars;\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Evaluates the expression instance for a result,\r\n\t * optionally in the context of an object.\r\n\t *\r\n\t * @param object context\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t//eval(context = null, callback = null)\r\n\t\r\n\t/**\r\n\t * Serializes the expression instance back to a string,\r\n\t * optionally in the context of an object.\r\n\t *\r\n\t * @param object context\r\n\t *\r\n\t * @return string\r\n\t */\r\n\t//toString(context = null)\r\n\t\r\n\t/**\r\n\t * SAttempts to parse a string into the class instance.\r\n\t *\r\n\t * @param string expr\r\n\t * @param object params\r\n\t *\r\n\t * @return ExprInterface\r\n\t */\r\n\t//static parse(expr, params = {})\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AssignmentInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'AssignmentExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ReferenceInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Reference'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * DeletionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'DeleteExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * CallInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'CallExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _remove from '@onephrase/commons/arr/remove.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _instanceof from '@onephrase/commons/js/instanceof.js';\r\nimport AssignmentInterface from './Expr/AssignmentInterface.js';\r\nimport ReferenceInterface from './Expr/ReferenceInterface.js';\r\nimport DeletionInterface from './Expr/DeletionInterface.js';\r\nimport CallInterface from './Expr/CallInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Jsen (base) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Jsen = class {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, Parsers, params = {}, Static = Jsen) {\r\n\t\tif (!params.meta) {\r\n\t\t\tparams.meta = {vars: []};\r\n\t\t}\r\n\t\tif (expr.length) {\r\n\t\t\tvar parsers = Object.values(Parsers || Static.grammars);\r\n\t\t\tfor (var i = 0; i < parsers.length; i ++) {\r\n\t\t\t\t// From this point forward, all vars is within current scope\r\n\t\t\t\tvar varsScope = params.meta && _isArray(params.meta.vars) ? params.meta.vars.length : 0;\r\n\t\t\t\tvar parsed = parsers[i].parse(expr, (_expr, _Parsers) => Jsen.parse(_expr, _Parsers, params, Static));\r\n\t\t\t\t// Add/remove vars to scope\r\n\t\t\t\tif (parsed && params.meta) {\r\n\t\t\t\t\tif (!parsed.meta) {\r\n\t\t\t\t\t\tparsed.meta = {};\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// Reap vars into scope expr\r\n\t\t\t\t\tparsed.meta.vars = params.meta.vars.slice(varsScope);\r\n\t\t\t\t\t// Add vars to scope\r\n\t\t\t\t\tif (_instanceof(parsed, ReferenceInterface) || _instanceof(parsed, CallInterface)) {\r\n\t\t\t\t\t\t_remove(parsed.meta.vars, parsed.context);\r\n\t\t\t\t\t\t_remove(params.meta.vars, parsed.context);\r\n\t\t\t\t\t\tparams.meta.vars.push(parsed);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (parsed && params.explain) {\r\n\t\t\t\t\tconsole.log(expr, ' >>------------->> ', parsed.jsenType);\r\n\t\t\t\t}\r\n\t\t\t\tif ((parsed instanceof AssignmentInterface || parsed instanceof DeletionInterface) \r\n\t\t\t\t&& (!params || !params.mutates)) {\r\n\t\t\t\t\tthrow new Error('[Permission error:] ' + expr);\r\n\t\t\t\t}\r\n\t\t\t\tif (parsed) {\r\n\t\t\t\t\treturn parsed;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (params.assert === false) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tthrow new Error('[Syntax error:] ' + expr);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Jsen;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\n\r\n/**\r\n * Flattens a nested array to the given depth.\r\n *\r\n * @param array \tarr\r\n * @param int \t \tdepth\r\n * @param bool \t \twithObjects\r\n *\r\n * @return array\r\n */\r\nconst _flatten = function(arr, depth = 1, withObjects = true) {\r\n\tif (!_isNumeric(depth) || depth <= 0) {\r\n\t\treturn arr;\r\n\t};\r\n\tif (!_isArray(arr) && _isObject(arr) && withObjects) {\r\n\t\tarr = Object.values(arr);\r\n\t};\r\n\tif (!_isArray(arr)) {\r\n\t\treturn arr;\r\n\t};\r\n\treturn arr.reduce((acc, val) => _isArray(val) || (_isObject(val) && withObjects) \r\n\t\t? acc.concat(_flatten(!_isArray(val) ? Object.values(val) : val, depth - 1, withObjects)) \r\n\t\t: acc.concat(val), []);\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default _flatten;","\r\n/**\r\n * Returns THE FIRST ENTRY OR A NUMBER OF ENTRIES counting forward from the begining.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nexport default function(arr, amount = 1) {\r\n\tvar count = 0;\r\n\tarr.forEach(itm => {\r\n\t\tcount ++;\r\n\t});\r\n\tvar firsts = arr.slice(arr.length - count, amount);\r\n\treturn arguments.length > 1 ? firsts : firsts[0];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _first from './first.js';\r\n\r\n/**\r\n * Returns THE LAST ENTRY OR A NUMBER OF ENTRIES counting forward to the end.\r\n *\r\n * @param array \tarr\r\n * @param int\t \tamount\r\n *\r\n * @return mixed|array\r\n */\r\nexport default function(arr, amount = 1) {\r\n\treturn arguments.length > 1\r\n\t\t? _first(arr.slice().reverse(), amount).reverse()\r\n\t\t: _first(arr.slice().reverse());\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _pushUnique from '../arr/pushUnique.js';\r\nimport _getPrototypeChain from './getPrototypeChain.js';\r\n\r\n/**\r\n * Eagerly retrieves object members all down the prototype chain.\r\n *\r\n * @param object\t \tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return array\r\n */\r\nexport default function(obj, until) {\r\n\tvar keysAll = [];\r\n\t_getPrototypeChain(obj, until).forEach(obj => {\r\n\t\t_pushUnique(keysAll, ...Object.getOwnPropertyNames(obj));\r\n\t});\r\n\treturn keysAll;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the prototype chain.\r\n *\r\n * @param object \t\tobj\r\n * @param object\t \tuntil\r\n *\r\n * @return bool\r\n */\r\nexport default function(obj, until) {\r\n\tuntil = until || Object.prototype;\r\n\tuntil = until && !_isArray(until) ? [until] : until;\r\n\t// We get the chain of inheritance\r\n\tvar prototypalChain = [];\r\n\tvar obj = obj;\r\n\twhile((obj && (!until || until.indexOf(obj) < 0) && obj.name !== 'default')) {\r\n\t\tprototypalChain.push(obj);\r\n\t\tobj = obj ? Object.getPrototypeOf(obj) : null;\r\n\t}\r\n\treturn prototypalChain;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isObject from '../js/isObject.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _getAllPropertyNames from './getAllPropertyNames.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(objs, callback, deepProps = false, isReplace = false, withSymbols = false) {\r\n\tvar depth = 0;\r\n\tvar obj1 = objs.shift();\r\n\tif (_isNumeric(obj1) || obj1 === true || obj1 === false) {\r\n\t\tdepth = obj1;\r\n\t\tobj1 = objs.shift();\r\n\t}\r\n\tif (!objs.length) {\r\n\t\tthrow new Error('_merge() requires two or more array/objects.');\r\n\t}\r\n\tobjs.forEach((obj2, i) => {\r\n\t\tif (!_isTypeObject(obj2) && !_isFunction(obj2)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t(deepProps ? _getAllPropertyNames(obj2) : Object.getOwnPropertyNames(obj2)).forEach(key => {\r\n\t\t\tvar valAtObj1 = obj1[key];\r\n\t\t\tvar valAtObj2 = obj2[key];\r\n\t\t\tif (((_isArray(valAtObj1) && _isArray(valAtObj2)) || (_isObject(valAtObj1) && _isObject(valAtObj2))) \r\n\t\t\t&& (depth === true || depth > 0)) {\r\n\t\t\t\t// RECURSE...\r\n\t\t\t\tobj1[key] = _isArray(valAtObj1) && _isArray(valAtObj2) ? [] : {};\r\n\t\t\t\t_mergeCallback([_isNumeric(depth) ? depth - 1 : depth, obj1[key], valAtObj1, valAtObj2], callback, deepProps, isReplace);\r\n\t\t\t} else if (callback(key, obj1, obj2, i)) {\r\n\t\t\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\t\t\tif (isReplace) {\r\n\t\t\t\t\t\tobj1[key] = valAtObj2;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tobj1.push(valAtObj2);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (withSymbols) {\r\n\t\t\t\t\tObject.defineProperty(obj1, key, Object.getOwnPropertyDescriptor(obj2, key));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\t// In case we're setting a read-only property\r\n\t\t\t\t\t\tobj1[key] = obj2[key];\r\n\t\t\t\t\t} catch(e) {}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n\treturn obj1;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects first array/object;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(...objs) {\r\n\treturn _mergeCallback(objs, (k, obj1, obj2) => {\r\n\t\treturn true;\r\n\t});\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n * Copies only properties of an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tonly\r\n * @param array\t\t \texcept\r\n *\r\n * @return object\r\n */\r\nexport default function(obj, filter = []) {\r\n\treturn _mergeCallback([{}, obj], (key, obj1, obj2) => {\r\n\t\tif (!_isFunction(obj2[key])) {\r\n\t\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t\t}\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _first from '@onephrase/commons/arr/first.js';\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _merge from '@onephrase/commons/obj/merge.js';\r\nimport _even from '@onephrase/commons/obj/even.js';\r\nimport _copyPlain from '@onephrase/commons/obj/copyPlain.js';\r\n\r\n/**\r\n * --------------------------\r\n * TOKENIZER\r\n * --------------------------\r\n */\r\n\r\nconst Lexer = class {\r\n\r\n\t/**\r\n\t * Factory method.\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic lex(str, delims, options) {\r\n\t\tif (!_isString(str)) {\r\n\t\t\tthrow new Error('Argument1 must be a string!');\r\n\t\t}\r\n\t\t// CREATE NEW -----------------------------\r\n\t\tvar instance = new Lexer(str, options);\r\n\t\t// GIVE CACHE -----------------------------\r\n\t\tLexer.$cache[str] = Lexer.$cache[str] || [];\r\n\t\tLexer.$cache[str].push(instance);\r\n\t\t// RETURN NEW -----------------------------\r\n\t\treturn instance.lex(delims);\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method for .split().\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic split(str, delims, options) {\r\n\t\treturn Lexer.lex(str, delims, options).tokens;\r\n\t}\r\n\r\n\t/**\r\n\t * Factory method for .match().\r\n\t *\r\n\t * Handles caching.\r\n\t *\r\n\t * @see constructor()\r\n\t */\r\n\tstatic match(str, delims, options) {\r\n\t\treturn Lexer.lex(str, delims, options).matches;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a lexer instance on a string with the given options.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions:\r\n\t * @param string \t\tblocks\t\t\t\tThe strings that begin and end a nested structure\r\n\t * @param number \t\tlimit\t\t\t\tMax results to return\r\n\t * @param string \t\tbackreference\t\tA character like (\\) that prefixes non-delim characters\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tconstructor(str, options) {\r\n\t\tif (!_isString(str)) {\r\n\t\t\tthrow new Error('Lexer requires the first argument to be a string.');\r\n\t\t}\r\n\t\tthis.$str = str;\r\n\t\tthis.$options = options || {};\r\n\t\tif (!this.$options.blocks) {\r\n\t\t\tthis.$options.blocks = Lexer.$blocks;\r\n\t\t}\r\n\t\tif (!this.$options.quotes) {\r\n\t\t\tthis.$options.quotes = Lexer.$quotes;\r\n\t\t}\r\n\t\tif (!this.$options.comments) {\r\n\t\t\tthis.$options.comments = Lexer.$comments;\r\n\t\t}\r\n\t\tthis.$cache = [];\r\n\t}\r\n\r\n\t/**\r\n\t * Parses the instance string on the given delimeters.\r\n\t *\r\n\t * This method supports static calling,\r\n\t * in which case a string is required as the first argument.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tlex(delims, options) {\r\n\t\tvar runtime = {\r\n\t\t\tdelims: _arrFrom(delims),\r\n\t\t\toptions: _merge(true, {}, this.$options, options || {}),\r\n\t\t\tnesting: [],\r\n\t\t\tmaxDepth: 0,\r\n\t\t\tcomments: [],\r\n\t\t\ttokens: [],\r\n\t\t\tmatches: [],\r\n\t\t\tmatchesi: {},\r\n\t\t};\r\n\t\t// ASK INSTANCE CACHE ---------------------------\r\n\t\tif (runtime.options.cache !== false) {\r\n\t\t\tfor (var i = 0; i < this.$cache.length; i ++) {\r\n\t\t\t\tif (_even(this.$cache[i].delims, runtime.delims) && _even(this.$cache[i].options, runtime.options)) {\r\n\t\t\t\t\treturn _copyPlain(this.$cache[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// EVALUATE NEW --------------------------------\r\n\t\t// Iterate over each character, keep track of current row and column (of the returned array)\r\n\t\tthis._evalCharsAt(runtime, 0);\r\n\t\tif (runtime.nesting.length) {\r\n\t\t\tthrow new Error('Error parsing the string: ' + this.$str + '. Unterminated blocks: ' + _flatten(runtime.nesting).join(', ') + '');\r\n\t\t}\r\n\t\t// GIVE CACHE ----------------------------------\r\n\t\tif (runtime.options.cache !== false) {\r\n\t\t\tthis.$cache.push(runtime);\r\n\t\t}\r\n\t\t// RETURN NEW ----------------------------------\r\n\t\treturn runtime;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: evaluates and handles the character on the current cursor.\r\n\t * Advances the cursor.\r\n\t *\r\n\t * @param object \truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_evalCharsAt(runtime, i) {\r\n\t\tif (i >= this.$str.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar charWidth = 1;\r\n\t\tvar commentTest = {}, quoteTest = {}, nestingTest = {};\r\n\t\t// Quotes inside comments must be ignored\r\n\t\tif (!runtime.openComment) {\r\n\t\t\tquoteTest = this._testQuotes(runtime, i);\r\n\t\t}\r\n\t\t// Comments inside quotes must be ignored\r\n\t\tif (!runtime.openQuote) {\r\n\t\t\tcommentTest = this._testComments(runtime, i);\r\n\t\t}\r\n\t\t// Save comments\r\n\t\tif (runtime.openComment || commentTest.ending) {\r\n\t\t\t// Save only outer comments\r\n\t\t\tif (!runtime.nesting.length && !nestingTest.ending) {\r\n\t\t\t\tvar chars = commentTest.starting || commentTest.ending || this.$str[i];\r\n\t\t\t\tcharWidth = chars.length;\r\n\t\t\t\tthis._push(runtime, chars, 'comments');\r\n\t\t\t\tif (runtime.options.preserveComments) {\r\n\t\t\t\t\tthis._push(runtime, chars);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\t}\r\n\t\t} else if (runtime.openQuote || quoteTest.ending) {\r\n\t\t\t// Yes add quotes\r\n\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t} else if (runtime.options.limit && runtime.matches.length === runtime.options.limit) {\r\n\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\treturn this._evalCharsAt(runtime, i + 1);\r\n\t\t} else {\r\n\t\t\t// Nesting tags inside comments and quotes have been ignored\r\n\t\t\tnestingTest = this._testNesting(runtime, i);\r\n\t\t\t// ---------------------\r\n\t\t\t// STOP ON THIS CHARACTER...?\r\n\t\t\t// ---------------------\r\n\t\t\tvar nestingTest = this._testNesting(runtime, i);\r\n\t\t\t// STOP CHAR(S)? at top level?\r\n\t\t\tvar stopChar = this._testChars(runtime.options.stopChars || [], runtime, i);\r\n\t\t\tif (!runtime.nesting.length && stopChar !== false) {\r\n\t\t\t\truntime.options.stopChar = stopChar;\r\n\t\t\t\truntime.options.stopCharForward = this.$str.substr(i);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// ---------------------\r\n\t\t\t// Match and split now...\r\n\t\t\t// ---------------------\r\n\t\t\tif (!runtime.delims.length) {\r\n\t\t\t\t// BLOCK-BASED SPLITTING...\r\n\t\t\t\tif (runtime.nesting.length === 2 && nestingTest.starting) {\r\n\t\t\t\t\truntime.matches.push(null);\r\n\t\t\t\t\tthis._push(runtime, nestingTest.starting);\r\n\t\t\t\t\tcharWidth = nestingTest.starting.length;\r\n\t\t\t\t} else if (!runtime.nesting.length && nestingTest.ending) {\r\n\t\t\t\t\tthis._push(runtime, nestingTest.ending);\r\n\t\t\t\t\tcharWidth = nestingTest.ending.length;\r\n\t\t\t\t\truntime.matches.push(null);\r\n\t\t\t\t} else/*no-nesting flag*/ {\r\n\t\t\t\t\tthis._push(runtime, this.$str[i]);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\t// ---------------------\r\n\t\t\t\t// DELIMS-BASED SPLITTING\r\n\t\t\t\t// ---------------------\r\n\t\t\t\tif (!runtime.nesting.length && !nestingTest.ending) {\r\n\t\t\t\t\t// In case the chars at index 0 is a delim,\r\n\t\t\t\t\t// the resulting split should first have an empty string, instead of undefined\r\n\t\t\t\t\tthis._push(runtime, '');\r\n\t\t\t\t\tvar matchedDelim = this._testChars(runtime.delims, runtime, i);\r\n\t\t\t\t\tif (matchedDelim !== false) {\r\n\t\t\t\t\t\truntime.matches.push(matchedDelim);\r\n\t\t\t\t\t\truntime.matchesi[i] = matchedDelim;\r\n\t\t\t\t\t\tcharWidth = matchedDelim.length || 1;\r\n\t\t\t\t\t\tif (!runtime.options.preserveDelims) {\r\n\t\t\t\t\t\t\t// The current character is a delimiter...\r\n\t\t\t\t\t\t\t// and should not get to appending to the split series down the line\r\n\t\t\t\t\t\t\treturn this._evalCharsAt(runtime, i + (matchedDelim.length || 1));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis._push(runtime, matchedDelim || this.$str[i]);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar chars = nestingTest.starting || nestingTest.ending || this.$str[i];\r\n\t\t\t\t\tcharWidth = chars.length;\r\n\t\t\t\t\tthis._push(runtime, chars);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this._evalCharsAt(runtime, i + charWidth);\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a quote start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testQuotes(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.quotes || []).forEach(quote => {\r\n\t\t\tif (this.$str.substr(i, 1) === quote) {\r\n\t\t\t\tif (!runtime.openQuote) {\r\n\t\t\t\t\truntime.openQuote = quote;\r\n\t\t\t\t\tresult.starting = quote;\r\n\t\t\t\t} else if (quote === runtime.openQuote) {\r\n\t\t\t\t\truntime.openQuote = false;\r\n\t\t\t\t\tresult.ending = quote;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a comment start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testComments(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.comments || []).forEach(block => {\r\n\t\t\tif (!runtime.openComment) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + _first(block)));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\truntime.openComment = block;\r\n\t\t\t\t\tresult.starting = m[0];\r\n\t\t\t\t}\r\n\t\t\t} else if (_last(block) === _last(runtime.openComment)) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + _last(block)));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\truntime.openComment = false;\r\n\t\t\t\t\tresult.ending = m[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a nesting start/end character on the current cursor.\r\n\t *\r\n\t * @param object\truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return object\r\n\t */\r\n\t_testNesting(runtime, i) {\r\n\t\tvar result = {};\r\n\t\t(runtime.options.blocks || []).forEach(block => {\r\n\t\t\tvar starting = this.$str.substr(i).match(new RegExp('^' + _first(block)));\r\n\t\t\tif (starting) {\r\n\t\t\t\truntime.nesting = runtime.nesting.concat([block]);\r\n\t\t\t\tresult.starting = starting[0];\r\n\t\t\t} else if (runtime.nesting.length && _last(block) === _last(_last(runtime.nesting))) {\r\n\t\t\t\tvar ending = this.$str.substr(i).match(new RegExp('^' + _last(block)));\r\n\t\t\t\tif (ending) {\r\n\t\t\t\t\truntime.nesting = runtime.nesting.slice(0, -1);\r\n\t\t\t\t\tresult.ending = ending[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\truntime.maxDepth = Math.max(runtime.maxDepth, runtime.nesting.length);\r\n\t\treturn result;\r\n\t}\r\n\r\n\t/**\r\n\t * Expr helper: tests for a delimiter or stop character on the current cursor.\r\n\t *\r\n\t * @param array\t\ttestList\r\n\t * @param object \truntime\r\n\t * @param int\t\ti\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\t_testChars(testList, runtime, i) {\r\n\t\tfor (var k = 0; k < testList.length; k ++) {\r\n\t\t\tvar test = testList[k];\r\n\t\t\tif (runtime.options.useRegex) {\r\n\t\t\t\tvar m = this.$str.substr(i).match(new RegExp('^' + test, runtime.options.useRegex !== true ? runtime.options.useRegex : ''));\r\n\t\t\t\tif (m) {\r\n\t\t\t\t\treturn m[0];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ((!runtime.options.ci && this.$str.substr(i, test.length) === test)\r\n\t\t\t|| (runtime.options.ci && this.$str.substr(i, test.length).toLowerCase() === test.toLowerCase())) {\r\n\t\t\t\treturn test;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Expr helper: pushes a character or set of characters into the current split series.\r\n\t *\r\n\t * @param object \truntime\r\n\t * @param string\tchars\r\n\t * @param string\ttarget\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_push(runtime, chars, target = 'tokens') {\r\n\t\tvar splitSeries = runtime.matches.length;\r\n\t\tif (_isUndefined(runtime[target][splitSeries])) {\r\n\t\t\truntime[target][splitSeries] = '';\r\n\t\t}\r\n\t\truntime[target][splitSeries] += chars;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters and returns the tokens.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tsplit(str, delims, options) {\r\n\t\treturn this.lex(delims, options).tokens;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters and returns the matches.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions:\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tmatch(str, delims, options) {\r\n\t\treturn this.lex(delims, options).matches;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses the instance string on the given delimeters using regex.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tregParse(delims, options) {\r\n\t\treturn this.lex(delims, _merge({useRegex: true}, options || {}));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Splits the instance string on the given delimeters using regex; returns the tokens.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tregSplit(delims, options) {\r\n\t\treturn this.regParse(delims, options).tokens;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Matches the instance string on the given delimeters using regex; returns the matches.\r\n\t *\r\n\t * @param string \tstr\r\n\t * @param object\toptions\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tregMatch(delims, options) {\r\n\t\treturn this.regParse(delims, options).matches;\r\n\t}\r\n};\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$blocks = [['\\\\(', '\\\\)'], ['\\\\[', '\\\\]'], ['\\\\{', '\\\\}'],];\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$quotes = ['\"', \"'\", '`',];\r\n\r\n/**\r\n * @var array\r\n */\r\nLexer.$comments = [['\\\\/\\\\*', '\\\\*\\\\/'], ['\\\\/\\\\/', '(\\\\r)?\\\\n'],];\r\n\r\n/**\r\n * @var object\r\n */\r\nLexer.$cache = {};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Lexer;\r\n\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _all from '../arr/all.js';\r\nimport _isFunction from './isFunction.js';\r\nimport _isObject from './isObject.js';\r\n\r\n/**\r\n * Tells if a given object has observability methods.\r\n *\r\n * @param mixed\t\tinput\r\n *\r\n * @return bool\r\n */\r\nexport default function(input) {\r\n\treturn _isObject(input) && _all([\r\n\t\t'observe',\r\n\t\t'unobserve',\r\n\t\t'get',\r\n\t\t'set',\r\n\t\t'has',\r\n\t\t'del',\r\n\t], method => _isFunction(input[method]));\r\n};\r\n","\r\n/**\r\n * Tells if ALL items pass the test.\r\n *\r\n * @param array \tarr\r\n * @param function \tcallback\r\n *\r\n * @return bool\r\n */\r\nexport default function(arr, callback) {\r\n\treturn arr.reduce((prevTest, itm) => prevTest && callback(itm), true);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObservable from '../js/isObservable.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _isUndefined from '../js/isUndefined.js';\r\nimport _isNull from '../js/isNull.js';\r\nimport _arrFrom from '../arr/from.js';\r\n\r\n/**\r\n * Retrieves the value at the given path.\r\n *\r\n * A return value of undefined is ambiguous, and can mean either that the\r\n * path does not exist, or that the path actually exists but with a value of undefined. If it is required to\r\n * know whether the path actually exists, pass an object as a third argument.\r\n * This object will have an \"exists\" key set to true/false.\r\n *\r\n * @param object \t\t\t\tctxt\r\n * @param array \t\t\t\tpath\r\n * @param object \t\t\t\treciever\r\n * @param bool\t \t\t\t\tdetectObservables\r\n *\r\n * @return mixed\r\n */\r\nexport default function(ctxt, path, reciever = {}, detectObservables = true) {\r\n\tpath = _arrFrom(path).slice();\r\n\tvar _ctxt = ctxt;\r\n\twhile(!_isUndefined(_ctxt) && !_isNull(_ctxt) && path.length) {\r\n\t\tvar _key = path.shift();\r\n\t\tvar isObsvble = detectObservables && _isObservable(_ctxt);\r\n\t\tif (!(isObsvble ? _ctxt.get(_key) : (_isTypeObject(_ctxt) ? _key in _ctxt : _ctxt[_key]))) {\r\n\t\t\treciever.exists = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_ctxt = isObsvble ? _ctxt.get(_key) : _ctxt[_key];\r\n\t}\r\n\treciever.exists = true;\r\n\treturn _ctxt;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _get from '@onephrase/commons/obj/get.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\n\r\n/**\r\n * @exports\r\n */\r\nclass Contexts extends Array {\r\n\t\r\n\t/**\r\n\t * Returns the first found \"undefined\" value of a reference from \r\n\t * from contexts.\r\n\t *\r\n\t * @param string|number varName\r\n\t * @param bool\t\t\tbindThis\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(varName, bindThis = true) {\r\n\t\tfor(var i = 0; i < this.length; i ++) {\r\n\t\t\tvar val = _get(this[i], varName);\r\n\t\t\tif (_isFunction(val) && bindThis) {\r\n\t\t\t\treturn val.bind(this[i]);\r\n\t\t\t}\r\n\t\t\tif (!_isUndefined(val)) {\r\n\t\t\t\treturn val;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Factory method for making a Contexts instance.\r\n\t *\r\n\t * @param array|object \tcntxt\r\n\t *\r\n\t * @return Contexts\r\n\t */\r\n\tstatic create(cntxt) {\r\n\t\treturn cntxt instanceof Contexts ? cntxt \r\n\t\t\t: (cntxt ? new Contexts(cntxt) : new Contexts());\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Contexts;","\r\n/**\r\n * Tells if the string is warapped with the given opening and closing tags.\r\n *\r\n * @param  string  subject\r\n * @param  string  openingTag\r\n * @param  string  closingTag\r\n *\r\n * @return bool\r\n */\r\nexport default function(subject, openingTag, closingTag) {\r\n\treturn subject.startsWith(openingTag) && subject.endsWith(closingTag);\r\n};\r\n","\r\n/**\r\n * Return the remainder of a string after a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n * @param  bool\t   afterLast\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search, afterLast = false) {\r\n\tif (search == '') {\r\n\t\treturn subject;\r\n\t}\r\n\tvar pos = afterLast ? subject.lastIndexOf(search) : subject.indexOf(search);\r\n\tif (pos === -1) {\r\n\t\treturn '';\r\n\t}\r\n\treturn subject.substr(pos + search.length);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _before from './before.js';\r\n\r\n/**\r\n * Return the part of a string before last occurence of a given value.\r\n *\r\n * @param  string  subject\r\n * @param  string  search\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, search) {\r\n\treturn _before(subject, search, true);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _after from './after.js';\r\nimport _beforeLast from './beforeLast.js';\r\n\r\n/**\r\n * Returns the string without the given opening and closing tags.\r\n *\r\n * @param  string  subject\r\n * @param  string  openingTag\r\n * @param  string  closingTag\r\n *\r\n * @return string\r\n */\r\nexport default function(subject, openingTag, closingTag) {\r\n\treturn _beforeLast(_after(subject, openingTag), closingTag);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AbstractionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Abstraction'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport AbstractionInterface from './AbstractionInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Abstraction class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Abstraction = class extends AbstractionInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.expr.eval(context, callback);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '(' + this.expr.toString(context) + ')';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Abstraction) {\r\n\t\tif (_wrapped(expr, '(', ')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(_unwrap(expr, '(', ')'))\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Abstraction;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ArrInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ArrayType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport ArrInterface from './ArrInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Array utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Arr = class extends ArrInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(exprs) {\r\n\t\tsuper();\r\n\t\tthis.exprs = exprs || [];\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof ArrInterface) {\r\n\t\t\tvar newExprs = Super.exprs.filter(exprA => {\r\n\t\t\t\treturn this.exprs.reduce((uniqueSoFar, exprB) => uniqueSoFar && !exprA.even(exprB), true);\r\n\t\t\t});\r\n\t\t\tthis.exprs = newExprs.concat(this.exprs);\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.exprs.map(expr => expr.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '[' + this.exprs.map(expr => expr.toString(context)).join(', ') + ']';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Arr) {\r\n\t\tif (_wrapped(expr, '[', ']') && !Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar splits = Lexer.split(_unwrap(expr, '[', ']'), [','])\r\n\t\t\t\t.map(n => n.trim()).filter(n => n).map(expr => parseCallback(expr));\r\n\t\t\treturn new Static(splits);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @export\r\n */\r\nexport default Arr;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ArgumentsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Arguments'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport ArgumentsInterface from './ArgumentsInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Arguments class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Arguments = class extends ArgumentsInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(list = []) {\r\n\t\tsuper();\r\n\t\tthis.list = list;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.list.map(arg => arg.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '(' + this.list.map(arg => arg.toString(context)).join(', ') + ')';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Arguments) {\r\n\t\tvar args; expr = expr.trim();\r\n\t\tif (_wrapped(expr, '(', ')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tLexer.split(_unwrap(expr, '(', ')'), [',']).map(arg => parseCallback(arg.trim()))\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Arguments;\r\n","\r\n/**\r\n * Returns a list of unique items.\r\n *\r\n * @param array\t \t\t\t\tarr\r\n *\t *\r\n * @return array\r\n */\r\nexport default function(arr) {\r\n\tconst distinct = (value, index, self) => {\r\n\t\treturn self.indexOf(value) === index;\r\n\t};\r\n\treturn arr.filter(distinct);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * AssertionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'AssertionExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _first from '@onephrase/commons/arr/first.js';\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _unique from '@onephrase/commons/arr/unique.js';\r\nimport AssertionInterface from './AssertionInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Assertion class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Assertion = class extends AssertionInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(exprs, logic) {\r\n\t\tsuper();\r\n\t\tthis.exprs = exprs;\r\n\t\tthis.logic = logic;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\t eval(context = null, callback = null) {\r\n\t\tif (this.logic === '!') {\r\n\t\t\treturn !_first(this.exprs).eval(context, callback);\r\n\t\t}\r\n\t\tvar operators = _flatten(Assertion.operators);\r\n\t\tvar logic = (this.logic || '').trim().toUpperCase();\r\n\t\tvar isOr = logic === (Assertion.operators.or || '').trim().toUpperCase();\r\n\t\tvar isNor = logic === (Assertion.operators.nor || '').trim().toUpperCase();\r\n\t\tvar isAnd = logic === (Assertion.operators.and || '').trim().toUpperCase();\r\n\t\tvar isNand = logic === (Assertion.operators.nand || '').trim().toUpperCase();\r\n\t\tvar lastResult = true, trues = 0;\r\n\t\tfor(var i = 0; i < this.exprs.length; i ++) {\r\n\t\t\tif (isAnd && !lastResult) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (isNand && !lastResult) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t\tlastResult = this.exprs[i].eval(context, callback);\r\n\t\t\tif (isOr && lastResult) {\r\n\t\t\t\treturn lastResult;\r\n\t\t\t}\r\n\t\t\ttrues += lastResult ? 1 : 0;\r\n\t\t}\r\n\t\tif (isOr) {\r\n\t\t\t// Which is falsey,\r\n\t\t\t// by virtue of getting here\r\n\t\t\treturn lastResult;\r\n\t\t}\r\n\t\tif (isAnd || isNand) {\r\n\t\t\t// For AND and NAND, all entries must be true,\r\n\t\t\t// by virtue of getting here.\r\n\t\t\t// For AND, this means true; for NAND, false\r\n\t\t\treturn isAnd;\r\n\t\t}\r\n\t\t// For NOR, all entries need to be false\r\n\t\treturn isNor && trues === 0;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\t toString(context = null) {\r\n\t\tif (this.logic === '!') {\r\n\t\t\treturn '!' + _first(this.exprs).toString(context);\r\n\t\t}\r\n\t\treturn this.exprs.map(expr => expr.toString(context)).join(' ' + this.logic + ' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Assertion) {\r\n\t\tif (expr.startsWith('!')) {\r\n\t\t\treturn new Static(\r\n\t\t\t\t[parseCallback(expr.substr(1))],\r\n\t\t\t\t'!'\r\n\t\t\t);\r\n\t\t}\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\tvar logic = _unique(parse.matches);\r\n\t\t\tif (logic.length > 1) {\r\n\t\t\t\tthrow new Error('\"AND\" and \"OR\" logic cannot be asserted in the same expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparse.tokens.map(expr => parseCallback(expr.trim())),\r\n\t\t\t\t_first(logic)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nAssertion.operators = {\r\n\tand: '&&',\r\n\tor: '||',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Assertion;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport AssignmentInterface from './AssignmentInterface.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Assignment class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Assignment = class extends AssignmentInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, val, operator = '=') {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.val = val;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tvar val = this.val.eval(context, callback);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name, val);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar cntxt = reference.context instanceof Contexts \r\n\t\t\t\t? _last(reference.context) \r\n\t\t\t\t: reference.context;\r\n\t\t\t// -----------------------------\r\n\t\t\tcntxt[reference.name] = val;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.reference.toString(context), this.operator, this.val.toString(context)].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Assignment) {\r\n\t\tvar parse = Lexer.lex(expr, Static.operators);\r\n\t\tif (parse.tokens.length === 2) {\r\n\t\t\tvar reference, val;\r\n\t\t\tif (!((reference = parseCallback(parse.tokens.shift().trim())) instanceof ReferenceInterface) \r\n\t\t\t|| !(val = parseCallback(parse.tokens.shift().trim()))) {\r\n\t\t\t\tthrow new Error('Invalid assignment directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, val, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nAssignment.operators = [' = '];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Assignment;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * BoolInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'BooleanType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport BoolInterface from './BoolInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Bool (boolean) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Bool = class extends BoolInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(state) {\r\n\t\tsuper();\r\n\t\tthis.state = state;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn this.state.toLowerCase().trim() === 'true';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString() {\r\n\t\treturn this.state;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Bool) {\r\n\t\tvar expr = expr.toLowerCase().trim();\r\n\t\tif (expr === 'true' || expr === 'false') {\r\n\t\t\treturn new Static(expr);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Bool;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport CallInterface from './CallInterface.js';\r\nimport Arguments from './Arguments.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Call = class extends CallInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, args) {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.args = args;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tvar args = this.args.eval(context, callback);\r\n\t\tif (!_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name, args);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar _contexts = Contexts.create(reference.context).slice();\r\n\t\t\tvar func = _contexts.get(reference.name, true/*bindThis*/);\r\n\t\t\tif (_isFunction(func)) {\r\n\t\t\t\treturn func(...args);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar handler, _cntxts = _contexts.slice();\r\n\t\t\twhile(_cntxts.length && !handler) {\r\n\t\t\t\tvar cntxt = _cntxts.shift();\r\n\t\t\t\tvar utils = Call.utils || {};\r\n\t\t\t\tvar handler = _isNumeric(cntxt) && utils.Num ? utils.Num\r\n\t\t\t\t\t: (_isString(cntxt) && utils.Str ? utils.Str\r\n\t\t\t\t\t\t: (_isArray(cntxt) && utils.Arr ? utils.Arr\r\n\t\t\t\t\t\t\t: (_isObject(cntxt) && utils.Obj ? utils.Obj : null)));\r\n\t\t\t\tif (handler && _isFunction(handler[reference.name])) {\r\n\t\t\t\t\targs.unshift(cntxt);\r\n\t\t\t\t\treturn handler[reference.name](...args);\r\n\t\t\t\t}\r\n\t\t\t\tthrow new Error('\"' + this + '\" is not a function. (Called on ' + _contexts.map(c => typeof c).join(', ') + ')');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.reference.toString(context) + this.args.toString(context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Call) {\r\n\t\tif (!expr.startsWith('(') && expr.endsWith(')') && !Lexer.match(expr, [' ']).length) {\r\n\t\t\tvar tokens = Lexer.split(expr, []);\r\n\t\t\tvar reference, args = tokens.pop();\r\n\t\t\tif (!((reference = parseCallback(tokens.join(''))) instanceof ReferenceInterface) \r\n\t\t\t|| !(args = parseCallback(args, [Arguments]))) {\r\n\t\t\t\tthrow new Error('Invalid call directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, args);\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Call;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * CommentsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Comments'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _after from '@onephrase/commons/str/after.js';\r\nimport _before from '@onephrase/commons/str/before.js';\r\nimport CommentsInterface from './CommentsInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Comments class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Comments = class extends CommentsInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(comments, type) {\r\n\t\tsuper();\r\n\t\tthis.comments = comments;\r\n\t\tthis.type = type;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn '';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Comments) {\r\n\t\tvar _comments = null;\r\n\t\tvar _expr = null;\r\n\t\tvar type = 0;\r\n\t\tvar commentPlacement = 'before';\r\n\t\t// Oneliner comments\r\n\t\tif (expr.startsWith('//')) {\r\n\t\t\tvar splits = Lexer.split(_after(expr, '//'), [\"\\r\\n\"]);\r\n\t\t\t_comments = splits.shift().trim();\r\n\t\t\t_expr = splits.shift().trim();\r\n\t\t\ttype = 1;\r\n\t\t} else if (expr.startsWith('/*')) {\r\n\t\t\tvar splits = Lexer.split(_after(expr, '/*'), [\"*/\"]);\r\n\t\t\t_comments = splits.shift().trim();\r\n\t\t\t_expr = splits.shift().trim();\r\n\t\t\ttype = 2;\r\n\t\t} else if (expr.endsWith('*/')) {\r\n\t\t\tvar splits = Lexer.split(_beforeLast(expr, '*/'), [\"/*\"]);\r\n\t\t\t_comments = splits.pop().trim();\r\n\t\t\t_expr = splits.pop().trim();\r\n\t\t\ttype = 2;\r\n\t\t\tvar commentPlacement = 'after';\r\n\t\t}\r\n\t\tif (type) {\r\n\t\t\tif (type === 2) {\r\n\t\t\t\t_comments = Lexer.split(_comments.trim(), [\"\\r\\n\"])\r\n\t\t\t\t\t.map(line => line.replace(/^[\\*]+/, ''))\r\n\t\t\t\t\t.filter(line => line.trim());\r\n\t\t\t}\r\n\t\t\tconsole.log(_comments, commentPlacement, expr);\r\n\t\t\t_comments = new Static(_comments, type);\r\n\t\t}\r\n\t\tif (_expr) {\r\n\t\t\t_expr = parseCallback(_expr);\r\n\t\t\t_expr.meta.commenta = _comments;\r\n\t\t\treturn _expr;\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Comments;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\n\r\n/**\r\n * Returns the difference of two arrays;\r\n * optionally using a custom matching function.\r\n *\r\n * @param array \tarr\r\n * @param array\t \tarr2\r\n * @param function \tcallback\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, arr2, callback = null) {\r\n\treturn !_isArray(arr2) ? [] : arr.filter(val1 => callback \r\n\t\t? arr2.filter(val2 => callback(val1, val2)).length \r\n\t\t: arr2.indexOf(val1) === -1\r\n\t);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ComparisonInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ComparisonExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _first from '@onephrase/commons/arr/first.js';\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _difference from '@onephrase/commons/arr/difference.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport ComparisonInterface from './ComparisonInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Comparison class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Comparison = class extends ComparisonInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(operand1, operand2, operator) {\r\n\t\tsuper();\r\n\t\tthis.operand1 = operand1;\r\n\t\tthis.operand2 = operand2;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn Comparison.compare(\r\n\t\t\tthis.operand1.eval(context, callback), \r\n\t\t\tthis.operand2.eval(context, callback), \r\n\t\t\tthis.operator\r\n\t\t);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [\r\n\t\t\tthis.operand1.toString(context), \r\n\t\t\tthis.operator, \r\n\t\t\tthis.operand2.toString(context)\r\n\t\t].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Comparison) {\r\n\t\tvar operators = _flatten(Static.operators).map(oper => ' ' + oper + ' ');\r\n\t\tvar parse = Lexer.lex(expr, operators);\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\tif (parse.tokens.length > 2) {\r\n\t\t\t\tthrow new Error('Malformed \"Comparison\" expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(_first(parse.tokens).trim()),\r\n\t\t\t\tparseCallback(_last(parse.tokens).trim()),\r\n\t\t\t\tparse.matches[0].trim()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------------------------------------------\r\n\t */\r\n\t \r\n\t/**\r\n\t * Use the operator type to compare the two operands\r\n\t *\r\n\t * @param mixed\t\toperand1\t\t\r\n\t * @param mixed\t\toperand2\t\t\r\n\t * @param string \toperator\t\t\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstatic compare(operand1, operand2, operator = '==') {\r\n\t\tif (_flatten(Comparison.operators).indexOf(operator) === -1) {\r\n\t\t\tthrow new Error('The operator \"' + operator + '\" is not recognized.');\r\n\t\t}\r\n\t\tif (_isArray(operand1) && _isArray(operand2) && operator !== '===') {\r\n\t\t\tif (operand1.length !== operand2.length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar allItemsMatch = true;\r\n\t\t\toperand1.sort();\r\n\t\t\toperand2.sort();\r\n\t\t\tfor (var i = 0; i < operand1.length; i ++) {\r\n\t\t\t\tallItemsMatch = allItemsMatch && Comparison.compare(operand1[i], operand2[i], operator);\r\n\t\t\t}\r\n\t\t\treturn allItemsMatch;\r\n\t\t} else if (_isObject(operand1) && _isObject(operand2) && operator !== '===') {\r\n\t\t\tvar entry1Keys = Object.keys(operand1);\r\n\t\t\tvar entry2Keys = Object.keys(operand2);\r\n\t\t\tif (entry1Keys.length !== entry2Keys.length || _difference(entry1Keys, entry2Keys).length) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar allEntriesMatch = true;\r\n\t\t\t_each(entry1Keys, (i, key) => {\r\n\t\t\t\tallEntriesMatch = allEntriesMatch && Comparison.compare(operand1[key], operand2[key], operator);\r\n\t\t\t});\r\n\t\t\treturn allEntriesMatch;\r\n\t\t}\r\n\t\tswitch(operator) {\r\n\t\t\tcase '===':\r\n\t\t\t\treturn operand1 === operand2;\r\n\t\t\tcase '==':\r\n\t\t\tcase '=':\r\n\t\t\t\treturn operand1 == operand2;\r\n\t\t\tcase '>':\r\n\t\t\t\treturn operand1 > operand2;\r\n\t\t\tcase '<':\r\n\t\t\t\treturn operand1 < operand2;\r\n\t\t\tcase '>=':\r\n\t\t\t\treturn operand1 >= operand2;\r\n\t\t\tcase '<=':\r\n\t\t\t\treturn operand1 <= operand2;\r\n\t\t\tcase '!=':\r\n\t\t\t\treturn operand1 != operand2;\r\n\t\t\tcase '!==':\r\n\t\t\t\treturn operand1 !== operand2;\r\n\t\t\tcase '^=':\r\n\t\t\t\treturn _isString(operand1) && operand1.startsWith(operand2);\r\n\t\t\tcase '$=':\r\n\t\t\t\treturn _isString(operand1) && operand1.endsWith(operand2);\r\n\t\t\tcase '*=':\r\n\t\t\t\t// Contains\r\n\t\t\t\treturn _isArray(operand2) || _isString(operand2) ? operand1.indexOf(operand2) > -1 : false;\r\n\t\t\tcase '~=':\r\n\t\t\t\t// Contains word\r\n\t\t\t\treturn _isString(operand1) && _isString(operand2) && (' ' + operand1 + ' ').indexOf(' ' + operand2 + ' ') > -1;\r\n\t\t\tcase '>=<': // Between\r\n\t\t\t\t if (!(_isArray(operand2) && operand2.length === 2)) {\r\n\t\t\t\t\t throw new Error('A \\'Between\\' comparison requires argument 2 to be an array of exactly 2 values.');\r\n\t\t\t\t }\r\n\t\t\t\t return operand1 >= operand2[0] && operand1 <= operand2[1];\r\n\t\r\n\t\t\tcase '/**/': // Regex\r\n\t\t\t\treturn operand2.match(new RegExp(operand1));\r\n\t\t\tdefault:\r\n\t\t\t\treturn false;\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * Compares two operands for differences\r\n\t *\r\n\t * @param mixed\t\toperand1\t\t\r\n\t * @param mixed\t\toperand2\t\t\r\n\t * @param bool\t \tstrict\t\t\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstatic diff(operand1, operand2, strict) {\r\n\t\treturn !Comparison.compare(operand1, operand2, strict ? '===' : '==');\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nComparison.operators = {\r\n\texact: {\r\n\t\tis: '===',\r\n\t\tisNull: '===',\r\n\t\tequalsTo: '==',\r\n\t\tnotEqualsTo: '!=',\r\n\t},\r\n\trelative: {\r\n\t\tlesserThan: '<',\r\n\t\tgreaterThan: '>',\r\n\t\tlesserThanOrEqualsTo: '<=',\r\n\t\tgreaterThanOrEqualsTo: '>=',\r\n\t\tbetween: '>=<',\r\n\t},\r\n\tpartial: {\r\n\t\tstartsWith: '^=',\r\n\t\tendsWith: '$=',\r\n\t\tcontains: '*=',\r\n\t\tany: '~=',\r\n\t\tin: '~=',\r\n\t\tmatches: '/**/',\r\n\t},\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Comparison;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ConditionInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ConditionExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport ConditionInterface from './ConditionInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Condition class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Condition = class extends ConditionInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(assertion, onTrue, onFalse) {\r\n\t\tsuper();\r\n\t\tthis.assertion = assertion;\r\n\t\tthis.onTrue = onTrue;\r\n\t\tthis.onFalse = onFalse;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.assertion.eval(context, callback) \r\n\t\t\t? this.onTrue.eval(context, callback) \r\n\t\t\t: this.onFalse.eval(context, callback);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [\r\n\t\t\tthis.assertion.toString(context), \r\n\t\t\tCondition.operators[0], \r\n\t\t\tthis.onTrue.toString(context),\r\n\t\t\tCondition.operators[1], \r\n\t\t\tthis.onFalse.toString(context)\r\n\t\t].join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Condition) {\r\n\t\tvar splits = Lexer.split(expr, Static.operators);\r\n\t\tif (splits.length > 1) {\r\n\t\t\tif (splits.length === 2) {\r\n\t\t\t\tthrow new Error('Malformed ternary expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(splits[0].trim()),\r\n\t\t\t\tparseCallback(splits[1].trim()),\r\n\t\t\t\tparseCallback(splits[2].trim())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nCondition.operators = ['?', ':'];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Condition;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport DeletionInterface from './DeletionInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Deletion class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Deletion = class extends DeletionInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(reference, operator = 'delete') {\r\n\t\tsuper();\r\n\t\tthis.reference = reference;\r\n\t\tthis.operator = operator;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar reference = this.reference.getEval(context, callback);\r\n\t\tif (!_isUndefined(reference.context) && !_isUndefined(reference.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, reference.context, reference.name);\r\n\t\t\t}\r\n\t\t\t// -----------------------------\r\n\t\t\tvar cntxt = reference.context instanceof Contexts \r\n\t\t\t\t? _last(reference.context) \r\n\t\t\t\t: reference.context;\r\n\t\t\t// -----------------------------\r\n\t\t\tdelete cntxt[reference.name];\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.operator + ' ' + this.reference.toString(context);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Deletion) {\r\n\t\tvar parse = Lexer.lex(expr, Object.values(Static.operators));\r\n\t\tif (parse.matches.length === 1 && expr.startsWith(parse.matches[0] + ' ')) {\r\n\t\t\tvar reference;\r\n\t\t\tif (!((reference = parseCallback(parse.tokens.pop().trim())) instanceof ReferenceInterface)) {\r\n\t\t\t\tthrow new Error('Invalid delete directive: ' + expr);\r\n\t\t\t}\r\n\t\t\treturn new Static(reference, parse.matches[0].trim());\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @prop array\r\n */\r\nDeletion.operators = {\r\n\tred: 'reduce', \r\n\tdel: 'delete',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Deletion;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _isFunction from '../js/isFunction.js';\r\nimport _isNumeric from '../js/isNumeric.js';\r\nimport _isTypeObject from '../js/isTypeObject.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n * Copies an object.\r\n *\r\n * @param object\t \tobj\r\n * @param array\t\t \tfilter\r\n *\r\n * @return object\r\n */\r\nexport default function(obj, filter = []) {\r\n\tvar depth = 0;\r\n\tif (_isNumeric(arguments[0]) && _isTypeObject(arguments[1])) {\r\n\t\tdepth = arguments[0];\r\n\t\tobj = arguments[1];\r\n\t\tfilter = arguments[2] || [];\r\n\t}\r\n\treturn _mergeCallback([depth, {}, obj], (key, obj1, obj2) => {\r\n\t\treturn _isFunction(filter) ? filter(key) \r\n\t\t\t: (_isArray(filter) && filter.length ? filter.indexOf(key) > -1 : true);\r\n\t}, false/*deepProps*/, false/*isReplace*/, false/*withSymbols*/);\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * FuncInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'FunctionType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport FuncInterface from './FuncInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Func class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Func = class extends FuncInterface {\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(paramters, statements, arrowFunctionFormatting = {}) {\r\n\t\tsuper();\r\n\t\tthis.paramters = paramters || {};\r\n\t\tthis.statements = statements;\r\n\t\tthis.arrowFunctionFormatting = arrowFunctionFormatting;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof FuncInterface) {\r\n\t\t\tvar parentParams = Object.keys(Super.paramters);\r\n\t\t\tvar ownParams = Object.keys(this.paramters);\r\n\t\t\tfor (var i = 0; i < Math.max(ownParams.length, parentParams.length); i ++) {\r\n\t\t\t\tvar nameInParent = parentParams[i];\r\n\t\t\t\tvar nameInSelf = ownParams[i];\r\n\t\t\t\tif (!nameInSelf && nameInParent) {\r\n\t\t\t\t\tthrow new Error('Parameter #' + i + ' (' + nameInParent + ') in parent function must be implemented.');\r\n\t\t\t\t}\r\n\t\t\t\tif (nameInSelf && nameInParent) {\r\n\t\t\t\t\tvar defaultValInParent = Super.paramters[nameInParent];\r\n\t\t\t\t\tvar defaultValInSelf = this.paramters[nameInSelf];\r\n\t\t\t\t\tif (defaultValInSelf && !defaultValInParent) {\r\n\t\t\t\t\t\tthrow new Error('Parameter #' + i + ' (' + nameInSelf + ') must not have a default value as established in parent function.');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (defaultValInSelf && defaultValInParent && defaultValInSelf.jsenType !== defaultValInParent.jsenType) {\r\n\t\t\t\t\t\tthrow new Error('Default value for parameter #' + i + ' (' + nameInSelf + ') must be of type ' + defaultValInParent.jsenType + ' as established in parent function.');\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.sup = Super;\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn (...args) => {\r\n\t\t\tvar localContext = {};\r\n\t\t\t_each(Object.keys(this.paramters), (i, name) => {\r\n\t\t\t\tvar defaultVal = this.paramters[name];\r\n\t\t\t\tif (args.length - 1 < i && !defaultVal) {\r\n\t\t\t\t\tthrow new Error('The parameter \"' + name + '\" is required.');\r\n\t\t\t\t}\r\n\t\t\t\tlocalContext[name] = args.length > i \r\n\t\t\t\t\t? args[i] \r\n\t\t\t\t\t: (this.paramters[name] \r\n\t\t\t\t\t\t? this.paramters[name].eval(context, callback) \r\n\t\t\t\t\t\t: null);\r\n\t\t\t});\r\n\t\t\t// But this newer context should come first\r\n\t\t\tvar multipleContexts = Contexts.create(localContext).concat(Contexts.create(context));\r\n\t\t\treturn this.statements.eval(multipleContexts, callback);\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar paramters = [];\r\n\t\t_each(this.paramters, (name, value) => {\r\n\t\t\tparamters.push(name + (value ? '=' + value.toString(context) : ''));\r\n\t\t});\r\n\t\tif (this.arrowFunctionFormatting) {\r\n\t\t\tvar headNoWrap = this.arrowFunctionFormatting.head === false || (paramters.length === 1 && paramters[0].indexOf('=') === -1);\r\n\t\t\tvar bodyNoWrap = this.arrowFunctionFormatting.body === false\r\n\t\t\treturn (headNoWrap ? paramters[0] : '(' + paramters.join(', ') + ')')\r\n\t\t\t+ ' => ' + (bodyNoWrap ? this.statements.toString(context) : '{' + this.statements.toString(context) + '}');\r\n\t\t}\r\n\t\treturn 'function (' + paramters.join(', ') + ') {' + this.statements.toString(context) + '}';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Func) {\r\n\t\texpr = expr.trim();\r\n\t\tvar splits;\r\n\t\tif (expr.startsWith('function') \r\n\t\t&& (splits = Lexer.split(expr, []).slice(1).filter(b => b.trim())) && splits.length === 2) {\r\n\t\t\tvar arrowFunctionFormatting = false;\r\n\t\t\tvar funcHead = _unwrap(splits.shift().trim(), '(', ')');\r\n\t\t\tvar funcBody = _unwrap(splits.shift().trim(), '{', '}');\r\n\t\t} else if (!expr.startsWith('function') \r\n\t\t&& (splits = Lexer.split(expr, ['=>'])) && splits.length === 2) {\r\n\t\t\tvar funcHead = splits.shift().trim();\r\n\t\t\tvar funcBody = splits.shift().trim();\r\n\t\t\tvar arrowFunctionFormatting = {};\r\n\t\t\tif (_wrapped(funcHead, '(', ')')) {\r\n\t\t\t\tfuncHead = _unwrap(funcHead, '(', ')');\r\n\t\t\t} else {\r\n\t\t\t\tarrowFunctionFormatting.head = false;\r\n\t\t\t}\r\n\t\t\tif (_wrapped(funcBody, '{', '}')) {\r\n\t\t\t\tfuncBody = _unwrap(funcBody, '{', '}');\r\n\t\t\t} else {\r\n\t\t\t\tarrowFunctionFormatting.body = false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar paramters = {};\r\n\t\tLexer.split(funcHead, [',']).forEach(param => {\r\n\t\t\tvar paramSplit = param.split('=');\r\n\t\t\tif (paramSplit[1]) {\r\n\t\t\t\tparamters[paramSplit[0].trim()] = parseCallback(paramSplit[1].trim());\r\n\t\t\t} else {\r\n\t\t\t\tparamters[param.trim()] = null;\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar statements = parseCallback(funcBody);\r\n\t\treturn new Static(paramters, statements, arrowFunctionFormatting);\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nFunc.operators = ['=>',];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Func;","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * MathInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'MathExpression'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport _intersect from '@onephrase/commons/arr/intersect.js';\r\nimport _unique from '@onephrase/commons/arr/unique.js';\r\nimport MathInterface from './MathInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Math class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Math = class extends MathInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(val, exprs) {\r\n\t\tsuper();\r\n\t\tthis.val = val;\r\n\t\tthis.exprs = exprs;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.exprs.reduce((currentTotal, expr) => {\r\n\t\t\tvar val = expr.val.eval(context, callback);\r\n\t\t\tvar operator = expr.operator.trim();\r\n\t\t\tif ((!_isNumeric(currentTotal) || !_isNumeric(val)) && operator !== '+') {\r\n\t\t\t\tthrow new Error('Invalid Math expression: ' + this.toString() + '!');\r\n\t\t\t}\r\n\t\t\tswitch(operator) {\r\n\t\t\t\tcase '+':\r\n\t\t\t\t\treturn currentTotal + val;\r\n\t\t\t\tcase '-':\r\n\t\t\t\t\treturn currentTotal - val;\r\n\t\t\t\tcase '*':\r\n\t\t\t\t\treturn currentTotal * val;\r\n\t\t\t\tcase '/':\r\n\t\t\t\t\treturn currentTotal / val;\r\n\t\t\t}\r\n\t\t}, this.val.eval(context, callback));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn [this.val.toString(context)].concat(\r\n\t\t\tthis.exprs.map(expr => expr.operator + ' ' + expr.val.toString(context))\r\n\t\t).join(' ');\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Math) {\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1 && parse.matches.length === parse.tokens.length - 1) {\r\n\t\t\tvar operators = _unique(parse.matches);\r\n\t\t\tif (_intersect(operators, Math.operators.sup).length && _intersect(operators, Math.operators.sub).length) {\r\n\t\t\t\tthrow new Error('\"Addition/subtraction\" and \"multiplication/division\" operators cannot be used in the same expression: ' + expr + '!');\r\n\t\t\t}\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(parse.tokens.shift().trim()),\r\n\t\t\t\tparse.tokens.map((expr, i) => {return {\r\n\t\t\t\t\toperator: parse.matches[i],\r\n\t\t\t\t\tval: parseCallback(expr.trim())\r\n\t\t\t\t};})\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nMath.operators = {\r\n\tsup: ['*', '/'],\r\n\tsub: [' + ', ' - '],\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Math;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * NumInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'NumberType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport NumInterface from './NumInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Num (number) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Num = class extends NumInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(int, dec = 0) {\r\n\t\tsuper();\r\n\t\tthis.int = int;\r\n\t\tthis.dec = dec;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn parseFloat(this.int + (this.dec ? '.' + this.dec : null));\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.int + (this.dec ? '.' + this.dec : null);\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Num) {\r\n\t\tif (_isNumeric(expr)) {\r\n\t\t\tvar expr = expr.split('.');\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseInt(expr.shift()),\r\n\t\t\t\tparseInt(expr.shift())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Num;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ObjInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ObjectType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport _first from '@onephrase/commons/arr/first.js';\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport ObjInterface from './ObjInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Object utils\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Obj = class extends ObjInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(entries) {\r\n\t\tsuper();\r\n\t\tthis.entries = entries || {};\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tinherit(Super) {\r\n\t\tif (Super instanceof ObjInterface) {\r\n\t\t\t_each(Super.entries, (name, val) => {\r\n\t\t\t\tif (!(name in this.entries)) {\r\n\t\t\t\t\tthis.entries[name] = val;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar items = {};\r\n\t\t_each(this.entries, (key, expr) => {\r\n\t\t\titems[key] = expr.eval(context, callback);\r\n\t\t});\r\n\t\treturn items;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar str = [];\r\n\t\t_each(this.entries, (key, expr) => {\r\n\t\t\tstr.push(key + Obj.operators.sub + expr.toString(context));\r\n\t\t});\r\n\t\treturn '{' + str.join(Obj.operators.sup) + '}';\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Obj) {\r\n\t\tif (_wrapped(expr, '{', '}') && !Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar entries = {};\r\n\t\t\tvar _entriesSplit = Lexer.split(_unwrap(expr, '{', '}'), [Obj.operators.sup])\r\n\t\t\t\t.map(n => n.trim()).filter(n => n);\r\n\t\t\t_each(_entriesSplit, (key, expr) => {\r\n\t\t\t\tvar entry = Lexer.split(expr, [Obj.operators.sub], {limit:1}/*IMPORTANT*/);\r\n\t\t\t\tentries[_first(entry).trim()] = parseCallback(_last(entry).trim());\r\n\t\t\t});\r\n\t\t\treturn new Static(entries);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop object\r\n */\r\nObj.operators = {\r\n\tsup: ',',\r\n\tsub: ':',\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Obj;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport ReferenceInterface from './ReferenceInterface.js';\r\nimport ExprInterface from '../ExprInterface.js';\r\nimport Contexts from '../Contexts.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Reference class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Reference = class extends ReferenceInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(context, name, backticks = false) {\r\n\t\tsuper();\r\n\t\tthis.context = context;\r\n\t\tthis.name = name;\r\n\t\tthis.backticks = backticks;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tgetEval(context = null, callback = null) {\r\n\t\tvar sourceContext = context, name = this.name;\r\n\t\tif (this.context) {\r\n\t\t\tif (name instanceof ExprInterface) {\r\n\t\t\t\tname = name.eval(context, callback);\r\n\t\t\t}\r\n\t\t\tsourceContext = this.context.eval(context, callback);\r\n\t\t}\r\n\t\treturn {context:sourceContext, name:name,};\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar parts = this.getEval(context, callback);\r\n\t\tif (!_isUndefined(parts.context) && !_isUndefined(parts.name)) {\r\n\t\t\tif (_isFunction(callback)) {\r\n\t\t\t\treturn callback(this, parts.context, parts.name);\r\n\t\t\t}\r\n\t\t\treturn Contexts.create(parts.context).get(parts.name);\r\n\t\t}\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\tvar name = this.name;\r\n\t\tif (this.context) {\r\n\t\t\tvar subjectContext = this.context.toString(context);\r\n\t\t\tif (name instanceof ExprInterface) {\r\n\t\t\t\tname = '[' + name.toString(context) + ']';\r\n\t\t\t} else if (this.backticks) {\r\n\t\t\t\tname = '`' + name + '`';\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tvar subjectContext = context;\r\n\t\t\tif (this.backticks) {\r\n\t\t\t\tname = '`' + name + '`';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn (subjectContext || '') + (subjectContext && !name.startsWith('[') ? Reference.separator : '') + name;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Reference) {\r\n\t\tif (!Lexer.match(expr.trim(), [' ']).length) {\r\n\t\t\tvar splits = Lexer.split(expr, []);\r\n\t\t\t// ------------------------\r\n\t\t\t// name, first\r\n\t\t\t// ------------------------\r\n\t\t\tvar context, name = splits.pop(), backticks;\r\n\t\t\tvar nameSplit = Lexer.split(name.trim(), [Static.separator], {preserveDelims:true});\r\n\t\t\tif (nameSplit.length > 1) {\r\n\t\t\t\tname = nameSplit.pop().substr(1);\r\n\t\t\t\tsplits = splits.concat(nameSplit);\r\n\t\t\t}\r\n\t\t\tif (_wrapped(name, '`', '`')) {\r\n\t\t\t\tname = _unwrap(name, '`', '`');\r\n\t\t\t\tbackticks = true;\r\n\t\t\t}\r\n\t\t\t// ------------------------\r\n\t\t\t// context, second\r\n\t\t\t// ------------------------\r\n\t\t\tif (splits.length) {\r\n\t\t\t\tcontext = parseCallback(splits.join(''));\r\n\t\t\t\tcontext.isContext = true;\r\n\t\t\t}\r\n\t\t\tif (_wrapped(name, '[', ']')) {\r\n\t\t\t\tif (!context) {\r\n\t\t\t\t\tthrow new Error('Invalid reference: ' + expr + '!');\r\n\t\t\t\t}\r\n\t\t\t\tname = parseCallback(_unwrap(name, '[', ']'));\r\n\t\t\t}\r\n\t\t\treturn new Static(context, name, backticks);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop string\r\n */\r\nReference.separator = '.';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Reference;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * ReturnInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'ReturnDirective'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Lexer from '../Lexer.js';\r\nimport ReturnInterface from './ReturnInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Ret (return) class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Return = class extends ReturnInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\treturn this.expr ? this.expr.eval(context, callback) : undefined;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.expr ? 'return ' + this.expr.toString(context) : 'return';\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------------------------------------------\r\n\t */\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Return) {\r\n\t\tvar exprLc = expr.toLowerCase();\r\n\t\tif (exprLc.startsWith('return ') || exprLc === 'return') {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparseCallback(expr.substr(6).trim())\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Return;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * StatementsInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'Statements'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _flatten from '@onephrase/commons/arr/flatten.js';\r\nimport StatementsInterface from './StatementsInterface.js';\r\nimport ReturnInterface from './ReturnInterface.js';\r\nimport Lexer from '../Lexer.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Statements class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Statements = class extends StatementsInterface {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(stmts, delim) {\r\n\t\tsuper();\r\n\t\tthis.stmts = exprs;\r\n\t\tthis.delim = delim;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval(context = null, callback = null) {\r\n\t\tvar exprs = [];\r\n\t\tfor (var i = 0; i < this.stmts.length; i ++) {\r\n\t\t\tif (this.stmts[i] instanceof ReturnInterface) {\r\n\t\t\t\treturn this.stmts[i].eval(context, callback);\r\n\t\t\t} else {\r\n\t\t\t\texprs[i] = this.stmts[i].eval(context, callback);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn exprs;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.stmts.map(expr => expr.toString(context)).join(this.delim);\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Statements) {\r\n\t\tvar parse = Lexer.lex(expr, _flatten(Static.operators));\r\n\t\tif (parse.tokens.length > 1) {\r\n\t\t\treturn new Static(\r\n\t\t\t\tparse.tokens.map(expr => parseCallback(expr)),\r\n\t\t\t\tparse.matches[0].trim()\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @prop array\r\n */\r\nStatements.operators = [\r\n\t';',\r\n\t\"\\r\\n\",\r\n];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Statements;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport ExprInterface from '../ExprInterface.js';\r\n\r\n/**\r\n * ---------------------------\r\n * StrInterface\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Interface = class extends ExprInterface {};\r\nObject.defineProperty(Interface.prototype, 'jsenType', {\r\n\tget() { return 'StringType'; },\r\n});\r\nexport default Interface;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport StrInterface from './StrInterface.js';\r\nimport Lexer from '../Lexer.js';\r\nimport Bool from './Bool.js';\r\n\r\n/**\r\n * ---------------------------\r\n * String utils\r\n * ---------------------------\r\n */\r\n\r\nconst Str = class extends StrInterface {\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(expr, quote) {\r\n\t\tsuper();\r\n\t\tthis.expr = expr;\r\n\t\tthis.quote = quote;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\teval() {\r\n\t\treturn this.expr;\r\n\t}\r\n\t\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString() {\r\n\t\treturn this.quote + this.expr + this.quote;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tstatic parse(expr, parseCallback, Static = Str) {\r\n\t\texpr = expr.trim();\r\n\t\tif ((_wrapped(expr, '\"', '\"') || _wrapped(expr, \"'\", \"'\")) \r\n\t\t&& !Lexer.match(expr, [' ']).length) {\r\n\t\t\tvar quote = _wrapped(expr, '\"', '\"') ? '\"' : \"'\";\r\n\t\t\treturn new Static(\r\n\t\t\t\t_unwrap(expr, quote, quote),\r\n\t\t\t\tquote\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Str;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen from './Jsen.js';\r\nimport ExprInterface from './ExprInterface.js';\r\nimport Lexer from './Lexer.js';\r\nimport Contexts from './Contexts.js';\r\nimport Abstraction from './Expr/Abstraction.js';\r\nimport AbstractionInterface from './Expr/AbstractionInterface.js';\r\nimport Arr from './Expr/Arr.js';\r\nimport ArrInterface from './Expr/ArrInterface.js';\r\nimport Arguments from './Expr/Arguments.js';\r\nimport ArgumentsInterface from './Expr/ArgumentsInterface.js';\r\nimport Assertion from './Expr/Assertion.js';\r\nimport AssertionInterface from './Expr/AssertionInterface.js';\r\nimport Assignment from './Expr/Assignment.js';\r\nimport AssignmentInterface from './Expr/AssignmentInterface.js';\r\nimport Bool from './Expr/Bool.js';\r\nimport BoolInterface from './Expr/BoolInterface.js';\r\nimport Call from './Expr/Call.js';\r\nimport CallInterface from './Expr/CallInterface.js';\r\nimport Comments from './Expr/Comments.js';\r\nimport CommentsInterface from './Expr/CommentsInterface.js';\r\nimport Comparison from './Expr/Comparison.js';\r\nimport ComparisonInterface from './Expr/ComparisonInterface.js';\r\nimport Condition from './Expr/Condition.js';\r\nimport ConditionInterface from './Expr/ConditionInterface.js';\r\nimport Deletion from './Expr/Deletion.js';\r\nimport DeletionInterface from './Expr/DeletionInterface.js';\r\nimport Func from './Expr/Func.js';\r\nimport FuncInterface from './Expr/FuncInterface.js';\r\nimport Math from './Expr/Math.js';\r\nimport MathInterface from './Expr/MathInterface.js';\r\nimport Num from './Expr/Num.js';\r\nimport NumInterface from './Expr/NumInterface.js';\r\nimport Obj from './Expr/Obj.js';\r\nimport ObjInterface from './Expr/ObjInterface.js';\r\nimport Reference from './Expr/Reference.js';\r\nimport ReferenceInterface from './Expr/ReferenceInterface.js';\r\nimport Return from './Expr/Return.js';\r\nimport ReturnInterface from './Expr/ReturnInterface.js';\r\nimport Statements from './Expr/Statements.js';\r\nimport StatementsInterface from './Expr/StatementsInterface.js';\r\nimport Str from './Expr/Str.js';\r\nimport StrInterface from './Expr/StrInterface.js';\r\n\r\n/**\r\n * @var object\r\n */\r\nJsen.grammars = {\r\n\tComments: Comments,\t\t\t// // single-line | /* double-line */\r\n\tReturn: Return,\t\t\t\t// return field1\r\n\tStatements: Statements,\t\t// field1 = 3; field2 = val2\r\n\tDeletion: Deletion,\t\t\t// delete field1\r\n\tAssignment: Assignment,\t\t// field1[key1].key2 = k\r\n\tFunc: Func,\t\t\t\t\t// (field1, field2) => {}\r\n\tAbstraction: Abstraction,\t// (field1)\r\n\tCondition: Condition,\t\t// field1 > field2 ? val1 : val2\r\n\tAssertion: Assertion,\t\t// !field1 && field2\r\n\tComparison: Comparison,\t\t// field1 > field2\r\n\tMath: Math,\t\t\t\t\t// field1 + field2\r\n\tArr: Arr,\t\t\t\t\t// [field1, field2]\r\n\tObj: Obj,\t\t\t\t\t// {field1:val1, field2:val2}\r\n\tNum: Num,\t\t\t\t\t// [0-9]\r\n\tStr: Str,\t\t\t\t\t// \"\"\r\n\tBool: Bool,\t\t\t\t\t// true\r\n\tCall: Call,\t\t\t\t\t// field1()\r\n\tReference: Reference,\t\t\t\t// field1\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tExprInterface,\r\n\tLexer,\r\n\tContexts\r\n};\r\nexport {\r\n\tAbstraction,\r\n\tArr,\r\n\tArguments,\r\n\tAssertion,\r\n\tAssignment,\r\n\tBool,\r\n\tCall,\r\n\tComments,\r\n\tComparison,\r\n\tCondition,\r\n\tDeletion,\r\n\tFunc,\r\n\tMath,\r\n\tNum,\r\n\tObj,\r\n\tReference,\r\n\tReturn,\r\n\tStr,\r\n\tStatements\r\n};\r\nexport {\r\n\tAbstractionInterface,\r\n\tArrInterface,\r\n\tArgumentsInterface,\r\n\tAssertionInterface,\r\n\tAssignmentInterface,\r\n\tBoolInterface,\r\n\tCallInterface,\r\n\tCommentsInterface,\r\n\tComparisonInterface,\r\n\tConditionInterface,\r\n\tDeletionInterface,\r\n\tFuncInterface,\r\n\tMathInterface,\r\n\tNumInterface,\r\n\tObjInterface,\r\n\tReferenceInterface,\r\n\tReturnInterface,\r\n\tStrInterface,\r\n\tStatementsInterface\r\n};\r\nexport default Jsen;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isObject from './isObject.js';\r\n\r\n/**\r\n * Tells if a given object instance has been proxied.\r\n *\r\n * @param mixed\t\tinput\r\n *\r\n * @return bool\r\n */\r\nexport default function(input) {\r\n\treturn (_isObject(input) && input.__proxyTargetByCommons) || false;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isProxy from './isProxy.js';\r\n\r\n/**\r\n * Returns the proxy's target object as earlier saved.\r\n *\r\n * @param mixed\t\tproxy\r\n *\r\n * @return mixed\r\n */\r\nexport default function(instance) {\r\n\treturn _isProxy(instance) ? instance.__proxyTargetByCommons : undefined;\r\n};\r\n","\r\n/**\r\n * Tells if val is of type \"number\".\r\n *\r\n * @param string \tval\r\n *\r\n * @return bool\r\n */\r\nexport default function(val) {\r\n\treturn typeof val === 'number';\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isArray from '../js/isArray.js';\r\nimport _mergeCallback from './mergeCallback.js';\r\n\r\n/**\r\n  * Merges values from subsequent arrays/objects into first array/object but only when not set;\r\n  * optionally recursive\r\n  *\r\n  * @param array ...objs\r\n  *\r\n  * @return void\r\n  */\r\nexport default function(...objs) {\r\n\treturn _mergeCallback(objs, (key, obj1, obj2) => {\r\n\t\tif (_isArray(obj1) && _isArray(obj2)) {\r\n\t\t\tif (obj1.indexOf(obj2[key]) === -1) {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t} else if (!(key in obj1)) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t});\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _pushUnique from './pushUnique.js';\r\nimport _from from './from.js';\r\n\r\n/**\r\n * Adds items that do not already exist.\r\n *\r\n * @param array \tarr\r\n * @param array\t \t...arrs\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...arrs) {\r\n\tarrs.forEach(_arr => {\r\n\t\t_arr.forEach(itm => _pushUnique(arr, ..._from(_arr)));\r\n\t});\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _each from '@onephrase/commons/obj/each.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Event class\r\n * ---------------------------\r\n */\r\n\r\nconst Event = class {\r\n\r\n\t/**\r\n\t * Initializes an Event instance.\r\n\t *\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(params) {\r\n\t\tthis.$ = {\r\n\t\t\tpropagationStopped: false,\r\n\t\t\tdefaultPrevented: false,\r\n\t\t\tpromisesInstance: null,\r\n\t\t\tpromises: [],\r\n\t\t};\r\n\t\t_each(params, (name, value) => {\r\n\t\t\tthis[name] = value;\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Stops the evnt from reaching other listeners.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tstopPropagation() {\r\n\t\tthis.$.propagationStopped = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if stopPropagation() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget propagationStopped() {\r\n\t\treturn this.$.propagationStopped;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a disposition that asks event initiator not to\r\n\t * proceed with default action.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpreventDefault() {\r\n\t\tthis.$.defaultPrevented = true;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) tells if preventDefault() has been called.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tget defaultPrevented() {\r\n\t\treturn this.$.defaultPrevented;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Sets a Promise disposition.\r\n\t *\r\n\t * @param Promise\tpromise\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tpromise(promise) {\r\n\t\tif (!(promise instanceof Promise)) {\r\n\t\t\tthrow new Error('Event.promise() must be called with a Promise.');\r\n\t\t}\r\n\t\tthis.$.promises.push(promise);\r\n\t\tthis.$.promisesInstance = null;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * (Readonly) returns all promises.\r\n\t *\r\n\t * @return Promise|null\r\n\t */\r\n\tget promises() {\r\n\t\tif (!this.$.promisesInstance && this.$.promises.length) {\r\n\t\t\tthis.$.promisesInstance = Promise.all(this.$.promises);\r\n\t\t}\r\n\t\treturn this.$.promisesInstance;\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Event;","\r\n/**\r\n * @imports\r\n */\r\nimport _even from '@onephrase/commons/obj/even.js';\r\nimport _get from '@onephrase/commons/obj/get.js';\r\nimport _remove from '@onephrase/commons/arr/remove.js';\r\nimport _concatUnique from '@onephrase/commons/arr/concatUnique.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _difference from '@onephrase/commons/arr/difference.js';\r\nimport _intersect from '@onephrase/commons/arr/intersect.js';\r\nimport _exclude from '@onephrase/commons/arr/exclude.js';\r\nimport _isNull from '@onephrase/commons/js/isNull.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _getType from '@onephrase/commons/js/getType.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Reactive class\r\n * ---------------------------\r\n */\r\n\r\nconst EventController = class {\r\n\t\r\n\t/**\r\n\t * Initializes the instance.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor() {\r\n\t\tthis.$ = {\r\n\t\t\tlisteners: [],\r\n\t\t};\r\n\t}\r\n\t\r\n\t/**\r\n\t * Creates a listener object.\r\n\t *\r\n\t * @param string|array\t\teventNames\r\n\t * @param function\t\t\tcallback\r\n\t * @param object\t\t\tparams\r\n\t * @param string\t\t\ttag\r\n\t *\r\n\t * @return void\r\n\t */\r\n\taddListener(eventNames, callback, params = {}, tag = null) {\r\n\t\tif (_isFunction(eventNames)) {\r\n\t\t\ttag = arguments.length > 2 ? params : '';\r\n\t\t\tparams = callback;\r\n\t\t\tcallback = eventNames;\r\n\t\t\teventNames = null;\r\n\t\t}\r\n\t\tif (!_isFunction(callback)) {\r\n\t\t\tthrow new Error('Callback must be a function; \"' + _getType(callback) + '\" given!');\r\n\t\t}\r\n\t\tvar listener = {\r\n\t\t\teventNames: eventNames, \r\n\t\t\tcallback: callback, \r\n\t\t\tparams: params,\r\n\t\t\ttag: tag,\r\n\t\t\tremove: () => {\r\n\t\t\t\t_remove(this.$.listeners, listener);\r\n\t\t\t},\r\n\t\t};\r\n\t\tthis.$.listeners.push(listener);\r\n\t\treturn listener;\r\n\t}\r\n\r\n\t/**\r\n\t * Unregisters an listener.\r\n\t *\r\n\t * @param string|array\t\teventNames\r\n\t * @param function\t\t\tcallback\r\n\t * @param object\t\t\tparams\r\n\t * @param string\t\t\ttag\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tremoveListener(eventNames, callback = null, params = {}, tag = null) {\r\n\t\tif (_isFunction(eventNames)) {\r\n\t\t\ttag = arguments.length > 2 ? params : '';\r\n\t\t\tparams = callback || {};\r\n\t\t\tcallback = eventNames;\r\n\t\t\teventNames = null;\r\n\t\t}\r\n\t\tvar success = false;\r\n\t\tfor (var i = 0; i < this.$.listeners.length; i ++) {\r\n\t\t\tif ((_isNull(eventNames) || _even(_arrFrom(this.$.listeners[i].eventNames), _arrFrom(eventNames))) \r\n\t\t\t&& (_isNull(callback) || this.$.listeners[i].callback === callback)\r\n\t\t\t&& (_isNull(params) || _even(this.$.listeners[i].params, params))\r\n\t\t\t&& (_isNull(tag) || this.$.listeners[i].tag === tag)) {\r\n\t\t\t\tif (this.$.listeners[i].removeCallback) {\r\n\t\t\t\t\tthis.$.listeners[i].removeCallback();\r\n\t\t\t\t}\r\n\t\t\t\tthis.$.listeners[i].remove();\r\n\t\t\t\tsuccess = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn success;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Returns the list of params being listend.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\teventsAll() {\r\n\t\tvar eventsAll = [];\r\n\t\t(this.$.listeners || []).forEach(listener => {\r\n\t\t\tif (!_isNull(listener.eventNames)) {\r\n\t\t\t\teventsAll = _concatUnique(eventsAll, _arrFrom(listener.eventNames));\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn eventsAll;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Fires listeners that are bound to the given events.\r\n\t *\r\n\t * @param string|array\t \teventNames\r\n\t * @param object \t\t\tdetails\r\n\t *\r\n\t * @return bool|Promise\r\n\t */\r\n\tfire(eventNames, details) {\r\n\t\tvar e = details instanceof Event ? details : new Event(details);\r\n\t\t// We handle multiple events actually...\r\n\t\teventNames = _arrFrom(eventNames);\r\n\t\t// And fields already firing should trigger a refire\r\n\t\tthis.$.currentlyFiring = this.$.currentlyFiring || [];\r\n\t\tvar eventNamesAntiRecursion = _difference(eventNames, this.$.currentlyFiring);\r\n\t\tif (!eventNamesAntiRecursion.length) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t_concatUnique(this.$.currentlyFiring, eventNamesAntiRecursion)\r\n\t\t// Initialize evteters for \"return\"\r\n\t\tfor (var i = 0; i < (this.$.listeners || []).length; i ++) {\r\n\t\t\tif (e.propagationStopped) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar listener = this.$.listeners[i];\r\n\t\t\tvar listenerParams = listener.params || {};\r\n\t\t\tvar listenerEventNames = _arrFrom(listener.eventNames).map(str => str.replace(/\\`/g, ''));\r\n\t\t\t// --------------------------\r\n\t\t\t// Level-1 filtering...\r\n\t\t\t// Match listenerEventNames to firingEventNames\r\n\t\t\t// --------------------------\r\n\t\t\tvar matches;\r\n\t\t\tif (listenerEventNames.length) {\r\n\t\t\t\tmatches = listenerEventNames.filter(listenerEventName => {\r\n\t\t\t\t\tvar firingEventNames = e.bubbling && listenerEventName.indexOf('.') > -1 ? e.bubbling\r\n\t\t\t\t\t\t: (!e.bubbling || listenerParams.allowBubbling ? eventNamesAntiRecursion : []);\r\n\t\t\t\t\treturn firingEventNames.filter(firingEventName => (listenerEventName + '.').startsWith(firingEventName + '.')).length;\r\n\t\t\t\t}).length;\r\n\t\t\t} else {\r\n\t\t\t\tmatches = !e.bubbling || listenerParams.allowBubbling;\r\n\t\t\t}\r\n\t\t\t// --------------------------\r\n\t\t\t// Level-2 filtering...\r\n\t\t\t// --------------------------\r\n\t\t\tif (matches && this._shouldFire(listener, eventNames, e)) {\r\n\t\t\t\t// Call listener...\r\n\t\t\t\tvar dispostn = this._doFire(listener, eventNames, e), proms;\r\n\t\t\t\tif ((dispostn === false) || (dispostn instanceof Event && dispostn.propagationStopped)) {\r\n\t\t\t\t\te.stopPropagation();\r\n\t\t\t\t} else if ((dispostn === false) || (dispostn instanceof Event && dispostn.defaultPrevented)) {\r\n\t\t\t\t\te.preventDefault();\r\n\t\t\t\t} else if ((dispostn instanceof Promise && (proms = dispostn))\r\n\t\t\t\t|| (dispostn instanceof Event && (proms = dispostn.promises))) {\r\n\t\t\t\t\te.promise(proms);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t_exclude(this.$.currentlyFiring, ...eventNamesAntiRecursion)\r\n\t\t// -----------------------------\r\n\t\t// The overall return value\r\n\t\t// -----------------------------\r\n\t\treturn e;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determins if to fire the listener at entry \"i\".\r\n\t * Returns a data object if so.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\t_shouldFire(listener, eventNames, e) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t/**\r\n\t * Fires the listener at entry \"i\".\r\n\t * Returns listener's disposition.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\t_doFire(listener, eventNames, e) {\r\n\t\tvar context = e.context || {};\r\n\t\tvar _context = e._context || {};\r\n\t\tif (!_isNull(listener.eventNames)) {\r\n\t\t\t// Call listener...\r\n\t\t\tvar data = [];\r\n\t\t\tvar _data = [];\r\n\t\t\tvar result = _arrFrom(listener.eventNames).forEach(eventName => {\r\n\t\t\t\teventName = _isString(eventName) ? eventName.split('.') : eventName;\r\n\t\t\t\tdata.push(_get(context, eventName));\r\n\t\t\t\t_data.push(_get(_context, eventName));\r\n\t\t\t});\r\n\t\t\treturn _isArray(listener.eventNames) \r\n\t\t\t\t? listener.callback(data, _data, e)\r\n\t\t\t\t: listener.callback(data[0], _data[0], e);\r\n\t\t}\r\n\t\tvar data = {};\r\n\t\tvar _data = {};\r\n\t\teventNames.forEach(eventName => {\r\n\t\t\tvar path = _isString(eventName) ? eventName.split('.') : eventName;\r\n\t\t\tdata[eventName] = _get(context, path);\r\n\t\t\t_data[eventName] = _get(_context, path);\r\n\t\t});\r\n\t\t// Call listener...\r\n\t\treturn listener.callback(data, _data, e);\r\n\t}\r\n};\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default EventController;","\r\n/**\r\n * Returns the val's type.\r\n *\r\n * @param string \tval\r\n *\r\n * @return string\r\n */\r\nexport default function(val) {\r\n\treturn typeof val;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _remove from './remove.js';\r\n\r\n/**\r\n * Removes all instances of each item.\r\n *\r\n * @param array \tarr\r\n * @param array\t \titms\r\n *\r\n * @return array\r\n */\r\nexport default function(arr, ...itms) {\r\n\titms.forEach(itm => _remove(arr, itm));\r\n\treturn arr;\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isNull from '@onephrase/commons/js/isNull.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _isNumber from '@onephrase/commons/js/isNumber.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isObservable from '@onephrase/commons/js/isObservable.js';\r\nimport _getProxyTarget from '@onephrase/commons/js/getProxyTarget.js';\r\nimport _isProxy from '@onephrase/commons/js/isProxy.js';\r\nimport _proxy from '@onephrase/commons/js/proxy.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _unique from '@onephrase/commons/arr/unique.js';\r\nimport _inherit from '@onephrase/commons/obj/inherit.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _even from '@onephrase/commons/obj/even.js';\r\nimport _get from '@onephrase/commons/obj/get.js';\r\nimport EventController from './EventController.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Observable\r\n * ---------------------------\r\n */\r\n \r\nconst Observable = class extends EventController {\r\n\r\n\t/**\r\n\t * Handles initializations.\r\n\t *\r\n\t * @param object\t\t\tstate\r\n\t * @param object\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(state = {}, params = {}) {\r\n\t\tsuper();\r\n\t\t// @see ObservableCore.init()\r\n\t\tthis.$.params = _inherit({}, params, Observable.params);\r\n\t\tthis.$.bubblers = {};\r\n\t\tthis.$.state = state;\r\n\t\tthis.$._state = _isArray(state) ? state.slice() : _copy(1, state);\r\n\t\t_each(this.$.state, (prop, value) => {\r\n\t\t\tthis._incoming(prop, value);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * Alias of addListener.\r\n\t *\r\n\t * @see addListener()\r\n\t */\r\n\tobserve(...args) {\r\n\t\treturn this.addListener(...args);\r\n\t}\r\n\r\n\t/**\r\n\t * Alias of removeListener.\r\n\t *\r\n\t * @see removeListener()\r\n\t */\r\n\tunobserve(...args) {\r\n\t\treturn this.removeListener(...args);\r\n\t}\r\n\r\n\t/**\r\n\t * Pushes data into a given property, or list of properties.\r\n\t *\r\n\t * @param string\t\tprops\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\tset(prop, value) {\r\n\t\tvar data = {};\r\n\t\tif (_isString(prop) || _isNumber(prop)) {\r\n\t\t\tdata[prop] = value;\r\n\t\t} else if (_isArray(prop)) {\r\n\t\t\tprop.forEach(p => {\r\n\t\t\t\tdata[p] = value;\r\n\t\t\t})\r\n\t\t} else if (_isObject(prop)) {\r\n\t\t\tdata = prop;\r\n\t\t}\r\n\t\tvar changedProps = Object.keys(data);\r\n\t\tif (_isArray(this.$.state)) {\r\n\t\t\tchangedProps = changedProps.map(key => parseInt(key));\r\n\t\t}\r\n\t\t// ------------------\r\n\t\tvar entries = [];\r\n\t\tchangedProps.forEach(prop => {\r\n\t\t\tif (prop in this.$.state) {\r\n\t\t\t\tthis._outgoing(prop, this.$.state[prop]);\r\n\t\t\t} else {\r\n\t\t\t\tentries.push(prop);\r\n\t\t\t}\r\n\t\t\t// Incoming...\r\n\t\t\t// ------------------\r\n\t\t\tvar value = data[prop];\r\n\t\t\t// When observables come as proxies,\r\n\t\t\t// we'll save them real\r\n\t\t\tif (_isProxy(value)) {\r\n\t\t\t\tvar _value = _getProxyTarget(value);\r\n\t\t\t\tif (_isObservable(_value)) {\r\n\t\t\t\t\tvalue = _value;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis._incoming(prop, value);\r\n\t\t\t// Set now...\r\n\t\t\t// ------------------\r\n\t\t\tthis.$.state[prop] = value;\r\n\t\t});\r\n\t\tvar observersDisposition = this.fire(changedProps, {context: this.$.state, _context: this.$._state, entries: entries, exits: []});\r\n\t\tchangedProps.forEach(prop => {\r\n\t\t\tthis.$._state[prop] = this.$.state[prop];\r\n\t\t});\r\n\t\treturn observersDisposition;\r\n\t}\r\n\r\n\t/**\r\n\t * Unsets the property or list of properties from the object.\r\n\t *\r\n\t * @param string|array\t\tprop\r\n\t *\r\n\t * @return null|false|Promise\r\n\t */\r\n\tdel(prop) {\r\n\t\tvar props = _arrFrom(prop);\r\n\t\tvar exits = [];\r\n\t\tprops.forEach(prop => {\r\n\t\t\tif (prop in this.$.state) {\r\n\t\t\t\texits.push(prop);\r\n\t\t\t\tthis._outgoing(prop, this.$.state[prop]);\r\n\t\t\t}\r\n\t\t\tdelete this.$.state[prop];\r\n\t\t});\r\n\t\tvar observersDisposition = this.fire(props, {context: this.$.state, _context: this.$._state, entries: [], exits: exits});\r\n\t\tprops.forEach(prop => {\r\n\t\t\tdelete this.$._state[prop];\r\n\t\t});\r\n\t\treturn observersDisposition;\r\n\t}\r\n\r\n\t/**\r\n\t * Evaluates a property name to see if it's a request for instance method\r\n\t * as against state property.\r\n\t *\r\n\t * @param string\t\t\tprop\r\n\t *\r\n\t * @return function|undefined\r\n\t */\r\n\tasOwnMethod(prop) {\r\n\t\tif (_isString(prop) && this.$.params.methodPrefix && prop.startsWith(this.$.params.methodPrefix)) {\r\n\t\t\tvar ownMethod = prop.substr(this.$.params.methodPrefix.length);\r\n\t\t\tif (ownMethod && _isFunction(ownMethod = this[ownMethod])) {\r\n\t\t\t\treturn ownMethod.bind(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns a field's value.\r\n\t *\r\n\t * @param string|int \t\tprop\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(prop) {\r\n\t\t// ----------------------\r\n\t\tvar asOwnMethod = this.asOwnMethod(prop);\r\n\t\tif (asOwnMethod) {\r\n\t\t\treturn asOwnMethod;\r\n\t\t}\r\n\t\t// ----------------------\r\n\t\tvar value = this.$.state[prop];\r\n\t\tif (_isArray(this.$.state) && !_isNumeric(prop) && _isFunction(value)) {\r\n\t\t\treturn (...args) => {\r\n\t\t\t\tvar copy = this.$.state.slice();\r\n\t\t\t\tvar ret = value.apply(this.$.state, args);\r\n\t\t\t\tvar changedKeys = _unique(Object.keys(copy).concat(Object.keys(this.$.state))).filter(k => {\r\n\t\t\t\t\tk = parseInt(k);\r\n\t\t\t\t\tif (this.$.state[k] !== copy[k]) {\r\n\t\t\t\t\t\tif (!(k in this.$.state)) {\r\n\t\t\t\t\t\t\t// Outgoing...\r\n\t\t\t\t\t\t\t// ------------------\r\n\t\t\t\t\t\t\tthis._outgoing(k, copy[k]);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t// Incoming...\r\n\t\t\t\t\t\t\t// ------------------\r\n\t\t\t\t\t\t\tthis._incoming(k, this.$.state[k]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn true;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (changedKeys.length) {\r\n\t\t\t\t\tthis.fire(changedKeys, {context: this.$.state, _context: this.$._state});\r\n\t\t\t\t\tthis.$._state = this.$.state.slice();\r\n\t\t\t\t}\r\n\t\t\t\treturn ret;\r\n\t\t\t};\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Tells if a a field exists.\r\n\t *\r\n\t * @param string|int \t\tprop\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\thas(prop) {\r\n\t\treturn (prop in this.$.state);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Keys of current entries.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tkeys() {\r\n\t\treturn Object.keys(this.$.state);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Determins if to fire the listener at entry \"i\".\r\n\t * Returns a data object if so.\r\n\t *\r\n\t * @param object\t\t \tlistener\r\n\t * @param array\t\t\t \teventNames\r\n\t * @param object \t\t\te\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\t_shouldFire(listener, eventNames, e) {\r\n\t\tvar passes = 0, failures = 0;\r\n\t\t// One CACHE across listeners\r\n\t\t// IMPORTANT: This cache must\r\n\t\t// be destroyed before bubbling the (e) object\r\n\t\tif (!('CACHE' in e.$)) {\r\n\t\t\te.$.CACHE = {};\r\n\t\t\te.$._CACHE = {};\r\n\t\t}\r\n\t\tvar listenerParams = listener.params || {};\r\n\t\t(!_isNull(listener.eventNames) ? _arrFrom(listener.eventNames) : eventNames).forEach(prop => {\r\n\t\t\tif (!(prop in e.$.CACHE)) {\r\n\t\t\t\te.$.CACHE[prop] = {};\r\n\t\t\t\te.$._CACHE[prop] = {};\r\n\t\t\t\t// > ACCESS\r\n\t\t\t\tvar existsReciever = {};\r\n\t\t\t\tvar _existsReciever = {};\r\n\t\t\t\tvar path = _isString(prop) ? prop.split('.') : prop;\r\n\t\t\t\te.$.CACHE[prop].val = _get(e.context, path, existsReciever);\r\n\t\t\t\te.$._CACHE[prop].val = _get(e._context, path, _existsReciever);\r\n\t\t\t\te.$.CACHE[prop].existence = existsReciever.exists;\r\n\t\t\t\te.$._CACHE[prop].existence = _existsReciever.exists;\r\n\t\t\t\t// > DIFFING\r\n\t\t\t\tif (listenerParams.diff !== false && !('diffing' in e.$.CACHE[prop])) {\r\n\t\t\t\t\te.$.CACHE[prop].diffing = e.bubbling\r\n\t\t\t\t\t|| e.$.CACHE[prop].existence !== e.$._CACHE[prop].existence \r\n\t\t\t\t\t|| (_isObject(e.$.CACHE[prop].val) && _isObject(e.$._CACHE[prop].val) \r\n\t\t\t\t\t\t? !_even(e.$.CACHE[prop].val, e.$._CACHE[prop].val) \r\n\t\t\t\t\t\t: e.$.CACHE[prop].val !== e.$._CACHE[prop].val);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// > Delta...\r\n\t\t\tif (_isNumeric(listenerParams.pulse) && e.context && e._context) {\r\n\t\t\t\tif (listenerParams.pulse === 0 && e.$.CACHE[prop].val && !e.$._CACHE[prop].val) {\r\n\t\t\t\t\tfailures ++;\r\n\t\t\t\t} else if (listenerParams.pulse === 1 && !e.$.CACHE[prop].val && e.$._CACHE[prop].val) {\r\n\t\t\t\t\tfailures ++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// > Diff...\r\n\t\t\tif (listenerParams.diff === false || e.$.CACHE[prop].diffing) {\r\n\t\t\t\tpasses ++;\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn !failures && passes && super._shouldFire(listener, eventNames, e);\r\n\t}\r\n\r\n\t/**\r\n\t * A function that captures outgoing objects/values.\r\n\t *\r\n\t * @param string\t\tprop\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_outgoing(prop, value) {\r\n\t\tif (_isObservable(value)) {\r\n\t\t\tif (prop in this.$.bubblers) {\r\n\t\t\t\tvalue.unobserve(this.$.bubblers[prop], {allowBubbling:true});\r\n\t\t\t}\r\n\t\t\tif (_isFunction(value.getOffsetParent) && value.getOffsetParent() === this) {\r\n\t\t\t\tvalue.setOffsetParent(null);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * A function that captures incoming objects/values.\r\n\t *\r\n\t * @param string\t\tprop\r\n\t * @param mixed\t\t\tvalue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\t_incoming(prop, value) {\r\n\t\tif (_isObservable(value)) {\r\n\t\t\tvalue.observe(this._getBubbler(prop), {allowBubbling:true});\r\n\t\t\tif (_isFunction(value.getOffsetParent) && !value.getOffsetParent()) {\r\n\t\t\t\tvalue.setOffsetParent(this);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a reference to the parent instance.\r\n\t *\r\n\t * @param object|null\t\toffsetParent\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tsetOffsetParent(offsetParent) {\r\n\t\tthis.$.offsetParent = offsetParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets a reference to the parent instance.\r\n\t *\r\n\t * @return object|null\r\n\t */\r\n\tgetOffsetParent() {\r\n\t\treturn this.$.offsetParent;\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a function that observes changes in child observables and bubble them up here.\r\n\t *\r\n\t * @param string\t\tname\r\n\t *\r\n\t * @return function\r\n\t */\r\n\t_getBubbler(prop) {\r\n\t\tthis.$.bubblers = this.$.bubblers || {};\r\n\t\tthis.$.bubblers[prop] = (changes, _changes, e) => {\r\n\t\t\tvar _e = {};\r\n\t\t\t_e.context = this.$.state;\r\n\t\t\t_e._context = this.$._state;\r\n\t\t\t_e.entries = (e.entries || []).slice();\r\n\t\t\t_e.exits = (e.exits || []).slice();\r\n\t\t\t_e.bubbling = (e.bubbling ? _arrFrom(e.bubbling) : Object.keys(changes))\r\n\t\t\t\t.map(subFieldName => prop + '.' + subFieldName);\r\n\t\t\treturn this.fire(prop, _e);\r\n\t\t};\r\n\t\treturn this.$.bubblers[prop];\r\n\t}\r\n\t\r\n\t/**\r\n\t * Warning handler.\r\n\t *\r\n\t * @param string\t\tmsg\r\n\t *\r\n\t * @return void\r\n\t */\r\n\twarn(msg) {\r\n\t\tconsole.error(msg);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Error handler.\r\n\t *\r\n\t * @param string\t\tmsg\r\n\t *\r\n\t * @return void\r\n\t */\r\n\terror(msg) {\r\n\t\tif (this.$.params.strictDebug) {\r\n\t\t\tthrow new Error(msg);\r\n\t\t} else {\r\n\t\t\tconsole.error(msg);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Constructs a proxy wrapper for the target.\r\n\t *\r\n\t * @return new Proxy\r\n\t */\r\n\tproxy() {\r\n\t\treturn _proxy(this, {\r\n\t\t\t// -----------------------\r\n\t\t\t// The 4 cardinal points...\r\n\t\t\t// -----------------------\r\n\t\t\tget: function(target, prop) {\r\n\t\t\t\tvar value = target.get(prop);\r\n\t\t\t\tif (_isObject(value) && _isFunction(value.proxy)) {\r\n\t\t\t\t\tvalue = value.proxy();\r\n\t\t\t\t}\r\n\t\t\t\treturn value;\r\n\t\t\t},\r\n\t\t\tset: function(target, prop, val) {\r\n\t\t\t\ttarget.set(prop, val);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\thas: function(target, prop) {\r\n\t\t\t\treturn target.has(prop);\r\n\t\t\t},\r\n\t\t\tdeleteProperty: function(target, prop) {\r\n\t\t\t\treturn target.del(prop);\r\n\t\t\t},\r\n\t\t\t// -----------------------\r\n\t\t\t// Unimportant additions...\r\n\t\t\t// -----------------------\r\n\t\t\townKeys: function(target) {\r\n\t\t\t\t//TODO:return Reflect.ownKeys(target.$.state);\r\n\t\t\t\treturn Object.keys(target.$.state);\r\n\t\t\t},\r\n\t\t\tdefineProperty: function(target, prop, descriptor) {\r\n\t\t\t\tObject.defineProperty(target.$.state, prop, descriptor);\r\n\t\t\t\ttarget.set(prop, target.$.state[prop]);\r\n\t\t\t\treturn true;\r\n\t\t\t},\r\n\t\t\tgetOwnPropertyDescriptor: function(target, prop) {\r\n\t\t\t\treturn Object.getOwnPropertyDescriptor(target.$.state, prop);\r\n\t\t\t},\r\n\t\t\tgetOwnPropertySymbols: function(target) {\r\n\t\t\t\treturn Object.getOwnPropertySymbols(target.$.state);\r\n\t\t\t},\r\n\t\t\tgetOwnPropertyNames: function(target) {\r\n\t\t\t\treturn Object.getOwnPropertyNames(target.$.state);\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nObservable.params = {\r\n\tmethodPrefix: '$',\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Observable;","\r\n/**\r\n * @imports\r\n */\r\nimport _merge from '../obj/merge.js';\r\n\r\n/**\r\n * Creats a proxy and keeps special reference to it.\r\n *\r\n * @param object\t target\r\n * @param object\t trap\r\n *\r\n * @return Proxy\r\n */\r\nexport default function(target, trap) {\r\n\tvar trapByCommons = {\r\n\t\tget: (target, prop) => {\r\n\t\t\tif (prop === '__proxyTargetByCommons') {\r\n\t\t\t\treturn target;\r\n\t\t\t}\r\n\t\t\tif (prop === '__proxyTrapByCommons') {\r\n\t\t\t\treturn trap;\r\n\t\t\t}\r\n\t\t\treturn trap.get ? trap.get(target, prop) : target[prop];\r\n\t\t},\r\n\t};\r\n\treturn new Proxy(target, _merge({}, trap, trapByCommons));\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Observable from './Observable.js';\r\nimport EventController from './EventController.js';\r\nimport Event from './Event.js';\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tEventController,\r\n\tEvent\r\n};\r\nexport default Observable;","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport _last from '@onephrase/commons/arr/last.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Def = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(key, value, flag = null) {\r\n\t\tthis.key = key;\r\n\t\tthis.value = value;\r\n\t\tthis.flag = flag;\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null) {\r\n\t\treturn this.key + ': ' + this.value + (this.flag ? ' ' + this.flag : '');\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return Def\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\tif (expr) {\r\n\t\t\tvar _opts = _copy(opts);\r\n\t\t\t_opts.limit = 1;\r\n\t\t\tvar defSplit = Lexer.split(expr, [':'], _opts);\r\n\t\t\tif (defSplit.length < 2) {\r\n\t\t\t\tthrow new Error('Malformed def: ' + expr);\r\n\t\t\t}\r\n\t\t\tvar key = defSplit.shift().trim();\r\n\t\t\tvar value, flag, vf = Lexer.split(defSplit.shift().trim(), [' '], opts);\r\n\t\t\tif (vf.length > 1) {\r\n\t\t\t\tif (Def.flags.includes(_last(vf).trim().toLowerCase())) {\r\n\t\t\t\t\tflag = vf.pop().trim().toLowerCase();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tvalue = vf.join(' ');\r\n\t\t\treturn new Def(key, value, flag);\r\n\t\t}\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nDef.flags = ['!replace', '!incase',];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Def;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport _wrapped from '@onephrase/commons/str/wrapped.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport Def from './Def.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst DefBlock = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(entries = []) {\r\n\t\t// We must add them through the door\r\n\t\tthis.entries = [];\r\n\t\tentries.forEach(entry => this.add(entry));\r\n\t}\r\n\t\r\n\t/**\r\n\t * Returns valid entries.\r\n\t *\r\n\t * @param bool\t\twithDuplicates\r\n\t * @param bool\t\twithOverRidden\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tfilter(withDuplicate = false, withOverRidden = false) {\r\n\t\treturn this.entries.filter(entry => (!entry.isDuplicate || withDuplicate) && (!entry.overridden || withOverRidden));\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null, withDuplicate = false, withOverRidden = true) {\r\n\t\treturn this.filter(withDuplicate, withOverRidden).map(def => def.toString(context)).join('; ') + ';';\r\n\t}\r\n\t\r\n\t/**\r\n\t * Adds an entry to the list with overRiding resolved.\r\n\t *\r\n\t * @param object\t\tentry\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tadd(newDef) {\r\n\t\tif (!newDef.key || !newDef.value) {\r\n\t\t\tthrow new Error('Def must contain a valid key and value!');\r\n\t\t}\r\n\t\tif (!(newDef instanceof Def)) {\r\n\t\t\tnewDef = new Def(newDef.key, newDef.value, newDef.flag);\r\n\t\t}\r\n\t\tthis.entries.forEach(existingDef => {\r\n\t\t\tif (existingDef.isDuplicate || existingDef.overridden) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tvar key_a = existingDef.key.toString();\r\n\t\t\tvar value_a = existingDef.value.toString();\r\n\t\t\tvar value_aUnwrapped = _wrapped(value_a, '(', ')') ? _unwrap(value_a, '(', ')') : value_a;\r\n\t\t\tvar key_b = newDef.key.toString();\r\n\t\t\tvar value_b = newDef.value.toString();\r\n\t\t\tvar value_bUnwrapped = _wrapped(value_b, '(', ')') ? _unwrap(value_b, '(', ')') : value_b;\r\n\t\t\tvar incase_a = (existingDef.flag || '').toLowerCase() === '!incase';\r\n\t\t\tvar important_a = (existingDef.flag || '').toLowerCase() === '!replace';\r\n\t\t\tvar incase_b = (newDef.flag || '').toLowerCase() === '!incase';\r\n\t\t\tvar important_b = (newDef.flag || '').toLowerCase() === '!replace';\r\n\t\t\tif (key_a === key_b) {\r\n\t\t\t\tif ((value_a === value_b || value_aUnwrapped === value_bUnwrapped) \r\n\t\t\t\t&& (important_a === important_b || incase_a === incase_b)) {\r\n\t\t\t\t\tnewDef.isDuplicate = true;\r\n\t\t\t\t} else if (important_b || incase_a) {\r\n\t\t\t\t\texistingDef.overridden = true;\r\n\t\t\t\t} else if ((important_a || incase_b)) {\r\n\t\t\t\t\tnewDef.overridden = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.entries.push(newDef);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return DefBlock\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\treturn new DefBlock(\r\n\t\t\tLexer.split(expr, [';'], opts).filter(def => def.trim()).map(def => Def.parse(def.trim()))\r\n\t\t);\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default DefBlock;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport {\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isObject from '@onephrase/commons/js/isObject.js';\r\nimport _unwrap from '@onephrase/commons/str/unwrap.js';\r\nimport DefBlock from './DefBlock.js';\r\n\r\n/**\r\n * ---------------------------\r\n * Call class\r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst DefSheet = class {\r\n\r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\tconstructor(block = {}) {\r\n\t\tthis.block = {};\r\n\t\tthis.apply(block);\r\n\t}\r\n\t \r\n\t/**\r\n\t * @inheritdoc\r\n\t */\r\n\ttoString(context = null, withDuplicate = false, withOverRidden = true) {\r\n\t\tvar str = [];\r\n\t\t_each(this.block, (type, defBlock) => {\r\n\t\t\tstr.push('@' + type);\r\n\t\t\tstr.push('{' + defBlock.toString(context, withDuplicate, withOverRidden) + '}');\r\n\t\t});\r\n\t\treturn str.join(' ');\r\n\t}\r\n\t \r\n\t/**\r\n\t * Merges a DefSheet instance or a block of entries into the current instance.\r\n\t *\r\n\t * @param array|DefSheet\tdefSheet\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tapply(defSheet) {\r\n\t\tvar block = defSheet;\r\n\t\tif (defSheet instanceof DefSheet) {\r\n\t\t\tblock = defSheet.block;\r\n\t\t} else if (!_isObject(defSheet)) {\r\n\t\t\tthrow new Error('Argument #1 must only be an object or an instance of ./DefSheet!');\r\n\t\t}\r\n\t\t_each(block, (section, defBlock) => {\r\n\t\t\tthis.applyTo(section, defBlock);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t \r\n\t/**\r\n\t * Adds entries to the list of entries for the given type.\r\n\t *\r\n\t * @param string\t\t\tsection\r\n\t * @param array|DefBlock\tdefBlock\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tapplyTo(section, defBlock) {\r\n\t\tvar entries = defBlock;\r\n\t\tif (defBlock instanceof DefBlock) {\r\n\t\t\tentries = defBlock.entries;\r\n\t\t} else if (!_isArray(defBlock)) {\r\n\t\t\tthrow new Error('Argument #1 must only be an array or an instance of ./DefBlock!');\r\n\t\t}\r\n\t\tif (!this.block[section]) {\r\n\t\t\tthis.block[section] = new DefBlock;\r\n\t\t}\r\n\t\tentries.forEach(entry => this.block[section].add(_copy(entry)));\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an entire block of CHTML deinitions.\r\n\t *\r\n\t * @param string\t\texpr\r\n\t * @param object\t\topts\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parse(expr, opts = {}) {\r\n\t\tvar splits = Lexer.split(expr, [], opts);\r\n\t\tvar type, expr, defBlock, block = {};\r\n\t\twhile ((type = splits.shift()) && (defBlock = splits.shift())) {\r\n\t\t\tblock[type.trim().toLowerCase().substr(1)] = DefBlock.parse(_unwrap(defBlock.trim(), '{', '}'), opts);\r\n\t\t}\r\n\t\treturn new DefSheet(block);\r\n\t}\r\n};\t\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default DefSheet;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport Jsen, {\r\n\tArgumentsInterface,\r\n\tCallInterface,\r\n\tReferenceInterface,\r\n\tArguments,\r\n\tLexer\r\n} from '@onephrase/jsen';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isArray from '@onephrase/commons/js/isArray.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _getProxyTarget from '@onephrase/commons/js/getProxyTarget.js';\r\nimport _isProxy from '@onephrase/commons/js/isProxy.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport _unique from '@onephrase/commons/arr/unique.js';\r\nimport _copy from '@onephrase/commons/obj/copy.js';\r\nimport _each from '@onephrase/commons/obj/each.js';\r\nimport _even from '@onephrase/commons/obj/even.js';\r\nimport _before from '@onephrase/commons/str/before.js';\r\nimport _after from '@onephrase/commons/str/after.js';\r\nimport Observable from '@onephrase/observable';\r\nimport Matrix from './Def/Matrix.js';\r\nimport DefSheet from './Def/DefSheet.js';\r\nimport DefBlock from './Def/DefBlock.js';\r\nimport Schema from './Schema.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n push, observe bare class, return proxy if, \r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst ChtmlCore = class extends Observable {\r\n\r\n\t/**\r\n\t * Initializes the new Chtml instance.\r\n\t *\r\n\t * @param document|HTMLElement\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper({}, params);\r\n\t\t// -----------------------------\r\n\t\t// ROOT RESOLUTION:\r\n\t\t// -----------------------------\r\n\t\tthis.root = this.el = el;\r\n\t\tif (el.nodeName === '#document') {\r\n\t\t\tthis.el = el.querySelector('html');\r\n\t\t} else if (!(el instanceof HTMLElement)) {\r\n\t\t\tthrow new Error('Argument #1 must be instanceof of HTMLElement or the document object!');\r\n\t\t}\r\n\t\t// -----------------------------\r\n\t\t// BINDINGS/DIRECTIVES\r\n\t\t// -----------------------------\r\n\t\t// The parsed namespace ($ns)\r\n\t\tthis.$.ns = ChtmlCore.parseNamespace(this.el);\r\n\t\t// The parsed Cascaded Definition Sheet ($defs)\r\n\t\tthis.$.defs = ChtmlCore.parseCascadedDefSheet(this.el);\r\n\t\t// Initialize...\r\n\t\tthis.init();\r\n\t}\r\n\t\r\n\t/**\r\n\t * Executes one-off initialization directives.\r\n\t *\r\n\t * Then executes reactive bindings and keeps them bound.\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tinit() {\r\n\t\t// -----------------------\r\n\t\t// Free the instance first...\r\n\t\tthis.free(false);\r\n\t\t// -----------------------\r\n\t\t// One-off init\r\n\t\tthis.getCpsBlock('init', true/*asDirectives*/).forEach(directive => directive.eval(this));\r\n\t\t// -----------------------\r\n\t\t// Reactive bindings\r\n\t\tthis.$.bindingsListeners = [];\r\n\t\t// Apply bindings...\r\n\t\tvar stringifyEach = list => _unique(list.map(expr => _before(_before(expr.toString(), '['), '(')));\r\n\t\tthis.getCpsBlock('directives', true/*asDirectives*/).forEach(binding => {\r\n\t\t\tif (!this.$.params.observeOnly) {\r\n\t\t\t\tbinding.eval(this);\r\n\t\t\t}\r\n\t\t\t// We'll execute binding on the appriopriate changes\r\n\t\t\tvar listenerObj = this.observe(stringifyEach(binding.meta.vars), (newState, oldState, params) => {\r\n\t\t\t\t// Next eval() should be triggered by only the changes in the vars that participated in this eval()\r\n\t\t\t\tvar evalReturn = binding.eval(this);\r\n\t\t\t\t// If the result of this evaluation is false,\r\n\t\t\t\t// e.stopPropagation will be called and subsequent expressions\r\n\t\t\t\t// will not be evaluated. So we must not allow false to be returned.\r\n\t\t\t\t// All expressions are meant to be evaluated in parallel, independent of each other.\r\n\t\t\t\tif (evalReturn !== false) {\r\n\t\t\t\t\treturn evalReturn;\r\n\t\t\t\t}\r\n\t\t\t}, {diff: this.$.params.diff});\r\n\t\t\tthis.$.bindingsListeners.push(listenerObj);\r\n\t\t});\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Frees the instance of either observed bindings\r\n\t * or entire available listeners.\r\n\t *\r\n\t * @param bool\t\t\t\t\tall\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tfree(all = true) {\r\n\t\tif (all) {\r\n\t\t\t// Remove all available listeners\r\n\t\t\tsuper.removeListener();\r\n\t\t} else if (this.$.bindingsListeners) {\r\n\t\t\t// Remove all observed bindings\r\n\t\t\tthis.$.bindingsListeners.forEach(listener => listener.remove());\r\n\t\t\tthis.$.bindingsListeners.splice();\r\n\t\t}\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Clones the instance using a serialize/deserialize strategy.\r\n\t *\r\n\t * @param bool\t \t\tcleanCopy\r\n\t *\r\n\t * @return ChtmlInterface\r\n\t */\r\n\tclone(cleanCopy = true) {\r\n\t\tif (!_isFunction(this.$.params.componentCallback)) {\r\n\t\t\tthrow new Error('The params.componentCallback function is required!');\r\n\t\t}\r\n\t\tvar el = this.el.cloneNode(true);\r\n\t\t// -------------------------------\r\n\t\t// We'll remove all aprsable components of the element\r\n\t\t// as we already have the most accurate available\r\n\t\t// -------------------------------\r\n\t\tvar attrCache = {};\r\n\t\tChtmlCore.paramsAttrs.map(attr => ChtmlCore.attributeMap[attr]).forEach(type => {\r\n\t\t\tvar attrValue;\r\n\t\t\tif (attrValue = el.getAttribute(type)) {\r\n\t\t\t\tattrCache.type = attrValue;\r\n\t\t\t\tel.removeAttribute(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar dataBlockScript;\r\n\t\tif (dataBlockScript = _arrFrom(el.children).filter(node => node.matches(ChtmlCore.elementMap.defsheet))[0]) {\r\n\t\t\tdataBlockScript.remove();\r\n\t\t}\r\n\t\t// -------------------------------\r\n\t\t// Instantiate now...\r\n\t\t// -------------------------------\r\n\t\tvar instance = this.$.params.componentCallback(el, this.$.params, false/*resolveInheritance*/);\r\n\t\tvar _instance = _isProxy(instance) ? _getProxyTarget(instance) : instance;\r\n\t\t// Serialize/deserialize definitions\r\n\t\t_instance.$defs = DefSheet.parse(this.$.defs.toString(null/*context*/, !cleanCopy/*withDuplicate*/, true/*withOverRidden*/));\r\n\t\t// -------------------------------\r\n\t\t// Restore parsable components of the element just for the records\r\n\t\t// -------------------------------\r\n\t\t_each(attrCache, (type, attrValue) => {\r\n\t\t\tel.setAttribute(type, attrValue);\r\n\t\t});\r\n\t\tif (dataBlockScript) {\r\n\t\t\tel.prepend(dataBlockScript);\r\n\t\t}\r\n\t\treturn instance;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Evalutes the bindings for the component;\r\n\t * caches the result for subsequent calls.\r\n\t *\r\n\t * @param string\t\tkey\r\n\t * @param bool\t\t\tasDirectives\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tgetCpsBlock(key, asDirectives = false) {\r\n\t\tvar cpsBlockDefs = this.$.defs.block[key] ? this.$.defs.block[key].filter() : [];\r\n\t\tif (asDirectives) {\r\n\t\t\tvar directives = [];\r\n\t\t\tcpsBlockDefs.forEach(def => {\r\n\t\t\t\tvar argsExpr = (this.$.params.chainableDirectives === false || !def.value.trim().startsWith('(') ? [def.value] : Lexer.split(def.value, ['.']))\r\n\t\t\t\t\t.map(expr => Jsen.parse(expr, [Arguments], {assert:false}) || Jsen.parse(expr));\r\n\t\t\t\tif (argsExpr.length !== argsExpr.filter(a => a).length) {\r\n\t\t\t\t\tthis.error('Malformed argument in the CPS expression: ' + def.toString());\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tvar directive, _directive = def.key + (argsExpr.length > 1 || argsExpr[0] instanceof ArgumentsInterface ? argsExpr.join('.') : '(' + argsExpr[0].toString() + ')');\r\n\t\t\t\tif (!(directive = Jsen.parse(_directive, null, {explain: this.$.params.explainJsen}))) {\r\n\t\t\t\t\tthis.error('Malformed CPS expression: ' + def.toString());\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tdirectives.push(directive);\r\n\t\t\t});\r\n\t\t\treturn directives;\r\n\t\t}\r\n\t\treturn cpsBlockDefs;\r\n\t}\r\n\r\n\t/**\r\n\t * Attempts to resolve a node as related node.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|ChtmlInterface\r\n\t */\r\n\tgetRelatedNode(requestNodeName) {\r\n\t\tvar computeQuery, node;\r\n\t\tif (!this.computedRelated) {\r\n\t\t\tthis.computedRelated = {};\r\n\t\t\tthis.getCpsBlock('related', false/*asDirectives*/).forEach(entry => {\r\n\t\t\t\tthis.computedRelated[entry.key] = Jsen.parse(entry.value);\r\n\t\t\t});\r\n\t\t}\r\n\t\tif ((computeQuery = this.computedRelated[requestNodeName]) \r\n\t\t&& (node = computeQuery.eval(this))) {\r\n\t\t\tif (_isFunction(node)) {\r\n\t\t\t\tnode = node(this.el, requestNodeName);\r\n\t\t\t\tif (!_isString(node) && !(node instanceof HTMLElement)) {\r\n\t\t\t\t\tthrow new Error('The callback for node \"' + requestNodeName + '\" returned an invalid type.');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (_isString(node)) {\r\n\t\t\t\t// Markup or plain selector string....\r\n\t\t\t\tnode = ChtmlCore.toElement(node);\r\n\t\t\t}\r\n\t\t\tif (!(node instanceof HTMLElement)) {\r\n\t\t\t\tthrow new Error('\"' + requestNodeName + '\" could not be resolved to a valid node instance.');\r\n\t\t\t}\r\n\t\t\treturn node;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from explicit model.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tgetExplicitNode(requestNodeName) {\r\n\t\t// If given a rolecase, we can perform a query if we understand the semantics.\r\n\t\tif ((this.$.roles && this.$.roles.length)\r\n\t\t|| (this.$.roles = (this.el.getAttribute(ChtmlCore.attributeMap.superrole) || '').replace('  ', ' ').split(' ')).length) {\r\n\t\t\tvar roles = this.$.params.rolecase ? [this.$.params.rolecase] : this.$.roles;\r\n\t\t\t// Find matches...\r\n\t\t\treturn roles.reduce((matchedNode, role) => {\r\n\t\t\t\tif (!matchedNode) {\r\n\t\t\t\t\tvar closestSuperSelector = '[' + CSS.escape(ChtmlCore.attributeMap.superrole) + '~=\"' + role + '\"]';\r\n\t\t\t\t\tvar nodeSelector = '[' + CSS.escape(ChtmlCore.attributeMap.subrole) + '~=\"' + role + '-' + requestNodeName + '\"]';\r\n\t\t\t\t\tvar closestSuper, _matchedNode;\r\n\t\t\t\t\tif ((_matchedNode = (this.el.shadowRoot || this.el).querySelector(nodeSelector))\r\n\t\t\t\t\t// If this.el has a shadowRoot, we don't expect _matchedNode to be able to find is superRole element.\r\n\t\t\t\t\t// If it finds one, then its not for the curren superRole element.\r\n\t\t\t\t\t&& ((this.el.shadowRoot && !(_matchedNode.parentNode.closest && _matchedNode.parentNode.closest(closestSuperSelector)))\r\n\t\t\t\t\t// _matchedNode must find this.el as its superRole element to qualify.\r\n\t\t\t\t\t\t|| (!this.el.shadowRoot && _matchedNode.parentNode && (closestSuper = _matchedNode.parentNode.closest(closestSuperSelector)) && closestSuper.isSameNode(this.el))\r\n\t\t\t\t\t)) {\r\n\t\t\t\t\t\tmatchedNode = _matchedNode;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn matchedNode;\r\n\t\t\t}, null);\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Attempts to resolve a node from implicit model.\r\n\t *\r\n\t * @param string\t\t\t\trequestNodeName\r\n\t *\r\n\t * @return HTMLElement|array\r\n\t */\r\n\tgetImplicitNode(requestNodeName) {\r\n\t\tif (requestNodeName.match(/[^a-zA-Z0-9\\-]/)) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Use schema...\r\n\t\tvar nodeSchema, nodeSelector = [];\r\n\t\tvar tries = [];\r\n\t\tif (ChtmlCore.schema.aria[requestNodeName]) {\r\n\t\t\ttries.push({\r\n\t\t\t\tschema: ChtmlCore.schema.aria[requestNodeName],\r\n\t\t\t\tselector: ['[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\ttries.push({\r\n\t\t\t\tschema: ChtmlCore.schema.std[requestNodeName] || ChtmlCore.schema.aria[requestNodeName],\r\n\t\t\t\tselector: [requestNodeName, '[role=\"' + requestNodeName + '\"]'],\r\n\t\t\t});\r\n\t\t}\r\n\t\t_each(ChtmlCore.schema.std, (tagname, schema) => {\r\n\t\t\tif (schema.implicitRole === requestNodeName) {\r\n\t\t\t\ttries.push({\r\n\t\t\t\t\tschema: schema,\r\n\t\t\t\t\tselector: [tagname],\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t});\r\n\t\tvar matches = null;\r\n\t\ttries.forEach(trie => {\r\n\t\t\t(this.el.shadowRoot || this.el).querySelectorAll(trie.selector.join(',')).forEach(node => {\r\n\t\t\t\tif (ChtmlCore.schema.assertNodeBelongsInScopeAs(this.el, node, trie.schema)) {\r\n\t\t\t\t\tif (trie.schema && trie.schema.singleton) {\r\n\t\t\t\t\t\tmatches = node;\r\n\t\t\t\t\t} else if (!matches || _isArray(matches)) {\r\n\t\t\t\t\t\tmatches = matches || [];\r\n\t\t\t\t\t\tmatches.push(node);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t});\r\n\t\treturn matches;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Makes a node object following the nodeCallback rules\r\n\t * for the instance.\r\n\t *\r\n\t * @param string|int\t nodeName\r\n\t * @param mixed\t\t\t node\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tcreateNode(nodeName, node) {\r\n\t\tvar _node = node;\r\n\t\tif (this.$.params.drilldown) {\r\n\t\t\tif (node === this.root || node === this.el) {\r\n\t\t\t\tnode = this;\r\n\t\t\t} else if (node) {\r\n\t\t\t\tif (!_isFunction(this.$.params.componentCallback)) {\r\n\t\t\t\t\tthrow new Error('The params.componentCallback function is required!');\r\n\t\t\t\t}\r\n\t\t\t\tvar params = _copy(this.$.params);\r\n\t\t\t\tparams.alias = nodeName;\r\n\t\t\t\tnode = _isArray(node) \r\n\t\t\t\t\t? node.map(node => this.$.params.componentCallback(node, params, true/*resolveInheritance*/)) \r\n\t\t\t\t\t: this.$.params.componentCallback(node, params, true/*resolveInheritance*/);\r\n\t\t\t}\r\n\t\t} else if (_isFunction(this.$.params.nodeCallback)) {\r\n\t\t\tnode = _isArray(node) \r\n\t\t\t\t? node.map(node => this.$.params.nodeCallback(node)) \r\n\t\t\t\t: this.$.params.nodeCallback(node);\r\n\t\t}\r\n\t\tthis.set(nodeName, node);\r\n\t\tif (_node && _node !== this.root && _node !== this.el && !_isArray(_node)) {\r\n\t\t\tChtmlCore.disconnectedCallback(_node, () => {\r\n\t\t\t\tthis.del(nodeName);\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn node;\r\n\t\t\r\n\t}\r\n\t\r\n\t/**\r\n\t * Finds a node by name; caches result.\r\n\t *\r\n\t * @param string \t\tnodeName\r\n\t *\r\n\t * @return mixed\r\n\t */\r\n\tget(nodeName) {\r\n\t\t// ----------------------\r\n\t\tvar asOwnMethod = this.asOwnMethod(nodeName);\r\n\t\tif (asOwnMethod) {\r\n\t\t\treturn asOwnMethod;\r\n\t\t}\r\n\t\t// ----------------------\r\n\t\tvar node;\r\n\t\tif (nodeName === '_') {\r\n\t\t\treturn this.getOffsetParent();\r\n\t\t}\r\n\t\tif ((nodeName === 'root' && (node = this.root)) \r\n\t\t|| (nodeName === 'el' && (node = this.el))) {\r\n\t\t\treturn _isFunction(this.$.params.nodeCallback) \r\n\t\t\t\t? this.$.params.nodeCallback(node) \r\n\t\t\t\t: node;\r\n\t\t}\r\n\t\tif (!(nodeName in this.$.state)) {\r\n\t\t\tif ((node = this.getRelatedNode(nodeName))\r\n\t\t\t|| (!this.$.params.implicitOnly && (node = this.getExplicitNode(nodeName)))\r\n\t\t\t|| (!this.$.params.explicitOnly && (node = this.getImplicitNode(nodeName)))) {\r\n\t\t\t\tthis.createNode(nodeName, node);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn this.$.state[nodeName];\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------\r\n\t * UTILITY METHODS\r\n\t * -------------------\r\n\t */\r\n\t\r\n\t/**\r\n\t * Parses an element's CHTML namespace.\r\n\t * This explains how an element's namespace is used in CHTML.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\t\tel\r\n\t *\r\n\t * @return object\r\n\t */\r\n\tstatic parseNamespace(el) {\r\n\t\tvar namespaceParse = {roadmap: el.getAttribute(ChtmlCore.attributeMap.ns)};\r\n\t\tif (namespaceParse.roadmap) {\r\n\t\t\tnamespaceParse.namespace = _before(namespaceParse.roadmap, '//');\r\n\t\t\tnamespaceParse.subnamespace = _after(namespaceParse.roadmap, '//');\r\n\t\t\t// In case this is the /// spot...\r\n\t\t\tif (namespaceParse.subnamespace.startsWith('/')) {\r\n\t\t\t\tnamespaceParse.subnamespace = _after(namespaceParse.subnamespace, '/');\r\n\t\t\t}\r\n\t\t\tif (namespaceParse.subnamespace.endsWith('//') && namespaceParse.subnamespace.indexOf('///') === -1) {\r\n\t\t\t\tnamespaceParse.subnamespace = namespaceParse.subnamespace + namespaceParse.namespace + '//';\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn namespaceParse;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Parses an element's CHTML definitions (related, bindings)\r\n\t * both from attributes and from an embedded script data block.\r\n\t *\r\n\t * Where both attributes and data block are set, definitions in attributes inherit from those in data block.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\t\tel\r\n\t *\r\n\t * @return DefSheet\r\n\t */\r\n\tstatic parseCascadedDefSheet(el) {\r\n\t\tvar dataBlockScript, defsheet;\r\n\t\tif (!(dataBlockScript = _arrFrom(el.children).filter(node => node.matches(ChtmlCore.elementMap.defsheet))[0])\r\n\t\t|| !(defsheet = DefSheet.parse((dataBlockScript.textContent || '').trim()))) {\r\n\t\t\tdefsheet = new DefSheet;\r\n\t\t}\r\n\t\tvar attr, defBlock;\r\n\t\tChtmlCore.paramsAttrs.forEach(type => {\r\n\t\t\tif ((attr = el.getAttribute(ChtmlCore.attributeMap[type])) && (defBlock = DefBlock.parse(attr))) {\r\n\t\t\t\tdefsheet.applyTo(type, defBlock);\r\n\t\t\t}\r\n\t\t});\r\n\t\treturn defsheet;\r\n\t}\r\n\t\t\r\n\t/**\r\n\t * Composes a component from a super component.\r\n\t *\r\n\t * All definitions (related, directives) will be inherited.\r\n\t * If the idea is to import, the super component's element will be returned,\r\n\t * (On import, nodes in component (as defined, if) will be uploaded into slots in the super component.)\r\n\t *\r\n\t * @param HTMLElement\t\t\t\telTo\r\n\t * @param HTMLElement\t\t\t\telFrom\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic recompose(elTo, elFrom) {\r\n\t\tif (elTo.matches(ChtmlCore.elementMap.import)) {\r\n\t\t\telFrom = elFrom.cloneNode(true);\r\n\t\t\tvar elToNs = elTo.getAttribute(ChtmlCore.attributeMap.ns);\r\n\t\t\tvar elFromNs = elFrom.getAttribute(ChtmlCore.attributeMap.ns);\r\n\t\t\tvar elFromRoles = (elFrom.getAttribute(ChtmlCore.attributeMap.superrole) || '').split(' ').map(r => r.trim());\r\n\t\t\t// -------------------------\r\n\t\t\t// So we concat() the role attribute\r\n\t\t\t// -------------------------\r\n\t\t\telFrom.setAttribute(ChtmlCore.attributeMap.ns, elToNs);\r\n\t\t\t// We will prepend defs from the elTo into elFrom\r\n\t\t\tChtmlCore.recomposeDefs(elFrom, elTo, 'append');\r\n\t\t\t// -------------------------\r\n\t\t\t// Upload nodes into elFrom just the way slots work in Web Compoonents\r\n\t\t\t// -------------------------\r\n\t\t\t_arrFrom((elTo.shadowRoot || elTo).children).forEach((replacementNode, i) => {\r\n\t\t\t\tif (replacementNode.matches(ChtmlCore.elementMap.defsheet)) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\treplacementNode = replacementNode.cloneNode(true);\r\n\t\t\t\tvar applicableContextRoles = [], applicableReplacementNodeRoles = [];\r\n\t\t\t\tvar replacementNodeRoles = (replacementNode.getAttribute(ChtmlCore.attributeMap.subrole) || '').split(' ').map(r => r.trim());\r\n\t\t\t\treplacementNodeRoles.forEach(replacementNodeRole => {\r\n\t\t\t\t\tvar _applicableContextRoles = elFromRoles.filter(contextRole => replacementNodeRole.startsWith(contextRole + '-'));\r\n\t\t\t\t\tif (_applicableContextRoles.length) {\r\n\t\t\t\t\t\tapplicableContextRoles.push(_applicableContextRoles[0]);\r\n\t\t\t\t\t\tapplicableReplacementNodeRoles.push(replacementNodeRole);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tif (applicableContextRoles.length) {\r\n\t\t\t\t\tvar slotNodes;\r\n\t\t\t\t\tvar contextSelector = applicableContextRoles.map(contextRole => '[' + CSS.escape(ChtmlCore.attributeMap.superrole) + '~=\"' + contextRole + '\"]');\r\n\t\t\t\t\tvar slotNodeSelector = applicableReplacementNodeRoles.map(replacementNodeRole => '[' + CSS.escape(ChtmlCore.attributeMap.subrole) + '~=\"' + replacementNodeRole + '\"]');\r\n\t\t\t\t\tif ((elFrom.shadowRoot && (slotNodes = elFrom.shadowRoot.querySelectorAll(slotNodeSelector)))\r\n\t\t\t\t\t|| ((slotNodes = elFrom.querySelectorAll(slotNodeSelector)).length === 1 && slotNodes[0].closest(contextSelector) === elFrom)) {\r\n\t\t\t\t\t\t// We will prepend defs from the slot node into replacement node\r\n\t\t\t\t\t\tChtmlCore.recomposeDefs(replacementNode, slotNodes[0], 'prepend');\r\n\t\t\t\t\t\t// Port to target...\r\n\t\t\t\t\t\tslotNodes[0].replaceWith(replacementNode);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthrow new Error('Composition Error: Node #' + i + ' (at ' + elToNs + ') must match exactly one targetNode in ' + elFromNs + '! (' + slotNodes.length + ' matched)');\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\telFrom.append(replacementNode);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\treturn elFrom;\r\n\t\t}\r\n\t\t// We will append defs from the elFrom into elTo\r\n\t\tChtmlCore.recomposeDefs(elTo, elFrom, 'prepend');\r\n\t\treturn elTo;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Composes definitions (related, directives) from elFrom into elTo.\r\n\t *\r\n\t * @param HTMLElement\t\t\t\telTo\r\n\t * @param HTMLElement\t\t\t\telFrom\r\n\t * @param string\t\t\t\t\tappendOrPrepend\r\n\t * @param array\t\t\t\t\t\tnorecompose\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic recomposeDefs(elTo, elFrom, appendOrPrepend, norecompose = []) {\r\n\t\tnorecompose = norecompose.concat([ChtmlCore.attributeMap.ns, ...ChtmlCore.attributeMap.nocompose]);\r\n\t\tif (elTo.hasAttribute('norecompose')) {\r\n\t\t\tnorecompose = norecompose.concat((elTo.getAttribute('norecompose') || '*').split(' ').map(val => val.trim()));\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// Custom Composition...\r\n\t\t// ----------------------------\r\n\t\tif (_isFunction(ChtmlCore.recomposeCallback)) {\r\n\t\t\tvar disposition = ChtmlCore.recomposeCallback(elTo, elFrom, appendOrPrepend, norecompose);\r\n\t\t\tif (disposition === false) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else if (_isString(disposition) || _isArray(disposition)) {\r\n\t\t\t\tnorecompose = norecompose.concat(disposition);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// Merge list attributes...\r\n\t\t// ----------------------------\r\n\t\t_unique([ChtmlCore.attributeMap.superrole, ChtmlCore.attributeMap.subrole, 'role', 'class']).forEach(type => {\r\n\t\t\tvar b_attr, a_attr;\r\n\t\t\tif (!norecompose.includes(type) && !norecompose.includes('*') && (b_attr = elFrom.getAttribute(type))) {\r\n\t\t\t\tif (a_attr = elTo.getAttribute(type)) {\r\n\t\t\t\t\tvar jointList = appendOrPrepend === 'prepend' ? [b_attr, a_attr] : [a_attr, b_attr];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar jointList = [b_attr];\r\n\t\t\t\t}\r\n\t\t\t\telTo.setAttribute(type, _unique(jointList.join(' ').split(' ').map(r => r.trim())).join(' '));\r\n\t\t\t\tnorecompose.push(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\t// ----------------------------\r\n\t\t// Merge definition attributes...\r\n\t\t// ----------------------------\r\n\t\tChtmlCore.paramsAttrs.map(attr => ChtmlCore.attributeMap[attr]).concat('style').forEach(type => {\r\n\t\t\tvar b_attr, a_attr;\r\n\t\t\tif (!norecompose.includes(type) && !norecompose.includes('*') && (b_attr = elFrom.getAttribute(type))) {\r\n\t\t\t\tif (a_attr = elTo.getAttribute(type)) {\r\n\t\t\t\t\tvar jointDefs = appendOrPrepend === 'prepend' ? [b_attr, a_attr] : [a_attr, b_attr];\r\n\t\t\t\t\tif (!jointDefs[0].trim().endsWith(';')) {\r\n\t\t\t\t\t\tjointDefs[0] = jointDefs[0] + ';';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar jointDefs = [b_attr];\r\n\t\t\t\t}\r\n\t\t\t\telTo.setAttribute(type, jointDefs.join(' '));\r\n\t\t\t\tnorecompose.push(type);\r\n\t\t\t}\r\n\t\t});\r\n\t\t// ----------------------------\r\n\t\t// Port all other attributes...\r\n\t\t// ----------------------------\r\n\t\tfor (var i = 0; i < elFrom.attributes.length; i ++) {\r\n\t\t\tvar attr = elFrom.attributes[i];\r\n\t\t\tif (!norecompose.includes(attr.name) && !norecompose.includes('*') && !elTo.hasAttribute(attr.name)) {\r\n\t\t\t\telTo.setAttribute(attr.name, attr.value);\r\n\t\t\t\tnorecompose.push(attr.name);\r\n\t\t\t}\r\n\t\t}\r\n\t\t// ----------------------------\r\n\t\t// For data blocks...\r\n\t\t// ----------------------------\r\n\t\tif (!norecompose.includes('@cps') && !norecompose.includes('*')) {\r\n\t\t\tvar elToDefs = _arrFrom((elTo.shadowRoot || elTo).children)\r\n\t\t\t\t.filter(node => node.matches(ChtmlCore.elementMap.defsheet));\r\n\t\t\tvar elFromDefs = _arrFrom((elFrom.shadowRoot || elFrom).children)\r\n\t\t\t\t.filter(node => node.matches(ChtmlCore.elementMap.defsheet));\r\n\t\t\tif (elFromDefs.length) {\r\n\t\t\t\tif (elToDefs.length) {\r\n\t\t\t\t\telToDefs[0][appendOrPrepend](elFromDefs[0].textContent);\r\n\t\t\t\t} else {\r\n\t\t\t\t\telTo.prepend(elFromDefs[0].cloneNode(true));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves markup or selector string to a DOM element.\r\n\t *\r\n\t * @param sting\t\t\t\t\t\tinput\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic toElement(input) {\r\n\t\tif (ChtmlCore.ctxt.document) {\r\n\t\t\tvar el;\r\n\t\t\tif (input.trim().startsWith('<')) {\r\n\t\t\t\t// Create a node from markup\r\n\t\t\t\tvar temp = ChtmlCore.ctxt.document.createElement('div');\r\n\t\t\t\ttemp.innerHtml = input;\r\n\t\t\t\tel = temp.firstChild;\r\n\t\t\t} else {\r\n\t\t\t\tel = ChtmlCore.ctxt.document.querySelector(input);\r\n\t\t\t}\r\n\t\t\treturn el;\r\n\t\t}\r\n\t}\r\n\t\r\n\t/**\r\n\t * Resolves markup or selector string to a DOM element.\r\n\t *\r\n\t * @param sting\t\t\t\t\t\tinput\r\n\t * @param function\t\t\t\t\tcallback\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tstatic disconnectedCallback(el, callback) {\r\n\t\tif (el.parentNode) {\r\n\t\t\tvar called = false;\r\n\t\t\tvar observer = new MutationObserver(mutations => {\r\n\t\t\t\tmutations.forEach(m => {\r\n\t\t\t\t\tif (!called && _arrFrom(m.removedNodes).includes(el)) {\r\n\t\t\t\t\t\tcalled = true;\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t\tobserver.observe(el.parentNode, {childList:true});\r\n\t\t\tChtmlCore.disconnectedCallback(el.parentNode, () => {\r\n\t\t\t\tif (!called) {\r\n\t\t\t\t\tcalled = true;\r\n\t\t\t\t\tcallback();\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.ctxt = {};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.schema = Schema;\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.elementMap = {\r\n\tdefsheet: 'script[type=\"text/jsen-p\"]',\r\n\tbundle: 'chtml-bundle',\r\n\timport: 'chtml-import',\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtmlCore.attributeMap = {\r\n\t// paramsAttrs\r\n\trelated: 'chtml-related',\r\n\tdirectives: 'chtml-directives',\r\n\t// structuralAttrs\r\n\tns: 'chtml-ns',\r\n\tsuperrole: 'chtml-role',\r\n\tsubrole: 'chtml-role',\r\n\t// other\r\n\tnocompose: ['nocompose', 'shadow',],\r\n};\r\n\r\n/**\r\n * @var array\r\n */\r\nChtmlCore.paramsAttrs = [\r\n\t'related', \r\n\t'directives',\r\n];\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default ChtmlCore;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _mixin from '@onephrase/commons/js/mixin.js';\r\nimport _isString from '@onephrase/commons/js/isString.js';\r\nimport _isNumber from '@onephrase/commons/js/isNumber.js';\r\nimport _isNumeric from '@onephrase/commons/js/isNumeric.js';\r\nimport _isFunction from '@onephrase/commons/js/isFunction.js';\r\nimport _isUndefined from '@onephrase/commons/js/isUndefined.js';\r\nimport _isObservable from '@onephrase/commons/js/isObservable.js';\r\nimport _getProxyTarget from '@onephrase/commons/js/getProxyTarget.js';\r\nimport _isProxy from '@onephrase/commons/js/isProxy.js';\r\nimport _all from '@onephrase/commons/arr/all.js';\r\nimport _following from '@onephrase/commons/arr/following.js';\r\nimport _before from '@onephrase/commons/str/before.js';\r\nimport _beforeLast from '@onephrase/commons/str/beforeLast.js';\r\nimport _closest from '@onephrase/commons/num/closest.js';\r\nimport _inherit from '@onephrase/commons/obj/inherit.js';\r\nimport ChtmlCore from './ChtmlCore.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The Chtml class\r\n push, observe bare class, return proxy if, \r\n * ---------------------------\r\n */\t\t\t\t\r\n\r\nconst Chtml = class extends ChtmlCore {\r\n\r\n\t/**\r\n\t * Constructs a new Chtml and optionally returns a proxy wrapper.\r\n\t *\r\n\t * @param document|HTMLElement\tel\r\n\t * @param object\t\t\t\tparams\r\n\t *\r\n\t * @return new Proxy\r\n\t */\r\n\tconstructor(el, params = {}) {\r\n\t\tsuper(el, _inherit({}, params, Chtml.params));\r\n\t\t// -----------------------------\r\n\t\t// OBSERVABILITY\r\n\t\t// -----------------------------\r\n\t\t// Bind populable context\r\n\t\tthis.observe(this.$.params.dataKey, (context, _context) => {\r\n\t\t\tif (this.$.ns.subnamespace && !_isString(context) && !_isNumber(context) && !_isUndefined(context)) {\r\n\t\t\t\t// Initial Sync...\r\n\t\t\t\tthis.populate(context, this.$.ns.subnamespace, this.$.params.itemCallback);\r\n\t\t\t\t// Reactive Sync?\r\n\t\t\t\tif (_isObservable(context)) {\r\n\t\t\t\t\tcontext.observe(changes => {\r\n\t\t\t\t\t\tthis.populate(context, this.$.ns.subnamespace, this.$.params.itemCallback, Object.keys(changes));\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a (reactive) context object or logical object to the instance.\r\n\t *\r\n\t * @param object \t\tcontext\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tbind(context) {\r\n\t\tthis.set(this.$.params.dataKey, context);\r\n\t\treturn this;\r\n\t}\r\n\t\r\n\t/**\r\n\t * Binds a (reactive) list context to the instance.\r\n\t * Childnodes will be automatically created/removed per key.\r\n\t *\r\n\t * @param array \t\tlistContext\r\n\t * @param string \t\tsubnamespace\r\n\t * @param function \t\titemCallback\r\n\t * @param array \t\tonlyKeys\r\n\t *\r\n\t * @return this\r\n\t */\r\n\tpopulate(listContext, subnamespace, itemCallback = null, onlyKeys = []) {\r\n\t\tif (_isObservable(listContext) && !_isProxy(listContext)) {\r\n\t\t\tlistContext = listContext.proxy();\r\n\t\t}\r\n\t\t(arguments.length > 3 ? onlyKeys : Object.keys(listContext)).forEach(k => {\r\n\t\t\tk = _isNumeric(k) ? parseInt(k) : k;\r\n\t\t\tvar item = this.has(k) ? this.get(k) : null;\r\n\t\t\tif (!_isUndefined(listContext[k])) {\r\n\t\t\t\tvar isNewItem = false;\r\n\t\t\t\tif (!item) {\r\n\t\t\t\t\tvar itemNamespaceArray = subnamespace.split('//');\r\n\t\t\t\t\t// Create a namespace hash...\r\n\t\t\t\t\titemNamespaceArray[0] += '/' + k;\r\n\t\t\t\t\tvar itemEl = Chtml.import(itemNamespaceArray.join('//'));\r\n\t\t\t\t\tif (itemEl) {\r\n\t\t\t\t\t\tvar following = _following(Object.keys(listContext), k + ''/*numeric k needs this*/, true/*length*/)\r\n\t\t\t\t\t\t\t.reduce((closest, _k) => closest || (this.has(_k) ? this.get(_k) : null), null);\r\n\t\t\t\t\t\tif (following) {\r\n\t\t\t\t\t\t\tfollowing.el.before(itemEl);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\tthis.el.append(itemEl);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\titem = this.createNode(k, itemEl);\r\n\t\t\t\t\t\tisNewItem = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (item) {\r\n\t\t\t\t\tif (_isFunction(itemCallback)) {\r\n\t\t\t\t\t\titemCallback(item, listContext[k], k, isNewItem);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.bind(listContext[k]);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else if (item) {\r\n\t\t\t\tif (_isFunction(itemCallback)) {\r\n\t\t\t\t\tvar unbindReturn = itemCallback(item, false, k);\r\n\t\t\t\t\tif (('Promise' in ChtmlCore.ctxt) && unbindReturn instanceof ChtmlCore.ctxt.Promise) {\r\n\t\t\t\t\t\tunbindReturn.then(() => {\r\n\t\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t\t}).catch(() => {\r\n\t\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\titem.el.remove();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\titem.free();\r\n\t\t\t\t\titem.el.remove();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t/**\r\n\t * -------------------\r\n\t * INSTANCE-RELATED METHODS\r\n\t * -------------------\r\n\t */\r\n\r\n\t/**\r\n\t * Creates a Chtml over a root resolved from definition or markup string.\r\n\t *\r\n\t * @param string|document|HTMLElement\tinput\r\n\t * @param object\t\t\t\t\t\tparams\r\n\t * @param bool\t\t\t\t\t\t\tresolveInheritance\r\n\t * @param object\t\t\t\t\t\tStatic\r\n\t *\r\n\t * @return Chtml\r\n\t */\r\n\tstatic from(input, params = {}, resolveInheritance = true, Static = Chtml) {\r\n\t\t// -----------------------------\r\n\t\t// Resolve element from input\r\n\t\t// -----------------------------\r\n\t\tvar el = input;\r\n\t\tif (_isString(input) && !input.trim().startsWith('<') && input.indexOf('/') !== -1) {\r\n\t\t\tif (!ChtmlCore.bundles || !(el = Chtml.import(_before(input, '//')))) {\r\n\t\t\t\tthrow new Error('No element found on the namespace \"' + input + '\"!');\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (_isString(input)) {\r\n\t\t\t\tif (!(el = ChtmlCore.toElement(input))) {\r\n\t\t\t\t\tthrow new Error('Could not resolve the string \"' +input + '\" to an element!');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (resolveInheritance && ChtmlCore.bundles) {\r\n\t\t\t\tvar ns, superNs, superEl, isImport = el.matches(ChtmlCore.elementMap.import);\r\n\t\t\t\tif ((ns = _before(el.getAttribute(ChtmlCore.attributeMap.ns) || '', '//'))\r\n\t\t\t\t// The entire namespace is used for elements of type import.\r\n\t\t\t\t// The supernamespace is used for normal elements\r\n\t\t\t\t&& ((isImport && (superNs = ns)) || (superNs = _beforeLast(ns, '/')) && superNs.indexOf('/') > -1)\r\n\t\t\t\t&& (superEl = Chtml.import(superNs))) {\r\n\t\t\t\t\tvar _el = el;\r\n\t\t\t\t\tel = ChtmlCore.recompose(el, superEl);\r\n\t\t\t\t\tif (isImport) {\r\n\t\t\t\t\t\t_el.replaceWith(el);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (ns) {\r\n\t\t\t\t\tconsole.warn('Namespace resolution failed: ' + ns);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn new Static(el, params);\r\n\t}\r\n\t\r\n\t/**\r\n\t * Imports a module from bundles.\r\n\t *\r\n\t * @param string\t\t\t\t\t\tnamespace\r\n\t *\r\n\t * @return HTMLElement\r\n\t */\r\n\tstatic import(namespace) {\r\n\t\treturn ChtmlCore.bundles.find(namespace);\r\n\t}\r\n};\r\n\r\n/**\r\n * @var object\r\n */\r\nChtml.params = {\r\n\tdiff: true,\r\n\tdataKey: '$',\r\n\tdrilldown: false,\r\n\tnodeCallback: null,\r\n\tcomponentCallback: Chtml.from,\r\n\tobserveOnly: false,\r\n}\r\n\r\n/**\r\n * @exports\r\n */\r\nexport default Chtml;\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _isUndefined from '../js/isUndefined.js';\r\n\r\n/**\r\n * 1. Returns the ENTRY following (either the FIRST or the LAST instance of) the reference.\r\n * 2. Returns A NUMBER OF ENTRIES counting forwards from (either the FIRST or the LAST instance of) the given reference.\r\n *\r\n * @param array \tarr\r\n * @param mixed\t \treference\r\n * @param int|bool \tlength\r\n * @param bool\t \trotate\r\n * @param bool\t \tlastReference\r\n *\r\n * @return mixed|array\r\n */\r\nexport default function(arr, reference, length = false, rotate = false, lastReference = false) {\r\n\tif (arr.indexOf(reference) === -1) {\r\n\t\treturn length ? [] : undefined;\r\n\t}\r\n\tvar amount = length === true ? arr.length - 1 : (length === false ? 1 : length);\r\n\tvar from = lastReference ? arr.lastIndexOf(reference) + 1 : arr.indexOf(reference) + 1;\r\n\tvar after = !_isUndefined(reference) ? arr.slice(from, from + amount) : [];\r\n\tif (rotate && after.length < amount && after.length < arr.length) {\r\n\t\tafter = after.concat(arr.slice(0, amount - after.length));\r\n\t};\r\n\treturn length ? after : after[0];\r\n};\r\n","\r\n/**\r\n * @imports\r\n */\r\nimport _before from '@onephrase/commons/str/before.js';\r\nimport _arrFrom from '@onephrase/commons/arr/from.js';\r\nimport Schema from './Schema.js';\r\nimport Matrix from './Def/Matrix.js';\r\nimport ChtmlCore from './ChtmlCore.js';\r\nimport Chtml from './Chtml.js';\r\n\r\n/**\r\n * ---------------------------\r\n * The client-build entry\r\n * ---------------------------\r\n */\r\n\r\n/**\r\n * Configure CHTM with\r\n * a global document.\r\n */\r\nChtmlCore.ctxt = window;\r\n\r\n/**\r\n * Create a \"ready\" construct that\r\n * init-related functionality can leverage.\r\n */\r\nvar contentLoadedPromise = new Promise(resolve => {\r\n\tif (document.readyState === 'complete') {\r\n\t\tresolve(); return;\r\n\t}\r\n\tdocument.addEventListener('DOMContentLoaded', resolve, false);\r\n\twindow.addEventListener('load', resolve, false);\r\n});\r\n// ------------------------------------\r\nChtmlCore.ready = (callback, waitForBundles = true) => {\r\n\tcontentLoadedPromise.then(() => {\r\n\t\tif (!waitForBundles) {\r\n\t\t\tcallback(); return;\r\n\t\t}\r\n\t\tChtmlCore.initObj.loadingBundlesPromise.then(callback);\r\n\t});\r\n};\r\n\r\n/**\r\n * Create an initialization object that all\r\n * init-related functionality can build on.\r\n */\r\ncontentLoadedPromise.then(() => {\r\n\t// ------------------------------------\r\n\tChtmlCore.initObj = (() => {\r\n\t\tvar bundles = _arrFrom(document.querySelectorAll('template[is=\"' + ChtmlCore.elementMap.bundle + '\"]')).reverse();\r\n\t\tvar remoteBundles = bundles.filter(b => b.hasAttribute('src') && !b.content.children.length);\r\n\t\tvar loadingBundles = remoteBundles.map(b => new Promise(resolve => {\r\n\t\t\tb.addEventListener('bundleloadsuccess', resolve);\r\n\t\t\tb.addEventListener('bundleloaderror', resolve);\r\n\t\t}));\r\n\t\tvar loadingBundlesPromise = Promise.all(loadingBundles).then(() => {\r\n\t\t\tloadingBundles.splice(0);\r\n\t\t});\r\n\t\treturn {\r\n\t\t\tcontentLoadedPromise,\r\n\t\t\tloadingBundlesPromise,\r\n\t\t\tbundles,\r\n\t\t\tremoteBundles,\r\n\t\t\tloadingBundles\r\n\t\t};\r\n\t})();\r\n\t// ------------------------------------\r\n\t// Configure CHTM with bundle sources.\r\n\t// ------------------------------------\r\n\tvar warnedEarlyBundleAccess;\r\n\tvar anticyclicBundlesQuery = [];\r\n\tChtmlCore.bundles = new Matrix(ChtmlCore.initObj.bundles/*sources*/, []/*namespace*/, (bundle, namespace, superEl, bundleIndex) => {\r\n\t\tif (ChtmlCore.initObj.loadingBundles.length && !warnedEarlyBundleAccess) {\r\n\t\t\twarnedEarlyBundleAccess = true;\r\n\t\t\tconsole.warn('Remote bundles are still loading at this time! You should probabbly wrap bundle-dependent code within Chtml.ready(callback[, true/*waitForBundles*/]).');\r\n\t\t}\r\n\t\tvar _namespace = namespace.join('/');\r\n\t\tif (anticyclicBundlesQuery.includes(_namespace)) {\r\n\t\t\treturn ChtmlCore.bundles.find(namespace.slice(0, -1).join('/'));\r\n\t\t}\r\n\t\tanticyclicBundlesQuery.push(_namespace);\r\n\t\tvar el = bundle.content.querySelector('[' + CSS.escape(ChtmlCore.attributeMap.ns) + '=\"' + _namespace + '\"]');\r\n\t\tif (el && superEl) {\r\n\t\t\ttry {\r\n\t\t\t\tvar norecompose = [];\r\n\t\t\t\tif (bundle.hasAttribute('norecompose')) {\r\n\t\t\t\t\tnorecompose = (bundle.getAttribute('norecompose') || '*').split(' ').map(val => val.trim());\r\n\t\t\t\t}\r\n\t\t\t\tel = ChtmlCore.recompose(el, superEl, 'prepend', norecompose);\r\n\t\t\t} catch(e) {\r\n\t\t\t\tconsole.error('[Inheritance error at source #' + bundleIndex + ']: ' + e.message);\r\n\t\t\t}\r\n\t\t\tanticyclicBundlesQuery.pop();\r\n\t\t\treturn el;\r\n\t\t}\r\n\t\tanticyclicBundlesQuery.pop();\r\n\t\treturn el ? el.cloneNode(true) \r\n\t\t\t: (superEl ? superEl.cloneNode(true) : null);\r\n\t}/*getter*/);\r\n});\r\n\t\t\t\r\n/**\r\n * Define the customized built-in template element\r\n * that supports remote content.\r\n */\r\ncustomElements.define(ChtmlCore.elementMap.bundle, class extends HTMLTemplateElement {\r\n\r\n\t/**\r\n\t * This handles both triggers remote loading\r\n\t * when so defined.\r\n\t *\r\n\t * @param string\tname\r\n\t * @param string\toldValue\r\n\t * @param string\tnewValue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tattributeChangedCallback(name, oldValue, newValue) {\r\n\t\tif (newValue) {\r\n\t\t\tthis.load();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempt to load remote content if so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tload() {\r\n\t\tvar src = this.getAttribute('src');\r\n\t\tif (src && this.content.children.length) {\r\n\t\t\tconsole.warn('A CHTML bundle must define only either a remote content or local content! Bundle ignored.');\r\n\t\t} else if (src) {\r\n\t\t\tfetch(src).then(response => {\r\n\t\t\t\treturn response.ok ? response.text() : Promise.reject(response.statusText);\r\n\t\t\t}).then(content => {\r\n\t\t\t\tthis.innerHTML = content;\r\n\t\t\t\t// Dispatch the event.\r\n\t\t\t\tthis.dispatchEvent(new Event('bundleloadsuccess'));\r\n\t\t\t}).catch(error => {\r\n\t\t\t\t// Dispatch the event.\r\n\t\t\t\tconsole.warn('Error fetching the bundle at ' + src + '. (' + error + ')');\r\n\t\t\t\tthis.dispatchEvent(new Event('bundleloaderror'));\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * The attributes we want to observe.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tstatic get observedAttributes() {\r\n\t\treturn ['src'];\r\n\t}\r\n}, {extends: 'template'});\r\n\t\t\t\r\n/**\r\n * Define the custom import element\r\n */\r\ncustomElements.define(ChtmlCore.elementMap.import, class extends HTMLElement {\r\n\r\n\t/**\r\n\t * Tests if conditions are right to resolve the import.\r\n\t *\r\n\t * @return bool\r\n\t */\r\n\tshouldResolve() {\r\n\t\treturn !this.hasAttribute('ondemand')\r\n\t\t\t&& !this.closest('template')\r\n\t\t\t&& !this.closest(ChtmlCore.elementMap.import + '[ondemand]');\r\n\t}\r\n\r\n\t/**\r\n\t * This triggers self-replacement\r\n\t * when so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tconnectedCallback() {\r\n\t\tthis.processed = false;\r\n\t\tif (this.shouldResolve()) {\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * This triggers self-replacement\r\n\t * when so defined.\r\n\t *\r\n\t * @param string\tname\r\n\t * @param string\toldValue\r\n\t * @param string\tnewValue\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tattributeChangedCallback(name, oldValue, newValue) {\r\n\t\tif (this.shouldResolve()) {\r\n\t\t\tthis.resolve();\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * Attempt self-replacement if so defined.\r\n\t *\r\n\t * @return void\r\n\t */\r\n\tresolve() {\r\n\t\tChtml.ready(() => {\r\n\t\t\tif (!this.parentNode) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tvar replacement, namespace, namespaceAttr = ChtmlCore.attributeMap.ns;\r\n\t\t\tif ((namespace = _before(this.getAttribute(namespaceAttr) || '', '//'))\r\n\t\t\t&& (namespace !== this.__namespace)) {\r\n\t\t\t\tthis.__namespace = namespace;\r\n\t\t\t\tif (!(replacement = Chtml.import(namespace))) {\r\n\t\t\t\t\tthis.innnerText = 'No element found on the namespace \"' + namespace + '\"!';\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar resolved = ChtmlCore.recompose(this, replacement);\r\n\t\t\t\t\tif (this.hasAttribute('shadow')) {\r\n\t\t\t\t\t\tif (!this.parentNode.shadowRoot) {\r\n\t\t\t\t\t\t\tthis.parentNode.attachShadow({mode: 'open'});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.parentNode.shadowRoot.append(resolved);\r\n\t\t\t\t\t\tthis.remove();\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.replaceWith(resolved);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * The attributes we want to observe.\r\n\t *\r\n\t * @return array\r\n\t */\r\n\tstatic get observedAttributes() {\r\n\t\treturn ['ondemand', ChtmlCore.attributeMap.ns];\r\n\t}\r\n});\r\n\r\n/**\r\n * @exports\r\n */\r\nexport {\r\n\tChtmlCore,\r\n\tSchema,\r\n\tMatrix\r\n};\r\nexport default Chtml;","\r\n/**\r\n * @imports\r\n */\r\nimport Chtml from './index.js';\r\n\r\n// As globals\r\nif (!window.OnePhrase) {\r\n\twindow.OnePhrase = {};\r\n}\r\nwindow.OnePhrase.Chtml = Chtml;\r\n"],"sourceRoot":""}