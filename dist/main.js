!function(e){var t={};function r(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,r),s.l=!0,s.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)r.d(n,s,function(t){return e[t]}.bind(null,s));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t,r){"use strict";r.r(t);var n=function(e){return Array.isArray(e)},s=function(e){return"string"==typeof e},i=function(e){return arguments.length&&(void 0===e||void 0===e)},a=function(e){return null===e||""===e},o=function(e){return Array.isArray(e)||"object"==typeof e},l=function(e){return!Array.isArray(e)&&"object"==typeof e&&e},p=function(e,t=!0){return n(e)?e:!t&&l(e)?[e]:!1!==e&&0!==e&&function(e){return a(e)||i(e)||!1===e||0===e||o(e)&&!Object.keys(e).length}(e)?[]:function(e){return!s(e)&&!i(e.length)}(e)?Array.prototype.slice.call(e):l(e)?Object.values(e):[e]},h=function(e,t,r=!1){for(var n=e.indexOf(t);n>-1&&(r||!1===r);)e.splice(n,1),r>0&&r--,n=e.indexOf(t);return e},c=function(e,t){if(!e)return!1;if(e instanceof t)return!0;var r=e=>{for(;e&&e!==Function.prototype;){if(e===t||e.prototypes&&e.prototypes.reduce((e,n)=>e||n===t||r(n),!1))return!0;e=Object.getPrototypeOf(e)}return!1};return r(e.constructor)},u=function(e){return"number"==typeof e},d=function(e){return function(e){return"function"==typeof e}(e)||e&&"[object function]"==={}.toString.call(e)},g=function(e){return l(e)&&Object.getPrototypeOf(e)===Object.prototype},m=function(e){return!0===e||!1===e},f=function(e){return!0!==e&&!1!==e&&null!==e&&""!==e&&!isNaN(1*e)},v=function(e,t){var r=void 0;return o(e)&&Object.keys(e).forEach((n,s)=>{!1!==r&&(r=t(f(n)?parseFloat(n):n,e[n],s))}),r};const b=function(e,t,r=!0,s=1){if(n(e)&&n(t)&&e.length!==t.length)return!r;if(l(e)&&l(t)){var i=Object.keys(e),a=Object.keys(t);if(!i.length&&!a.length)return g(e)&&g(t)?r:e===t===r;if(!b(i,a))return!r}if(s>0&&(n(e)&&n(t)||l(e)&&l(t))){var p=function(e,t,r=!0,s=!0,i=!1,a=!1){if(n(e)&&n(t)){var p=[],h=!0;return e.forEach(e=>{if(h){var c=!1;v(t,(t,i)=>{(!c||s&&o(e))&&(c=r(e,i),(n(c)&&!c.length||l(c)&&!Object.keys(c).length)&&(c=!1),o(c)&&s&&(e=c))}),o(c)?p.push(s?c:e):m(c)?i&&!c||!i&&c?p.push(e):a&&(h=!1):p.push(c)}}),p}if(l(e)&&l(t)){p={},h=!0;return Object.keys(e).forEach(c=>{if(h){var u=r(e[c],t[c]);(n(u)&&!u.length||l(u)&&!Object.keys(u).length)&&(u=!1),o(u)?p[c]=s?u:e[c]:m(u)?i&&!u||!i&&u?p[c]=e[c]:a&&(h=!1):p[c]=u}}),p}}(e,t,(e,t)=>b(e,t,r,s-1),!1,!1,!0);return n(p)?p.length===e.length&&p.length===t.length:l(p)&&l(e)?Object.keys(p).length===Object.keys(e).length&&Object.keys(p).length===Object.keys(t).length:p}return d(r)?r(e,t):u(e)&&u(t)&&isNaN(e)&&isNaN(t)?r:e===t===r};var y=b,w=class{even(e){return!(!l(e)||e.jsenType!==this.jsenType)&&y(e,this)}inherit(e){return this}withComments(e){return this.meta||(this.meta={}),this.meta.comments=e,this}withVars(e){return this.meta||(this.meta={}),this.meta.vars=e,this}};const x=class extends w{};Object.defineProperty(x.prototype,"jsenType",{get:()=>"Reference"});var j=x;const E=class extends w{};Object.defineProperty(E.prototype,"jsenType",{get:()=>"CallExpression"});var O=E;const S=class{static parse(e,t,r={},s=S){if(r.meta||(r.meta={vars:[]}),e.length){for(var i=Object.values(t||s.grammars),a=0;a<i.length;a++){var o=r.meta&&n(r.meta.vars)?r.meta.vars.length:0,l=i[a].parse(e,(e,t)=>S.parse(e,t,r,s));if(l&&r.meta&&(l.meta||(l.meta={}),l.meta.vars=r.meta.vars.slice(o),(c(l,j)||c(l,O))&&(h(l.meta.vars,l.context),h(r.meta.vars,l.context),r.meta.vars.push(l))),l&&n(r.explain)&&r.explain.push(e+" >>-------------\x3e> "+l.jsenType),l)return l}if(!1===r.assert)return;throw new Error("[Syntax error:] "+e)}}};var k=S;const C=function(e,t=1,r=!0){return!f(t)||t<=0?e:(!n(e)&&l(e)&&r&&(e=Object.values(e)),n(e)?e.reduce((e,s)=>n(s)||l(s)&&r?e.concat(C(n(s)?s:Object.values(s),t-1,r)):e.concat(s),[]):e)};var T=C,P=function(e,t=1){var r=0;e.forEach(e=>{r++});var n=e.slice(e.length-r,t);return arguments.length>1?n:n[0]},R=function(e,t=1){return arguments.length>1?P(e.slice().reverse(),t).reverse():P(e.slice().reverse())},A=function(e,...t){return t.forEach(t=>{e.indexOf(t)<0&&e.push(t)}),e},F=function(e,t){var r=[];return function(e,t){t=(t=t||Object.prototype)&&!n(t)?[t]:t;var r=[];for(e=e;e&&(!t||t.indexOf(e)<0)&&"default"!==e.name;)r.push(e),e=e?Object.getPrototypeOf(e):null;return r}(e,t).forEach(e=>{A(r,...Object.getOwnPropertyNames(e))}),r};function M(e,t,r=!1,s=!1,i=!0){var a=0,p=e.shift();if((f(p)||!0===p||!1===p)&&(a=p,p=e.shift()),!e.length)throw new Error("_merge() requires two or more array/objects.");return e.forEach((e,h)=>{(o(e)||d(e))&&(r?F(e):Object.getOwnPropertyNames(e)).forEach(o=>{var c=p[o],u=e[o];if((n(c)&&n(u)||l(c)&&l(u))&&(!0===a||a>0))p[o]=n(c)&&n(u)?[]:{},M([f(a)?a-1:a,p[o],c,u],t,r,s,i);else if(t(o,p,e,h))if(n(p)&&n(e))s?p[o]=u:p.push(u);else try{i?Object.defineProperty(p,o,Object.getOwnPropertyDescriptor(e,o)):p[o]=e[o]}catch(e){}})}),p}var $=function(...e){return M(e,(e,t,r)=>!0,!1,!1,!1)},N=function(e,t=[]){return M([{},e],(e,r,s)=>{if(!d(s[e]))return d(t)?t(e):!n(t)||!t.length||t.indexOf(e)>-1},!1,!1,!1)};const _=class{static lex(e,t,r){if(!s(e))throw new Error("Argument1 must be a string!");var n=new _(e,r);return _.$cache[e]=_.$cache[e]||[],_.$cache[e].push(n),n.lex(t)}static split(e,t,r){return _.lex(e,t,r).tokens}static match(e,t,r){return _.lex(e,t,r).matches}constructor(e,t){if(!s(e))throw new Error("Lexer requires the first argument to be a string.");this.$str=e,this.$options=t||{},this.$options.blocks||(this.$options.blocks=_.$blocks),this.$options.quotes||(this.$options.quotes=_.$quotes),this.$options.comments||(this.$options.comments=_.$comments),this.$cache=[]}lex(e,t){var r={delims:p(e),options:$(!0,{},this.$options,t||{}),nesting:[],maxDepth:0,comments:[],tokens:[],matches:[],matchesi:{}};if(!1!==r.options.cache)for(var n=0;n<this.$cache.length;n++)if(y(this.$cache[n].delims,r.delims)&&y(this.$cache[n].options,r.options))return N(this.$cache[n]);if(this._evalCharsAt(r,0),r.nesting.length)throw new Error("Error parsing the string: "+this.$str+". Unterminated blocks: "+T(r.nesting).join(", "));return!1!==r.options.cache&&this.$cache.push(r),r}_evalCharsAt(e,t){if(!(t>=this.$str.length)){var r=1,n={},s={},i={};if(e.openComment||(s=this._testQuotes(e,t)),e.openQuote||(n=this._testComments(e,t)),e.openComment||n.ending)if(e.nesting.length||i.ending)this._push(e,this.$str[t]);else r=(o=n.starting||n.ending||this.$str[t]).length,this._push(e,o,"comments"),e.options.preserveComments&&this._push(e,o);else if(e.openQuote||s.ending)this._push(e,this.$str[t]);else{if(e.options.limit&&e.matches.length===e.options.limit)return this._push(e,this.$str[t]),this._evalCharsAt(e,t+1);i=this._testNesting(e,t);i=this._testNesting(e,t);var a=this._testChars(e.options.stopChars||[],e,t);if(!e.nesting.length&&!1!==a)return e.options.stopChar=a,void(e.options.stopCharForward=this.$str.substr(t));if(e.delims.length)if(e.nesting.length||i.ending){var o;r=(o=i.starting||i.ending||this.$str[t]).length,this._push(e,o)}else{this._push(e,"");var l=this._testChars(e.delims,e,t);if(!1!==l&&(e.matches.push(l),e.matchesi[t]=l,r=l.length||1,!e.options.preserveDelims))return this._evalCharsAt(e,t+(l.length||1));this._push(e,l||this.$str[t])}else 2===e.nesting.length&&i.starting?(e.matches.push(null),this._push(e,i.starting),r=i.starting.length):!e.nesting.length&&i.ending?(this._push(e,i.ending),r=i.ending.length,e.matches.push(null)):this._push(e,this.$str[t])}return this._evalCharsAt(e,t+r)}}_testQuotes(e,t){var r={};return(e.options.quotes||[]).forEach(n=>{this.$str.substr(t,1)===n&&(e.openQuote?n===e.openQuote&&(e.openQuote=!1,r.ending=n):(e.openQuote=n,r.starting=n))}),r}_testComments(e,t){var r={};return(e.options.comments||[]).forEach(n=>{if(e.openComment){if(R(n)===R(e.openComment)){var s;(s=this.$str.substr(t).match(new RegExp("^"+R(n))))&&(e.openComment=!1,r.ending=s[0])}}else(s=this.$str.substr(t).match(new RegExp("^"+P(n))))&&(e.openComment=n,r.starting=s[0])}),r}_testNesting(e,t){var r={};return(e.options.blocks||[]).forEach(n=>{var s=this.$str.substr(t).match(new RegExp("^"+P(n)));if(s)e.nesting=e.nesting.concat([n]),r.starting=s[0];else if(e.nesting.length&&R(n)===R(R(e.nesting))){var i=this.$str.substr(t).match(new RegExp("^"+R(n)));i&&(e.nesting=e.nesting.slice(0,-1),r.ending=i[0])}}),e.maxDepth=Math.max(e.maxDepth,e.nesting.length),r}_testChars(e,t,r){for(var n=0;n<e.length;n++){var s=e[n];if(t.options.useRegex){var i=this.$str.substr(r).match(new RegExp("^"+s,!0!==t.options.useRegex?t.options.useRegex:""));if(i)return i[0]}if(!t.options.ci&&this.$str.substr(r,s.length)===s||t.options.ci&&this.$str.substr(r,s.length).toLowerCase()===s.toLowerCase())return s}return!1}_push(e,t,r="tokens"){var n=e.matches.length;i(e[r][n])&&(e[r][n]=""),e[r][n]+=t}split(e,t,r){return this.lex(t,r).tokens}match(e,t,r){return this.lex(t,r).matches}regParse(e,t){return this.lex(e,$({useRegex:!0},t||{}))}regSplit(e,t){return this.regParse(e,t).tokens}regMatch(e,t){return this.regParse(e,t).matches}};_.$blocks=[["\\(","\\)"],["\\[","\\]"],["\\{","\\}"]],_.$quotes=['"',"'","`"],_.$comments=[["\\/\\*","\\*\\/"],["\\/\\/","(\\r)?\\n"]],_.$cache={};var D=_;class q extends Array{get(e,t={},r=!0){for(var n=0;n<this.length;n++){var s;if(!i(this[n]))return s=t.get?t.get(this[n],e):this[n][e],d(s)&&r?s.bind(this[n]):s}}set(e,t,r={}){const n=(e,t,r,n)=>n.set?n.set(e,t,r):(e[t]=r,!0);for(var s=0;s<this.length;s++)if(!i(this[s])&&W(this[s],e,r))return n(this[s],e,t,r);return!(!o(this[0])||!this[0])&&n(this[0],e,t,r)}del(e,t={}){for(var r=0;r<this.length;r++)if(!i(this[r])&&W(this[r],e,t))return t.deleteProperty||t.del?(t.deleteProperty||t.del)(this[r],e):(delete this[r][e],!0)}has(e,t,r={}){for(var n=0;n<this.length;n++)if(!i(this[n])&&W(this[n],e,r)){var s=r.get?r.get(this[n],e):this[n][e];return W(s,t,r)}throw new Error('"'+e+'" is undefined!')}exec(e,t,r={}){for(var n=0;n<this.length;n++)if(!i(this[n])&&W(this[n],e,r)){var s=r.get?r.get(this[n],e):this[n][e];if(!d(s)){if(r.exec)return r.exec(this[n],e,t);throw new Error('"'+e+'" is not a function! (Called on type: '+typeof this[n]+".)")}return r.apply?r.apply(s,this[n],t):s.apply(this[n],t)}if(r.execUnknown)return r.execUnknown(this,e,t);throw new Error('"'+e+'" is undefined! (Called on types: '+this.map(e=>typeof e).join(", ")+".)")}static create(e){return e instanceof q?e:e?new q(e):new q}}const W=(e,t,r)=>r.has?r.has(e,t):o(e)&&e?t in e:!i(e[t]);var L=function(e,t,r){return e.startsWith(t)&&e.endsWith(r)},I=function(e,t,r=!1){if(""==t)return e;var n=r?e.lastIndexOf(t):e.indexOf(t);return-1===n?"":e.substr(n+t.length)},B=function(e,t,r=!1){if(""==t)return e;var n=r?e.lastIndexOf(t):e.indexOf(t);return-1===n?e:e.substr(0,n)},H=function(e,t){return B(e,t,!0)},Q=function(e,t,r){return H(I(e,t),r)};const U=class extends w{};Object.defineProperty(U.prototype,"jsenType",{get:()=>"Abstraction"});var K=U;const z=class extends K{constructor(e){super(),this.expr=e}eval(e=null,t={}){return this.expr.eval(e,t)}toString(e=null){return"("+this.expr.toString(e)+")"}static parse(e,t,r=z){if(L(e,"(",")")&&!D.match(e,[" "]).length)return new r(t(Q(e,"(",")")))}};var J=z;const V=class extends w{};Object.defineProperty(V.prototype,"jsenType",{get:()=>"ArrayType"});var Y=V;const Z=class extends Y{constructor(e){super(),this.exprs=e||[]}inherit(e){if(e instanceof Y){var t=e.exprs.filter(e=>this.exprs.reduce((t,r)=>t&&!e.even(r),!0));this.exprs=t.concat(this.exprs)}return this}eval(e=null,t={}){return this.exprs.map(r=>r.eval(e,t))}toString(e=null){return"["+this.exprs.map(t=>t.toString(e)).join(", ")+"]"}static parse(e,t,r=Z){if(L(e,"[","]")&&!D.match(e.trim(),[" "]).length)return new r(D.split(Q(e,"[","]"),[","]).map(e=>e.trim()).filter(e=>e).map(e=>t(e)))}};var G=Z;const X=class extends w{};Object.defineProperty(X.prototype,"jsenType",{get:()=>"Arguments"});var ee=X;const te=class extends ee{constructor(e=[]){super(),this.list=e}eval(e=null,t={}){return this.list.map(r=>r.eval(e,t))}toString(e=null){return"("+this.list.map(t=>t.toString(e)).join(", ")+")"}static parse(e,t,r=te){if(e=e.trim(),L(e,"(",")")&&!D.match(e,[" "]).length)return new r(D.split(Q(e,"(",")"),[","]).map(e=>t(e.trim())))}};var re=te,ne=function(e){return e.filter((e,t,r)=>r.indexOf(e)===t)};const se=class extends w{};Object.defineProperty(se.prototype,"jsenType",{get:()=>"AssertionExpression"});var ie=se;const ae=class extends ie{constructor(e,t){super(),this.exprs=e,this.logic=t}eval(e=null,t={}){if("!"===this.logic)return!P(this.exprs).eval(e,t);T(ae.operators);for(var r=(this.logic||"").trim().toUpperCase(),n=r===(ae.operators.or||"").trim().toUpperCase(),s=r===(ae.operators.nor||"").trim().toUpperCase(),i=r===(ae.operators.and||"").trim().toUpperCase(),a=r===(ae.operators.nand||"").trim().toUpperCase(),o=!0,l=0,p=0;p<this.exprs.length;p++){if(o=this.exprs[p].eval(e,t),i&&!o)return!1;if(a&&!o)return!0;if(n&&o)return o;l+=o?1:0}return n?o:i||a?i:s&&0===l}toString(e=null){return"!"===this.logic?"!"+P(this.exprs).toString(e):this.exprs.map(t=>t.toString(e)).join(" "+this.logic+" ")}static parse(e,t,r=ae){if(e.startsWith("!"))return new r([t(e.substr(1))],"!");var n=D.lex(e,T(r.operators));if(n.tokens.length>1){var s=ne(n.matches);if(s.length>1)throw new Error('"AND" and "OR" logic cannot be asserted in the same expression: '+e+"!");return new r(n.tokens.map(e=>t(e.trim())),P(s))}}};ae.operators={and:"&&",or:"||"};var oe=ae;const le=class extends w{};Object.defineProperty(le.prototype,"jsenType",{get:()=>"AssignmentExpression"});var pe=le;const he=class extends pe{constructor(e,t,r="="){super(),this.reference=e,this.val=t,this.operator=r}eval(e=null,t={}){var r=this.reference.getEval(e,t),n=this.val.eval(e,t);if(!i(r.context)&&!i(r.name))return q.create(r.context).set(r.name,n,t);throw new Error('"'+this+'" is undefined!')}toString(e=null){return[this.reference.toString(e),this.operator,this.val.toString(e)].join(" ")}static parse(e,t,r=he){var n=D.lex(e,r.operators);if(2===n.tokens.length){var s,i;if(!((s=t(n.tokens.shift().trim()))instanceof j&&(i=t(n.tokens.shift().trim()))))throw new Error("Invalid assignment expression: "+e);return new r(s,i,n.matches[0].trim())}}};he.operators=[" = "];var ce=he;const ue=class extends w{};Object.defineProperty(ue.prototype,"jsenType",{get:()=>"BooleanType"});var de=ue;const ge=class extends de{constructor(e){super(),this.state=e}eval(){return"true"===this.state.toLowerCase().trim()}toString(){return this.state}static parse(e,t,r=ge){if("true"===(e=e.toLowerCase().trim())||"false"===e)return new r(e)}};var me=ge;const fe=class extends O{constructor(e,t){super(),this.reference=e,this.args=t}eval(e=null,t={}){var r=this.reference.getEval(e,t),n=this.args.eval(e,t);if(!i(r.context)&&!i(r.name))return q.create(r.context).exec(r.name,n,t);throw new Error('"'+this+'" is undefined!')}toString(e=null){return this.reference.toString(e)+this.args.toString(e)}static parse(e,t,r=fe){if(!e.startsWith("(")&&e.endsWith(")")&&!D.match(e,[" "]).length){var n,s=D.split(e,[]),i=s.pop();if(!((n=t(s.join("")))instanceof j&&(i=t(i,[re]))))throw new Error("Invalid call directive: "+e);return new r(n,i)}}};var ve=fe;const be=class extends w{};Object.defineProperty(be.prototype,"jsenType",{get:()=>"Comments"});var ye=be;const we=class extends ye{constructor(e,t){super(),this.comments=e,this.type=t}eval(e=null,t={}){}toString(e=null){return""}static parse(e,t,r=we){var n=null,s=null,i=0,a="before";if(e.startsWith("//"))n=(o=D.split(I(e,"//"),["\r\n"])).shift().trim(),s=o.shift().trim(),i=1;else if(e.startsWith("/*")){n=(o=D.split(I(e,"/*"),["*/"])).shift().trim(),s=o.shift().trim(),i=2}else if(e.endsWith("*/")){var o;n=(o=D.split(_beforeLast(e,"*/"),["/*"])).pop().trim(),s=o.pop().trim(),i=2;a="after"}if(i&&(2===i&&(n=D.split(n.trim(),["\r\n"]).map(e=>e.replace(/^[\*]+/,"")).filter(e=>e.trim())),console.log(n,a,e),n=new r(n,i)),s)return(s=t(s)).meta.commenta=n,s}};var xe=we;const je=class extends w{};Object.defineProperty(je.prototype,"jsenType",{get:()=>"ComparisonExpression"});var Ee=je;const Oe=class extends Ee{constructor(e,t,r){super(),this.operand1=e,this.operand2=t,this.operator=r}eval(e=null,t={}){return Oe.compare(this.operand1.eval(e,t),this.operand2.eval(e,t),this.operator)}toString(e=null){return[this.operand1.toString(e),this.operator,this.operand2.toString(e)].join(" ")}static parse(e,t,r=Oe){var n=T(r.operators).map(e=>" "+e+" "),s=D.lex(e,n);if(s.tokens.length>1){if(s.tokens.length>2)throw new Error('Malformed "Comparison" expression: '+e+"!");return new r(t(P(s.tokens).trim()),t(R(s.tokens).trim()),s.matches[0].trim())}}static compare(e,t,r="=="){if(-1===T(Oe.operators).indexOf(r))throw new Error('The operator "'+r+'" is not recognized.');switch(r){case"===":return e===t;case"==":case"=":return e==t;case">":return e>t;case"<":return e<t;case">=":return e>=t;case"<=":return e<=t;case"!=":return e!=t;case"!==":return e!==t;case"^=":return s(e)&&e.startsWith(t);case"$=":return s(e)&&e.endsWith(t);case"*=":return!(!n(t)&&!s(t))&&e.indexOf(t)>-1;case"~=":return s(e)&&s(t)&&(" "+e+" ").indexOf(" "+t+" ")>-1;case">=<":if(!n(t)||2!==t.length)throw new Error("A 'Between' comparison requires argument 2 to be an array of exactly 2 values.");return e>=t[0]&&e<=t[1];case"/**/":return t.match(new RegExp(e));default:return!1}}static diff(e,t,r){return!Oe.compare(e,t,r?"===":"==")}};Oe.operators={exact:{is:"===",isNull:"===",equalsTo:"==",strictlyNotEqualsTo:"!==",notEqualsTo:"!="},relative:{lesserThan:"<",greaterThan:">",lesserThanOrEqualsTo:"<=",greaterThanOrEqualsTo:">=",between:">=<"},partial:{startsWith:"^=",endsWith:"$=",contains:"*=",any:"~=",in:"~=",matches:"/**/"}};var Se=Oe;const ke=class extends w{};Object.defineProperty(ke.prototype,"jsenType",{get:()=>"ConditionExpression"});var Ce=ke;const Te=class extends Ce{constructor(e,t,r){super(),this.assertion=e,this.onTrue=t,this.onFalse=r}eval(e=null,t={}){return this.assertion.eval(e,t)?this.onTrue.eval(e,t):this.onFalse.eval(e,t)}toString(e=null){return[this.assertion.toString(e),Te.operators[0],this.onTrue.toString(e),Te.operators[1],this.onFalse.toString(e)].join(" ")}static parse(e,t,r=Te){var n=D.split(e,r.operators);if(n.length>1){if(2===n.length)throw new Error("Malformed ternary expression: "+e+"!");return new r(t(n[0].trim()),t(n[1].trim()),t(n[2].trim()))}}};Te.operators=["?",":"];var Pe=Te;const Re=class extends w{};Object.defineProperty(Re.prototype,"jsenType",{get:()=>"DeleteExpression"});var Ae=Re;const Fe=class extends Ae{constructor(e,t="delete"){super(),this.reference=e,this.operator=t}eval(e=null,t={}){var r=this.reference.getEval(e,t);if(!i(r.context)&&!i(r.name))return q.create(r.context).del(r.name,t);throw new Error('"'+this+'" is undefined!')}toString(e=null){return this.operator+" "+this.reference.toString(e)}static parse(e,t,r=Fe){var n=D.lex(e,Object.values(r.operators));if(1===n.matches.length&&e.startsWith(n.matches[0]+" ")){var s;if(!((s=t(n.tokens.pop().trim()))instanceof j))throw new Error("Invalid delete directive: "+e);return new r(s,n.matches[0].trim())}}};Fe.operators={red:"reduce",del:"delete"};var Me=Fe,$e=function(e,t=[]){var r=0;return f(arguments[0])&&o(arguments[1])&&(r=arguments[0],e=arguments[1],t=arguments[2]||[]),M([r,{},e],(e,r,s)=>d(t)?t(e):!n(t)||!t.length||t.indexOf(e)>-1,!1,!1,!0)};const Ne=class extends w{};Object.defineProperty(Ne.prototype,"jsenType",{get:()=>"FunctionType"});var _e=Ne;const De=class extends _e{constructor(e,t,r={}){super(),this.paramters=e||{},this.statements=t,this.arrowFunctionFormatting=r}inherit(e){if(e instanceof _e){for(var t=Object.keys(e.paramters),r=Object.keys(this.paramters),n=0;n<Math.max(r.length,t.length);n++){var s=t[n],i=r[n];if(!i&&s)throw new Error("Parameter #"+n+" ("+s+") in parent function must be implemented.");if(i&&s){var a=e.paramters[s],o=this.paramters[i];if(o&&!a)throw new Error("Parameter #"+n+" ("+i+") must not have a default value as established in parent function.");if(o&&a&&o.jsenType!==a.jsenType)throw new Error("Default value for parameter #"+n+" ("+i+") must be of type "+a.jsenType+" as established in parent function.")}}this.sup=e}return this}eval(e=null,t={}){return(...r)=>{var n={};v(Object.keys(this.paramters),(s,i)=>{var a=this.paramters[i];if(r.length-1<s&&!a)throw new Error('The parameter "'+i+'" is required.');n[i]=r.length>s?r[s]:this.paramters[i]?this.paramters[i].eval(e,t):null});var s=q.create(n).concat(q.create(e));return this.statements.eval(s,t)}}toString(e=null){var t=[];if(v(this.paramters,(r,n)=>{t.push(r+(n?"="+n.toString(e):""))}),this.arrowFunctionFormatting){var r=!1===this.arrowFunctionFormatting.head||1===t.length&&-1===t[0].indexOf("="),n=!1===this.arrowFunctionFormatting.body;return(r?t[0]:"("+t.join(", ")+")")+" => "+(n?this.statements.toString(e):"{"+this.statements.toString(e)+"}")}return"function ("+t.join(", ")+") {"+this.statements.toString(e)+"}"}static parse(e,t,r=De){var n;if((e=e.trim()).startsWith("function")&&(n=D.split(e,[]).slice(1).filter(e=>e.trim()))&&2===n.length)var s=!1,i=Q(n.shift().trim(),"(",")"),a=Q(n.shift().trim(),"{","}");else{if(e.startsWith("function")||!(n=D.split(e,["=>"]))||2!==n.length)return;i=n.shift().trim(),a=n.shift().trim(),s={};L(i,"(",")")?i=Q(i,"(",")"):s.head=!1,L(a,"{","}")?a=Q(a,"{","}"):s.body=!1}var o={};D.split(i,[","]).forEach(e=>{var r=e.split("=");r[1]?o[r[0].trim()]=t(r[1].trim()):o[e.trim()]=null});var l=t(a);return new r(o,l,s)}};De.operators=["=>"];var qe=De,We=function(e,t,r=null){return n(t)?e.filter(e=>r?t.filter(t=>r(e,t)).length:-1!==t.indexOf(e)):[]};const Le=class extends w{};Object.defineProperty(Le.prototype,"jsenType",{get:()=>"MathExpression"});var Ie=Le;const Be=class extends Ie{constructor(e,t){super(),this.val=e,this.exprs=t}eval(e=null,t={}){return this.exprs.reduce((r,n)=>{var s=n.val.eval(e,t),i=n.operator.trim();if(!(f(r)&&f(s)||"+"===i))throw new Error("Invalid Math expression: "+this.toString()+"!");switch(i){case"+":return r+s;case"-":return r-s;case"*":return r*s;case"/":return r/s}},this.val.eval(e,t))}toString(e=null){return[this.val.toString(e)].concat(this.exprs.map(t=>t.operator+" "+t.val.toString(e))).join(" ")}static parse(e,t,r=Be){var n=D.lex(e,T(r.operators));if(n.tokens.length>1&&n.matches.length===n.tokens.length-1){var s=ne(n.matches);if(We(s,Be.operators.sup).length&&We(s,Be.operators.sub).length)throw new Error('"Addition/subtraction" and "multiplication/division" operators cannot be used in the same expression: '+e+"!");return new r(t(n.tokens.shift().trim()),n.tokens.map((e,r)=>({operator:n.matches[r],val:t(e.trim())})))}}};Be.operators={sup:["*","/"],sub:[" + "," - "]};var He=Be;const Qe=class extends w{};Object.defineProperty(Qe.prototype,"jsenType",{get:()=>"NumberType"});var Ue=Qe;const Ke=class extends Ue{constructor(e,t=0){super(),this.int=e,this.dec=t}eval(){return parseFloat(this.int+(this.dec?"."+this.dec:null))}toString(e=null){return this.int+(this.dec?"."+this.dec:null)}static parse(e,t,r=Ke){if(f(e)){e=e.split(".");return new r(parseInt(e.shift()),parseInt(e.shift()))}}};var ze=Ke;const Je=class extends w{};Object.defineProperty(Je.prototype,"jsenType",{get:()=>"ObjectType"});var Ve=Je;const Ye=class extends Ve{constructor(e){super(),this.entries=e||{}}inherit(e){return e instanceof Ve&&v(e.entries,(e,t)=>{e in this.entries||(this.entries[e]=t)}),this}eval(e=null,t={}){var r={};return v(this.entries,(n,s)=>{r[n]=s.eval(e,t)}),r}toString(e=null){var t=[];return v(this.entries,(r,n)=>{t.push(r+Ye.operators.sub+n.toString(e))}),"{"+t.join(Ye.operators.sup)+"}"}static parse(e,t,r=Ye){if(L(e,"{","}")&&!D.match(e.trim(),[" "]).length){var n={},s=D.split(Q(e,"{","}"),[Ye.operators.sup]).map(e=>e.trim()).filter(e=>e);return v(s,(e,r)=>{var s=D.split(r,[Ye.operators.sub],{limit:1});n[P(s).trim()]=t(R(s).trim())}),new r(n)}}};Ye.operators={sup:",",sub:":"};var Ze=Ye;const Ge=class extends w{};Object.defineProperty(Ge.prototype,"jsenType",{get:()=>"PresenceOperator"});var Xe=Ge;const et=class extends Xe{constructor(e,t,r="in"){super(),this.prop=e,this.reference=t,this.operator=r}eval(e=null,t={}){var r=this.reference.getEval(e,t),n=this.prop.eval(e,t);if(!i(r.context)&&!i(r.name))return q.create(r.context).has(r.name,n,t);throw new Error('"'+this+'" is undefined!')}toString(e=null){return[this.prop.toString(e),this.operator,this.reference.toString(e)].join(" ")}static parse(e,t,r=et){var n=D.lex(e,r.operators);if(2===n.tokens.length){var s,i;if(!((s=t(n.tokens.shift().trim()))&&(i=t(n.tokens.shift().trim()))instanceof j))throw new Error("Invalid presence check expression: "+e);return new r(s,i,n.matches[0].trim())}}};et.operators=[" in "];var tt=et;const rt=class extends j{constructor(e,t,r=!1){super(),this.context=e,this.name=t,this.backticks=r}getEval(e=null,t={}){var r=e,n=this.name;return this.context&&(n instanceof w&&(n=n.eval(e,t)),r=this.context.eval(e,t)),{context:r,name:n}}eval(e=null,t={}){var r=this.getEval(e,t);if(!i(r.context)&&!i(r.name))return q.create(r.context).get(r.name,t);throw new Error('"'+this+'" is undefined!')}toString(e=null){var t=this.name;if(this.context){var r=this.context.toString(e);t instanceof w?t="["+t.toString(e)+"]":this.backticks&&(t="`"+t+"`")}else{r=e;this.backticks&&(t="`"+t+"`")}return(r||"")+(r&&!t.startsWith("[")?rt.separator:"")+t}static parse(e,t,r=rt){if(!D.match(e.trim(),[" "]).length){var n,s,i=D.split(e,[]),a=i.pop(),o=D.split(a.trim(),[r.separator],{preserveDelims:!0});if(o.length>1&&(a=o.pop().substr(1),i=i.concat(o)),L(a,"`","`")&&(a=Q(a,"`","`"),s=!0),i.length&&((n=t(i.join(""))).isContext=!0),L(a,"[","]")){if(!n)throw new Error("Invalid reference: "+e+"!");a=t(Q(a,"[","]"))}return new r(n,a,s)}}};rt.separator=".";var nt=rt;const st=class extends w{};Object.defineProperty(st.prototype,"jsenType",{get:()=>"ReturnDirective"});var it=st;const at=class extends it{constructor(e){super(),this.expr=e}eval(e=null,t={}){return this.expr?this.expr.eval(e,t):void 0}toString(e=null){return this.expr?"return "+this.expr.toString(e):"return"}static parse(e,t,r=at){var n=e.toLowerCase();if(n.startsWith("return ")||"return"===n)return new r(t(e.substr(6).trim()))}};var ot=at;const lt=class extends w{};Object.defineProperty(lt.prototype,"jsenType",{get:()=>"Statements"});var pt=lt;const ht=class extends pt{constructor(e,t){super(),this.stmts=e,this.delim=t}eval(e=null,t={}){for(var r=[],n=0;n<this.stmts.length;n++){if(this.stmts[n]instanceof it)return this.stmts[n].eval(e,t);r[n]=this.stmts[n].eval(e,t)}return r}toString(e=null){return this.stmts.map(t=>t.toString(e)).join(this.delim)}static parse(e,t,r=ht){var n=D.lex(e,T(r.operators));if(n.tokens.length>1)return new r(n.tokens.map(e=>t(e)),n.matches[0].trim())}};ht.operators=[";","\r\n"];var ct=ht;const ut=class extends w{};Object.defineProperty(ut.prototype,"jsenType",{get:()=>"StringType"});var dt=ut;const gt=class extends dt{constructor(e,t){super(),this.expr=e,this.quote=t}eval(){return this.expr}toString(){return this.quote+this.expr+this.quote}static parse(e,t,r=gt){if(e=e.trim(),(L(e,'"','"')||L(e,"'","'"))&&!D.match(e,[" "]).length){var n=L(e,'"','"')?'"':"'";return new r(Q(e,n,n),n)}}};var mt=gt;k.grammars={Comments:xe,Return:ot,Statements:ct,Deletion:Me,Assignment:ce,Presence:tt,Func:qe,Abstraction:J,Condition:Pe,Assertion:oe,Comparison:Se,Math:He,Arr:G,Obj:Ze,Num:ze,Str:mt,Bool:me,Call:ve,Reference:nt};var ft=k,vt=function(e,t=null){var r={};return 2===arguments.length&&(s(e)?r[e]=t:n(e)&&n(t)&&e.forEach((e,n)=>r[e]=t[n])),r},bt=class{constructor(e,t={}){this.$={},this.$.target=e,this.$.details=t,v(t,(e,t)=>{"$"!==e&&Object.defineProperty(this,e,{value:t})})}get target(){return this.$.target}get details(){return this.$.details}},yt=class extends bt{constructor(e,t={}){super(e,t)}},wt=class{disconnect(){this.disconnected=!0}},xt=class{constructor(){this.fireables=[],this.currentlyFiringEvents=[]}addFireable(e){return this.fireables.push(e),e}removeFireable(e,t=[]){this.fireables=this.fireables.filter(t=>t!==e)}findFireables(e){return this.fireables.filter(t=>!(e.handler&&t.handler!==e.handler||e.params&&(e.params.type&&t.params.type!==e.params.type||e.params.tags&&We(t.params.tags||[],e.params.tags).length!==e.params.tags.length)))}static createForTarget(e,t,r){var n;if(e&&o(e))return(n=e[jt])||(n={},Object.defineProperty(e,jt,{get:()=>n,set:e=>{if(e!==n)throw new Error('Attempt to overwrite the "'+jt+'" special property!')},enumerable:!1})),n[t]=new r,n[t]}static getForTarget(e,t){var r;if(e&&o(e)&&(r=e[jt]))return r[t]}};const jt="< r e f l e c t >";var Et=class extends wt{constructor(e,t={}){super(),this.handler=e,this.params=t}fire(e,t,r){return this.disconnected||this.params.type&&this.params.type!==e.type?t(...p(arguments).slice(2)):this.handler(e.target,r,t,e)}};class Ot extends xt{fire(e,t=null){if(this.currentlyFiringEvents.filter(t=>t.type===e.type&&t.query===e.query).length)return t?t():void 0;this.currentlyFiringEvents.push(e);const r=(n,...s)=>{var i=this.fireables[n];return i?i.fire(e,(...e)=>r(n+1,...e),...s):t?t(...s):s[0]};var n=r(0);return this.currentlyFiringEvents.pop(),n}static createForTarget(e){return super.createForTarget(e,"traps",Ot)}static getForTarget(e){return super.getForTarget(e,"traps")}}var St=class extends bt{constructor(e,t={}){if(t.data&&(t.fields=Object.keys(t.data)),super(e,t),this.srcEvt){this.dataEven=this.srcEvt.dataEven,this.originatingTarget=this.srcEvt.originatingTarget,this.originatingType=this.srcEvt.originatingType,this.originatingFields=[],this.originatingData={},this._originatingData={};var r=this.fields[0];Object.keys(this.srcEvt.originatingData).forEach(e=>{var t=r+"."+e;this.originatingFields.push(t),this.originatingData[t]=this.srcEvt.originatingData[e],this._originatingData[t]=this.srcEvt._originatingData[e]}),this.originatingCreated=this.srcEvt.originatingCreated,this.originatingDeleted=this.srcEvt.originatingDeleted}else this.dataEven=y(this.data,this._data,!0,2),this.originatingTarget=this.target,this.originatingType=this.type,this.originatingFields=this.fields,this.originatingData=this.data,this._originatingData=this._data,this.originatingCreated=this.created,this.originatingDeleted=this.deleted;this.$.propagationStopped=!1,this.$.defaultPrevented=!1,this.$.promisesInstance=null,this.$.promises=[]}stopPropagation(){this.$.propagationStopped=!0}get propagationStopped(){return this.$.propagationStopped}preventDefault(){this.$.defaultPrevented=!0}get defaultPrevented(){return this.$.defaultPrevented}promise(e){if(!(e instanceof Promise))throw new Error("Event.promise() must be called with a Promise.");this.$.promises.push(e),this.$.promisesInstance=null}get promises(){return!this.$.promisesInstance&&this.$.promises.length&&(this.$.promisesInstance=Promise.all(this.$.promises)),this.$.promisesInstance}response(e){var t,r=l(e)&&!i(e.propagationStopped)&&!i(e.defaultPrevented);!1===e||r&&e.propagationStopped?this.stopPropagation():!1===e||r&&e.defaultPrevented?this.preventDefault():(e instanceof Promise&&(t=e)||r&&(t=e.promises))&&this.promise(t)}};class kt extends xt{findFireables(e){return super.findFireables(e).filter(t=>a(e.fields)||i(e.fields)||y(p(t.fields),p(e.fields)))}fire(e){return this.currentlyFiringEvents.filter(t=>t.type===e.type&&t.fields===e.fields).length?e:(this.currentlyFiringEvents.push(e),this.fireables.forEach(t=>{e.propagationStopped||t.params.type&&t.params.type!==e.type||t.fire(e)}),this.currentlyFiringEvents.pop(),e)}static createForTarget(e){return super.createForTarget(e,"observers",kt)}static getForTarget(e){return super.getForTarget(e,"observers")}}var Ct=function(e,t,r=null,n={}){if(!e||!o(e))throw new Error("Object must be of type object!");var s;(d(t)||a(t)||i(t))&&(n=arguments.length>2?r:{},r=t,t=null),(s=kt.getForTarget(e))&&s.findFireables({handler:r,fields:t,params:n}).forEach(e=>{s.removeFireable(e)})},Tt=function(e,t,r){Ct(r,null,{tags:["#e-bubbling",e]})},Pt=function(e){return typeof e},Rt=function(e,t,r={},n={}){t=p(t).slice();for(var s=e;!i(s)&&!a(s)&&t.length;){var l=t.shift();if(!(r.get?r.get(s,l):o(s)?l in s:s[l]))return void(n.exists=!1);s=r.get?r.get(s,l):s[l]}return n.exists=!0,s},At=class extends wt{constructor(e,t=null,r={}){if(super(),this.handler=e,this.fields=t,this.params=r,this.fieldsArray=p(this.fields),this.isDynamicField=this.fieldsArray.filter(e=>e.indexOf("..")>-1||e.startsWith(".")||e.endsWith(".")).length,this.isDynamicField&&this.fieldsArray.length>1)throw new Error('Only one "Dynamic Field" must be observed at a time! "'+this.fieldsArray.join(", ")+'" have been bound together.')}fire(e){this.disconnected||this.params.type&&this.params.type!==e.type||e.dataEven&&!1!==this.params.diff||this.fireCallback(e,t=>{if(t){var r=[],i=[];return t.forEach(t=>{var n=e.originatingFields.reduce((r,n)=>{var s=e.originatingData[n],i=e._originatingData[n];if(!r&&t===n)return[s,i];if(!r&&(t+".").startsWith(n+".")){var a=I(t,n+".");return[Rt(s,a.split("."),{get:Nt}),Rt(i,a.split("."),{get:Nt})]}return r},null);if(n)r.push(n.shift()),i.push(n.shift());else{var a=Rt(e.target,s(t)?t.split("."):t,{get:Nt});r.push(a),i.push(a)}}),n(this.fields)?e.response(this.handler(r,i,e)):e.response(this.handler(r[0],i[0],e))}r={},i={};return e.fields.forEach(t=>{var n=t in e.data?e.data[t]:Nt(e.target,t),s=t in e._data?e._data[t]:n;r[t]=n,i[t]=s}),e.response(this.handler(r,i,e))})}fireCallback(e,t){if(this.fieldsArray.length){var r=[];this.fieldsArray.filter((t,n)=>(r[n]=[],e.originatingFields.filter(e=>{var s=e.split("."),i=this.isDynamicField?t.split(".").map((e,t)=>e||s[t]||"").join("."):t;return A(r[n],i),(i===e||!1!==this.params.observeUp&&(i+".").startsWith(e+".")||this.params.observeDown&&(e+".").startsWith(i+"."))&&(!this.isDynamicField||!i.split(".").filter(e=>!e).length)}).length)).length&&(n=r,n.reduce((e,t)=>{var r=[];return e.forEach(e=>{p(t).forEach(t=>{var n=e.slice();n.push(t),r.push(n)})}),r},[[]])).forEach(t)}else(e.fields===e.originatingFields||this.params.observeDown)&&t();var n}},Ft=function(e,t,r=null,n={}){if(!e||!o(e))throw new Error("Object must be of type object!");if(d(t)&&(n=arguments.length>2?r:{},r=t,t=null),!d(r))throw new Error('Callback must be a function; "'+Pt(r)+'" given!');var s;return(s=kt.getForTarget(e))||(s=kt.createForTarget(e)),s.addFireable(new At(r,t,n))},Mt=function(e,t,r){var n;Ft(r,(s,i,a)=>{if(n=kt.getForTarget(e)){var o=vt(t,r);return n.fire(new St(e,{type:a.type,bubbling:!0,data:o,_data:o,srcEvt:a}))}},{observeDown:!0,tags:["#e-bubbling",e]})},$t=function(e,t,r=[],s=!1){var i=e.map((e,t)=>{if(!e||!o(e))throw new Error("Target must be of type object!");return{target:e,targetCopy:$e(e,r),setData:{},_setData:{},delData:{},_delData:{},created:[],deleted:[]}}),a=t(...e);return i.map(e=>{var t,i,a=Object.keys(e.targetCopy),l=Object.keys(e.target),p=ne(a.concat(l)).filter(t=>{if(!(r.length&&!r.includes(t)||n(e.target)&&("length"===t||"< r e f l e c t >"===t)))return l.includes(t)?(e._setData[t]=e.targetCopy[t],e.setData[t]=e.target[t],a.includes(t)||e.created.push(t)):(e._delData[t]=e.targetCopy[t],e.delData[t]=void 0,e.deleted.push(t)),e.targetCopy[t]!==e.target[t]?(e.targetCopy[t]&&o(e.targetCopy[t])&&Tt(e.target,0,e.targetCopy[t]),e.target[t]&&o(e.target[t])&&Mt(e.target,t,e.target[t]),!0):void 0});return(s||(i=kt.getForTarget(e.target)))&&(t=new St(e.target,{type:"transaction",data:$(e.setData,e.delData),_data:$(e._setData,e._delData),created:e.created,deleted:e.deleted}),i&&(Object.keys(e.delData).length&&t.response(i.fire(new St(e.target,{type:"del",data:e.delData,_data:e._delData,deleted:e.deleted}))),Object.keys(e.setData).length&&t.response(i.fire(new St(e.target,{type:"set",data:e.setData,_data:e._setData,created:e.created}))))),s?t:p}),a},Nt=function(e,t){if(!e||!o(e))throw new Error("Target must be of type object!");var r,s,i=function(r){return arguments.length?r:n(t)?vt(t,e):e[t]};return r=(s=Ot.getForTarget(e))?s.fire(new yt(e,{type:"get",query:t}),i):i(),n(e)&&!f(t)&&d(r)?function(...t){return $t([e],()=>r.apply(e,t))}:r},_t=function(e,t){return e.reduce((e,r)=>e&&t(r),!0)},Dt=function(e,t){if(!e||!o(e))throw new Error("Target must be of type object!");var r,n=function(r){return arguments.length?r:t in e};return(r=Ot.getForTarget(e))?r.fire(new yt(e,{type:"has",query:t}),n):n()},qt=function(e,t,r,i=null,a=!1){if(!t||!o(t))throw new Error("Target must be of type object!");var h,c,d=r,g={},m={},f=[],v=(r,n)=>{var s;g[r]=t[r],Dt(t,r)||f.push(r),e&&(n=(s=n||{}).value);var i,a,l=function(e){return arguments.length?e:(s?Object.defineProperty(t,r,s):t[r]=n,!0)};if(a=Ot.getForTarget(t)){var p=s?{type:"define",query:r,descriptor:s}:{type:"set",query:r,value:n};i=a.fire(new yt(t,p),l)}else i=l();return i&&(m[r]=n,m[r]!==g[r]&&(g[r]&&o(g[r])&&Tt(t,0,g[r]),m[r]&&o(m[r])&&Mt(t,r,m[r]))),i},b=[];return n(d)||(s(d)||u(d))&&(d=p(d))?b=d.map(e=>v(e,i)):l(r)&&(b=Object.keys(r).map(e=>v(e,r[e])),arguments.length>2&&(a=i)),(a||(c=kt.getForTarget(t)))&&(h=new St(t,{type:"set",data:m,_data:g,created:f}),c&&Object.keys(m).length&&c.fire(h)),a?h:_t(b,e=>e)},Wt=function(e,t,r=null,n=!1){return qt(!1,...arguments)},Lt=function(e,t){p(t).forEach(t=>{var r,n,s=e[t],i=Object.getOwnPropertyDescriptor(e,t)||{enumerable:!(t in e)};"value"in i&&delete i.value,"writable"in i&&delete i.writable,i.get=()=>{if(r)return s;r=!0;var n=Nt(e,t);return r=!1,n},i.set=r=>{if(n)return s=r,!0;n=!0;Wt(e,t,r);return n=!1,!0},Object.defineProperty(e,t,i)})},It=function(e,t){if(!t||!o(t))throw new Error("Target must be of type object!");var r,n=function(r){return arguments.length?r:e?Object.getOwnPropertyNames(t):Object.keys(t)};return(r=Ot.getForTarget(t))?r.fire(new yt(t,{type:e?"ownKeys":"keys"}),n):n()},Bt=function(e){return It(!1,...arguments)};var Ht=function(e,t,r=null,n=!1){return qt(!0,...arguments)},Qt=function(e,t,r=!1){if(!e||!o(e))throw new Error("Target must be of type object!");t=p(t);var n,s,i={},a={},l=[],h=t.map(t=>{i[t]=e[t],Dt(e,t)&&l.push(t);var r,n,s=function(r){return arguments.length?r:(delete e[t],!0)};return(r=(n=Ot.getForTarget(e))?n.fire(new yt(e,{type:"del",query:t}),s):s())&&(a[t]=void 0,i[t]&&o(i[t])&&Tt(e,0,i[t])),r});return(r||(s=kt.getForTarget(e)))&&(n=new St(e,{type:"del",data:a,_data:i,deleted:l}),s&&Object.keys(a).length&&s.fire(n)),r?n:_t(h,e=>e)};var Ut={build:function e(t,r=!1){if(!t||!o(t))throw new Error("Target must be of type object!");var n=Bt(t);n.forEach(n=>{var s=Nt(t,n);o(s)&&s&&(Mt(t,n,s),e(s,r))}),r&&Lt(t,n)},observe:Ft,unobserve:Ct,trap:function(e,t,r={}){if(!e||!o(e))throw new Error("Object must be of type object!");if(!d(t))throw new Error('Callback must be a function; "'+Pt(t)+'" given!');var n;return(n=Ot.getForTarget(e))||(n=Ot.createForTarget(e)),n.addFireable(new Et(t,r))},untrap:function(e,t,r={}){if(!e||!o(e))throw new Error("Object must be of type object!");var n;(n=kt.getForTarget(e))&&n.findFireables({handler:t,params:r}).forEach(e=>{n.removeFireable(e)})},def:Ht,defineProperty:Ht,set:Wt,del:Qt,deleteProperty:Qt,connect:Mt,disconnect:Tt,transaction:$t,get:Nt,has:Dt,init:Lt,keys:Bt,ownKeys:function(e){return It(!0,...arguments)},MutationEvent:St,QueryEvent:yt},Kt={env:"server",context:{},factory:null,attrMap:{model:"chtml-model",related:"chtml-rel",bindings:"chtml-bindings",namespace:"chtml-ns",superrole:"chtml-role",subrole:"chtml-role",nocompose:["nocompose","shadow"],bundle:"chtml-bundle"},tagMap:{jsen:'script[type="text/jsen"]',jsenp:'script[type="text/jsenp"]',bundle:'template[is="chtml-bundle"]',import:"chtml-import"},remodelCallback:null,dataKey:"$",globalParamsAttrs:["related","bindings"],hideDefsheet:!0},zt=function(e,t=null){if(t=t||Kt.context.document){var r;if(e.trim().startsWith("<")){var n=t.createElement("div");n.innerHtml=e,r=n.firstChild}else r=t.querySelector(e);return r}},Jt=function(e,t,r,i=[]){if(i=i.concat([Kt.attrMap.namespace,...Kt.attrMap.nocompose]),t.hasAttribute("norecompose")&&(i=i.concat((t.getAttribute("norecompose")||"*").split(" ").map(e=>e.trim()))),d(Kt.recomposeCallback)){var a=Kt.recomposeCallback(e,t,r,i);if(!1===a)return!1;(s(a)||n(a))&&(i=i.concat(a))}ne([Kt.attrMap.superrole,Kt.attrMap.subrole,"role","class"]).forEach(n=>{var s,a;if(!i.includes(n)&&!i.includes("*")&&(s=e.getAttribute(n))){if(a=t.getAttribute(n))var o="prepend"===r?[s,a]:[a,s];else o=[s];t.setAttribute(n,ne(o.join(" ").split(" ").map(e=>e.trim())).join(" ")),i.push(n)}}),Kt.globalParamsAttrs.map(e=>Kt.attrMap[e]).concat("style").forEach(n=>{var s,a;if(!i.includes(n)&&!i.includes("*")&&(s=e.getAttribute(n))){if(a=t.getAttribute(n))(o="prepend"===r?[s,a]:[a,s])[0].trim().endsWith(";")||(o[0]=o[0]+";");else var o=[s];t.setAttribute(n,o.join(" ")),i.push(n)}});for(var o=0;o<e.attributes.length;o++){var l=e.attributes[o];i.includes(l.name)||i.includes("*")||t.hasAttribute(l.name)||(t.setAttribute(l.name,l.value),i.push(l.name))}if(!i.includes("@cps")&&!i.includes("*")){var h=p((t.shadowRoot||t).children).filter(e=>e.matches(Kt.tagMap.jsenp)),c=p((e.shadowRoot||e).children).filter(e=>e.matches(Kt.tagMap.jsenp));c.length&&(h.length?h[0][r](c[0].textContent):t.prepend(c[0].cloneNode(!0)))}return t},Vt=function(e,t){return t.matches(Kt.tagMap.import)?function(e,t){t=t.cloneNode(!0);var r=e.getAttribute(Kt.attrMap.namespace),n=t.getAttribute(Kt.attrMap.namespace),s=(t.getAttribute(Kt.attrMap.superrole)||"").split(" ").map(e=>e.trim());return t.setAttribute(Kt.attrMap.namespace,r),Jt(e,t,"append"),p((e.shadowRoot||e).children).forEach((e,i)=>{if(!e.matches(Kt.tagMap.jsenp)){e=e.cloneNode(!0);var a=[],o=[];(e.getAttribute(Kt.attrMap.subrole)||"").split(" ").map(e=>e.trim()).forEach(e=>{var t=s.filter(t=>e.startsWith(t+"-"));t.length&&(a.push(t[0]),o.push(e))});var l=Kt.context.CSS?Kt.context.CSS.escape:e=>e;if(a.length){var p,h=a.map(e=>"["+l(Kt.attrMap.superrole)+'~="'+e+'"]'),c=o.map(e=>"["+l(Kt.attrMap.subrole)+'~="'+e+'"]');if(!(t.shadowRoot&&(p=t.shadowRoot.querySelectorAll(c))||1===(p=t.querySelectorAll(c)).length&&p[0].closest(h)===t))throw new Error("Composition Error: Node #"+i+" (at "+r+") must match exactly one targetNode in "+n+"! ("+p.length+" matched)");Jt(p[0],e,"prepend"),p[0].replaceWith(e)}else t.append(e)}}),t}(t,e):Jt(e,t,"prepend")};class Yt{constructor(e,t,r,n=null){this.sources=p(e),this.namespace=p(t),this.getter=r,this.carry=n,this.collections={},this.value}enter(e){return e in this.collections||(this.collections[e]=new Yt(this.sources,this.namespace.concat(e),this.getter,this)),this.collections[e]}leave(){return this.carry}get(){if(!this.value){var e=this.namespace.slice(),t=this.carry?this.carry.get():null;this.sources.forEach((r,n)=>{(t=this.getter.call(null,r,e,t,n))&&(this.value=t)})}return this.value}find(e){for(var t,r,n=e.split("/"),s=this;(r=n.shift())&&(s=s.enter(r));)t=s;var i=t.get();if(i)return i.cloneNode(!0)}}class Zt{constructor(e,t,r=null){this.key=e,this.value=t,this.flag=r}toString(e=null){return this.key+": "+this.value+(this.flag?" "+this.flag:"")}toJsenString(e=!1){var t=(!1!==e&&this.value.trim().startsWith("(")?D.split(this.value,["."]):[this.value]).map(e=>ft.parse(e,[re],{assert:!1})||ft.parse(e));if(t.length===t.filter(e=>e).length)return this.key+(t.length>1||t[0]instanceof ee?t.join("."):"("+t[0].toString()+")");this.error("Malformed argument in the CPS expression: "+this.toString())}static parse(e,t={}){if(e){var r=$e(t);r.limit=1;var n=D.split(e,[":"],r);if(n.length<2)throw new Error("Malformed rule: "+e);var s,i,a=n.shift().trim(),o=D.split(n.shift().trim(),[" "],t);return o.length>1&&Zt.flags.includes(R(o).trim().toLowerCase())&&(i=o.pop().trim().toLowerCase()),s=o.join(" "),new Zt(a,s,i)}}}Zt.flags=["!important","!fallback"];class Gt{constructor(e=[]){this.atRules=e}toString(e=null){return this.atRules.map(t=>["@"+t.name,t.specifiers.join(" "),(t.condition||"").toString(e),"{\r\n\t"+t.body.map(t=>t.toString(e)).join(";\r\n\t")+"\r\n}"].filter(e=>e).join(" ")).join("\r\n")}filter(e,t=!1,r=!1){var n=[];return this.atRules.filter(e).forEach(e=>{var r;t&&(r=e.condition?e.condition.toString(e.name):e.name),r=ft.parse(r),e.body.forEach(t=>{n.push({rule:t,atRuleName:e.name,atRuleCondition:e.condition,atRuleConditionAbs:r,atRuleSpecifiers:e.specifiers})})}),n.reduce((e,t)=>(e.forEach(e=>{if(!e.isDuplicate&&!e.overridden){var r=e.rule.key.toString(),n=e.rule.value.toString(),s=L(n,"(",")")?Q(n,"(",")"):n,i=t.rule.key.toString(),a=t.rule.value.toString(),o=L(a,"(",")")?Q(a,"(",")"):a,l="!fallback"===(e.rule.flag||"").toLowerCase(),p="!important"===(e.rule.flag||"").toLowerCase(),h="!fallback"===(t.rule.flag||"").toLowerCase(),c="!important"===(t.rule.flag||"").toLowerCase();r===i&&(n!==a&&s!==o||p!==c&&l!==h?c||l?e.overridden=!0:(p||h)&&(t.overridden=!0):t.isDuplicate=!0)}}),e.concat([t])),[]),n.filter(e=>!e.isDuplicate&&!e.overridden).map(e=>{var t=e.rule.toJsenString(r);if(e.atRuleConditionAbs)var n="("+e.atRuleConditionAbs+') && "SEPARATOR" ? ('+t+") : return";else n=t;return e.finalRule=ft.parse(n),e})}static parse(e,t={}){e=e.trim();var r=D.split(e,["@"],t).slice(1).map(r=>{for(var n,s=D.split(r.trim(),[" "],t).filter(e=>e.trim()),i=s.shift().trim(),a=[],o=s.pop().trim();s.length&&!s[0].trim().startsWith("(");)a.push(s.shift());if(s.length&&(n=ft.parse(s.join(" ").trim())),!i||!L(o,"{","}"))throw new Error("Malformed @rule: "+e);return{name:i,specifiers:a,condition:n,body:o=D.split(Q(o,"{","}"),[";"],t).filter(e=>e.trim()).map(e=>Zt.parse(e.trim()))}});if(r.length)return new Gt(r)}}var Xt=function(...e){return M(e,(e,t,r)=>{if(n(t)&&n(r)){if(-1===t.indexOf(r[e]))return!0}else if(!(e in t))return!0})};const er={std:{html:{type:["#sectioning-root"],model:["head","body"],singleton:!0},caption:{model:["#flow","!table"],singleton:!0},col:{model:["#nothing"]},colgroup:{model:[{"colgroup[span]":["#nothing"]},{":not(colgroup[span])":["col","template"]}],singleton:!0},dd:{model:["#flow"],implicitRole:"definition"},dt:{model:["#flow","!#heading","!#sectioning","!header","!footer"],implicitRole:"term"},figcaption:{model:["#flow"],singleton:!0},head:{model:["#metadata"],singleton:!0},legend:{model:["#phrasing"],singleton:!0},li:{model:["#flow"],implicitRole:"listitem"},optgroup:{model:["option","#script-supporting"],implicitRole:"group"},option:{model:[{"option[label][value]":["#nothing"]},{"option[label]:not(option[value])":["#text"]},{":not(option[label])":["#text"]}]},param:{model:["#nothing"]},rp:{model:["#text"]},rt:{model:["#phrasing"]},source:{model:["#nothing"]},summary:{model:["#phrasing","#heading"],singleton:!0},track:{model:["#nothing"]},tbody:{model:["#script-supporting","tr"]},td:{model:["#flow","!#heading","!#sectioning","!header","!footer"]},tfoot:{model:["tr","#script-supporting"],singleton:!0},thead:{model:["tr","#script-supporting"],singleton:!0},tr:{model:["#script-supporting","td","th"]},a:{type:["#flow","#phrasing",{"a[href]":["#interactive","#palpable"]}],model:["#transparent","!#interactive","!a"]},abbr:{type:["#flow","#palpable","#phrasing"],model:["#phrasing"]},address:{type:["#flow","#palpable"],model:["#flow","!#heading","!#sectioning","!header","!footer","!address"]},area:{type:["#flow","#phrasing"],model:["#nothing"]},article:{type:["#flow","#palpable","#sectioning-content"],model:["#flow"],implicitRole:"article",acceptableRoles:["application","article","document","main"]},aside:{type:["#flow","#palpable","#sectioning-content"],model:["#flow"],implicitRole:"complementary",acceptableRoles:["complementary","note","search"]},audio:{type:["#embedded","#flow","#phrasing",{"audio[controls]":["#interactive","#palpable"]}],model:["#transparent","!#media","track",{":not(audio[src])":["source"]}]},b:{type:["#flow","#palpable","#phrasing"],model:["#phrasing"]},base:{type:["#metadata"],model:["#nothing"],singleton:!0},bdi:{type:["#flow","#palpable","#phrasing"],model:["#phrasing"]},bdo:{type:["#flow","#palpable","#phrasing"],model:["#phrasing"]},blockquote:{type:["#flow","#palpable","#sectioning-root"],model:["#flow"]},body:{type:["#sectioning-root"],model:["#flow","@banner","@contentinfo","@complementary","@main"],singleton:!0},br:{type:["#flow","#phrasing"],model:["#nothing"]},button:{type:["#flow","#interactive","#palpable","#phrasing"],model:["#phrasing","!#interactive"]},canvas:{type:["#embedded","#flow","#palpable","#phrasing"],model:["#transparent","!#interactive","a","img[usemap]","button",'input[type="button"]','input[type="radio"]','input[type="checkbox"]',"select[multiple]","select[size>=1]","[tabindex]!#interactive"]},cite:{type:["#flow","#palpable","#phrasing"],model:["#phrasing"]},code:{type:["#flow","#palpable","#phrasing"],model:["#phrasing"]},data:{type:["#flow","#palpable","#phrasing"],model:["#phrasing"]},datalist:{type:["#flow","#phrasing"],model:["#phrasing","#script-supporting","option"]},del:{type:["#flow","#phrasing"],model:["#transparent"]},details:{type:["#flow","#interactive","#palpable","#sectioning-root"],model:["#flow","summary"]},dfn:{type:["#flow","#palpable","#phrasing"],model:["#phrasing","!dfn"],implicitRole:"term"},dialog:{type:["#flow","#sectioning-root"],model:["#flow"],implicitRole:"dialog"},div:{type:["#flow","#palpable"],model:[{"dl > div":["dt","dd"]},{":not(dl > div)":["#flow"]}]},dl:{type:["#flow"],model:["#script-supporting","dl","dt","div"]},em:{type:["#flow","#palpable","#phrasing"],model:["#phrasing"]},embed:{type:["#embedded","#flow","#phrasing","#interactive","#palpable"],model:["#nothing"]},fieldset:{type:["#flow","#sectioning-root","#palpable"],model:["legend","#flow"]},figure:{type:["#flow","#sectioning-root","#palpable"],model:["#flow","figcaption"],implicitRole:"figure"},footer:{type:["#flow","#palpable"],model:["#flow","!header","!footer"],acceptableRoles:["contentinfo"],singleton:!0},form:{type:["#flow","#palpable"],model:["#flow","!form"]},h1:{type:["#flow","#heading","#palpable"],model:["#phrasing"],implicitRole:"heading"},h2:{type:["#flow","#heading","#palpable"],model:["#phrasing"],implicitRole:"heading"},h3:{type:["#flow","#heading","#palpable"],model:["#phrasing"],implicitRole:"heading"},h4:{type:["#flow","#heading","#palpable"],model:["#phrasing"],implicitRole:"heading"},h5:{type:["#flow","#heading","#palpable"],model:["#phrasing"],implicitRole:"heading"},h6:{type:["#flow","#heading","#palpable"],model:["#phrasing"],implicitRole:"heading"},header:{type:["#flow","#palpable"],model:["#flow","!header","!footer"],acceptableRoles:["banner"],singleton:!0},hgroup:{type:["#flow","#heading","#palpable"],model:["h1","h2","h3","h4","h5","h6","#script-supporting"]},hr:{type:["#flow"],model:["#nothing"],implicitRole:"separator"},i:{type:["#flow","#palpable","#phrasing"],model:["#phrasing"]},iframe:{type:["#embedded","#flow","#phrasing","#interactive","#palpable"],model:["#nothing"]},img:{type:["#embedded","#flow","#phrasing",{"img[usemap]":["#interactive","#palpable"]}],model:["#nothing"]},input:{type:["#flow","#phrasing",{'input:not([type!="hidden"])':["#interactive","#palpable"]}],model:["#nothing"]},ins:{type:["#flow","#phrasing","#palpable"],model:["#transparent"]},kbd:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},label:{type:["#flow","#phrasing","#interactive","#palpable"],model:["#phrasing","!label"]},link:{type:["#metadata",{"body link":["#flow","#phrasing"]}],model:["#nothing"]},main:{type:["#flow","#palpable"],model:["#flow"],implicitRole:"main",singleton:!0},map:{type:["#flow","#phrasing","#palpable"],model:["#transparent"]},mark:{type:["#flow","#phrasing","#palpable"],model:["#transparent"]},math:{type:["#embedded","#flow","#phrasing","#palpable"],model:[]},menu:{type:["#flow",{":contains(> li)":["#palpable"]}],model:["#script-supporting","li"],implicitRole:"list"},meta:{type:["#metadata",{"meta[itemprop]":["#flow","#phrasing"]}],model:["#nothing"],names:["application-name","author","description","generator","keywords","referrer","theme-color"]},meter:{type:["#flow","#labelable","#phrasing","#palpable"],model:["#phrasing","!meter"]},nav:{type:["#flow","#sectioning-content","#palpable"],model:["#flow"],implicitRole:"navigation",acceptableRoles:["navigation"]},noscript:{type:["#metadata","#flow","#phrasing"],model:[{"head link":["style","meta","link"]},{":not(head link)":["#transparent","!noscript"]}]},object:{type:["#embedded","#flow","#phrasing",{"object[usemap]":["#interactive","#palpable"]}],model:["#transparent","param"]},ol:{type:["#flow",{":contains(> li)":["#palpable"]}],model:["#script-supporting","li"],implicitRole:"list"},output:{type:["#flow","#labelable","#phrasing","#palpable"],model:["#phrasing","!meter"]},p:{type:["#flow","#palpable"],model:["#phrasing"]},picture:{type:["#embedded","#flow","#phrasing"],model:["source","img","#acript-supporting"]},pre:{type:["#flow","#palpable"],model:["#phrasing"]},progress:{type:["#flow","#labelable","#phrasing","#palpable"],model:["#phrasing","!progress"]},q:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},ruby:{type:["#flow","#phrasing","#palpable"],model:["rp","rt"]},s:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},samp:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},script:{type:["#flow","#metadata","#phrasing","#acript-supporting"],model:[{"script[src]":[]}]},section:{type:["#flow","#sectioning-content","#palpable"],model:["#flow"],implicitRole:"region",acceptableRoles:["alert","alertdialog","application","contentinfo","dialog","document","log","main","marquee","region","search","status"]},select:{type:["#flow","#interactive","#labelable","#phrasing","#palpable"],model:["option","optgroup","#acript-supporting"]},slot:{type:["#flow","#phrasing"],model:["#transparent"]},small:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},span:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},strong:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},style:{type:["#metadata"],model:["#text"]},sub:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},sup:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},svg:{type:["#embedded","#flow","#phrasing","#palpable"],model:[]},table:{type:["#flow","#palpable"],model:["caption","colgroup","thead","tbody","tr","tfoot","#script-supporting"]},td:{type:["#sectioning-root"],model:["#flow"]},template:{type:["#metadata","#flow","#phrasing","#script-supporting"],model:["#nothing"]},textarea:{type:["#flow","#interactive","#labelable","#phrasing","#palpable"],model:["#text"]},time:{type:["#flow","#phrasing","#palpable"],model:[{"time[datetime]":["#phrasing"]},{":not(time[datetime])":["#text"]}]},title:{type:["#metadata"],model:["#text"],singleton:!0},u:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},ul:{type:["#flow",{":contains(> li)":["#palpable"]}],model:["#script-supporting","li"],implicitRole:"list"},var:{type:["#flow","#phrasing","#palpable"],model:["#phrasing"]},video:{type:["#embedded","#flow","#phrasing",{"video[controls]":["#interactive","#palpable"]}],model:["#transparent","!#media","track",{":not(video[src])":["source"]}]},wbr:{type:["#flow","#phrasing"],model:["#nothing"]}},aria:{banner:{type:["@banner"],singleton:!0},contentinfo:{type:["@contentinfo"],singleton:!0},complementary:{type:["@complementary"],singleton:!0},navigation:{type:["@navigation"],singleton:!0},list:{type:["@list"]},listitem:{type:["@listitem"]}},getContentModelFor(e){var t=e.nodeName.toLowerCase();return er.std[t]?er.expandRules(e,er.std[t].model||[]):[]},getCategoriesFor(e,t=!0){var r=e.nodeName.toLowerCase(),n=er.std[r]||er.aria[r]||{},s=[];if(t&&!e.nodeName.startsWith("#")&&(e.hasAttribute("role")||n.implicitRole))if(e.hasAttribute("role")){e.getAttribute("role").split(" ");e.getAttribute("role").split(" ").forEach(t=>{n&&n.acceptableRoles&&!n.acceptableRoles.includes(t)||(t=t.trim(),s.push("@"+t),er.aria[t]&&er.aria[t].type&&(s=s.concat(er.expandRules(e,er.aria[t].type||[]))))})}else n.implicitRole&&A(s,"@"+n.implicitRole,r);else s=A(er.expandRules(e,n.type||[]),r);return s},assertNodeBelongsInContentModel(e,t){var r,n=e instanceof HTMLElement?er.getContentModelFor(e):e,s=t instanceof HTMLElement?er.getCategoriesFor(t):t;return!We(n,["#nothing","#text"]).length&&(n.forEach(e=>{if(e.startsWith("!")){var t=e.substr(1);s.includes(t)&&(r=!1)}else!1!==r&&s.includes(e)&&(r=!0)}),r&&!0)},assertNodeBelongsInScopeAs(e,t,r=null){for(var n,s=er.getCategoriesFor(e),i=t;!n&&(i=i.parentNode);)We(s,er.getCategoriesFor(i)).length&&er.assertNodeBelongsInContentModel(i,r&&r.type||t)&&(n=i);return n===e},expandRules(e,t){var r=t.reduce((t,r)=>(l(r)?e.matches(Object.keys(r)[0])&&(t=t.concat(Object.values(r)[0])):t.push(r),t),[]);return r.includes("#sectioning-root")&&r.push("#sectioning-content"),r}};var tr=er;class rr{constructor(e,t={}){Object.defineProperty(this,"params",{value:Xt(Kt,t)}),Object.defineProperty(this,"_el",{value:e,enumerable:!0}),Object.defineProperty(this,"el",{value:"#document"===e.nodeName?e.querySelector("html"):e,enumerable:!0});const r=(e.getAttribute(Kt.attrMap.superrole)||"").split(" ").map(e=>e.trim()).filter(e=>e);Object.defineProperty(this,"roles",{value:r,enumerable:!0});const n={};Ut.defineProperty(this,"model",{value:n,enumerable:!0}),Ut.trap(n,(e,t,r,n)=>r(t||this.getNodes(n.query)),{type:"get"});const s=(e.getAttribute(Kt.attrMap.model)||"").split(" ").map(e=>e.trim()).filter(e=>e);Ut.init(this.model,s);const i=(e.getAttribute(Kt.attrMap.related)||"").replace(/\;/g,",");var a=ft.parse("{"+i.trim()+"}").eval();Object.defineProperty(this,"related",{value:a,enumerable:!0}),Object.freeze(this.related)}getNodes(e){return p(e).forEach(e=>{if(e in this.model&&this.model instanceof rr)return this.model[e];var t;((t=this.getRelatedNode(e))||(t=this.getExplicitNode(e))||(t=this.getImplicitNode(e)))&&this.addNode(e,t)}),n(e)?_objFrom(e,this.model):this.model[e]}getRelatedNode(e){var t;if(t=this.related[e]){if(d(t)&&(t=t(this.el,e),!(s(t)||t instanceof Kt.context.HTMLElement)))throw new Error('The callback for node "'+e+'" returned an invalid type.');if(s(t)&&(t=zt(t)),!(t instanceof Kt.context.HTMLElement))throw new Error('"'+e+'" could not be resolved to a valid node instance.');return t}}getExplicitNode(e){if(this.roles&&this.roles.length||(this.roles=(this.el.getAttribute(Kt.attrMap.superrole)||"").replace("  "," ").split(" ")).length){var t=Kt.rolecase?[Kt.rolecase]:this.roles,r=Kt.context.CSS?Kt.context.CSS.escape:e=>e;return t.reduce((t,n)=>{if(!t){var s,i,a="["+r(Kt.attrMap.superrole)+'~="'+n+'"]',o="["+r(Kt.attrMap.subrole)+'~="'+n+"-"+e+'"]';(i=(this.el.shadowRoot||this.el).querySelector(o))&&(this.el.shadowRoot&&(!i.parentNode.closest||!i.parentNode.closest(a))||!this.el.shadowRoot&&i.parentNode&&(s=i.parentNode.closest(a))&&s.isSameNode(this.el))&&(t=i)}return t},null)}}getImplicitNode(e){if(!e.match(/[^a-zA-Z0-9\-]/)){var t=[];tr.aria[e]?t.push({schema:tr.aria[e],selector:['[role="'+e+'"]']}):t.push({schema:tr.std[e]||tr.aria[e],selector:[e,'[role="'+e+'"]']}),v(tr.std,(r,n)=>{n.implicitRole===e&&t.push({schema:n,selector:[r]})});var r=null;return t.forEach(e=>{(this.el.shadowRoot||this.el).querySelectorAll(e.selector.join(",")).forEach(t=>{tr.assertNodeBelongsInScopeAs(this.el,t,e.schema)&&(e.schema&&e.schema.singleton?r=t:r&&!n(r)||(r=r||[]).push(t))})}),r}}addNode(e,t){var r,s=Kt.factory||((e,t)=>new rr(e,t));return n(t)?r=t.map(e=>s(e,this.params)):(r=s(t,this.params),function e(t,r){if(t.parentNode&&Kt.context.MutationObserver){var n=!1;new Kt.context.MutationObserver(e=>{e.forEach(e=>{!n&&p(e.removedNodes).includes(t)&&(n=!0,r())})}).observe(t.parentNode,{childList:!0}),e(t.parentNode,()=>{n||(n=!0,r())})}}(t,()=>{Ut.del(this.model,e)})),Ut.set(this.model,e,r),r}}class nr extends rr{constructor(e,t={}){super(e,t);const r=function(e){var t={roadmap:e};return t.roadmap&&(t.namespace=B(t.roadmap,"//"),t.subnamespace=I(t.roadmap,"//"),t.subnamespace.startsWith("/")&&(t.subnamespace=I(t.subnamespace,"/")),t.subnamespace.endsWith("//")&&-1===t.subnamespace.indexOf("///")&&(t.subnamespace=t.subnamespace+t.namespace+"//")),t}(e.getAttribute(Kt.attrMap.namespace)||"");Object.defineProperty(this,"namespace",{value:r.namespace,enumerable:!0});Ut.defineProperty(this,"bindings",{value:[],enumerable:!0});Ut.observe(this.bindings,(e,t,r)=>{Object.keys(e).forEach(r=>{var n;t[r]&&Ut.unobserve(this,null,null,{tags:[t[r]]}),e[r]&&(!1!==this.autoEval&&e[r].eval(this,{get:Ut.get}),Ut.observe(this,(n=e[r].meta.vars,ne(n.map(e=>B(B(e.toString(),"["),"(")))),(t,n,s)=>{var i=e[r].eval(this,{get:Ut.get});if(!1!==i)return i},{tags:["#binding",e[r]],diff:Kt.diff}))})}),(this.dataBlockScript=p(e.children).filter(e=>e.matches(Kt.tagMap.jsenp))[0])&&(this.rulesheet=Gt.parse((this.dataBlockScript.textContent||"").trim()))||(this.rulesheet=new Gt);var n=this.rulesheet.filter(e=>"bindings"===e.name&&(!e.specifiers.length||e.specifiers.includes(Kt.env)),!0,Kt.ruleChaining),s=Ut.get(this.bindings,"push");n.forEach(e=>{this.autoEval=Kt.initialRendering,s(e.finalRule),this.autoEval=!0}),this.dataBlockScript&&Kt.hideDefsheet&&this.dataBlockScript.remove(),Ut.observe(this,Kt.dataKey,(e,t,n)=>{if(r.subnamespace)return o(e)&&e&&Ut.observe(e,t=>this.remodel(e,r.subnamespace,Kt.remodelCallback),{tags:["#mirror",this]}),o(t)&&t&&Ut.unobserve(t,null,null,{tags:["#mirror",this]}),this.remodel(e,r.subnamespace,Kt.remodelCallback)})}bind(e){return Ut.set(this,Kt.dataKey,e)}unbind(){return Ut.del(this,Kt.dataKey)}remodel(e,t,r=null){var n=new Ut.MutationEvent(this.el,{type:"remodelling"});return ne(Ut.keys(e).concat(Ut.keys(this.model))).forEach(s=>{s=f(s)?parseInt(s):s;var a,o=this.getNodes(s);if(Ut.has(e,s)){var l=!1;if(!o){var p=t.split("//");p[0]+="/"+s;var h=nr.import(p.join("//"));if(h){var c=function(e,t,r=!1,n=!1,s=!1){if(-1===e.indexOf(t))return r?[]:void 0;var a=!0===r?e.length-1:!1===r?1:r,o=s?e.lastIndexOf(t)+1:e.indexOf(t)+1,l=i(t)?[]:e.slice(o,o+a);return n&&l.length<a&&l.length<e.length&&(l=l.concat(e.slice(0,a-l.length))),r?l:l[0]}(Ut.keys(e),s+"",!0).reduce((e,t)=>e||this.getNodes(t),null);c?c.el.before(h):this.el.append(h),o=this.addNode(s,h),l=!0}}o&&(a=d(r)?r(o,Ut.get(e,s),s,l):o.bind(Ut.get(e,s)))}else if(o){var u=()=>{o.destroy(),o.el.remove()};(a=d(r)?r(o,s):o.unbind())instanceof Promise?a.then(u).catch(u):u()}n.response(a)}),n}destroy(){this.bindings.forEach(e=>Ut.unobserve(this,null,null,{tags:["#binding",e]})),this.dataBlockScript&&Kt.hideDefsheet&&this.prepend(this.dataBlockScript)}static init(e,t=[]){Kt.context=e,function(){const e=Kt.context;e.customElements.define(Kt.attrMap.bundle,class extends e.HTMLTemplateElement{attributeChangedCallback(e,t,r){r&&this.load()}load(){var t=this.getAttribute("src");t&&this.content.children.length?console.warn("A CHTML bundle must define only either a remote content or local content! Bundle ignored."):t&&(e.fetch?e.fetch(t).then(e=>e.ok?e.text():Promise.reject(e.statusText)).then(t=>{this.innerHTML=t,this.dispatchEvent(new e.Event("bundleloadsuccess"))}).catch(r=>{console.warn("Error fetching the bundle at "+t+". ("+r+")"),this.dispatchEvent(new e.Event("bundleloaderror"))}):setTimeout(()=>{this.dispatchEvent(new e.Event("bundleloadsuccess"))},0))}static get observedAttributes(){return["src"]}},{extends:"template"})}(),nr.contentLoadedPromise=new Promise(t=>{"complete"!==e.document.readyState?(e.document.addEventListener("DOMContentLoaded",t,!1),e.addEventListener("load",t,!1)):t()}),Kt.bundles=function(e,t=null){var[r,n]=function(e,t){for(var r=[],n=[],s=e.length,i=0;i<s;i++)t(e[i])?r.push(e[i]):n.push(e[i]);return[r,n]}(e,e=>e instanceof Promise);const s=Promise.all(r).then(e=>{n.push(...e),r=[]});var i;t&&t(s);const a=[],o=new Yt(n,[],(e,t,n,s)=>{var l=t.join("/");if(a.includes(l))return o.find(t.slice(0,-1).join("/"));a.push(l),r.length&&!i&&(i=!0,console.warn("Remote bundles are still loading at this time! You should probabbly wrap bundle-dependent code within Chtml.ready(callback[, true/*waitForBundles*/])."));var p=Kt.context.CSS?Kt.context.CSS.escape:e=>e,h=e.content.querySelector("["+p(Kt.attrMap.namespace)+'="'+l+'"]');if(h&&n){try{e.hasAttribute("norecompose")&&(e.getAttribute("norecompose")||"*").split(" ").map(e=>e.trim()),h=Vt(n,h)}catch(e){console.error("[Inheritance error at source #"+s+"]: "+e.message)}return a.pop(),h}return a.pop(),h?h.cloneNode(!0):n?n.cloneNode(!0):null});return o}(t,e=>{nr.loadingBundlesPromise=e,setTimeout(()=>{!function(e){const t=Kt.context;t.customElements.define(Kt.tagMap.import,class extends t.HTMLElement{shouldResolve(){return!this.hasAttribute("ondemand")&&!this.closest("template")&&!this.closest(Kt.tagMap.import+"[ondemand]")}connectedCallback(){this.processed=!1,this.shouldResolve()&&this.resolve()}attributeChangedCallback(e,t,r){this.shouldResolve()&&this.resolve()}resolve(){if(!this.parentNode)return!1;e.then(()=>{var e,t,r=Kt.attrMap.namespace;if((t=B(this.getAttribute(r)||"","//"))&&t!==this.__namespace)if(this.__namespace=t,Kt.bundles&&(e=Kt.bundles.find(t))){var n=Vt(this,e);this.hasAttribute("shadow")?(this.parentNode.shadowRoot||this.parentNode.attachShadow({mode:"open"}),this.parentNode.shadowRoot.append(n),this.remove()):this.replaceWith(n)}else this.innnerText='No element found on the namespace "'+t+'"!'})}static get observedAttributes(){return["ondemand",Kt.attrMap.namespace]}})}(e)},0)})}static ready(e,t=!0){nr.contentLoadedPromise.then(()=>{t?nr.loadingBundlesPromise.then(e):e()})}static from(e,t={},r=!0,n=nr){var i=e;if(s(e)&&!e.trim().startsWith("<")&&-1!==e.indexOf("/")){if(!(i=nr.import(B(e,"//"))))throw new Error('No element found on the namespace "'+e+'"!')}else{if(s(e)&&!(i=zt(e)))throw new Error('Could not resolve the string "'+e+'" to an element!');if(r){var a,o,l,p=i.matches(Kt.tagMap.import);if((a=B(i.getAttribute(Kt.attrMap.namespace)||"","//"))&&(p&&(o=a)||(o=H(a,"/"))&&o.indexOf("/")>-1)&&(l=nr.import(o))){var h=i;i=Vt(l,i),p&&h.replaceWith(i)}else a&&console.warn("Namespace resolution failed: "+a)}}return new n(i,t)}static import(e){if(Kt.bundles)return Kt.bundles.find(e)}}Kt.factory=nr.from;var sr=p(document.querySelectorAll(Kt.tagMap.bundle)).reverse();nr.init(window,sr.map(e=>e.hasAttribute("src")&&!e.content.children.length?new Promise(t=>{e.addEventListener("bundleloadsuccess",()=>t(e)),e.addEventListener("bundleloaderror",()=>t(e))}):e));var ir=nr;window.WebNative||(window.WebNative={}),window.WebNative.Chtml=ir,window.WebNative.Chtml.Reflex=Ut,window.WebNative.Chtml.Jsen=ft}]);
//# sourceMappingURL=main.js.map